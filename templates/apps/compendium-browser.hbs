<div class="xjzl-cb-root">

    {{#if isLoaded}}
    <!-- 1. 顶部 Tab 导航 -->
    <nav class="xjzl-cb-nav">
        {{#each tabs}}
        <button type="button" class="xjzl-cb-tab-btn {{#if (eq ../activeTab this.id)}}active{{/if}}"
            data-action="changeTab" data-tab="{{this.id}}">
            <i class="{{this.icon}}"></i> {{this.label}}
        </button>
        {{/each}}

        <!-- 刷新按钮 (靠右) -->
        <button type="button" data-action="refresh" class="xjzl-cb-tab-btn" style="margin-left: auto;" title="重新读取索引">
            <i class="fas fa-sync-alt"></i>
        </button>
    </nav>

    <div class="xjzl-cb-body">
        <!-- 2. 左侧：筛选器 (Phase 3 开发重点) -->
        <aside class="xjzl-cb-sidebar">
            <div class="xjzl-cb-filter-header">
                <i class="fas fa-filter"></i> 筛选条件
            </div>

            <!-- 这里暂时放一个搜索框 -->
            <div class="form-group">
                <label>名称搜索</label>
                <input type="text" name="search" placeholder="输入名称..." disabled title="下一阶段实现"
                    style="width:100%; background:#111; color:#fff; border:1px solid #444; padding:4px;">
            </div>

            <div class="xjzl-cb-placeholder">
                <p>高级筛选功能<br>正在施工中...</p>
                <p><i class="fas fa-wrench" style="font-size: 2em; color: #444;"></i></p>
            </div>
        </aside>

        <!-- 3. 右侧：结果展示 -->
        <main class="xjzl-cb-content">
            <!-- 统计条 -->
            <div class="xjzl-cb-stats-bar">
                <span>
                    共找到 <strong>{{totalCount}}</strong> 件物品
                    {{#if isClipped}}
                    <span style="color: #ff6400;">(为保障性能，仅显示前 {{displayCount}} 件，请使用筛选)</span>
                    {{/if}}
                </span>
            </div>

            <!-- 物品网格 -->
            <div class="xjzl-cb-grid">
                {{#each items}}
                <div class="xjzl-cb-card" data-uuid="{{this.uuid}}" data-action="openSheet"
                    data-quality="{{this.system.quality}}" draggable="true"
                    data-drag-data='{ "type": "Item", "uuid": "{{this.uuid}}" }'>

                    <img src="{{this.img}}" alt="{{this.name}}" />
                    <div class="xjzl-cb-card-name">{{this.name}}</div>

                    <!-- 如果有 Pack 来源，显示一下 -->
                    {{#if this.packLabel}}
                    <div class="xjzl-cb-pack-label">{{this.packLabel}}</div>
                    {{/if}}
                </div>
                {{/each}}
            </div>
        </main>
    </div>

    {{else}}
    <!-- Loading 界面 -->
    <div class="xjzl-cb-loading">
        <i class="fas fa-circle-notch fa-spin fa-3x" style="color: #ff6400;"></i>
        <p>正在读取江湖图谱，请稍候...</p>
    </div>
    {{/if}}
</div>