<section class="tab scroll-area {{#if (eq tabs.primary 'config')}}active{{/if}}" data-tab="config"
    data-group="primary">

    <div class="xjzl-bg-deco">设</div>

    {{!-- 标题栏 --}}
    <div class="section-title-row">
        <span class="title-text">{{localize "XJZL.Modifier.Label"}}</span>
        <span class="title-line"></span>
        {{!-- 新建按钮 --}}
        <a class="xjzl-btn-seal small" data-action="addGroup">
            <i class="fas fa-plus"></i> {{localize "XJZL.UI.CreateNew"}}
        </a>
    </div>

    <div class="modifiers-list">
        {{#each system.customModifiers as |group i|}}
        <div class="modifier-card {{#unless group.enabled}}disabled{{/unless}}">

            {{!-- A. 组标题 (Header) --}}
            <div class="mod-group-header">
                {{!-- 开关 --}}
                <div class="toggle-col">
                    <input type="checkbox" name="system.customModifiers.{{i}}.enabled" {{checked group.enabled}}
                        data-tooltip="{{localize 'XJZL.Modifier.ToggleGroup'}}" />
                </div>

                {{!-- 名称 --}}
                <div class="name-col">
                    <input type="text" name="system.customModifiers.{{i}}.name" value="{{group.name}}"
                        placeholder="{{localize 'XJZL.Modifier.NamePlaceholder'}}" />
                </div>

                {{!-- 操作：仅保留删除整组 --}}
                <div class="actions-col">
                    <a data-action="deleteGroup" data-index="{{i}}"
                        data-tooltip="{{localize 'XJZL.Modifier.DeleteGroup'}}" class="delete-group-btn">
                        <i class="fas fa-trash"></i>
                    </a>
                </div>
            </div>

            {{!-- B. 组内条目 (Body) --}}
            <div class="mod-group-body">
                {{#each group.changes as |change j|}}
                <div class="change-row">
                    {{!-- Key --}}
                    <div class="key-col" style="position: relative;">
                        {{!-- 隐藏 Input 存储真实值 --}}
                        <input type="hidden" name="system.customModifiers.{{i}}.changes.{{j}}.key"
                            value="{{change.key}}">

                        {{!-- 触发按钮 --}}
                        <button type="button" data-action="openModifierPicker" data-group-index="{{i}}"
                            data-change-index="{{j}}" class="picker-trigger" data-tooltip="{{change.key}}">
                            <!-- 悬停显示 Key -->

                            <span class="label-text" style="{{#unless change.key}}color: #999;{{/unless}}">
                                {{change.displayLabel}}
                            </span>
                            <i class="fas fa-caret-down"></i>
                        </button>
                    </div>

                    {{!-- Value --}}
                    <div class="val-col">
                        <input type="number" name="system.customModifiers.{{i}}.changes.{{j}}.value"
                            value="{{change.value}}" />
                    </div>

                    {{!-- Delete --}}
                    <div class="del-col">
                        <a data-action="deleteChange" data-group-index="{{i}}" data-change-index="{{j}}"
                            class="delete-change">
                            <i class="fas fa-times"></i>
                        </a>
                    </div>
                </div>
                {{/each}}

                {{!-- C. 底部添加按钮 (Footer) --}}
                <div class="mod-group-footer">
                    <a data-action="addChange" data-group-index="{{i}}" class="add-row-btn">
                        <i class="fas fa-plus"></i> {{localize "XJZL.Modifier.AddChange"}}
                    </a>
                </div>
            </div>
        </div>
        {{else}}
        {{!-- 空状态 --}}
        <div class="empty-arts-hint">
            <i class="fas fa-sliders-h"></i> {{localize "XJZL.Modifier.Empty"}}
        </div>
        {{/each}}
    </div>

</section>