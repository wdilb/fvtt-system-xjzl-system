<section class="tab scroll-area {{#if (eq tabs.primary 'stats')}}active{{/if}}" 
         data-tab="stats" 
         data-group="primary">

    {{!-- 1. 顶部：剩余自由点数 --}}
    <div class="xjzl-card" style="margin-bottom: 10px; text-align: center;">
        <h3 class="free-points-header" style="margin:0; padding-bottom:5px;">
            {{localize "XJZL.Stats.FreePoints"}}: 
            <span style="font-size:1.5em; color:var(--xjzl-accent);">{{system.stats.freePoints.total}}</span>
        </h3>
        <div class="xjzl-flex-row xjzl-center">
            <label>初始 (Value): </label>
            <input type="number" name="system.stats.freePoints.value" 
                   value="{{system.stats.freePoints.value}}" 
                   class="xjzl-input" 
                   style="width: 60px;"/>
        </div>
    </div>

    {{!-- 2. 特殊属性：悟性 (Wuxing) - 独立展示，不可分配 --}}
    <div class="xjzl-card" style="margin-bottom: 10px; background: rgba(255,255,255,0.8);">
        <div class="xjzl-card-header">{{localize "XJZL.Stats.Wuxing"}}</div>
        
        <div class="xjzl-flex-row" style="justify-content: space-around; font-size: 1.1em; padding: 5px;">
            <div title="最终值" style="font-weight: bold;">
                总值: <span style="color: var(--xjzl-accent); font-size: 1.3em;">{{system.stats.wuxing.total}}</span>
            </div>
            <div title="基础值">
                基: {{system.stats.wuxing.value}}
            </div>
            <div title="修正值">
                修: {{system.stats.wuxing.mod}}
            </div>
            {{!-- 悟性没有内功加成逻辑，或者你可以根据需要添加 --}}
        </div>
        <div style="text-align: center; font-size: 0.8em; color: #666; margin-top: 5px;">
            * 悟性由先天决定，不可通过自由点数分配。
        </div>
    </div>

    {{!-- 3. 六维属性网格 (排除悟性和自由点数) --}}
    <div class="xjzl-grid-3">
        {{#each system.stats as |stat key|}}
            {{!-- 排除 freePoints 和 wuxing --}}
            {{#if (and (ne key "freePoints") (ne key "wuxing"))}}
            
            <div class="xjzl-card xjzl-flex-col">
                {{!-- 标题修复：使用 capitalize 辅助函数拼接 key --}}
                <div class="xjzl-card-header">
                    {{localize (concat "XJZL.Stats." (capitalize key))}}
                </div>
                
                <div class="xjzl-flex-row" style="justify-content: space-between; font-size: 1.2em; font-weight: bold;">
                    <span>总值:</span>
                    <span style="color: var(--xjzl-accent);">{{stat.total}}</span>
                </div>
                
                <hr style="border-color: #999; width:100%; opacity:0.5;">
                
                <div class="xjzl-grid-2" style="font-size: 0.85em; color: #333;">
                    <div class="xjzl-flex-row" title="{{localize 'XJZL.Stats.Base'}}">
                        <span>基:</span> 
                        <span>{{stat.value}}</span>
                    </div>
                    
                    <div class="xjzl-flex-row" title="{{localize 'XJZL.Stats.Assigned'}}">
                        <span>分:</span> 
                        <input type="number" name="system.stats.{{key}}.assigned" 
                               value="{{stat.assigned}}" 
                               class="xjzl-input"
                               style="width: 40px; height: 20px; font-size: 0.9em;"/>
                    </div>
                    
                    <div class="xjzl-flex-row" title="{{localize 'XJZL.Stats.Mod'}}">
                        <span>修:</span> 
                        <span>{{stat.mod}}</span>
                    </div>
                    
                    <div class="xjzl-flex-row" title="内功加成">
                        <span>内:</span> 
                        <span>{{stat.neigongBonus}}</span>
                    </div>
                </div>
            </div>
            {{/if}}
        {{/each}}
    </div>
</section>