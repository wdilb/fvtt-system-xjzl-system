<div class="xjzl-flex-col scroll-area" style="height: 100%; padding: 5px; gap: 10px; overflow-y: auto;">

    {{!-- 1. 头部信息 --}}
    <header class="xjzl-header">
        <img class="char-portrait" src="{{document.img}}" data-edit="img"
            style="flex:0 0 80px; height:80px; border-radius:4px; margin-right:10px;" />

        <div class="xjzl-flex-col xjzl-grow" style="justify-content: space-between;">
            <input type="text" name="name" value="{{document.name}}" class="xjzl-input"
                style="font-size:1.8em; font-weight:bold; border:none; border-bottom:2px solid #444;" />

            <div class="xjzl-grid-3" style="gap: 5px;">
                <div class="xjzl-flex-col">
                    <label>{{localize "XJZL.Creature.Type"}}</label>
                    <select name="system.info.type">
                        {{selectOptions creatureTypes selected=system.info.type}}
                    </select>
                </div>
                <div class="xjzl-flex-col">
                    <label>{{localize "XJZL.Creature.Difficulty"}}</label>
                    <input type="number" name="system.info.difficulty" value="{{system.info.difficulty}}"
                        class="xjzl-input" />
                </div>
                <div class="xjzl-flex-col">
                    <label>{{localize "XJZL.Equipment.Price"}}</label>
                    <input type="text" name="system.info.price" value="{{system.info.price}}" class="xjzl-input" />
                </div>
            </div>
        </div>
    </header>

    {{!-- 2. 资源条 (体力 & 怒气) --}}
    <div class="xjzl-card" style="padding: 5px;">
        {{!-- 体力 --}}
        <div class="resource-row" style="margin-bottom: 5px;">
            <label style="font-weight:bold; flex:0 0 40px;">{{localize "XJZL.Creature.Tili"}}</label>
            <div class="resource-inputs" style="flex:1; display:flex; gap:5px; align-items:center;">
                <input type="number" name="system.resources.tili.value" value="{{system.resources.tili.value}}"
                    class="xjzl-input" />
                <span>/</span>
                <input type="number" name="system.resources.tili.max" value="{{system.resources.tili.max}}"
                    class="xjzl-input" />
            </div>
        </div>
        <div class="resource-bar-bg" style="height: 8px; background: #333; border-radius: 4px; overflow:hidden;">
            <div style="height:100%; background:#c0392b; width: {{tiliPercent}}%"></div>
        </div>

        {{!-- 怒气 --}}
        <div class="resource-row" style="margin-top: 8px; margin-bottom: 5px;">
            <label style="font-weight:bold; flex:0 0 40px;">{{localize "XJZL.Resources.Rage"}}</label>
            <div class="resource-inputs" style="flex:1; display:flex; gap:5px; align-items:center;">
                <input type="number" name="system.resources.rage.value" value="{{system.resources.rage.value}}"
                    class="xjzl-input" />
                <span style="color:#666;">/ 10</span>
            </div>
        </div>
        <div class="resource-bar-bg" style="height: 6px; background: #333; border-radius: 4px; overflow:hidden;">
            <div
                style="height:100%; background:#f1c40f; width: {{calculatePercentage system.resources.rage.value 10}}%">
            </div>
        </div>
    </div>

    {{!-- 3. 战斗属性 (大方块) --}}
    <div class="xjzl-card">
        <div class="xjzl-card-header">{{localize "XJZL.Combat.Label"}}</div>
        {!-- 使用自定义样式的 Grid --}}
        <div class="creature-combat-grid">

            {{!-- 速度 --}}
            <div class="stat-box">
                <label>{{localize "XJZL.Combat.Speed"}}</label>
                <input type="number" name="system.combat.speed" value="{{system.combat.speed}}" />
            </div>

            {{!-- 命中 --}}
            <div class="stat-box">
                <label>{{localize "XJZL.Creature.Hit"}}</label>
                <input type="number" name="system.combat.hit" value="{{system.combat.hit}}" />
            </div>

            {{!-- 闪避 --}}
            <div class="stat-box">
                <label>{{localize "XJZL.Combat.Dodge"}}</label>
                <input type="number" name="system.combat.dodge" value="{{system.combat.dodge}}" />
            </div>

            {{!-- 防护 (特殊颜色) --}}
            <div class="stat-box protection">
                <label>{{localize "XJZL.Creature.Protection"}}</label>
                <input type="number" name="system.combat.protection" value="{{system.combat.protection}}" />
            </div>
        </div>

        {{!-- 基础伤害 (单独一行) --}}
        <div class="xjzl-flex-row"
            style="margin-top: 8px; align-items: center; justify-content: center; border-top: 1px dashed #ccc; padding-top: 5px;">
            <label style="font-weight:bold; font-size:0.9em; margin-right: 5px;">{{localize
                "XJZL.Creature.DamageBase"}}:</label>
            <input type="number" name="system.combat.damage" value="{{system.combat.damage}}" class="xjzl-input"
                style="width: 60px; text-align: center; border: 1px solid #ccc; background: rgba(0,0,0,0.05); font-weight:bold;" />
        </div>
    </div>

    {{!-- 4. 描述 --}}
    <div class="xjzl-card" style="flex: 1;">
        <label class="xjzl-card-header">{{localize "XJZL.Info.Description"}}</label>
        {{!-- 野兽描述通常较短，直接用 Textarea 即可 --}}
        <textarea name="system.description" class="xjzl-input"
            style="height: 100px; resize: vertical;">{{system.description}}</textarea>
    </div>

    {{!-- 5. 特性与技能 (Abilities) --}}
    <div class="xjzl-card">
        <div class="xjzl-flex-row xjzl-card-header" style="justify-content: space-between;">
            <span>{{localize "XJZL.Creature.Abilities"}}</span>
            <a data-action="addAbility"><i class="fas fa-plus"></i></a>
        </div>

        <div class="xjzl-flex-col" style="gap: 5px;">
            {{#each system.abilities as |ability i|}}
            <div style="border: 1px solid #ccc; padding: 5px; border-radius: 4px; background: rgba(0,0,0,0.02);">
                <div class="xjzl-flex-row" style="margin-bottom: 4px; align-items: center;">
                    <input type="text" name="system.abilities.{{i}}.name" value="{{ability.name}}" class="xjzl-input"
                        style="font-weight: bold; flex: 1;" placeholder="技能名称" />

                    {{!-- 快捷操作 --}}
                    <a data-action="postAbility" data-index="{{i}}" title="发送详情" style="margin: 0 5px; color: #555;"><i
                            class="fas fa-comment"></i></a>
                    <a data-action="deleteAbility" data-index="{{i}}" title="删除" style="color: #999;"><i
                            class="fas fa-trash"></i></a>
                </div>
                <textarea name="system.abilities.{{i}}.description" rows="2" class="xjzl-input"
                    style="font-size: 0.9em; resize: vertical;" placeholder="技能效果...">{{ability.description}}</textarea>
            </div>
            {{else}}
            <div style="text-align: center; color: #999; font-size: 0.9em; padding: 10px;">暂无特性</div>
            {{/each}}
        </div>
    </div>

</div>