<!--暂时的页面，先运行起来-->
{{!-- 注意：不要写 <form> 标签，系统会自动包裹 --}}
{{!-- 最外层包裹一个 div，作为唯一的根元素 --}}
<div class="sheet-content">
    {{!-- 调试：在 F12 控制台打印当前数据 --}}
    {{log "渲染数据:" system}}

    {{!-- 头部 --}}
    <header>
        <img src="{{actor.img}}" data-edit="img" title="{{actor.name}}" class="profile-img"/>
        <div style="flex:1;">
            <label>角色姓名</label>
            <input name="name" type="text" value="{{actor.name}}" placeholder="输入姓名"/>
        </div>
    </header>

    {{!-- 1. 基础属性区域 --}}
    <section class="section-stats">
        <h2 style="border-bottom:1px solid #000">基础属性 (Stats)</h2>
        <div class="grid-2col">
            {{#each system.stats as |stat key|}}
            <div class="stat-box">
                {{!-- 这里的 capitalize 依赖我们之前在 JS 里注册的 Helper --}}
                <label>{{localize (concat "XJZL.Stats." (capitalize key))}}</label>
                
                <div style="display:flex; justify-content:center; gap:5px; align-items:center;">
                    <span>基:</span>
                    <input type="number" name="system.stats.{{key}}.value" value="{{stat.value}}" style="width:40px"/>
                    <span>+ 修: {{stat.mod}}</span>
                </div>
                <div style="font-weight:bold; color:red;">
                    总值: {{stat.total}}
                </div>
            </div>
            {{/each}}
        </div>
    </section>

    {{!-- 2. 资源区域 --}}
    <section class="section-resources" style="margin-top:20px;">
        <h2 style="border-bottom:1px solid #000">核心资源 (Resources)</h2>
        <div class="grid-3col">
            <div class="stat-box">
                <label>气血 (HP)</label>
                <span>{{system.resources.hp.value}} / {{system.resources.hp.max}}</span>
            </div>
            <div class="stat-box">
                <label>内力 (MP)</label>
                <span>{{system.resources.mp.value}} / {{system.resources.mp.max}}</span>
            </div>
            <div class="stat-box">
                <label>酒量 / 体魄</label>
                <input type="text" name="system.resources.alcohol.value" value="{{system.resources.alcohol.value}}" style="width:50px"/>
                <span> / {{system.resources.alcohol.max}}</span>
            </div>
        </div>
    </section>

    {{!-- 3. 战斗面板 --}}
    <section class="section-combat" style="margin-top:20px;">
        <h2 style="border-bottom:1px solid #000">战斗面板 (Derived)</h2>
        <div class="grid-3col">
            <div class="stat-box">
                <label>当前境界</label>
                <b>{{system.cultivation.realmLevel}}</b>
            </div>
            <div class="stat-box">
                <label>外功暴击</label>
                <b>{{system.combat.critWaigongTotal}}</b>
            </div>
            <div class="stat-box">
                <label>外功防御</label>
                <b>{{system.combat.defWaigongTotal}}</b>
            </div>
        </div>
    </section>

    {{!-- 4. 物品区域 --}}
    <section class="section-items" style="margin-top:20px;">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #000">
            <h2>已修内功</h2>
            <a data-action="createItem" data-type="neigong" style="background:#ddd; padding:2px 5px; border-radius:4px;">
                <i class="fas fa-plus"></i> 新建内功
            </a>
        </div>
        
        <ul class="item-list">
            {{#each actor.items as |item|}}
                {{#if (eq item.type "neigong")}}
                <li class="item-entry">
                    <img src="{{item.img}}"/>
                    <div style="flex:1;">
                        <h4 style="margin:0; font-weight:bold;">{{item.name}}</h4>
                        <div style="font-size:0.8em; color:#555;">
                            投入: {{item.system.xpInvested}} | 境界: {{item.system.stage}}
                        </div>
                    </div>
                    <div>
                        <a data-action="editItem" data-item-id="{{item._id}}"><i class="fas fa-edit"></i></a>
                        <a data-action="deleteItem" data-item-id="{{item._id}}"><i class="fas fa-trash"></i></a>
                    </div>
                </li>
                {{/if}}
            {{/each}}
        </ul>
    </section>

</div>