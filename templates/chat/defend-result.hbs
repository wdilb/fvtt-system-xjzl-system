<div class="xjzl-chat-card">
    <div class="card-content-wrapper" style="text-align: center;">

        {{!-- 1. 投掷详情 (重构：符合算术逻辑) --}}
        <div class="roll-header" style="pointer-events: none; padding-bottom: 0;">

            {{!-- 第一步：显示基础骰子公式/结果 --}}
            {{!-- 放在最上面，代表"基础值" --}}
            <div class="formula" style="font-size: 1.1em; color: #333; margin-bottom: 2px;">
                {{{rollDisplay}}}
            </div>

            {{!-- 第二步：显示修正值 --}}
            {{!-- 放在中间，代表"加项" --}}
            <div class="label" style="color: #666; font-size: 0.9em; margin-bottom: 5px;">
                {{localize "XJZL.UI.Chat.DefendResult.BonusInfo" kanpo=kanpoBase bonus=bonus}}
            </div>

            {{!-- 装饰：算术分割线 (等号) --}}
            <div style="border-top: 2px solid rgba(0,0,0,0.1); width: 50%; margin: 2px auto 5px auto;"></div>

            {{!-- 第三步：显示最终结果 --}}
            {{!-- 放在最下面，代表"总和" --}}
            <div class="value" title="{{localize 'XJZL.UI.Chat.DefendResult.Total'}}" style="margin-top: 0;">
                {{defTotal}}
            </div>
        </div>

        {{!-- 2. 结果判定 (结果框) --}}
        <div style="margin-top: 10px; font-size:1.2em; font-weight:bold; padding: 8px; border-radius: 4px; 
            {{#if isBroken}} color:#c0392b; background:rgba(192, 57, 43, 0.1); border:1px solid #c0392b;
            {{else}} color:#27ae60; background:rgba(39, 174, 96, 0.1); border:1px solid #27ae60; {{/if}}">

            {{#if isBroken}}
            <i class="fas fa-heart-broken"></i> {{localize "XJZL.UI.Chat.DefendResult.Broken"}}
            {{else}}
            <i class="fas fa-shield-alt"></i> {{localize "XJZL.UI.Chat.DefendResult.Resisted"}}
            {{/if}}
        </div>

        {{!-- 3. 提示文字 --}}
        <div style="font-size:0.8em; color:#666; margin-top:5px; font-style: italic;">
            {{#if isBroken}}
            {{localize "XJZL.UI.Chat.DefendResult.BrokenHint"}}
            {{else}}
            {{localize "XJZL.UI.Chat.DefendResult.ResistedHint"}}
            {{/if}}
        </div>
    </div>
</div>