<div class="xjzl-chat-card damage-card">
    {{!-- 1. 头部信息 --}}
    <header class="card-header" style="border-left: 4px solid #c0392b;">
        <img src="{{img}}" title="{{name}}" />
        <div style="flex:1;">
            <h3 style="color: #2c3e50;">{{name}}</h3>

            {{!-- 状态标签 --}}
            <div style="font-size:0.85em; display:flex; gap:5px; margin-top:2px;">
                {{#if isDead}}
                <span style="background:#000; color:red; padding:1px 4px; border-radius:2px; font-weight:bold;">
                    <i class="fas fa-skull"></i> {{localize "XJZL.Status.Dead"}}
                </span>
                {{else if isDying}}
                <span style="background:#c0392b; color:white; padding:1px 4px; border-radius:2px;">
                    <i class="fas fa-first-aid"></i> {{localize "XJZL.Status.Dying"}}
                </span>
                {{/if}}

                {{#if rageGained}}
                <!-- 修复：加回了 title 提示信息 -->
                <span style="background:#f39c12; color:white; padding:1px 4px; border-radius:2px;"
                    title="{{localize 'XJZL.UI.Chat.DamageCard.RageGainHint'}}">
                    <i class="fas fa-bolt"></i> {{localize "XJZL.UI.Chat.DamageCard.RageGain"}}
                </span>
                {{/if}}
            </div>
        </div>
    </header>

    <div class="card-content-wrapper">
        {{!-- 2. 数值变动 --}}
        {{#if (eq finalDamage 0)}}
        <div style="text-align:center; color:#7f8c8d; font-weight:bold; padding:10px;">
            {{localize "XJZL.UI.Chat.DamageCard.NoDamage"}}
        </div>
        {{else}}
        <div class="card-stats" style="flex-direction: column; align-items: stretch; gap: 5px;">
            {{#if (gt hutiLost 0)}}
            <div style="display:flex; justify-content:space-between;">
                <span>{{localize "XJZL.Resources.Huti"}}</span>
                <span style="color:#16a085; font-weight:bold;">-{{hutiLost}}</span>
            </div>
            {{/if}}

            {{#if (gt hpLost 0)}}
            <div style="display:flex; justify-content:space-between;">
                <!-- 修复：加回了 (HP) 后缀 -->
                <span>{{localize "XJZL.Resources.HP"}} (HP)</span>
                <span style="color:#c0392b; font-weight:bold;">-{{hpLost}}</span>
            </div>
            {{/if}}

            {{#if (gt mpLost 0)}}
            <div style="display:flex; justify-content:space-between;">
                <!-- 修复：加回了 (MP) 后缀 -->
                <span>{{localize "XJZL.Resources.MP"}} (MP)</span>
                <span style="color:#2980b9; font-weight:bold;">-{{mpLost}}</span>
            </div>
            {{/if}}

            {{#if (gt tiliLost 0)}}
            <div style="display:flex; justify-content:space-between; border-top:1px dashed #ccc; padding-top:5px;">
                <!-- 修复：加回了爪子和心碎的图标 -->
                <span><i class="fas fa-paw" style="opacity:0.5;"></i> {{localize "XJZL.Creature.Tili"}}</span>
                <span style="color:#e74c3c; font-weight:bold;">
                    -{{tiliLost}} <i class="fas fa-heart-broken"></i>
                </span>
            </div>
            {{/if}}
        </div>
        {{/if}}

        {{!-- 3. 底部按钮 --}}
        <div class="card-buttons">
            {{#unless isUndone}}
            <button data-action="undoDamage" class="btn-grey">
                <i class="fas fa-undo"></i> {{localize "XJZL.UI.Chat.DamageCard.Undo"}}
            </button>
            {{else}}
            <div style="text-align:center; color:#999; font-size:0.85em; padding:5px;">
                <i class="fas fa-history"></i> {{localize "XJZL.UI.Chat.DamageCard.Undone"}}
            </div>
            {{/unless}}
        </div>
    </div>
</div>