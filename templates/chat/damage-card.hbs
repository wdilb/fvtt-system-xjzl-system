<div class="xjzl-chat-card damage-card">
    {{!-- 1. 头部信息：头像与名字 --}}
    <div style="display:flex; gap:10px; margin-bottom:10px; align-items:flex-start;">
        <img src="{{img}}" style="flex:0 0 50px; height:50px; border:1px solid #000; border-radius:4px; object-fit:cover; background:#333;">
        
        <div style="flex:1;">
            <div style="font-weight:bold; font-size:1.1em; color:#2c3e50; border-bottom:1px solid #ccc; padding-bottom:2px; margin-bottom:4px;">
                {{name}}
            </div>
            
            {{!-- 状态标签 --}}
            <div style="font-size:0.85em; display:flex; gap:5px;">
                {{#if isDead}}
                    <span style="background:#000; color:red; padding:1px 4px; border-radius:3px; font-weight:bold;">
                        <i class="fas fa-skull"></i> {{localize "XJZL.UI.Chat.DamageCard.Death"}}
                    </span>
                {{else if isDying}}
                    <span style="background:#c0392b; color:white; padding:1px 4px; border-radius:3px;">
                        <i class="fas fa-first-aid"></i> {{localize "XJZL.UI.Chat.DamageCard.Dying"}}
                    </span>
                {{/if}}

                {{#if rageGained}}
                    <span style="background:#f39c12; color:white; padding:1px 4px; border-radius:3px;" title="{{localize 'XJZL.UI.Chat.DamageCard.RageGainHint'}}">
                        <i class="fas fa-bolt"></i> {{localize "XJZL.UI.Chat.DamageCard.RageGain"}}
                    </span>
                {{/if}}
            </div>
        </div>
    </div>

    {{!-- 2. 数值变动 --}}
    <div style="background:rgba(0,0,0,0.05); padding:8px; border-radius:4px; border-left:3px solid #c0392b; margin-bottom:8px;">
        {{#if (eq finalDamage 0)}}
            <div style="text-align:center; color:#7f8c8d; font-weight:bold;">{{localize "XJZL.UI.Chat.DamageCard.NoDamage"}}</div>
        {{else}}
            {{#if (gt hutiLost 0)}}
                <div style="display:flex; justify-content:space-between; font-size:0.9em;">
                    <span style="color:#666;">{{localize "XJZL.Resources.Huti"}}</span>
                    <span style="color:#16a085; font-weight:bold;">-{{hutiLost}}</span>
                </div>
            {{/if}}

            {{#if (gt hpLost 0)}}
                <div style="display:flex; justify-content:space-between; font-size:0.9em;">
                    <span style="color:#666;">{{localize "XJZL.Resources.HP"}} (HP)</span>
                    <span style="color:#c0392b; font-weight:bold; font-size:1.1em;">-{{hpLost}}</span>
                </div>
            {{/if}}

            {{#if (gt mpLost 0)}}
                <div style="display:flex; justify-content:space-between; font-size:0.9em;">
                    <span style="color:#666;">{{localize "XJZL.Resources.MP"}} (MP)</span>
                    <span style="color:#2980b9; font-weight:bold;">-{{mpLost}}</span>
                </div>
            {{/if}}
        {{/if}}
    </div>

    {{!-- 3. 底部按钮 --}}
    {{#unless isUndone}}
        <button data-action="undoDamage" style="background:#7f8c8d; color:white; border:none; width:100%;">
            <i class="fas fa-undo"></i> {{localize "XJZL.UI.Chat.DamageCard.Undo"}}
        </button>
    {{else}}
        <div style="text-align:center; font-size:0.85em; color:#999; border:1px dashed #ccc; padding:4px;">
            <i class="fas fa-history"></i> {{localize "XJZL.UI.Chat.DamageCard.Undone"}}
        </div>
    {{/unless}}
</div>