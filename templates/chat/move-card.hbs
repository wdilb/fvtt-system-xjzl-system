<div class="xjzl-chat-card move-card" data-item-id="{{item.id}}" data-move-id="{{move.id}}">

    {{!-- 1. 头部 --}}
    <header class="card-header"
        style="border-bottom: 2px solid var(--xjzl-gold); padding-bottom: 5px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
        <img src="{{move.img}}" width="40" height="40"
            style="border:1px solid #333; background:#000; border-radius: 4px;" />
        <div style="flex: 1;">
            <h3 style="margin: 0; font-weight: 900; border: none; color: #8b0000; font-size: 1.2em;">{{move.name}}</h3>
            <div style="font-size: 0.8em; color: #555;">
                <span style="background: #333; color: #fff; padding: 0 4px; border-radius: 2px;">
                    {{localize (concat "XJZL.Wuxue.Type." move.type)}}
                </span>
                - {{item.name}}
            </div>
        </div>
    </header>

    {{!-- 2. 描述 (可选) --}}
    {{#if move.description}}
    <div class="card-description"
        style="font-style: italic; font-size: 0.9em; color: #444; margin-bottom: 10px; padding: 5px; background: rgba(0,0,0,0.03); border-radius: 4px;">
        {{{move.description}}}
    </div>
    {{/if}}

    {{!-- 3. 命中检定 --}}
    {{#if attackRoll}}
    <div class="card-roll" style="margin-bottom: 10px;">
        {{!-- 加上类名 roll-header 方便 JS 监听点击 --}}
        <div class="roll-header"
            style="background: #eee; padding: 5px; border-radius: 4px; text-align: center; cursor: pointer; border: 1px solid #ccc;">
            <div style="font-size: 0.8em; color: #666;">{{localize "XJZL.UI.Chat.MoveCard.RollHeader" type=damageTypeLabel}}</div>
            <div style="font-size: 1.4em; font-weight: bold; color: #333;">
                {{displayTotal}}
            </div>
            <div style="font-size: 0.7em; color: #888;">
                {{attackRoll.formula}} {{localize "XJZL.UI.Chat.MoveCard.RollHint"}}
            </div>
        </div>

        <div class="dice-tooltip" style="display: none; margin-top: 5px;">
            {{{rollTooltip}}}
        </div>

        {{!-- 目标预判列表 --}}
        {{#if hasTargets}}
        <div style="margin-top: 5px; border-top: 1px dashed #ccc; padding-top: 5px; font-size: 0.85em;">
            {{#each targetsResults as |res id|}}
            <div style="display: flex; justify-content: space-between; padding: 2px 0;">
                <span style="font-weight:bold; color:#444;">{{res.name}}</span>
                <span>
                    <b style="color: {{#if res.isHit}}green{{else}}red{{/if}};">
                        {{res.total}}
                    </b>
                    vs {{res.dodge}}
                    <span style="font-size:0.8em; color:#999;">({{res.stateLabel}})</span>
                </span>
            </div>
            {{/each}}
        </div>
        {{/if}}
    </div>
    {{/if}}

    {{!-- 4. 核心数值展示 (汉化 + 清晰化) --}}
    <div class="card-stats"
        style="display: flex; justify-content: space-around; align-items: center; margin-bottom: 15px; background: #fff; border: 1px dashed #ccc; padding: 5px; border-radius: 4px;">

        {{!-- 伤害 --}}
        {{#if (gt calc.damage 0)}}
        <div style="text-align: center;">
            <div style="font-size: 0.8em; color: #666;">{{localize "XJZL.UI.Chat.MoveCard.Damage"}}</div>
            <div style="font-size: 1.8em; font-weight: 900; color: var(--xjzl-accent); line-height: 1;"
                title="{{calc.breakdown}}">
                {{calc.damage}}
            </div>
        </div>
        {{/if}}

        {{!-- 虚招 --}}
        {{#if (gt calc.feint 0)}}
        <div style="text-align: center;">
            <div style="font-size: 0.8em; color: #666;">{{localize "XJZL.UI.Chat.MoveCard.FeintVal"}}</div>
            <div style="font-size: 1.8em; font-weight: 900; color: #9370db; line-height: 1;"
                title="{{calc.feintBreakdown}}">
                {{calc.feint}}
            </div>
        </div>
        {{/if}}

        {{!-- 消耗 (文字版) --}}
        {{#if (or cost.mp cost.rage cost.hp)}}
        <div style="text-align: left; font-size: 0.85em; color: #555; border-left: 1px solid #eee; padding-left: 10px;">
            {{#if cost.mp}}<div><b style="color:#2b4c7e">{{localize "XJZL.UI.Chat.MoveCard.Cost.MP"}}:</b> {{cost.mp}}</div>{{/if}}
            {{#if cost.rage}}<div><b style="color:#c5a059">{{localize "XJZL.UI.Chat.MoveCard.Cost.Rage"}}:</b> {{cost.rage}}</div>{{/if}}
            {{#if cost.hp}}<div><b style="color:#8b0000">{{localize "XJZL.UI.Chat.MoveCard.Cost.HP"}}:</b> {{cost.hp}}</div>{{/if}}
        </div>
        {{/if}}
    </div>

    {{!-- 5. 交互按钮组 (调整顺序) --}}
    <div class="card-buttons" style="display: flex; flex-direction: column; gap: 5px;">

        {{!-- 虚招对抗 (放在上面) --}}
        {{#if isFeint}}
        {{#if showFeintBtn}}
        <button data-action="rollFeintContest" style="background: #483d8b; color: white;">
            <i class="fas fa-dice-d20"></i> {{localize "XJZL.UI.Chat.MoveCard.FeintContest"}}
        </button>
        {{else}}
        {{!-- 如果目标无架招，显示提示信息，或者完全隐藏 --}}
        <div style="text-align:center; font-size:0.8em; color:#666; background:#eee; padding:4px; border-radius:4px;">
            {{localize "XJZL.UI.Chat.MoveCard.NoStanceHint"}}
        </div>
        {{/if}}
        {{/if}}

        {{!-- 伤害应用 (放在下面) --}}
        {{#if (gt calc.damage 0)}}
        {{!-- 删除了特效按钮 --}}
        <button data-action="applyDamage" style="background: var(--xjzl-accent); color: white;" title="{{localize 'XJZL.UI.Chat.MoveCard.ApplyDamageTitle'}}">
            <i class="fas fa-tint"></i> {{localize "XJZL.UI.Chat.MoveCard.ApplyDamage"}}
        </button>
        {{/if}}

    </div>
</div>