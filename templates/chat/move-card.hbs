<div class="xjzl-chat-card move-card" data-item-id="{{item.id}}" data-move-id="{{move.id}}">

    {{!-- 1. 头部：招式信息 --}}
    <header class="card-header"
        style="border-bottom: 2px solid var(--xjzl-gold); padding-bottom: 5px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
        <img src="{{move.img}}" width="40" height="40"
            style="border:1px solid #333; background:#000; border-radius: 4px;" />
        <div style="flex: 1;">
            <h3 style="margin: 0; font-weight: 900; border: none; color: #8b0000; font-size: 1.2em;">{{move.name}}</h3>
            <div style="font-size: 0.8em; color: #555; display: flex; justify-content: space-between;">
                <span>{{item.name}}</span>
                <span style="background: #333; color: #fff; padding: 0 4px; border-radius: 2px;">
                    {{#if isStance}}架{{else if isFeint}}虚{{else}}实{{/if}}
                </span>
            </div>
        </div>
    </header>

    {{!-- 2. 描述 (可选，太长可以不显示，或者只显示简述) --}}
    {{#if move.description}}
    <div class="card-description"
        style="font-style: italic; font-size: 0.9em; color: #444; margin-bottom: 10px; padding: 5px; background: rgba(0,0,0,0.05); border-radius: 4px;">
        {{{move.description}}}
    </div>
    {{/if}}

    {{!-- 新增：命中检定结果 --}}
    {{#if attackRoll}}
    <div class="card-roll"
        style="background: #eee; padding: 5px; border-radius: 4px; margin-bottom: 10px; text-align: center;">
        <div style="font-size: 0.8em; color: #666;">{{damageTypeLabel}} - 命中检定</div>
        <div style="font-size: 1.4em; font-weight: bold; color: #333;">
            {{attackRoll.total}}
        </div>
        <div style="font-size: 0.7em; color: #888;">
            {{attackRoll.formula}}
        </div>
    </div>
    {{/if}}

    {{!-- 3. 核心数值展示 --}}
    <div class="card-stats"
        style="display: flex; justify-content: space-around; align-items: center; margin-bottom: 15px; background: #fff; border: 1px dashed #ccc; padding: 5px; border-radius: 4px;">

        {{!-- 伤害 --}}
        {{#if (gt calc.damage 0)}}
        <div style="text-align: center;">
            <div style="font-size: 0.8em; color: #666; text-transform: uppercase;">Damage</div>
            <div style="font-size: 1.8em; font-weight: 900; color: var(--xjzl-accent); line-height: 1;"
                title="{{calc.breakdown}}">
                {{calc.damage}}
            </div>
        </div>
        {{/if}}

        {{!-- 虚招 --}}
        {{#if (gt calc.feint 0)}}
        <div style="text-align: center;">
            <div style="font-size: 0.8em; color: #666; text-transform: uppercase;">Feint</div>
            <div style="font-size: 1.8em; font-weight: 900; color: #9370db; line-height: 1;"
                title="{{calc.feintBreakdown}}">
                {{calc.feint}}
            </div>
        </div>
        {{/if}}

        {{!-- 消耗 --}}
        {{#if (or calc.cost.mp calc.cost.rage calc.cost.hp)}}
        <div
            style="text-align: center; font-size: 0.9em; color: #333; border-left: 1px solid #eee; padding-left: 10px;">
            {{#if calc.cost.mp}}<div><i class="fas fa-bolt" style="color:#88caff"></i> {{calc.cost.mp}}</div>{{/if}}
            {{#if calc.cost.rage}}<div><i class="fas fa-fire" style="color:#ffca88"></i> {{calc.cost.rage}}</div>{{/if}}
            {{#if calc.cost.hp}}<div><i class="fas fa-heart" style="color:#ff8888"></i> {{calc.cost.hp}}</div>{{/if}}
        </div>
        {{/if}}
    </div>

    {{!-- 4. 交互按钮组 --}}
    <div class="card-buttons" style="display: flex; flex-direction: column; gap: 5px;">

        {{!-- 架招 --}}
        {{#if isStance}}
        <button data-action="applyStance" style="background: #444; color: white;">
            <i class="fas fa-shield-alt"></i> 开启架招姿态
        </button>
        {{/if}}

        {{!-- 伤害类 --}}
        {{#if (gt calc.damage 0)}}
        <div style="display: flex; gap: 5px;">
            <button data-action="applyDamage" style="flex: 2; background: var(--xjzl-accent); color: white;">
                <i class="fas fa-tint"></i> 应用伤害
            </button>
            <button data-action="applyEffects" style="flex: 1; background: #333; color: white;" title="给目标附加招式特效">
                <i class="fas fa-bolt"></i> 特效
            </button>
        </div>
        {{/if}}

        {{!-- 虚招 --}}
        {{#if isFeint}}
        <button data-action="rollFeintContest" style="background: #483d8b; color: white;">
            <i class="fas fa-dice-d20"></i> 虚招对抗检定
        </button>
        {{/if}}

    </div>
</div>