<section class="scroll-area" style="padding: 10px;">
    
    {{!-- 全局描述 --}}
    <div class="xjzl-card" style="margin-bottom: 15px;">
        <label class="xjzl-card-header">{{localize "XJZL.Item.Description"}}</label>
        <prose-mirror name="system.description" data-document-u-u-i-d="{{document.uuid}}" value="{{system.description}}" 
                      style="min-height: 100px;"></prose-mirror>
    </div>

    {{!-- 章节列表头部 --}}
    <div class="xjzl-flex-row" style="justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3 style="margin:0; border:none;">
            {{localize "XJZL.ArtBook.Chapters"}} 
            <span style="font-size: 0.8em; color: #666; font-weight: normal;">(共 {{totalLevelReward}} 等级奖励)</span>
        </h3>
        <button type="button" data-action="addChapter" style="width: auto; padding: 0 10px;">
            <i class="fas fa-plus"></i> 添加篇章
        </button>
    </div>

    {{!-- 章节循环 --}}
    <div class="xjzl-flex-col" style="gap: 10px;">
        {{#each system.chapters as |chapter i|}}
        <div class="xjzl-card" style="padding: 5px; background: rgba(255,255,255,0.8);">
            
            {{!-- 章节标题栏 --}}
            <div class="xjzl-flex-row" style="border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-bottom: 8px;">
                <img src="{{chapter.img}}" width="24" height="24" style="border:1px solid #000; margin-right: 5px;"/>
                <input type="text" name="system.chapters.{{i}}.name" value="{{chapter.name}}" 
                       class="xjzl-input" style="font-weight:bold; flex:1; text-align:left;" placeholder="篇章名称"/>
                
                <a data-action="deleteChapter" data-idx="{{i}}" style="color:#999; margin-left: 8px;" title="删除">
                    <i class="fas fa-trash"></i>
                </a>
            </div>

            {{!-- 章节内容：两列布局 --}}
            <div class="xjzl-grid-2" style="align-items: start;">
                
                {{!-- 左侧：数值配置 --}}
                <div class="xjzl-flex-col" style="gap: 5px;">
                    {{!-- 消耗 --}}
                    <div class="xjzl-flex-row">
                        <label>{{localize "XJZL.ArtBook.ChapterCost"}}</label>
                        <input type="number" name="system.chapters.{{i}}.cost" value="{{chapter.cost}}" 
                               class="xjzl-input" min="1"/>
                    </div>
                    
                    <hr style="margin: 2px 0; border-color: #eee;">
                    
                    {{!-- 奖励 --}}
                    <div class="xjzl-flex-row">
                        <label style="color: var(--xjzl-accent);">{{localize "XJZL.ArtBook.RewardLevel"}}</label>
                        <input type="number" name="system.chapters.{{i}}.reward.level" value="{{chapter.reward.level}}" 
                               class="xjzl-input"/>
                    </div>
                    <div class="xjzl-flex-row">
                        <label>{{localize "XJZL.ArtBook.RewardCheck"}}</label>
                        <input type="number" name="system.chapters.{{i}}.reward.check" value="{{chapter.reward.check}}" 
                               class="xjzl-input"/>
                    </div>
                </div>

                {{!-- 右侧：简短描述 (使用 Textarea 即可，不需要富文本) --}}
                <div class="xjzl-flex-col">
                    <label style="font-size: 0.9em; font-weight: bold;">{{localize "XJZL.ArtBook.ChapterDesc"}}</label>
                    <textarea name="system.chapters.{{i}}.description" rows="4" class="xjzl-input" 
                              style="text-align: left; background: rgba(0,0,0,0.03); resize: none;">{{chapter.description}}</textarea>
                </div>
            </div>

        </div>
        {{else}}
        <div style="text-align: center; color: #999; padding: 20px; border: 2px dashed #ddd; border-radius: 6px;">
            点击右上角按钮添加新的篇章
        </div>
        {{/each}}
    </div>

</section>