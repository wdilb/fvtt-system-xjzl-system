<div class="xjzl-flex-col" style="height: 100%;">
  <header class="xjzl-card xjzl-flex-row">
    <img src="{{document.img}}" data-edit="img" width="64" height="64" style="border-radius: 4px; border: 1px solid #000;"/>
    <div class="xjzl-flex-col xjzl-grow">
      <input type="text" name="name" value="{{document.name}}" class="xjzl-input" style="font-size: 1.5em; font-weight: bold;"/>
      <div class="xjzl-flex-row">
        <label>{{localize "XJZL.Neigong.Tier"}}</label>
        <select name="system.tier">
          {{selectOptions (array 1 2 3) selected=system.tier}}
        </select>
        
        <label>{{localize "XJZL.Neigong.Element"}}</label>
        <select name="system.element">
          {{selectOptions (array "yin" "yang" "taiji") selected=system.element}}
        </select>
      </div>
    </div>
  </header>

  <nav class="xjzl-tabs">
    <a class="xjzl-tab-item active" data-tab="config" data-group="primary">
      <i class="fas fa-cogs"></i> {{localize "XJZL.Neigong.StatsConfig"}}
    </a>
  </nav>

  <div class="xjzl-tab-content scroll-area">
    <div class="tab active xjzl-flex-col" data-tab="config" data-group="primary">
      
      {{#each stages as |stage|}}
      <fieldset class="xjzl-card">
        <legend class="xjzl-card-header">{{localize stage.label}} (Stage {{stage.id}})</legend>
        
        <div class="xjzl-grid-3">
            <div class="xjzl-flex-col">
                <label>{{localize "XJZL.Stats.Liliang"}}</label>
                <input type="number" name="system.config.{{stage.key}}.stats.liliang" 
                       value="{{lookup (lookup (lookup ../system.config stage.key) 'stats') 'liliang'}}" class="xjzl-input"/>
            </div>
            <div class="xjzl-flex-col">
                <label>{{localize "XJZL.Stats.Shenfa"}}</label>
                <input type="number" name="system.config.{{stage.key}}.stats.shenfa" 
                       value="{{lookup (lookup (lookup ../system.config stage.key) 'stats') 'shenfa'}}" class="xjzl-input"/>
            </div>
             <div class="xjzl-flex-col">
                <label>{{localize "XJZL.Stats.Tipo"}}</label>
                <input type="number" name="system.config.{{stage.key}}.stats.tipo" 
                       value="{{lookup (lookup (lookup ../system.config stage.key) 'stats') 'tipo'}}" class="xjzl-input"/>
            </div>
            <div class="xjzl-flex-col">
                <label>{{localize "XJZL.Stats.Neixi"}}</label>
                <input type="number" name="system.config.{{stage.key}}.stats.neixi" 
                       value="{{lookup (lookup (lookup ../system.config stage.key) 'stats') 'neixi'}}" class="xjzl-input"/>
            </div>
             <div class="xjzl-flex-col">
                <label>{{localize "XJZL.Stats.Shencai"}}</label>
                <input type="number" name="system.config.{{stage.key}}.stats.shencai" 
                       value="{{lookup (lookup (lookup ../system.config stage.key) 'stats') 'shencai'}}" class="xjzl-input"/>
            </div>
        </div>

        <hr style="border-color: #aaa; opacity: 0.5; margin: 10px 0;">

        <div class="xjzl-flex-col">
            <label>{{localize "XJZL.Neigong.ScriptLabel"}}</label>
            <p style="font-size: 0.8em; color: #555;">{{localize "XJZL.Neigong.ScriptHint"}}</p>
            <textarea name="system.config.{{stage.key}}.script" rows="3" 
                      class="xjzl-input script-editor">{{lookup (lookup ../system.config stage.key) 'script'}}</textarea>
        </div>
      </fieldset>
      {{/each}}
      
    </div>
  </div>
</div>