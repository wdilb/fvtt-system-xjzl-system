<section class="tab xjzl-body xjzl-body-scroll {{#if (eq tabs.primary 'details')}}active{{/if}}" data-tab="details"
    data-group="primary" data-application-part="details">

    {{!-- 背景字装饰 --}}
    <div class="xjzl-bg-deco">{{#if isManual}}{{localize "XJZL.Manual.BgDeco"}}{{else}}{{localize
        "XJZL.Consumable.BgDeco"}}{{/if}}</div>

    {{!-- 1. 秘籍专用区域 --}}
    {{#if isManual}}
    <div class="xjzl-card">
        <h3>{{localize "XJZL.Manual.ContentHeader"}}</h3>

        <label style="display:block; margin-bottom:10px; color:#666;">{{localize "XJZL.Manual.TargetItem"}}</label>

        {{!-- 拖拽区域 --}}
        <div class="manual-drop-zone" style="position: relative;"> {{!-- 加 relative 定位 --}}
            {{#if system.learnItemUuid}}
            <div style="font-size: 1.5em; font-weight: bold; color: var(--c-theme-main);">
                <i class="fas fa-book-open"></i> {{targetItemName}}
            </div>
            <div style="font-size: 0.8em; color: #999; margin-top: 5px; font-family: monospace;">
                {{system.learnItemUuid}}
            </div>

            {{!-- 删除按钮 --}}
            <a data-action="removeManualTarget" title="{{localize 'XJZL.Manual.ClearContent'}}"
                style="position: absolute; top: 10px; right: 10px; color: #999; cursor: pointer;">
                <i class="fas fa-times"></i>
            </a>

            {{else}}
            <i class="fas fa-file-import" style="font-size: 3em;"></i>
            <div style="margin-top: 10px; font-weight: bold;">{{localize "XJZL.Manual.DropHintTitle"}}</div>
            <div class="hint-text">{{localize "XJZL.Manual.DropHintDesc"}}</div>
            {{/if}}

            <input type="text" name="system.learnItemUuid" value="{{system.learnItemUuid}}" style="display:none;" />
        </div>

        <div class="xjzl-flex-row" style="justify-content: center; align-items: center; gap: 10px;">
            <input type="checkbox" name="system.destroyOnUse" {{checked system.destroyOnUse}} id="destroy-check">
            <label for="destroy-check" style="cursor: pointer;">{{localize "XJZL.Manual.Destroy"}}</label>
        </div>
    </div>
    {{/if}}

    {{!-- 2. 消耗品回复量 (使用印章样式) --}}
    {{#if isConsumable}}
    <div class="xjzl-card">
        <h3>{{localize "XJZL.Consumable.Recovery"}}</h3>

        <div class="xjzl-stats-grid" style="grid-template-columns: repeat(3, 1fr);">
            <div class="xjzl-seal-box">
                <label>{{localize "XJZL.Resources.HP"}}</label>
                <input type="number" name="system.recovery.hp" value="{{system.recovery.hp}}">
            </div>
            <div class="xjzl-seal-box">
                <label>{{localize "XJZL.Resources.MP"}}</label>
                <input type="number" name="system.recovery.mp" value="{{system.recovery.mp}}">
            </div>
            <div class="xjzl-seal-box">
                <label>{{localize "XJZL.Resources.Rage"}}</label>
                <input type="number" name="system.recovery.rage" value="{{system.recovery.rage}}">
            </div>
        </div>

        <div style="margin-top: 15px;">
            <label style="font-weight:bold; display:block; margin-bottom:5px;">{{localize
                "XJZL.Consumable.Script"}}</label>
            <textarea name="system.usageScript" class="script-editor"
                placeholder="{{localize 'XJZL.UI.CodePlaceholder'}}">{{system.usageScript}}</textarea>
        </div>
    </div>
    {{/if}}

    {{!-- 3. 通用描述 (ProseMirror 或者 Textarea) --}}
    <div class="xjzl-section-header" style="margin-top: 30px;">
        <span><i class="fas fa-align-left"></i> {{localize "XJZL.Equipment.Description"}}</span>
    </div>

    <div class="xjzl-description-editor">
        <prose-mirror name="system.description" data-document-u-u-i-d="{{document.uuid}}" value="{{system.description}}"
            toggled="false" button="true">
            {{{enrichedDescription}}}
        </prose-mirror>
    </div>

</section>