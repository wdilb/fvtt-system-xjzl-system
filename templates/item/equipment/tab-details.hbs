{{!-- templates/item/equipment/tab-details.hbs --}}
<section class="tab xjzl-body xjzl-body-scroll {{#if (eq tabs.primary 'details')}}active{{/if}}" data-tab="details"
    data-group="primary" data-application-part="details">

    <div class="xjzl-bg-deco">兵</div>

    {{!-- 1. 基础属性 (根据类型差异化布局) --}}
    <div class="xjzl-card">
        <h3>{{localize "XJZL.Equipment.BaseStats"}}</h3>

        {{!-- 武器：属性较多，使用 2x2 网格 --}}
        {{#if isWeapon}}
        <div class="xjzl-grid-2">
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Wuxue.Moves.WeaponType"}}</label>
                <select name="system.type">
                    {{selectOptions choices.weaponTypes selected=system.type}}
                </select>
            </div>
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Wuxue.Moves.WeaponSubtype"}}</label>
                <input type="text" name="system.subtype" value="{{system.subtype}}"
                    placeholder="{{localize 'XJZL.Weapon.SubtypePlaceholder'}}">
            </div>
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Equipment.Damage"}}</label>
                <input type="number" name="system.damage" value="{{system.damage}}">
            </div>
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Equipment.Block"}}</label>
                <input type="number" name="system.block" value="{{system.block}}">
            </div>
        </div>
        {{/if}}

        {{!-- 防具：单属性，居中显示 --}}
        {{#if isArmor}}
        <div style="display: flex; justify-content: center; padding: 10px 0;">
            <div class="xjzl-ink-field" style="width: 70%; flex: 0 0 auto;">
                <label>{{localize "XJZL.Armor.Category"}}</label>
                <select name="system.type" style="text-align: center;">
                    {{selectOptions choices.armorTypes selected=system.type}}
                </select>
            </div>
        </div>
        {{/if}}

        {{!-- 奇珍：单属性，居中显示 --}}
        {{#if isQizhen}}
        <div style="display: flex; justify-content: center; padding: 10px 0;">
            <div class="xjzl-ink-field" style="width: 70%; flex: 0 0 auto;">
                <label>{{localize "XJZL.Equipment.Acupoint"}}</label>
                <div
                    style="font-weight:bold; color:var(--c-theme-main); padding: 5px 0; text-align: center; font-size: 1.2em;">
                    {{acupointLabel}}
                </div>
            </div>
        </div>
        {{/if}}
    </div>

    {{!-- 2. 描述 --}}
    <div class="xjzl-section-header" style="margin-top:20px;">
        <i class="fas fa-align-left"></i> {{localize "XJZL.Equipment.Description"}}
    </div>
    <textarea name="system.description" rows="4">{{system.description}}</textarea>

    {{!-- 3. 脚本列表 --}}
    <div class="xjzl-card script-section" style="margin-top: 20px; padding: 10px;">
        <div class="xjzl-flex-row"
            style="align-items: center; justify-content: space-between; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed var(--c-theme-border);">
            <span
                style="font-family: var(--font-title); font-size: 18px; color: var(--c-theme-main); font-weight: bold;">
                <i class="fas fa-code"></i> {{localize "XJZL.Script.ScriptList"}}
            </span>
            <button type="button" data-action="addScript" class="xjzl-btn-seal"
                style="width:auto; padding: 2px 8px; font-size: 12px; border-width: 1px;">
                <i class="fas fa-plus"></i> {{localize "XJZL.UI.Add"}}
            </button>
        </div>

        <div class="xjzl-flex-col" style="gap: 8px;">
            {{#each system.scripts as |script i|}}
            <div class="xjzl-script-item">
                {{!-- 头部行：图标 | 名称(Flex) | 触发器 | 工具组 --}}
                <div class="script-header-row">
                    <i class="fas fa-scroll script-icon"></i>

                    {{!-- 1. 名称：自动填满空白 --}}
                    <input type="text" name="system.scripts.{{i}}.label" value="{{script.label}}"
                        class="script-name-input" placeholder="{{localize 'XJZL.Script.NamePlaceholder'}}">

                    {{!-- 2. 触发器：固定宽度 --}}
                    <select name="system.scripts.{{i}}.trigger" class="script-trigger-select">
                        {{selectOptions ../scriptTriggerChoices selected=script.trigger localize=false}}
                    </select>

                    {{!-- 3. 工具组：开关 + 删除 --}}
                    <div class="script-tools">
                        <label class="active-toggle" title="{{localize 'XJZL.UI.ToggleEnable'}}">
                            <span class="label-text">On</span>
                            <input type="checkbox" name="system.scripts.{{i}}.active" {{checked script.active}}>
                        </label>

                        <a data-action="deleteScript" data-index="{{i}}" class="delete-btn"
                            title="{{localize 'XJZL.UI.Delete'}}">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>

                {{!-- 代码编辑器：暗色主题，更高 --}}
                <textarea name="system.scripts.{{i}}.script" class="script-editor"
                    placeholder="// JS Code... (e.g. args.actor, args.item)">{{script.script}}</textarea>
            </div>
            {{else}}
            <div style="text-align: center; color: #999; padding: 15px; font-style: italic; font-size: 12px;">
                {{localize "XJZL.Script.EmptyHint"}}
            </div>
            {{/each}}
        </div>
    </div>

</section>