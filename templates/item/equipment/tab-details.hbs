{{!-- templates/item/equipment/tab-details.hbs --}}
<section class="tab xjzl-body xjzl-body-scroll {{#if (eq tabs.primary 'details')}}active{{/if}}" data-tab="details"
    data-group="primary" data-application-part="details">

    <div class="xjzl-bg-deco">兵</div>

    {{!-- 1. 基础属性 (根据类型差异化布局) --}}
    <div class="xjzl-card">
        <h3>基础属性</h3>

        {{!-- 武器：属性较多，使用 2x2 网格 --}}
        {{#if isWeapon}}
        <div class="xjzl-grid-2">
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Wuxue.Moves.WeaponType"}}</label>
                <select name="system.type">
                    {{selectOptions choices.weaponTypes selected=system.type}}
                </select>
            </div>
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Wuxue.Moves.WeaponSubtype"}}</label>
                <input type="text" name="system.subtype" value="{{system.subtype}}" placeholder="如: 重剑">
            </div>
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Equipment.Damage"}}</label>
                <input type="number" name="system.damage" value="{{system.damage}}">
            </div>
            <div class="xjzl-ink-field">
                <label>{{localize "XJZL.Equipment.Block"}}</label>
                <input type="number" name="system.block" value="{{system.block}}">
            </div>
        </div>
        {{/if}}

        {{!-- 防具：单属性，居中显示 --}}
        {{#if isArmor}}
        <div style="display: flex; justify-content: center; padding: 10px 0;">
            <div class="xjzl-ink-field" style="width: 70%; flex: 0 0 auto;">
                <label>{{localize "XJZL.Armor.Category"}}</label>
                <select name="system.type" style="text-align: center;">
                    {{selectOptions choices.armorTypes selected=system.type}}
                </select>
            </div>
        </div>
        {{/if}}

        {{!-- 奇珍：单属性，居中显示 --}}
        {{#if isQizhen}}
        <div style="display: flex; justify-content: center; padding: 10px 0;">
            <div class="xjzl-ink-field" style="width: 70%; flex: 0 0 auto;">
                <label>{{localize "XJZL.Equipment.Acupoint"}}</label>
                <div
                    style="font-weight:bold; color:var(--c-theme-main); padding: 5px 0; text-align: center; font-size: 1.2em;">
                    {{acupointLabel}}
                </div>
            </div>
        </div>
        {{/if}}
    </div>

    {{!-- 2. 描述 --}}
    <div class="xjzl-section-header" style="margin-top:20px;">
        <i class="fas fa-align-left"></i> {{localize "XJZL.Equipment.Description"}}
    </div>
    <textarea name="system.description" rows="4">{{system.description}}</textarea>

    {{!-- 3. 脚本列表 --}}
    <div class="xjzl-card" style="margin-top: 20px;">
        <div class="xjzl-flex-row"
            style="align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 2px solid var(--c-theme-border); padding-bottom: 8px;">
            <span style="font-family: var(--font-title); font-size: 22px; color: var(--c-theme-main);">
                <i class="fas fa-code"></i> {{localize "XJZL.Script.ScriptList"}}
            </span>
            <button type="button" data-action="addScript" class="xjzl-btn-seal"
                style="width:auto; padding: 2px 10px; font-size: 12px; border-width: 1px;">
                <i class="fas fa-plus"></i> 添加
            </button>
        </div>

        <div class="xjzl-flex-col" style="gap: 10px;">
            {{#each system.scripts as |script i|}}
            <div class="xjzl-script-item">
                <div class="xjzl-flex-row" style="gap: 5px; margin-bottom: 5px; align-items: center;">
                    <input type="text" name="system.scripts.{{i}}.label" value="{{script.label}}" class="xjzl-input"
                        style="flex: 2; font-weight: bold; border-bottom: 1px solid #ddd !important;"
                        placeholder="特效名称">

                    <select name="system.scripts.{{i}}.trigger" class="xjzl-input"
                        style="flex: 1.5; border-bottom: 1px solid #ddd !important;">
                        {{selectOptions ../scriptTriggerChoices selected=script.trigger localize=false}}
                    </select>

                    <div style="display:flex; align-items:center; padding:0 5px;" title="是否启用">
                        <input type="checkbox" name="system.scripts.{{i}}.active" {{checked script.active}}>
                    </div>

                    <a data-action="deleteScript" data-index="{{i}}"
                        style="color: #999; cursor: pointer; padding:0 5px;">
                        <i class="fas fa-trash"></i>
                    </a>
                </div>

                <textarea name="system.scripts.{{i}}.script" rows="2" class="script-editor"
                    placeholder="// JavaScript Code...">{{script.script}}</textarea>
            </div>
            {{else}}
            <div style="text-align: center; color: #999; padding: 20px; font-style: italic;">
                暂无特殊脚本
            </div>
            {{/each}}
        </div>
    </div>

</section>