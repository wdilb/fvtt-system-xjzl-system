<section class="xjzl-details-container">
    {{!-- 描述区块 --}}
    <div class="xjzl-section">
        <div class="xjzl-section-header">
            <i class="fas fa-scroll"></i> {{localize "XJZL.Personality.Description"}}
        </div>
        <div class="xjzl-input-wrapper" style="margin-top: 5px;">
            <textarea name="system.description" class="xjzl-textarea-base xjzl-description-text" rows="6"
                placeholder="{{localize 'XJZL.Personality.Placeholder'}}">{{system.description}}</textarea>
        </div>
    </div>

    <div class="xjzl-section" style="margin-top: 20px; border-top: 1px solid #8b7d6b; padding-top: 15px;">
        <div class="xjzl-section-header">
            <i class="fas fa-fist-raised"></i>
            {{#if isEditing}}
            {{localize "XJZL.Personality.ConfigHeaderGM"}}
            {{else}}
            {{localize "XJZL.Personality.ConfigHeaderPlayer"}}
            {{/if}}
            <span class="xjzl-badge">
                {{#if isEditing}}
                {{system.options.length}}/5
                {{else}}
                {{system.chosen.length}}/2
                {{/if}}
            </span>
        </div>

        {{#if isEditing}}
        <div class="xjzl-skills-grid editing">
            {{#each allSkills as |label key|}}
            {{!-- 使用 includes 辅助函数动态添加 active 类名 --}}
            <label class="xjzl-skill-pill {{#if (includes ../system.options key)}}active{{/if}}">
                <input type="checkbox" style="display:none;" data-action="manageOption" data-skill="{{key}}" {{checked
                    (includes ../system.options key)}}>
                {{localize label}}
            </label>
            {{/each}}
        </div>
        {{else}}
        <div class="xjzl-skills-grid playing">
            {{#each availableOptions as |opt|}}
            <div class="xjzl-skill-card {{#if opt.selected}}active{{/if}}" data-action="toggleChoice"
                data-skill="{{opt.key}}">
                <span class="xjzl-skill-name">{{localize opt.label}}</span>
                <span class="xjzl-skill-marker"><i class="fas fa-yin-yang"></i> {{localize
                    "XJZL.Modifier.Suffix.Mod"}}</span>
            </div>
            {{else}}
            <p class="xjzl-empty-hint">{{localize "XJZL.Personality.EmptyHint"}}</p>
            {{/each}}
        </div>
        {{/if}}
    </div>
</section>