<section class="xjzl-body xjzl-body-scroll" data-application-part="details">

    <div class="xjzl-bg-deco">心</div>

    {{!-- 描述 --}}
    <div class="xjzl-section-header">
        <span><i class="fas fa-scroll"></i> {{localize "XJZL.Personality.Description"}}</span>
    </div>

    <prose-mirror name="system.description" data-document-u-u-i-d="{{document.uuid}}" value="{{system.description}}">
        {{{system.description}}}
    </prose-mirror>

    {{!-- 选项配置区域 --}}
    <div class="xjzl-section-header" style="margin-top: 30px;">
        <span>
            <i class="fas fa-fist-raised"></i>
            {{#if isEditing}} GM配置池 {{else}} 玩家选择 {{/if}}
        </span>
        <span class="badge">
            {{#if isEditing}}{{system.options.length}} / 5{{else}}{{system.chosen.length}} / 2{{/if}}
        </span>
    </div>

    {{#if isEditing}}
    {{!-- GM 编辑模式 --}}
    <div class="xjzl-skills-grid editing">
        {{#each allSkills as |label key|}}
        <label class="xjzl-skill-pill {{#if (includes ../system.options key)}}active{{/if}}">
            <input type="checkbox" style="display:none;" data-action="manageOption" data-skill="{{key}}" {{checked
                (includes ../system.options key)}}>
            {{localize label}}
        </label>
        {{/each}}
    </div>
    {{else}}
    {{!-- 玩家选择模式 --}}
    <div class="xjzl-skills-grid playing">
        {{#each availableOptions as |opt|}}
        <div class="xjzl-skill-card {{#if opt.selected}}active{{/if}}" data-action="toggleChoice"
            data-skill="{{opt.key}}">
            <span class="name">{{localize opt.label}}</span>
            <span class="marker"><i class="fas fa-yin-yang"></i> 属性修正</span>
        </div>
        {{else}}
        <div style="grid-column: 1 / -1; text-align: center; color: #999; padding: 20px;">
            {{localize "XJZL.Personality.EmptyHint"}}
        </div>
        {{/each}}
    </div>
    {{/if}}

</section>