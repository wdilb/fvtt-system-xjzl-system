/* styles/sheets/item-equipment.css */

/* =========================================
   1. 局部变量与类型配色 (Type Coloring)
   ========================================= */

/* 默认 / 武器 (Weapon): 锐利寒光 */
.xjzl-window.item.equipment {
  --c-theme-main: #2c3e50;
  /* 深铁灰 */
  --c-theme-light: rgba(44, 62, 80, 0.05);
  --c-theme-border: rgba(44, 62, 80, 0.3);
}

/* 防具 (Armor): 厚重青铜 */
.xjzl-window.item.equipment.type-armor {
  --c-theme-main: #5d4037;
  /* 赭石褐 */
  --c-theme-light: rgba(93, 64, 55, 0.08);
  --c-theme-border: rgba(93, 64, 55, 0.3);
}

/* 奇珍 (Qizhen): 神秘紫金 */
.xjzl-window.item.equipment.type-qizhen {
  --c-theme-main: #6a1b9a;
  /* 绛紫 */
  --c-theme-light: rgba(106, 27, 154, 0.08);
  --c-theme-border: rgba(106, 27, 154, 0.3);
}

/* =========================================
   2. Grid 区域映射 (ApplicationV2)
   ========================================= */
.xjzl-window.item.equipment [data-application-part="header"] {
  grid-column: 1 / 2;
  grid-row: 1 / 2;
}

.xjzl-window.item.equipment [data-application-part="details"],
.xjzl-window.item.equipment [data-application-part="effects"] {
  grid-column: 2 / 3;
  grid-row: 1 / 2;
  height: 100%;
}

.xjzl-window.item.equipment [data-application-part="tabs"] {
  grid-column: 3 / 4;
  grid-row: 1 / 2;
}

/* =========================================
   3. 输入框视觉皮肤 (Visual Skin)
   ========================================= */

/* 1. 去除黑底 */
.xjzl-window.item.equipment input:not([type="checkbox"]),
.xjzl-window.item.equipment select,
.xjzl-window.item.equipment textarea {
  background: transparent !important;
  background-color: transparent !important;
  border: none !important;
  border-bottom: 1px dashed rgba(0, 0, 0, 0.2) !important;
  border-radius: 2px !important;
  color: var(--c-ink-dark) !important;
  box-shadow: none !important;
  font-family: var(--font-serif);
  transition: all 0.2s;
}

/* 2. 头部大标题 */
.xjzl-window.item.equipment .xjzl-sidebar input[name="name"] {
  font-family: var(--font-title);
  font-size: 28px !important;
  text-align: center;
  border-bottom: 2px solid var(--c-theme-main) !important;
  height: 50px !important;
  margin-bottom: 15px;
  color: var(--c-theme-main) !important;
}

/* 3. 小字段边框色 */
.xjzl-window.item.equipment .xjzl-ink-field {
  border-left-color: var(--c-theme-border) !important;
}

/* 4. 聚焦状态 */
.xjzl-window.item.equipment input:focus,
.xjzl-window.item.equipment select:focus,
.xjzl-window.item.equipment textarea:focus {
  background: #fff !important;
  border-bottom: 1px solid var(--c-theme-main) !important;
  outline: none !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
}

/* =========================================
   4. 侧边栏特化 (Sidebar) & 动态品阶 (Ranks)
   ========================================= */

/* --- 基础样式 --- */
.xjzl-window.item.equipment .portrait-wrapper {
  width: 100%;
  max-width: 140px;
  aspect-ratio: 1/1;
  margin: 20px auto;
  border-radius: 4px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  border: 3px solid var(--c-theme-border);
  background: rgba(0, 0, 0, 0.05);
  /* 解决白吃白 */
  overflow: hidden;
  transition: 0.3s;
}

.xjzl-window.item.equipment .portrait-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border: none;
  transform: none;
}

/* --- 品阶配色变量 --- */
.xjzl-window.item.equipment.rank-fan {
  --c-rank: #5f5f5f;
  --c-rank-bg: rgba(0, 0, 0, 0.05);
}

.xjzl-window.item.equipment.rank-tong {
  --c-rank: #b87333;
  --c-rank-bg: rgba(184, 115, 51, 0.1);
}

.xjzl-window.item.equipment.rank-yin {
  --c-rank: #718093;
  --c-rank-bg: rgba(113, 128, 147, 0.1);
}

.xjzl-window.item.equipment.rank-jin {
  --c-rank: #d4af37;
  --c-rank-bg: rgba(212, 175, 55, 0.1);
}

.xjzl-window.item.equipment.rank-yu {
  --c-rank: #2ecc71;
  --c-rank-bg: rgba(46, 204, 113, 0.1);
}

/* --- 应用品阶样式 --- */

/* 1. 头像框 */
.xjzl-window.item.equipment .portrait-wrapper {
  border-color: var(--c-rank) !important;
  background: var(--c-rank-bg) !important;
}

/* 高级特效 */
.xjzl-window.item.equipment.rank-jin .portrait-wrapper,
.xjzl-window.item.equipment.rank-yu .portrait-wrapper {
  box-shadow: 0 0 15px var(--c-rank);
  border-width: 2px;
}

/* 2. 头部标题 */
.xjzl-window.item.equipment .xjzl-sidebar input[name="name"] {
  color: var(--c-rank) !important;
  border-bottom-color: var(--c-rank) !important;
}

/* 3. 导航 Logo */
.xjzl-window.item.equipment .xjzl-nav__logo {
  border-color: var(--c-rank) !important;
  color: var(--c-rank) !important;
  box-shadow: 0 0 10px var(--c-rank-bg) !important;
}

/* 4. 云纹标题 */
.xjzl-window.item.equipment h3 {
  color: var(--c-rank) !important;
}

/* =========================================
   5. 内容区样式
   ========================================= */

/* 标题云纹 */
.xjzl-window.item.equipment h3 {
  font-family: var(--font-title);
  font-size: 26px;
  border-bottom: none !important;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  padding-bottom: 10px;
  margin-top: 10px;
  margin-bottom: 25px;
  color: var(--c-theme-main);
  /* 默认色，会被 rank 覆盖 */
}

.xjzl-window.item.equipment h3::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  max-width: 260px;
  height: 50px;
  background: url('../../assets/ui/header-divider.png') no-repeat center center;
  background-size: 100% 100%;
  opacity: 0.6;
  z-index: -1;
  pointer-events: none;
}

/* 属性 Grid */
.xjzl-window.item.equipment .xjzl-grid-2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

/* 描述文本域 */
.xjzl-window.item.equipment textarea[name="system.description"] {
  width: 100% !important;
  min-height: 150px;
  background: rgba(0, 0, 0, 0.03) !important;
  border: 1px solid var(--c-theme-border) !important;
  border-radius: 4px;
  padding: 10px;
  color: var(--c-ink-dark);
  font-family: var(--font-serif);
  line-height: 1.6;
  resize: vertical;
}

/* =========================================
   6. 脚本列表美化 (Script List) - [已重写]
   ========================================= */

/* 脚本项容器 */
.xjzl-window.item.equipment .xjzl-script-item {
  border: 1px solid var(--c-theme-border) !important;
  background: #fff !important;
  margin-bottom: 8px;
  border-radius: 4px;
  padding: 6px !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

/* 脚本头部 Flex 行 */
.xjzl-window.item.equipment .script-header-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
  width: 100%;
}

/* 图标 */
.xjzl-window.item.equipment .script-icon {
  color: #999;
  font-size: 12px;
  flex: 0 0 auto;
}

/* 1. 脚本名称输入框 (核心：flex:1) */
.xjzl-window.item.equipment input.script-name-input {
  flex: 1;
  font-weight: bold;
  font-size: 13px !important;
  height: 26px !important;
  min-width: 0;
  border-bottom: 1px dashed rgba(0, 0, 0, 0.2) !important;
}

/* 2. 触发器选择框 */
.xjzl-window.item.equipment select.script-trigger-select {
  flex: 0 0 100px;
  /* 固定宽度 */
  height: 26px !important;
  font-size: 11px !important;
  background: rgba(0, 0, 0, 0.03) !important;
  border-bottom: none !important;
  text-align: center;
}

/* 3. 工具组容器 */
.xjzl-window.item.equipment .script-tools {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  gap: 8px;
  padding-left: 6px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
}

/* 激活开关 */
.xjzl-window.item.equipment .active-toggle {
  display: flex;
  align-items: center;
  gap: 2px;
  cursor: pointer;
  font-size: 10px;
  color: #666;
  margin: 0;
}

.xjzl-window.item.equipment .active-toggle input {
  margin: 0;
  height: 14px;
  width: 14px;
}

/* 删除按钮 */
.xjzl-window.item.equipment .script-header-row .delete-btn {
  color: #999;
  cursor: pointer;
  font-size: 12px;
  display: flex;
  align-items: center;
  height: 24px;
}

.xjzl-window.item.equipment .script-header-row .delete-btn:hover {
  color: #c0392b;
  /* 红色高亮 */
}

/* --- 代码编辑器 (暗色模式) --- */
.xjzl-window.item.equipment textarea.script-editor {
  font-family: "Consolas", "Monaco", monospace !important;
  font-size: 12px !important;
  line-height: 1.4;
  background: #2b2b2b !important;
  /* 深色背景 */
  color: #f8f8f2 !important;
  /* 浅色文字 */
  border: 1px solid rgba(0, 0, 0, 0.3) !important;
  border-radius: 3px !important;

  /* 尺寸控制 */
  width: 100%;
  min-height: 100px;
  margin-top: 2px;
  padding: 8px !important;
  box-sizing: border-box;
  resize: vertical;
}

/* 编辑器聚焦特效 */
.xjzl-window.item.equipment textarea.script-editor:focus {
  border-color: var(--c-theme-main) !important;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3) !important;
}

/* =========================================
   XJZL - 装备(Equipment)富文本编辑器样式
   作用域: .xjzl-window.item.equipment
   ========================================= */

/* 1. 外层容器 */
.xjzl-window.item.equipment .xjzl-description-editor {
  position: relative;
  margin-top: 10px;
  padding: 0 2px;
}

/* 2. ProseMirror 组件本体 */
.xjzl-window.item.equipment prose-mirror {
  display: block;
  width: 100%;
  box-sizing: border-box;
  font-family: inherit;
  font-size: 14px;
  line-height: 1.6;
  color: inherit;
  transition: all 0.2s ease-in-out;
}

/* =========================================
   状态 A: 阅读模式
   ========================================= */
.xjzl-window.item.equipment prose-mirror:not([open]) {
  height: auto !important;
  min-height: 80px;
  overflow: visible !important;
  background: transparent;
  border: 1px solid transparent;
  padding: 0 5px;
}

.xjzl-window.item.equipment prose-mirror:not([open]) .editor-content,
.xjzl-window.item.equipment prose-mirror:not([open]) .ProseMirror {
  height: auto !important;
  overflow: visible !important;
  padding: 0;
}

.xjzl-window.item.equipment prose-mirror:not([open]) p {
  margin: 0 0 0.5em 0;
  text-indent: 0;
  text-align: justify;
}

/* =========================================
   状态 B: 编辑模式 (展开)
   ========================================= */
.xjzl-window.item.equipment prose-mirror[open] {
  height: 300px !important;
  display: flex !important;
  flex-direction: column;

  background: rgba(255, 255, 255, 0.95);
  border: 1px solid var(--color-border-light-2);
  border-radius: 4px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
  z-index: 100;

  /* 容器级别强制深色 */
  color: #333 !important;
  text-shadow: none !important;
}

/* 工具栏 */
.xjzl-window.item.equipment prose-mirror[open] .editor-menu {
  flex: 0 0 auto;
  background: #f1ebd8;
  border-bottom: 1px solid #d0c8b6;
  border-radius: 4px 4px 0 0;
  padding: 2px;
  color: #333;
}

/* 内容容器 */
.xjzl-window.item.equipment prose-mirror[open] .editor-container {
  flex: 1;
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
}

/* --- B3. 真正的输入区 (重点修复标题颜色) --- */
.xjzl-window.item.equipment prose-mirror[open] .ProseMirror {
  flex: 1;
  overflow-y: auto;
  padding: 10px 15px;
  height: 100%;

  /* 强制正文黑字 */
  color: #000 !important;
  text-shadow: none !important;
}

/* 修复所有标题 (H1-H6) */
.xjzl-window.item.equipment prose-mirror[open] .ProseMirror :is(h1, h2, h3, h4, h5, h6) {
  color: #111 !important;
  /* 强制黑色 */
  text-shadow: none !important;
  /* 去除阴影 */
  border-bottom-color: #aaa !important;
  /* 修复下划线颜色 */
  font-family: inherit !important;
}

/* 修复加粗等格式 */
.xjzl-window.item.equipment prose-mirror[open] .ProseMirror :is(strong, b, em, i, code) {
  color: #000 !important;
  text-shadow: none !important;
}

/* =========================================
   UI 细节：编辑按钮
   ========================================= */
.xjzl-window.item.equipment prose-mirror:not([open]) .toggle {
  position: absolute;
  top: -28px;
  right: 0;
  background: none;
  border: none;
  cursor: pointer;
  display: block !important;
  visibility: visible !important;
  opacity: 0.8 !important;
  color: var(--color-text-dark-primary);
  z-index: 10;
  padding: 0 5px;
  transition: all 0.2s;
}

.xjzl-window.item.equipment prose-mirror:not([open]) .toggle:hover {
  opacity: 1 !important;
  transform: scale(1.2);
  text-shadow: 0 0 3px currentColor;
}

.xjzl-window.item.equipment prose-mirror[open]>.toggle {
  display: none !important;
}

.xjzl-window.item.equipment prose-mirror[open] .editor-menu button[data-action="save"] {
  color: #333 !important;
  font-weight: bold;
}

.xjzl-window.item.equipment prose-mirror[open] .editor-menu button[data-action="save"]:hover {
  color: #000 !important;
  transform: scale(1.1);
}

/* =========================================
   修复：阅读模式下的文字颜色
   ========================================= */

/* 1. 强制阅读模式下的标题颜色为深黑 */
.xjzl-window.item.equipment prose-mirror:not([open]) :is(h1, h2, h3, h4, h5, h6) {
  color: #222 !important;
  /* 深灰偏黑 */
  text-shadow: none !important;
  /* 去掉发光 */
  border-bottom-color: #ccc !important;
  /* 修复下划线颜色 */
  font-weight: bold !important;
  margin-top: 0.5em;
  margin-bottom: 0.3em;
}

/* 2. 强制阅读模式下的粗体/强调为黑色 */
.xjzl-window.item.equipment prose-mirror:not([open]) :is(strong, b, em, i, code) {
  color: #000 !important;
  text-shadow: none !important;
}

/* 3. 强制普通段落文字颜色 (保险起见) */
.xjzl-window.item.equipment prose-mirror:not([open]) {
  color: #333 !important;
  /* 普通文字深灰 */
}