/* =========================================
   1. Grid 区域映射
   ========================================= */
.xjzl-window.item-neigong [data-application-part="header"] {
    grid-column: 1 / 2;
    grid-row: 1 / 2;
}

.xjzl-window.item-neigong [data-application-part="config"],
.xjzl-window.item-neigong [data-application-part="effects"] {
    grid-column: 2 / 3;
    grid-row: 1 / 2;
    height: 100%;
}

.xjzl-window.item-neigong [data-application-part="tabs"] {
    grid-column: 3 / 4;
    grid-row: 1 / 2;
}

/* =========================================
   2. 输入框视觉皮肤
   ========================================= */
.xjzl-window.item-neigong input,
.xjzl-window.item-neigong select,
.xjzl-window.item-neigong textarea {
    background: transparent !important;
    border: none !important;
    color: var(--c-ink-dark) !important;
    box-shadow: none !important;
}

.xjzl-window.item-neigong input:not([type="checkbox"]),
.xjzl-window.item-neigong select,
.xjzl-window.item-neigong textarea {
    background: rgba(0, 0, 0, 0.02) !important;
    border-bottom: 1px dashed rgba(0, 0, 0, 0.15) !important;
    border-radius: 2px;
    transition: all 0.2s ease;
}

.xjzl-window.item-neigong .xjzl-sidebar input,
.xjzl-window.item-neigong .xjzl-sidebar select,
.xjzl-window.item-neigong .xjzl-sidebar textarea {
    background: transparent !important;
}

.xjzl-window.item-neigong input:hover,
.xjzl-window.item-neigong select:hover,
.xjzl-window.item-neigong textarea:hover {
    background: rgba(0, 0, 0, 0.05) !important;
    border-bottom-color: var(--c-ink-light) !important;
}

.xjzl-window.item-neigong input:focus,
.xjzl-window.item-neigong select:focus,
.xjzl-window.item-neigong textarea:focus {
    background: #fff !important;
    border-bottom: 1px solid var(--c-cinnabar) !important;
    outline: none !important;
    box-shadow: 0 2px 5px rgba(166, 54, 54, 0.1) !important;
}

.xjzl-window.item-neigong select {
    padding-left: 5px;
    cursor: pointer;
}

.xjzl-window.item-neigong select option {
    background-color: var(--c-paper);
    color: var(--c-ink-dark);
}

/* =========================================
   3. 物品图标与动态品阶 (Portrait)
   ========================================= */
.xjzl-window.item-neigong {
    --color-tier-1: #a0a0a0;
    /* 凡 */
    --color-tier-2: #cd7f32;
    /* 地 */
    --color-tier-3: #c5a059;
    /* 天 (沉金) */
}

/* [修复作用域] */
.xjzl-window.item-neigong .xjzl-sidebar .portrait-wrapper {
    width: 100%;
    max-width: 140px;
    aspect-ratio: 1 / 1;
    margin: 20px auto;
    border-radius: 4px;
    position: relative;
    z-index: 1;
    overflow: hidden;
    flex-shrink: 0;
    transition: 0.3s;

    /* [核心修复] 给图片加底色，解决白图标不可见问题 */
    background: rgba(0, 0, 0, 0.05);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

.xjzl-window.item-neigong .xjzl-sidebar .portrait-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: none;
    transform: none;
}

/* 动态边框 - [修复作用域] */
.xjzl-window.item-neigong .xjzl-sidebar.tier-1 .portrait-wrapper {
    border: 3px solid #dcdcdc;
}

.xjzl-window.item-neigong .xjzl-sidebar.tier-2 .portrait-wrapper {
    border: 3px solid var(--color-tier-2);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    background: rgba(205, 127, 50, 0.1);
    /* 地级暖底色 */
}

.xjzl-window.item-neigong .xjzl-sidebar.tier-3 .portrait-wrapper {
    border: 1px solid var(--color-tier-3);
    outline: 2px solid var(--color-tier-3);
    outline-offset: 2px;
    /* 天级玉质底色 */
    background: linear-gradient(135deg, #fffcf5 0%, #f7eecf 100%);
    box-shadow: inset 0 0 10px rgba(197, 160, 89, 0.5), 0 10px 20px rgba(0, 0, 0, 0.3);
}

/* [修复作用域] */
.xjzl-window.item-neigong .title-input {
    font-family: var(--font-title);
    font-size: 28px;
    text-align: center;
    border-bottom-width: 2px !important;
    border-bottom-style: solid !important;
}

.xjzl-window.item-neigong .xjzl-sidebar.tier-1 .title-input {
    border-bottom-color: var(--color-tier-1) !important;
}

.xjzl-window.item-neigong .xjzl-sidebar.tier-2 .title-input {
    border-bottom-color: var(--color-tier-2) !important;
}

.xjzl-window.item-neigong .xjzl-sidebar.tier-3 .title-input {
    border-bottom-color: var(--color-tier-3) !important;
}

/* =========================================
   4. 动态五行配色与云纹标题
   ========================================= */
.xjzl-window.item-neigong {
    --color-element-taiji: #202020;
    --color-element-yin: #3c5a70;
    --color-element-yang: #a63636;
}

/* 确保网格无背景 - [修复作用域] */
.xjzl-window.item-neigong .xjzl-stats-grid {
    background: transparent !important;
    border: none !important;
    padding: 0;
}

/* 1. 调整 H3 容器，给背景图留出空间 - [修复作用域] */
.xjzl-window.item-neigong .xjzl-card h3 {
    font-size: 28px;
    /* 字体再大一点，更有气势 */
    font-weight: bold;
    border-bottom: none !important;

    /* 使用 Flex 居中 */
    display: flex;
    align-items: center;
    justify-content: center;

    position: relative;
    z-index: 1;
    /* 确保文字在图片上面 */

    /* 增加垂直方向的呼吸感 */
    padding-top: 10px;
    padding-bottom: 10px;
    margin-bottom: 20px;
    min-height: 40px;
}

/* 移除旧装饰 */
.xjzl-window.item-neigong .xjzl-card h3::before {
    display: none;
}

/* 2. 调整背景图伪元素：做成居中放大的底板 */
.xjzl-window.item-neigong .xjzl-card h3::after {
    content: "";
    position: absolute;

    /* 居中定位 */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    /* [核心修改] 尺寸收紧 */
    width: 100%;
    max-width: 260px;
    /* 宽度收窄 */
    height: 50px;
    /* 高度压扁，让上下边框贴近文字 */

    background: url('../../assets/ui/header-divider.png') no-repeat center center;

    /* [关键] 强制拉伸填满 260x50 的区域 */
    /* 这样能保证上下边框正好在文字的上方和下方，不会飞太远 */
    background-size: 100% 100%;

    opacity: 1;
    z-index: -1;
    pointer-events: none;
}

/* 太极: 默认 - [修复作用域] */
.xjzl-window.item-neigong .xjzl-body.element-taiji .xjzl-card {
    border-left-color: var(--c-ink-light);
}

.xjzl-window.item-neigong .xjzl-body.element-taiji .xjzl-card h3 {
    color: var(--c-ink-dark);
}

/* 阴: 清冷背景 + 标题变色 */
.xjzl-window.item-neigong .xjzl-body.element-yin .xjzl-card {
    border-left-color: var(--color-element-yin);
    background: linear-gradient(to right, rgba(60, 90, 112, 0.05), transparent);
    border-top: 1px solid rgba(60, 90, 112, 0.1);
    border-bottom: 1px solid rgba(60, 90, 112, 0.1);
    border-right: 1px solid rgba(60, 90, 112, 0.1);
}

.xjzl-window.item-neigong .xjzl-body.element-yin .xjzl-card h3 {
    color: var(--color-element-yin) !important;
}

.xjzl-window.item-neigong .xjzl-body.element-yin .xjzl-seal-box.compact input {
    color: var(--color-element-yin) !important;
}

/* 阳: 温暖背景 + 标题变色 */
.xjzl-window.item-neigong .xjzl-body.element-yang .xjzl-card {
    border-left-color: var(--color-element-yang);
    background: linear-gradient(to right, rgba(166, 54, 54, 0.05), transparent);
    border-top: 1px solid rgba(166, 54, 54, 0.1);
    border-bottom: 1px solid rgba(166, 54, 54, 0.1);
    border-right: 1px solid rgba(166, 54, 54, 0.1);
}

.xjzl-window.item-neigong .xjzl-body.element-yang .xjzl-card h3 {
    color: var(--color-element-yang) !important;
}

.xjzl-window.item-neigong .xjzl-body.element-yang .xjzl-seal-box.compact input {
    color: var(--color-element-yang) !important;
}

/* =========================================
   5. 紧凑型印章
   ========================================= */
/* [修复作用域] */
.xjzl-window.item-neigong .xjzl-seal-box.compact {
    padding: 2px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    background: rgba(255, 255, 255, 0.3);
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    z-index: 1;
}

.xjzl-window.item-neigong .xjzl-seal-box.compact::after {
    pointer-events: none;
}

.xjzl-window.item-neigong .xjzl-seal-box.compact label {
    font-size: 11px;
    margin-bottom: 0;
    color: var(--c-ink-light);
    pointer-events: none;
}

.xjzl-window.item-neigong .xjzl-seal-box.compact input {
    font-size: 20px !important;
    height: 24px;
    padding: 0;
    width: 100%;
    z-index: 2;
    position: relative;
    cursor: text;
    background: transparent !important;
    border-bottom: none !important;
}

/* =========================================
   6. 脚本编辑器
   ========================================= */
/* [修复作用域] */
.xjzl-window.item-neigong textarea.script-editor {
    font-family: "Consolas", "Monaco", monospace !important;
    font-size: 12px !important;
    background: rgba(0, 0, 0, 0.03) !important;
    color: #333 !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    border-radius: 4px;
    padding: 8px;
    line-height: 1.4;
    width: 100%;
    box-sizing: border-box;
    resize: vertical;
    min-height: 60px;
}

.xjzl-window.item-neigong textarea.script-editor:focus {
    background: #fff !important;
    border-color: var(--c-cinnabar) !important;
    box-shadow: 0 0 5px rgba(166, 54, 54, 0.1) !important;
}

/* =========================================
   7. 表格布局
   ========================================= */
/* [修复作用域] */
.xjzl-window.item-neigong .mastery-grid-row {
    display: grid;
    grid-template-columns: 3fr 1fr 2fr 30px;
    gap: 10px;
    align-items: center;
    margin-top: 5px;
}