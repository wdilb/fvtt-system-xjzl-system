/* =========================================================
   通用物品 (General) 物品卡专用样式 - Final Fixed Version
   ========================================================= */

/* 1. 局部变量定义 */
.xjzl-window.item.general {
    /* 通用物品主题色：铁灰/靛蓝 */
    --c-theme-main: #4a5c6a;
    --c-theme-light: rgba(74, 92, 106, 0.1);
    --c-theme-border: rgba(74, 92, 106, 0.3);
}

/* 秘籍 (Manual) 特化配色：古籍黄 */
.xjzl-window.item.general.type-manual {
    --c-theme-main: #8a6d3b;
    --c-theme-light: rgba(138, 109, 59, 0.1);
    --c-theme-border: rgba(138, 109, 59, 0.3);
}

/* =========================================
   2. Grid 区域映射 & Tab 切换修复
   ========================================= */
.xjzl-window.item.general [data-application-part="header"] {
    grid-column: 1 / 2;
    grid-row: 1 / 2;
}

.xjzl-window.item.general [data-application-part="details"],
.xjzl-window.item.general [data-application-part="effects"] {
    grid-column: 2 / 3;
    grid-row: 1 / 2;
    height: 100%;
}

.xjzl-window.item.general [data-application-part="tabs"] {
    grid-column: 3 / 4;
    grid-row: 1 / 2;
}

/* [关键修复] 强制隐藏非激活的 Tab，解决切换点击问题 */
.xjzl-window.item.general .tab {
    display: none;
    height: 100%;
    /* 确保激活时撑满高度 */
    overflow-y: auto;
    /* 内容溢出滚动 */
}

.xjzl-window.item.general .tab.active {
    display: block;
}

/* =========================================
   3. 输入框视觉皮肤 (Visual Skin)
   ========================================= */

/* 1. 针对所有单行输入框：去除黑底，保留虚线 */
.xjzl-window.item.general input:not([type="checkbox"]) {
    background: transparent !important;
    border: none !important;
    border-bottom: 1px dashed rgba(0, 0, 0, 0.2) !important;
    border-radius: 2px !important;
    color: var(--c-ink-dark) !important;
    box-shadow: none !important;
    font-family: var(--font-serif);
    transition: all 0.2s;
}

/* 2. [重点修复] 文本域 (Textarea - 物品描述)：盒子化 */
.xjzl-window.item.general textarea {
    width: 100% !important;
    /* 强制占满宽度 */
    min-height: 150px;
    /* 最小高度 */

    /* 样式：淡色纸张背景，实线边框 */
    background: rgba(0, 0, 0, 0.03) !important;
    border: 1px solid var(--c-theme-border) !important;
    border-radius: 4px !important;

    padding: 10px !important;
    /* 内边距，防止字贴边 */
    color: var(--c-ink-dark) !important;
    font-family: var(--font-serif);
    font-size: 14px;
    line-height: 1.6;
    resize: vertical;
    /* 允许垂直拉伸 */
    box-sizing: border-box;
    /* 防止 padding 撑破宽度 */
}

/* Textarea 聚焦状态 */
.xjzl-window.item.general textarea:focus {
    background: #fff !important;
    border-color: var(--c-theme-main) !important;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.05) !important;
    outline: none !important;
}

/* 3. 头部大标题特殊处理 */
.xjzl-window.item.general .xjzl-sidebar input[name="name"] {
    font-family: var(--font-title);
    font-size: 28px !important;
    text-align: center;
    border-bottom: 2px solid var(--c-theme-main) !important;
    height: 50px !important;
    margin-bottom: 15px;
    color: var(--c-theme-main) !important;
}

/* 4. 下拉框修正 */
.xjzl-window.item.general select {
    background: transparent !important;
    border: none !important;
    border-bottom: 1px dashed rgba(0, 0, 0, 0.2) !important;
    padding-left: 5px;
    cursor: pointer;
    color: var(--c-ink-dark) !important;
}

.xjzl-window.item.general select option {
    background-color: var(--c-paper);
    color: var(--c-ink-dark);
}

/* =========================================
   4. 侧边栏图片 (Sidebar Portrait)
   ========================================= */
.xjzl-window.item.general .portrait-wrapper {
    width: 100%;
    max-width: 140px;
    aspect-ratio: 1/1;
    margin: 20px auto;
    border-radius: 4px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    border: 3px solid var(--c-theme-border);
    background: rgba(0, 0, 0, 0.05);
    overflow: hidden;
}

.xjzl-window.item.general .portrait-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: none;
    transform: none;
}

/* =========================================
   5. 秘籍拖拽区域 (Manual Drop Zone)
   ========================================= */
.manual-drop-zone {
    border: 2px dashed var(--c-theme-border);
    border-radius: 8px;
    padding: 30px 20px;
    text-align: center;
    background: var(--c-theme-light);
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 20px;
}

.manual-drop-zone:hover {
    background: #fff;
    border-color: var(--c-theme-main);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.manual-drop-zone i {
    color: var(--c-theme-main);
    margin-bottom: 10px;
    opacity: 0.8;
}

.manual-drop-zone .hint-text {
    font-size: 12px;
    color: #888;
}

/* =========================================
   6. 脚本编辑器 (Script Editor - 消耗品专用)
   ========================================= */
.xjzl-window.item.general textarea.script-editor {
    font-family: "Consolas", "Monaco", monospace !important;
    font-size: 12px !important;
    background: rgba(0, 0, 0, 0.03) !important;
    color: #333 !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    min-height: 80px;
}

/* =========================================
   7. 标题样式分级 (Header Styles)
   ========================================= */

/* (A) 一级标题 (h3): 使用云纹装饰 (用于消耗品属性、秘籍内容) */
.xjzl-window.item.general h3 {
    font-family: var(--font-title);
    font-size: 26px;
    border-bottom: none !important;

    display: flex;
    justify-content: center;
    align-items: center;

    position: relative;
    padding-bottom: 10px;
    margin-top: 10px;
    margin-bottom: 25px;
    color: var(--c-theme-main);
}

.xjzl-window.item.general h3::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    max-width: 260px;
    height: 50px;
    background: url('../../assets/ui/header-divider.png') no-repeat center center;
    background-size: 100% 100%;
    opacity: 0.6;
    z-index: -1;
    pointer-events: none;
}

/* (B) 二级标题 (.xjzl-section-header): 使用简洁下划线 (用于物品描述) */
.xjzl-window.item.general .xjzl-section-header {
    font-family: var(--font-title);
    font-size: 22px;
    color: var(--c-theme-main);

    /* 简洁风格：实线底部 */
    border-bottom: 2px solid var(--c-theme-border);

    display: flex;
    align-items: center;
    padding-bottom: 5px;
    margin-top: 20px;
    margin-bottom: 10px;
}

/* 移除二级标题的伪元素 (如果有残留) */
.xjzl-window.item.general .xjzl-section-header::after {
    display: none;
}

/* 图标微调 */
.xjzl-window.item.general .xjzl-section-header i {
    margin-right: 8px;
    font-size: 0.9em;
    opacity: 0.8;
}

/* =========================================
   8. 属性印章网格修复 (Stats Grid Fix)
   ========================================= */
.xjzl-window.item.general .xjzl-stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 10px;
    width: 100%;
}

.xjzl-window.item.general .xjzl-seal-box input {
    background: transparent !important;
    border-bottom: none !important;
    font-size: 24px !important;
    font-weight: 900;
    color: var(--c-theme-main) !important;
}

/* =========================================
   9. 动态品级配色系统 (Dynamic Ranks)
   ========================================= */

/* --- 定义颜色变量 --- */
/* 消耗品/杂物 */
.xjzl-window.item.general.rank-fan {
    --c-rank: #5f5f5f;
    --c-rank-bg: rgba(0, 0, 0, 0.05);
}

/* 凡: 铁灰 */
.xjzl-window.item.general.rank-tong {
    --c-rank: #b87333;
    --c-rank-bg: rgba(184, 115, 51, 0.1);
}

/* 铜: 古铜 */
.xjzl-window.item.general.rank-yin {
    --c-rank: #718093;
    --c-rank-bg: rgba(113, 128, 147, 0.1);
}

/* 银: 亮银灰 */
.xjzl-window.item.general.rank-jin {
    --c-rank: #d4af37;
    --c-rank-bg: rgba(212, 175, 55, 0.1);
}

/* 金: 奢华金 */
.xjzl-window.item.general.rank-yu {
    --c-rank: #2ecc71;
    --c-rank-bg: rgba(46, 204, 113, 0.1);
}

/* 玉: 翡翠绿 */

/* 秘籍 */
.xjzl-window.item.general.rank-ren {
    --c-rank: #7f8c8d;
    --c-rank-bg: rgba(127, 140, 141, 0.1);
}

/* 人: 墨灰 */
.xjzl-window.item.general.rank-di {
    --c-rank: #8d6e63;
    --c-rank-bg: rgba(141, 110, 99, 0.1);
}

/* 地: 大地褐 */
.xjzl-window.item.general.rank-tian {
    --c-rank: #ffa502;
    --c-rank-bg: rgba(255, 165, 2, 0.1);
}

/* 天: 皇室金 */


/* --- 应用配色 --- */

/* 1. 头像框 (Portrait) */
.xjzl-window.item.general .portrait-wrapper {
    border-color: var(--c-rank) !important;
    background: var(--c-rank-bg) !important;
    transition: 0.3s;
}

/* 高级物品特效 (金/玉/天) */
.xjzl-window.item.general.rank-jin .portrait-wrapper,
.xjzl-window.item.general.rank-yu .portrait-wrapper,
.xjzl-window.item.general.rank-tian .portrait-wrapper {
    box-shadow: 0 0 15px var(--c-rank);
    /* 外发光 */
    border-width: 2px;
}

/* 2. 头部名称输入框 (Title Input) */
.xjzl-window.item.general .xjzl-sidebar input[name="name"] {
    color: var(--c-rank) !important;
    border-bottom-color: var(--c-rank) !important;
}

/* 3. 导航栏 Logo (Nav Logo) */
.xjzl-window.item.general .xjzl-nav__logo {
    color: var(--c-rank) !important;
    border-color: var(--c-rank) !important;
    box-shadow: 0 0 10px var(--c-rank-bg) !important;
}

/* 4. 中间云纹标题 (Cloud Header) */
.xjzl-window.item.general h3 {
    color: var(--c-rank) !important;
}

/* 5. 秘籍拖拽区 (Drop Zone) */
.xjzl-window.item.general .manual-drop-zone i {
    color: var(--c-rank) !important;
}

.xjzl-window.item.general .manual-drop-zone:hover {
    border-color: var(--c-rank) !important;
    box-shadow: inset 0 0 10px var(--c-rank-bg);
}

/* 6. 特殊光效动画 (针对 玉 & 天) */
@keyframes jade-pulse {
    0% {
        box-shadow: 0 0 5px var(--c-rank);
    }

    100% {
        box-shadow: 0 0 15px var(--c-rank), inset 0 0 10px rgba(255, 255, 255, 0.5);
    }
}

.xjzl-window.item.general.rank-yu .portrait-wrapper,
.xjzl-window.item.general.rank-tian .portrait-wrapper {
    animation: jade-pulse 3s infinite alternate;
}