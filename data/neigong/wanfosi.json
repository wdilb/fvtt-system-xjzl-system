[
    {
        "name": "《禅意功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 1,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>万佛寺入门内功心法，六祖慧能言：“无障无碍，处于一切善恶境界，心念不起，名为坐，内见自性不动，名为禅。”修之体魄强健，舒经活血。</p>",
            "requirement": "悟性需求: 1",
            "automationNote": "完全自动化。通过passive脚本修改regenHpAttack实现出招回血。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 5,
                        "shenfa": 2,
                        "tipo": 7,
                        "neixi": 1,
                        "qigan": 1,
                        "shencai": 2
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 11,
                        "shenfa": 4,
                        "tipo": 12,
                        "neixi": 3,
                        "qigan": 3,
                        "shencai": 3
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 5,
                        "tipo": 20,
                        "neixi": 5,
                        "qigan": 5,
                        "shencai": 4
                    },
                    "description": "<p>圆满运功特效：每次出招后回复5点气血。</p><p>修满特效：气血+10，内力+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "出招回血",
                            "trigger": "passive",
                            "script": "if (args.actor) args.actor.xjzlStatuses.regenHpAttack = (args.actor.xjzlStatuses.regenHpAttack || 0) + 5;",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 10
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《阿含功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 2,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>又称“阿罗汉神功”，七十二绝技之一，此功不讲法门，只求领悟，以意练气，变幻莫测。</p>",
            "requirement": "悟性需求: 4",
            "automationNote": "基础属性自动化。诵经回复效果需玩家在进行佛法检定时手动处理（因为系统无法自动判定'诵经'行为）。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 10,
                        "tipo": 10,
                        "neixi": 8,
                        "qigan": 4,
                        "shencai": 6
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 20,
                        "tipo": 20,
                        "neixi": 16,
                        "qigan": 8,
                        "shencai": 12
                    },
                    "description": "<p>小成运功特效：你诵经时可以在心中默念，不发出声，若这样做，你每次进行诵经的[佛法]检定成功时，可为自身和诵经目标回复20点气血。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 30,
                        "tipo": 30,
                        "neixi": 24,
                        "qigan": 12,
                        "shencai": 18
                    },
                    "description": "<p>圆满运功特效：你诵经时可以在心中默念，不发出声，若这样做，你每次进行诵经的[佛法]检定成功时，可为自身和诵经目标回复20点气血内力。</p><p>修满特效：气血+40，内力+20，[佛法]+1。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                },
                {
                    "key": "arts.fofa.value",
                    "value": 1
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《罗汉伏魔功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 2,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>万佛寺核心内功心法，为万佛七十二绝技之一。修行者皆身心六根清净，无明烦恼已断，大成后刚猛顽强，排除万魔。</p>",
            "requirement": "悟性需求: 4",
            "automationNote": "震伤效果会在出招后发送聊天卡片提示，需玩家手动扣除。诸相非相自动判定怒气生效。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 8,
                        "tipo": 13,
                        "neixi": 4,
                        "qigan": 4,
                        "shencai": 3
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 32,
                        "shenfa": 16,
                        "tipo": 26,
                        "neixi": 8,
                        "qigan": 8,
                        "shencai": 6
                    },
                    "description": "<p>小成运功特效：每次出招，气劲震伤周围2米内所有敌方，使他们流失5点气血。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "伏魔震伤提示",
                            "trigger": "hit_once",
                            "script": "ChatMessage.create({content: `<div class='xjzl-chat-card'><div class='card-header'><h3>罗汉伏魔功</h3></div><div class='card-content'>请手动扣除周围2米内敌方 <b>5点</b> 气血 (流失)。</div></div>`, speaker: ChatMessage.getSpeaker({actor: args.attacker})});",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 48,
                        "shenfa": 24,
                        "tipo": 39,
                        "neixi": 12,
                        "qigan": 12,
                        "shencai": 9
                    },
                    "description": "<p>圆满运功特效：每次出招，气劲震伤周围2米内所有敌方，使他们流失10点气血。<br>当你怒气积攒5点后，进入“诸相非相”：招式伤害+10，持续到战斗脱离。</p><p>修满特效：气血+30，内力+30，外功防御+5。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "伏魔震伤提示",
                            "trigger": "hit_once",
                            "script": "ChatMessage.create({content: `<div class='xjzl-chat-card'><div class='card-header'><h3>罗汉伏魔功</h3></div><div class='card-content'>请手动扣除周围2米内敌方 <b>10点</b> 气血 (流失)。</div></div>`, speaker: ChatMessage.getSpeaker({actor: args.attacker})});",
                            "active": true
                        },
                        {
                            "label": "诸相非相",
                            "trigger": "calc",
                            "script": "if (args.attacker.system.resources.rage.value >= 5) {\n    args.output.damage += 10;\n    args.output.bonusDesc.push('诸相非相 +10');\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 30
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 30
                },
                {
                    "key": "combat.def_waigong",
                    "value": 5
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《万佛三阳功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 2,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>万佛达摩院首座自一至阳绝阳神功残篇当中领悟而得的一门神功，得神功之高。</p>",
            "requirement": "悟性需求: 4",
            "automationNote": "完全自动化。包含针对阴/柔属性的减伤和增伤。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 5,
                        "shenfa": 5,
                        "tipo": 10,
                        "neixi": 13,
                        "qigan": 9,
                        "shencai": 6
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 10,
                        "tipo": 20,
                        "neixi": 26,
                        "qigan": 18,
                        "shencai": 12
                    },
                    "description": "<p>小成运功特效：你受到到阴、柔属性的招式攻击时，减免10点伤害。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "三阳护体",
                            "trigger": "preTake",
                            "script": "if (['yin', 'rou'].includes(args.element) && args.output.damage > 0) {\n    args.output.damage = Math.max(0, args.output.damage - 10);\n    if (ui.notifications) ui.notifications.info('万佛三阳功抵消了 10 点阴柔伤害');\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 15,
                        "tipo": 30,
                        "neixi": 39,
                        "qigan": 27,
                        "shencai": 18
                    },
                    "description": "<p>圆满运功特效：你受到到阴、柔属性的招式攻击时，减免10点伤害。<br>·你攻击运行阴柔内功的目标时招式伤害+10。</p><p>修满特效：气血+35，内力+35。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "三阳护体",
                            "trigger": "preTake",
                            "script": "if (['yin', 'rou'].includes(args.element) && args.output.damage > 0) {\n    args.output.damage = Math.max(0, args.output.damage - 10);\n}",
                            "active": true
                        },
                        {
                            "label": "三阳克阴",
                            "trigger": "preDamage",
                            "script": "const targetNeigongId = args.target.system.martial.active_neigong;\nif (targetNeigongId) {\n    const targetNeigong = args.target.items.get(targetNeigongId);\n    if (targetNeigong && targetNeigong.system.element === 'yin') {\n        args.config.amount += 10;\n        ui.notifications.info('三阳功克制阴柔内功，伤害+10');\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 35
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 35
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《释迦神功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 3,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>“世尊释迦牟尼为太子时，一日出城，大象碍路，太子手提象足掷向高空，三日后，象还堕地”此功法源自天竺，修掷象神力，可力千钧，随天竺第一高手带入中原，名噪一时。</p>",
            "requirement": "悟性需求: 11",
            "automationNote": "完全自动化。自动检测武学品阶和抛掷等级进行增伤。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 40,
                        "shenfa": 19,
                        "tipo": 24,
                        "neixi": 10,
                        "qigan": 10,
                        "shencai": 17
                    },
                    "description": "<p>领悟运功特效：你的人级暗器武学套路招式伤害+10，且额外提高你[抛掷]等级的伤害。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "掷象神力(领悟)",
                            "trigger": "calc",
                            "script": "if (args.move.weaponType === 'hidden' || args.item.system.category === 'sanshou') {\n    const tier = args.move.computedTier || args.item.system.tier || 1;\n    const paozhi = args.attacker.system.skills.paozhi.total || 0;\n    if (tier === 1) {\n        args.output.damage += (10 + paozhi);\n        args.output.bonusDesc.push(`释迦神功 +${10+paozhi}`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 80,
                        "shenfa": 38,
                        "tipo": 48,
                        "neixi": 20,
                        "qigan": 20,
                        "shencai": 34
                    },
                    "description": "<p>小成运功特效：你的人/地级暗器武学套路招式伤害+20，且额外提高你[抛掷]等级的伤害。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "掷象神力(小成)",
                            "trigger": "calc",
                            "script": "if (args.move.weaponType === 'hidden' || args.item.system.category === 'sanshou') {\n    const tier = args.move.computedTier || args.item.system.tier || 1;\n    const paozhi = args.attacker.system.skills.paozhi.total || 0;\n    if (tier <= 2) {\n        args.output.damage += (20 + paozhi);\n        args.output.bonusDesc.push(`释迦神功 +${20+paozhi}`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 120,
                        "shenfa": 57,
                        "tipo": 72,
                        "neixi": 30,
                        "qigan": 30,
                        "shencai": 51
                    },
                    "description": "<p>圆满运功特效：你的人/地/天级暗器武学套路招式伤害+30，且额外提高你[抛掷]等级的伤害。</p><p>修满特效：气血+100，内力+20，力量+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "掷象神力(圆满)",
                            "trigger": "calc",
                            "script": "if (args.move.weaponType === 'hidden' || args.item.system.category === 'sanshou') {\n    const paozhi = args.attacker.system.skills.paozhi.total || 0;\n    args.output.damage += (30 + paozhi);\n    args.output.bonusDesc.push(`释迦神功 +${30+paozhi}`);\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 100
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                },
                {
                    "key": "stats.liliang.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《金刚不坏神功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 3,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>达摩祖师所创，万佛七十二绝技中最难练的十种绝学之一。此功修炼至化境，体外天罡之气护体，灿若黄金，刀枪不入，水火不侵，成为真正的“无坚不摧、万毒不侵、金刚不坏、至刚无敌”。</p>",
            "requirement": "悟性需求: 11",
            "automationNote": "自动化护盾。受到伤害时若内力充足自动抵扣，并保留保底1点伤害。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 10,
                        "tipo": 60,
                        "neixi": 10,
                        "qigan": 10,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效：当你的内力高于100点时，你可以使用内力抵消伤害，每消耗1点内力抵消1点内外功伤害。但至少对你造成1点伤害。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "金刚护体(1:1)",
                            "trigger": "preTake",
                            "script": "const mp = args.attacker.system.resources.mp.value;\nif (mp > 100 && ['waigong', 'neigong'].includes(args.type) && args.output.damage > 1) {\n    const damageToAbsorb = args.output.damage - 1;\n    const mpCanPay = mp;\n    const absorb = Math.min(damageToAbsorb, mpCanPay);\n    if (absorb > 0) {\n        args.output.damage -= absorb;\n        await args.attacker.update({'system.resources.mp.value': mp - absorb});\n        ui.notifications.info(`金刚不坏: 消耗 ${absorb} 内力抵消伤害`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 50,
                        "shenfa": 30,
                        "tipo": 90,
                        "neixi": 30,
                        "qigan": 30,
                        "shencai": 10
                    },
                    "description": "<p>小成运功特效：当你的内力高于100点时，你可以使用内力抵消伤害，每消耗1点内力抵消2点内外功伤害。但至少对你造成1点伤害。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "金刚护体(1:2)",
                            "trigger": "preTake",
                            "script": "const mp = args.attacker.system.resources.mp.value;\nif (mp > 100 && ['waigong', 'neigong'].includes(args.type) && args.output.damage > 1) {\n    const damageToAbsorb = args.output.damage - 1;\n    const mpCost = Math.ceil(damageToAbsorb / 2);\n    const finalCost = Math.min(mpCost, mp);\n    const absorb = finalCost * 2;\n    const actualAbsorb = Math.min(damageToAbsorb, absorb);\n    if (actualAbsorb > 0) {\n        args.output.damage -= actualAbsorb;\n        await args.attacker.update({'system.resources.mp.value': mp - finalCost});\n        ui.notifications.info(`金刚不坏: 消耗 ${finalCost} 内力抵消 ${actualAbsorb} 伤害`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 70,
                        "shenfa": 50,
                        "tipo": 120,
                        "neixi": 50,
                        "qigan": 40,
                        "shencai": 20
                    },
                    "description": "<p>圆满运功特效：当你的内力高于100点时，你可以使用内力抵消伤害，每消耗1点内力抵消3点内外功伤害。但至少对你造成1点伤害。</p><p>修满特效：气血+100，内力+20，体魄+10。你领悟散手《闭口禅》。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "金刚护体(1:3)",
                            "trigger": "preTake",
                            "script": "const mp = args.attacker.system.resources.mp.value;\nif (mp > 100 && ['waigong', 'neigong'].includes(args.type) && args.output.damage > 1) {\n    const damageToAbsorb = args.output.damage - 1;\n    const mpCost = Math.ceil(damageToAbsorb / 3);\n    const finalCost = Math.min(mpCost, mp);\n    const absorb = finalCost * 3;\n    const actualAbsorb = Math.min(damageToAbsorb, absorb);\n    if (actualAbsorb > 0) {\n        args.output.damage -= actualAbsorb;\n        await args.attacker.update({'system.resources.mp.value': mp - finalCost});\n        ui.notifications.info(`金刚不坏: 消耗 ${finalCost} 内力抵消 ${actualAbsorb} 伤害`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 100
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                },
                {
                    "key": "stats.tipo.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《菩提禅经》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 2,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>万佛寺菩提院核心内功心法，老祖于菩提下参坐“苦禅”时所悟出的高深内功。神功初创，老祖便将心法口诀刻写于“菩提叶”之上，便于传世，故名之曰“菩提禅经”。内功出于禅门，释生死之道，道苦禅之谛，练至大成，静如枯木，无生无死，渡己伤敌于无形之中。</p>",
            "requirement": "悟性需求: 4",
            "automationNote": "完全自动化。同死触发减伤，独生检测同死标记触发回复。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 6,
                        "tipo": 12,
                        "neixi": 6,
                        "qigan": 8,
                        "shencai": 1
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 12,
                        "tipo": 24,
                        "neixi": 12,
                        "qigan": 16,
                        "shencai": 2
                    },
                    "description": "<p>小成运功特效：<br>同死：受伤时，减少10点内外功伤害。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "同死",
                            "trigger": "preTake",
                            "script": "if (['waigong', 'neigong'].includes(args.type) && args.output.damage > 0) {\n    args.output.damage = Math.max(0, args.output.damage - 10);\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 45,
                        "shenfa": 18,
                        "tipo": 36,
                        "neixi": 18,
                        "qigan": 24,
                        "shencai": 3
                    },
                    "description": "<p>圆满运功特效：<br>同死：受伤时，减少10点内外功伤害。<br>独生：若你触发“同死”，你下回合造成伤害时，回复10点气血，10点内力。</p><p>修满特效：气血+40，内力+20，[佛法]+1。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "同死/独生准备",
                            "trigger": "preTake",
                            "script": "if (['waigong', 'neigong'].includes(args.type) && args.output.damage > 0) {\n    args.output.damage = Math.max(0, args.output.damage - 10);\n    // 标记独生触发\n    const effect = thisItem.effects.getName('独生');\n    if (effect) {\n        const effectData = effect.toObject();\n        delete effectData._id;\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(args.target, effectData);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                },
                {
                    "key": "arts.fofa.value",
                    "value": 1
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "独生",
                "icon": "icons/svg/heal.svg",
                "duration": {
                    "turns": 1
                },
                "description": "下回合造成伤害时回复气血内力",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "dusheng",
                        "stackable": false,
                        "scripts": [
                            {
                                "trigger": "hit_once",
                                "script": "await args.attacker.applyHealing({amount: 10, type: 'hp'});\nawait args.attacker.applyHealing({amount: 10, type: 'mp'});\nif (thisEffect) await thisEffect.delete();",
                                "active": true
                            }
                        ]
                    }
                }
            }
        ]
    },
    {
        "name": "《洗髓经》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 3,
            "element": "yang",
            "sect": "wanfosi",
            "description": "<p>万佛寺菩提院顶级内功，在达摩面壁处的铁盒中发现，一曰易筋，一曰洗髓，一主外，一主内。道：“如来慈悲，演化《洗髓》，洗髓还本原，凡圣同归一”，此功修炼以血化精，精化为髓，清其内髓，坚其外形，大成后以静深静、静中求动，浃骨洽髓，脱壳飞身。</p>",
            "requirement": "悟性需求: 11",
            "automationNote": "完全自动化。被动防御通过Flags修改。受伤反弹流失通过damaged触发器。圆满毒素减伤通过preTake实现。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 32,
                        "shenfa": 20,
                        "tipo": 24,
                        "neixi": 12,
                        "qigan": 20,
                        "shencai": 12
                    },
                    "description": "<p>领悟运功特效：内外功防御+5。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "洗髓护体",
                            "trigger": "passive",
                            "script": "S.combat.def_waigong += 5; S.combat.def_neigong += 5;",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 64,
                        "shenfa": 40,
                        "tipo": 48,
                        "neixi": 24,
                        "qigan": 40,
                        "shencai": 24
                    },
                    "description": "<p>小成运功特效：内外功防御+5。<br>受伤后，真气鼓荡，对攻击目标造成20点气血流失。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "洗髓护体",
                            "trigger": "passive",
                            "script": "S.combat.def_waigong += 5; S.combat.def_neigong += 5;",
                            "active": true
                        },
                        {
                            "label": "真气鼓荡",
                            "trigger": "damaged",
                            "script": "if (args.attacker && args.finalDamage > 0) {\n    args.attacker.runtime_reflect = true;\n    try {\n        await args.attacker.applyDamage({ amount: 20, type: 'liushi', isHit: true });\n        ui.notifications.info('洗髓经真气鼓荡！反弹20流失伤害');\n    } finally {\n        delete args.attacker.runtime_reflect;\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 96,
                        "shenfa": 60,
                        "tipo": 72,
                        "neixi": 36,
                        "qigan": 60,
                        "shencai": 36
                    },
                    "description": "<p>圆满运功特效：内外功防御+10。<br>受伤后，真气鼓荡，对攻击目标造成30点气血流失。</p><p>修满特效：气血+80，内力+40，气感+10。你受到的毒素伤害减半。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "洗髓护体",
                            "trigger": "passive",
                            "script": "S.combat.def_waigong += 10; S.combat.def_neigong += 10;",
                            "active": true
                        },
                        {
                            "label": "真气鼓荡",
                            "trigger": "damaged",
                            "script": "if (args.attacker && args.finalDamage > 0) {\n    args.attacker.runtime_reflect = true;\n    try {\n        await args.attacker.applyDamage({ amount: 30, type: 'liushi', isHit: true });\n        ui.notifications.info('洗髓经真气鼓荡！反弹30流失伤害');\n    } finally {\n        delete args.attacker.runtime_reflect;\n    }\n}",
                            "active": true
                        },
                        {
                            "label": "修满：万毒不侵",
                            "trigger": "preTake",
                            "script": "if (args.type === 'poison' && args.output.damage > 0) {\n    args.output.damage = Math.floor(args.output.damage / 2);\n    ui.notifications.info('洗髓经化解了部分毒素伤害');\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "stats.qigan.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《地藏渡魂经》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 3,
            "element": "yin",
            "sect": "wanfosi",
            "description": "<p>“地狱不空，誓不成佛，众生度尽，方证菩提。”<br>万佛寺秘传绝学之一，大成之时，禅音邈邈，恶鬼退避，唯有得宏大誓愿，方可证得菩萨果位。</p>",
            "requirement": "悟性需求: 11",
            "automationNote": "完全自动化。通过脚本在战斗开始/回合开始时叠加愿力层数，并自动判断层数触发金身。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 15,
                        "tipo": 25,
                        "neixi": 25,
                        "qigan": 25,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效：进入战斗后获得一层“愿力”，至多三层，持续到战斗脱离。<br>愿力：每层使你虚招对抗结果+1，虚招伤害+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "积攒愿力",
                            "trigger": "combatStart",
                            "script": "const effect = thisItem.effects.getName('愿力');\nif (effect) {\n    const effectData = effect.toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.actor, effectData);\n}",
                            "active": true
                        },
                        {
                            "label": "虚招伤害加成",
                            "trigger": "calc",
                            "script": "const stacks = args.actor.effects.find(e => e.name === '愿力')?.getFlag('xjzl-system', 'stacks') || 0;\nif (stacks > 0) args.output.feint += (stacks * 10);",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 45,
                        "shenfa": 30,
                        "tipo": 40,
                        "neixi": 55,
                        "qigan": 50,
                        "shencai": 20
                    },
                    "description": "<p>小成运功特效：自己回合初时获得一层“愿力”，至多三层，持续到战斗脱离。<br>愿力：每层使你虚招对抗结果+1，虚招伤害+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "积攒愿力",
                            "trigger": "turnStart",
                            "script": "const effect = thisItem.effects.getName('愿力');\nif (effect) {\n    const effectData = effect.toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.actor, effectData);\n}",
                            "active": true
                        },
                        {
                            "label": "虚招伤害加成",
                            "trigger": "calc",
                            "script": "const stacks = args.actor.effects.find(e => e.name === '愿力')?.getFlag('xjzl-system', 'stacks') || 0;\nif (stacks > 0) args.output.feint += (stacks * 10);",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 65,
                        "shenfa": 45,
                        "tipo": 60,
                        "neixi": 85,
                        "qigan": 75,
                        "shencai": 30
                    },
                    "description": "<p>圆满运功特效：自己回合初时获得一层“愿力”，至多三层，叠满三层后自身进入“地藏菩萨金身”状态，持续到战斗脱离。<br>愿力：每层使你虚招对抗结果+1，虚招伤害+10。<br>地藏菩萨金身：内外功防御+20。</p><p>修满特效：气血+80，内力+40，当前恶行值归零（仅一次）。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "积攒愿力与金身",
                            "trigger": "turnStart",
                            "script": "const yuanli = thisItem.effects.getName('愿力');\nif (yuanli) {\n    const effectData = yuanli.toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    const effect = await game.xjzl.api.effects.addEffect(args.actor, effectData);\n    // 检查层数触发金身\n    if (effect && effect.getFlag('xjzl-system', 'stacks') >= 3) {\n        const jinshen = thisItem.effects.getName('地藏菩萨金身');\n        if (jinshen) {\n            const goldenBody = jinshen.toObject();\n            delete goldenBody._id;\n            goldenBody.origin = thisItem.uuid;\n            await game.xjzl.api.effects.addEffect(args.actor, goldenBody);\n        }\n    }\n}",
                            "active": true
                        },
                        {
                            "label": "虚招伤害加成",
                            "trigger": "calc",
                            "script": "const stacks = args.actor.effects.find(e => e.name === '愿力')?.getFlag('xjzl-system', 'stacks') || 0;\nif (stacks > 0) args.output.feint += (stacks * 10);",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "愿力",
                "icon": "icons/svg/light.svg",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "yuanli",
                        "stackable": true,
                        "maxStacks": 3
                    }
                },
                "changes": [
                    {
                        "key": "system.combat.xuzhao",
                        "mode": 2,
                        "value": "1"
                    },
                    {
                        "key": "system.combat.kanpo",
                        "mode": 2,
                        "value": "1"
                    }
                ]
            },
            {
                "name": "地藏菩萨金身",
                "icon": "icons/svg/sun.svg",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "jinshen",
                        "stackable": false
                    }
                },
                "changes": [
                    {
                        "key": "system.combat.def_waigong",
                        "mode": 2,
                        "value": "20"
                    },
                    {
                        "key": "system.combat.def_neigong",
                        "mode": 2,
                        "value": "20"
                    }
                ]
            }
        ]
    },
    {
        "name": "《睡梦罗汉诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 2,
            "element": "taiji",
            "sect": "wanfosi",
            "description": "<p>此功为戒律院一僧侣所创，因不爱诵经，常瞌睡偷懒，竟摸索出了睡觉时修炼搬运内力的功法。其进境缓慢，然大成后，睡觉走路，皆在修炼。</p>",
            "requirement": "悟性需求: 6",
            "automationNote": "休整时间需GM判定。困倦效果挂上AE作为提示。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 4,
                        "tipo": 10,
                        "neixi": 12,
                        "qigan": 6,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 32,
                        "shenfa": 14,
                        "tipo": 22,
                        "neixi": 16,
                        "qigan": 6,
                        "shencai": 6
                    },
                    "description": "<p>你的休整时间增加为八个时辰。<br>你被击破架招后，给攻击者添加“困倦”一回合。<br>困倦：你的出招动作提升一级。（简要-次要-主要-蓄力-全回合-招式中断）</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "睡梦反制",
                            "trigger": "damaged",
                            "script": "if (args.isBroken && args.attacker) {\n    const effect = thisItem.effects.getName('困倦');\n    if (effect) {\n        const effectData = effect.toObject();\n        delete effectData._id;\n        effectData.duration = { rounds: 1 };\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(args.attacker, effectData);\n        ui.notifications.info('睡梦罗汉诀：敌方陷入困倦');\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 48,
                        "shenfa": 20,
                        "tipo": 34,
                        "neixi": 24,
                        "qigan": 10,
                        "shencai": 8
                    },
                    "description": "<p>圆满运功特效：你被破架招后，给攻击者添加“困倦”两回合。<br>困倦：你的出招动作提升一级。（简要-次要-主要-蓄力-全回合-招式中断）</p><p>修满特效：气血+40，内力+20。你每月获得的修为额外增加100。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "睡梦反制",
                            "trigger": "damaged",
                            "script": "if (args.isBroken && args.attacker) {\n    const effect = thisItem.effects.getName('困倦');\n    if (effect) {\n        const effectData = effect.toObject();\n        delete effectData._id;\n        effectData.duration = { rounds: 2 };\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(args.attacker, effectData);\n        ui.notifications.info('睡梦罗汉诀：敌方陷入困倦');\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "困倦",
                "icon": "icons/svg/sleep.svg",
                "description": "出招动作提升一级",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "kunjuan",
                        "stackable": false
                    }
                }
            }
        ]
    },
    {
        "name": "《枯荣神功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "wanfosi",
            "description": "<p>“大觉世尊入涅槃已，其娑罗林东西二双合为一树，南北二双合为一树，垂覆宝床，盖于如来，四枯四荣，即枯即荣即非枯荣一刹那修”苦修此功者，心境于枯荣之间变换，修炼时面部及全身半枯半荣，唯有大成后，觉行圆满。</p>",
            "requirement": "悟性需求: 11",
            "automationNote": "进战自动添加Buff。Buff内嵌damaged和hit脚本实现吸内/回血逻辑。圆满主动效果需手动调用（可做个宏或Item Macro）。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 35,
                        "shenfa": 10,
                        "tipo": 25,
                        "neixi": 25,
                        "qigan": 15,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效：进战后获得“半枯”持续到脱战。<br>半枯：敌人出招对你造成伤害后流失10点内力。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "半枯",
                            "trigger": "combatStart",
                            "script": "const effect = thisItem.effects.getName('半枯');\nif (effect) {\n    const effectData = effect.toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.actor, effectData);\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 70,
                        "shenfa": 25,
                        "tipo": 45,
                        "neixi": 50,
                        "qigan": 30,
                        "shencai": 20
                    },
                    "description": "<p>小成运功特效：进战后获得“半荣”持续到脱战。<br>半荣：你出招命中他人后，回复10点气血内力。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "半荣",
                            "trigger": "combatStart",
                            "script": "const effect = thisItem.effects.getName('半荣');\nif (effect) {\n    const effectData = effect.toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.actor, effectData);\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 100,
                        "shenfa": 40,
                        "tipo": 70,
                        "neixi": 75,
                        "qigan": 45,
                        "shencai": 30
                    },
                    "description": "<p>圆满运功特效：进战后获得“枯荣”持续到脱战。<br>枯荣：敌人出招对你造成伤害后流失10点内力；你出招命中他人后，回复10点气血内力。<br>·你可以消耗主要动作，移除“枯荣”，选择20米内任意一个目标，使其流失最大气血值10%的气血和最大内力值10%的内力。（一个目标一场战斗只能被该效果影响一次）</p><p>修满特效：气血+80，内力+40，内功防御+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "枯荣",
                            "trigger": "combatStart",
                            "script": "const effect = thisItem.effects.getName('枯荣');\nif (effect) {\n    const effectData = effect.toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.actor, effectData);\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "combat.def_neigong",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "半枯",
                "icon": "icons/svg/skull.svg",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "banku",
                        "scripts": [
                            {
                                "trigger": "damaged",
                                "script": "if (args.attacker) args.attacker.applyDamage({amount: 10, type:'liushi', isHit:true});",
                                "active": true
                            }
                        ]
                    }
                }
            },
            {
                "name": "半荣",
                "icon": "icons/svg/heal.svg",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "banrong",
                        "scripts": [
                            {
                                "trigger": "hit",
                                "script": "if (args.isHit) { args.attacker.applyHealing({amount:10, type:'hp'}); args.attacker.applyHealing({amount:10, type:'mp'}); }",
                                "active": true
                            }
                        ]
                    }
                }
            },
            {
                "name": "枯荣",
                "icon": "icons/svg/balance.svg",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "kurong",
                        "scripts": [
                            {
                                "trigger": "damaged",
                                "script": "if (args.attacker) args.attacker.applyDamage({amount: 10, type:'liushi', isHit:true});",
                                "active": true
                            },
                            {
                                "trigger": "hit",
                                "script": "if (args.isHit) { args.attacker.applyHealing({amount:10, type:'hp'}); args.attacker.applyHealing({amount:10, type:'mp'}); }",
                                "active": true
                            }
                        ]
                    }
                }
            }
        ]
    },
    {
        "name": "《达摩渡灭功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/万佛.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "wanfosi",
            "description": "<p>万佛七十二绝技中最难练的十种绝学之一。达摩祖师神慧疏朗，闻皆晓悟，广传佛法，最后灭化圆寂于洛滨。此功以宏大佛法悲天悯人，修众生无我，苦乐随缘之境，大成后，渡己渡人，万物皆可渡。</p>",
            "requirement": "悟性需求: 11",
            "automationNote": "受击叠加渡人层数。消耗层数触发特效需手动（建议做成宏）。距离加成需脚本修改。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 10,
                        "tipo": 20,
                        "neixi": 35,
                        "qigan": 30,
                        "shencai": 15
                    },
                    "description": "<p>领悟运功特效：受到招式伤害时获得一层“渡人”，至多叠加五层，持续到战斗脱离。<br>渡人：每层使招式释放距离+1，命中目标后可移除一定层数，为单个受伤目标添加下列中的一个状态...</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "叠加渡人",
                            "trigger": "damaged",
                            "script": "if (args.attacker) {\n    const effect = thisItem.effects.getName('渡人');\n    if (effect) {\n        const effectData = effect.toObject();\n        delete effectData._id;\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(args.target, effectData);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 20,
                        "tipo": 40,
                        "neixi": 70,
                        "qigan": 60,
                        "shencai": 30
                    },
                    "description": "<p>小成运功特效：受到招式伤害时获得两层“渡人”，至多叠加五层，持续到战斗脱离。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "叠加渡人(x2)",
                            "trigger": "damaged",
                            "script": "if (args.attacker) {\n    const effect = thisItem.effects.getName('渡人');\n    if (effect) {\n        const effectData = effect.toObject();\n        delete effectData._id;\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(args.target, effectData);\n        await game.xjzl.api.effects.addEffect(args.target, effectData);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 30,
                        "tipo": 65,
                        "neixi": 110,
                        "qigan": 85,
                        "shencai": 40
                    },
                    "description": "<p>圆满运功特效：受到招式伤害时获得两层“渡人”，至多叠加十层，持续到战斗脱离。</p><p>修满特效：气血+60，内力+60，内息+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "叠加渡人(x2, Max 10)",
                            "trigger": "damaged",
                            "script": "if (args.attacker) {\n    const effect = thisItem.effects.getName('渡人');\n    if (effect) {\n        const effectData = effect.toObject();\n        delete effectData._id;\n        effectData.origin = thisItem.uuid;\n        // Stage 3 Override maxStacks\n        effectData.flags['xjzl-system'].maxStacks = 10;\n        await game.xjzl.api.effects.addEffect(args.target, effectData);\n        await game.xjzl.api.effects.addEffect(args.target, effectData);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 60
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 60
                },
                {
                    "key": "stats.neixi.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "渡人",
                "icon": "icons/svg/angel.svg",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "duren",
                        "stackable": true,
                        "maxStacks": 5
                    }
                }
            }
        ]
    }
]