[
    {
        "name": "《三阳经》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/擎天.png",
        "system": {
            "sect": "qingtianmen",
            "tier": 1,
            "element": "yang",
            "description": "擎天门入门内功，由初代掌门于巨云峰石塔下观日出日落悟出，太阳超然物外，少阳静境独得、岿然不动，明阳如大厦倾倒、有倾天之势。",
            "requirement": "悟性需求: 1",
            "automationNote": "完全自动化",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 5,
                        "shenfa": 2,
                        "tipo": 4,
                        "neixi": 2,
                        "qigan": 3,
                        "shencai": 2
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 4,
                        "tipo": 8,
                        "neixi": 4,
                        "qigan": 6,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 6,
                        "tipo": 12,
                        "neixi": 6,
                        "qigan": 9,
                        "shencai": 6
                    },
                    "description": "圆满运功特效：\n你施展阳、刚属性招式时，招式伤害提升5点。\n修满特效：修满[永久]：气血+15，内力+15。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "三阳经-阳刚增伤",
                            "trigger": "calc",
                            "active": true,
                            "script": "if (['yang', 'gang'].includes(args.move.element)) {\n    args.output.damage += 5;\n    args.output.bonusDesc.push('三阳经 +5');\n}"
                        }
                    ]
                }
            },
            "masteryEffect": "修满[永久]：气血+15，内力+15。",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 15
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 15
                }
            ]
        },
        "effects": []
    },
    {
        "name": "《锻心功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/擎天.png",
        "system": {
            "sect": "qingtianmen",
            "tier": 1,
            "element": "taiji",
            "description": "擎天门入门内功，以日积月累的锻造来锤炼体魄，淬炼心神，是修炼门内后续功法之基础。练成之后，皮骨坚实，心硬如铁，不为所动。绝大多数外门弟子，都是为了此功而拜入擎天门的。",
            "requirement": "悟性需求: 1",
            "automationNote": "完全自动化",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 5,
                        "shenfa": 2,
                        "tipo": 5,
                        "neixi": 2,
                        "qigan": 2,
                        "shencai": 2
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 4,
                        "tipo": 10,
                        "neixi": 4,
                        "qigan": 4,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 6,
                        "tipo": 15,
                        "neixi": 6,
                        "qigan": 6,
                        "shencai": 6
                    },
                    "description": "圆满运功特效：处于无架招状态时，内外功防御+10。\n修满特效：修满[永久]：气血+10，内力+10。[锻造]+1。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "锻心功-无架防御",
                            "trigger": "passive",
                            "active": true,
                            "script": "if (!actor.system.martial.stanceActive) {\n    system.combat.def_waigong += 10;\n    system.combat.def_neigong += 10;\n}"
                        }
                    ]
                }
            },
            "masteryEffect": "修满[永久]：气血+10，内力+10。[锻造]+1。",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 10
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 10
                },
                {
                    "key": "arts.duanzao.mod",
                    "value": 1
                }
            ]
        },
        "effects": []
    },
    {
        "name": "《无锋剑诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/擎天.png",
        "system": {
            "sect": "qingtianmen",
            "tier": 2,
            "element": "yang",
            "description": "擎天门兵器堂核心功法，取“重剑无锋，大巧不工”之意，重意不重器，以自身雄浑力道为基，破一切阻碍，无人能挡。",
            "requirement": "悟性需求: 4",
            "automationNote": "无视困难地形需手动；暴击破架完全自动化",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 11,
                        "tipo": 12,
                        "neixi": 3,
                        "qigan": 3,
                        "shencai": 3
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 32,
                        "shenfa": 22,
                        "tipo": 24,
                        "neixi": 6,
                        "qigan": 6,
                        "shencai": 6
                    },
                    "description": "小成运功特效：你无视困难地形。\n当你造成暴击时，如果对目标造成的实际伤害大于目标最大气血的60%，直接击破其架招。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "无锋剑诀-强力破架",
                            "trigger": "hit",
                            "active": true,
                            "script": "if (args.isCrit && args.target && args.target.system.martial.stanceActive) {\n    const threshold = args.target.system.resources.hp.max * 0.6;\n    if (args.finalDamage > threshold) {\n        await args.target.update({ \"system.martial.stanceActive\": false });\n        if (args.target.token?.object) {\n            canvas.interface.createScrollingText(args.target.token.object.center, \"重击破架！\", { fill: \"#ff0000\", stroke: \"#000000\", strokeThickness: 4 });\n        }\n        ui.notifications.info(`${actor.name} 的重击击破了 ${args.target.name} 的架招！`);\n    }\n}"
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 48,
                        "shenfa": 33,
                        "tipo": 36,
                        "neixi": 9,
                        "qigan": 9,
                        "shencai": 9
                    },
                    "description": "圆满运功特效：你无视困难地形。\n当你造成暴击时，如果对目标造成的实际伤害大于目标最大气血的50%，直接击破其架招。\n修满特效：修满[永久]：气血+30，内力+30，力量+5。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "无锋剑诀-强力破架",
                            "trigger": "hit",
                            "active": true,
                            "script": "if (args.isCrit && args.target && args.target.system.martial.stanceActive) {\n    const threshold = args.target.system.resources.hp.max * 0.5;\n    if (args.finalDamage > threshold) {\n        await args.target.update({ \"system.martial.stanceActive\": false });\n        if (args.target.token?.object) {\n            canvas.interface.createScrollingText(args.target.token.object.center, \"重击破架！\", { fill: \"#ff0000\", stroke: \"#000000\", strokeThickness: 4 });\n        }\n        ui.notifications.info(`${actor.name} 的重击击破了 ${args.target.name} 的架招！`);\n    }\n}"
                        }
                    ]
                }
            },
            "masteryEffect": "修满[永久]：气血+30，内力+30，力量+5。",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 30
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 30
                },
                {
                    "key": "stats.liliang.mod",
                    "value": 5
                }
            ]
        },
        "effects": []
    },
    {
        "name": "《十三太保横练功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/擎天.png",
        "system": {
            "sect": "qingtianmen",
            "tier": 2,
            "element": "taiji",
            "description": "擎天门横练功法，与金钟罩齐名，修炼之人需本身体格健硕，再辅以药液淬炼躯干，大成者肉身不惧刀剑，举手投足间开砖裂石，但若童子身破，其功立破。",
            "requirement": "悟性需求: 4",
            "automationNote": "童子身状态需GM监管；反伤与减伤自动化",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 14,
                        "shenfa": 7,
                        "tipo": 15,
                        "neixi": 4,
                        "qigan": 4,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 28,
                        "shenfa": 14,
                        "tipo": 30,
                        "neixi": 8,
                        "qigan": 8,
                        "shencai": 8
                    },
                    "description": "小成运功特效：你的格挡值+5。\n当你受到暴击时，攻击者受到5点气血流失。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "横练功-格挡",
                            "trigger": "passive",
                            "active": true,
                            "script": "system.combat.block += 5;"
                        },
                        {
                            "label": "横练功-暴击反伤",
                            "trigger": "damaged",
                            "active": true,
                            "script": "if (args.isCrit && args.attacker) {\n    if (args.attacker.temp_isReflecting) return;\n    actor.temp_isReflecting = true;\n    try {\n        await args.attacker.applyDamage({\n            type: 'liushi',\n            amount: 5,\n            isHit: true,\n            ignoreDefense: true\n        });\n        ui.notifications.info(`${actor.name} 触发横练功反震！`);\n    } finally {\n        delete actor.temp_isReflecting;\n    }\n}"
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 42,
                        "shenfa": 21,
                        "tipo": 45,
                        "neixi": 12,
                        "qigan": 12,
                        "shencai": 12
                    },
                    "description": "圆满运功特效：你的格挡值+10。\n当你受到暴击时，攻击者受到10点气血流失。\n当你被剑法、刀法招式攻击时减免10点伤害。\n·若你已非童子之身，即便将该内功修炼至圆满，也仅生效小成运功特效。\n修满特效：修满[永久]：气血+50，内力+10。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "横练功-格挡",
                            "trigger": "passive",
                            "active": true,
                            "script": "system.combat.block += 10;"
                        },
                        {
                            "label": "横练功-暴击反伤",
                            "trigger": "damaged",
                            "active": true,
                            "script": "if (args.isCrit && args.attacker) {\n    if (args.attacker.temp_isReflecting) return;\n    actor.temp_isReflecting = true;\n    try {\n        await args.attacker.applyDamage({\n            type: 'liushi',\n            amount: 10,\n            isHit: true,\n            ignoreDefense: true\n        });\n        ui.notifications.info(`${actor.name} 触发横练功反震！`);\n    } finally {\n        delete actor.temp_isReflecting;\n    }\n}"
                        },
                        {
                            "label": "横练功-刀剑减伤",
                            "trigger": "preTake",
                            "active": true,
                            "script": "if (args.move && (args.move.weaponType === 'sword' || args.move.weaponType === 'blade')) {\n    args.output.damage = Math.max(0, args.output.damage - 10);\n    if (actor.token?.object) {\n        canvas.interface.createScrollingText(actor.token.object.center, \"横练减伤\", { fill: \"#00FFFF\", stroke: \"#000000\", strokeThickness: 4 });\n    }\n}"
                        }
                    ]
                }
            },
            "masteryEffect": "修满[永久]：气血+50，内力+10。",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 50
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 10
                }
            ]
        },
        "effects": []
    },
    {
        "name": "《玄鼎诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/擎天.png",
        "system": {
            "sect": "qingtianmen",
            "tier": 3,
            "element": "taiji",
            "description": "“唯道集虚，虚者心斋也。”\n擎天门顶级功法，以苦修闻名，注重调心炼体，以及适应各种艰苦条件。大成后，不仅适应万物自然，反而能借助困境，使自身更加如鱼得水。",
            "requirement": "悟性需求: 11",
            "automationNote": "困难地形判定需玩家手动",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 24,
                        "tipo": 30,
                        "neixi": 10,
                        "qigan": 18,
                        "shencai": 8
                    },
                    "description": "领悟运功特效：你处于困难地形时格挡+20。",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 65,
                        "shenfa": 48,
                        "tipo": 55,
                        "neixi": 20,
                        "qigan": 36,
                        "shencai": 16
                    },
                    "description": "小成运功特效：你处于困难地形时格挡+30，攻击处于困难地形的目标时，暴击骰-1。",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 97,
                        "shenfa": 70,
                        "tipo": 85,
                        "neixi": 30,
                        "qigan": 54,
                        "shencai": 24
                    },
                    "description": "圆满运功特效：你处于困难地形时格挡+40，攻击处于困难地形的目标时，暴击骰-2。\n修满特效：修满[永久]：气血+80，内力+40。\n你无视困难地形。",
                    "xpCostRatio": 1,
                    "scripts": []
                }
            },
            "masteryEffect": "修满[永久]：气血+80，内力+40。\n你无视困难地形。",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                }
            ]
        },
        "effects": []
    },
    {
        "name": "《崭天诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/擎天.png",
        "system": {
            "sect": "qingtianmen",
            "tier": 3,
            "element": "yang",
            "description": "擎天门不世神功，欲与天公试比高。以绝豪迈的姿态激发力道，凝聚特殊狂莽内劲，寻常刀兵一式便碎，非重器不可承载。练至大成时，力气无穷尽，擎剑破天，睥睨英豪。",
            "requirement": "悟性需求: 11",
            "automationNote": "碎武层数自动叠加，达到5层需玩家手动处理武器损坏",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 38,
                        "shenfa": 22,
                        "tipo": 30,
                        "neixi": 12,
                        "qigan": 12,
                        "shencai": 6
                    },
                    "description": "你所持武器的伤害提高10点，每次用武器出招时，为该武器添加一层“碎武”。\n碎武：叠至五层时，移除所有碎武，武器损坏且无法修复，若你的武器因此效果损坏，你可以不消耗动作立即装备一把包裹里的武器。\n·碎武持续到叠加满五层为止。金、玉品武器质地坚固，不会被叠加碎武。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "崭天诀-武器增伤",
                            "trigger": "passive",
                            "active": true,
                            "script": "system.combat.damages.weapon.mod += 10;"
                        },
                        {
                            "label": "崭天诀-碎武",
                            "trigger": "attack",
                            "active": true,
                            "script": "if (args.move.weaponType && args.move.weaponType !== 'none') {\n    const source = thisItem.effects.getName(\"碎武\");\n    if (source) {\n        const effectData = source.toObject();\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(actor, effectData);\n        \n        const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"suiwu\");\n        if (effect && effect.getFlag(\"xjzl-system\", \"stacks\") >= 5) {\n            ui.notifications.warn(\"武器已不堪重负，彻底损坏！请手动卸下并移除。\");\n            await game.xjzl.api.effects.removeEffect(actor, \"suiwu\", 5);\n        }\n    }\n}"
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 76,
                        "shenfa": 44,
                        "tipo": 60,
                        "neixi": 24,
                        "qigan": 24,
                        "shencai": 12
                    },
                    "description": "小成运功特效：你所持武器的伤害提高15点。每次用武器出招时，为该武器添加一层“碎武”。\n碎武：叠至五层时，移除所有碎武，武器损坏且无法修复，若你的武器因此效果损坏，你可以不消耗动作立即装备一把包裹里的武器。\n·碎武持续到叠加满五层为止。金、玉品武器质地坚固，不会被叠加碎武。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "崭天诀-武器增伤",
                            "trigger": "passive",
                            "active": true,
                            "script": "system.combat.damages.weapon.mod += 15;"
                        },
                        {
                            "label": "崭天诀-碎武",
                            "trigger": "attack",
                            "active": true,
                            "script": "if (args.move.weaponType && args.move.weaponType !== 'none') {\n    const source = thisItem.effects.getName(\"碎武\");\n    if (source) {\n        const effectData = source.toObject();\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(actor, effectData);\n        \n        const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"suiwu\");\n        if (effect && effect.getFlag(\"xjzl-system\", \"stacks\") >= 5) {\n            ui.notifications.warn(\"武器已不堪重负，彻底损坏！请手动卸下并移除。\");\n            await game.xjzl.api.effects.removeEffect(actor, \"suiwu\", 5);\n        }\n    }\n}"
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 115,
                        "shenfa": 65,
                        "tipo": 90,
                        "neixi": 35,
                        "qigan": 35,
                        "shencai": 20
                    },
                    "description": "你所持武器的伤害提高20点。每次用武器出招时，为该武器添加一层“碎武”。\n碎武：叠至五层时，移除所有碎武，武器损坏且无法修复，若你的武器因此效果损坏，你可以不消耗动作立即装备一把包裹里的武器。\n·碎武持续到叠加满五层为止。金、玉品武器质地坚固，不会被叠加碎武。\n修满特效：修满[永久]：气血+80，内力+40。",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "崭天诀-武器增伤",
                            "trigger": "passive",
                            "active": true,
                            "script": "system.combat.damages.weapon.mod += 20;"
                        },
                        {
                            "label": "崭天诀-碎武",
                            "trigger": "attack",
                            "active": true,
                            "script": "if (args.move.weaponType && args.move.weaponType !== 'none') {\n    const source = thisItem.effects.getName(\"碎武\");\n    if (source) {\n        const effectData = source.toObject();\n        effectData.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(actor, effectData);\n        \n        const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"suiwu\");\n        if (effect && effect.getFlag(\"xjzl-system\", \"stacks\") >= 5) {\n            ui.notifications.warn(\"武器已不堪重负，彻底损坏！请手动卸下并移除。\");\n            await game.xjzl.api.effects.removeEffect(actor, \"suiwu\", 5);\n        }\n    }\n}"
                        }
                    ]
                }
            },
            "masteryEffect": "修满[永久]：气血+80，内力+40。",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                }
            ]
        },
        "effects": [
            {
                "name": "碎武",
                "icon": "icons/svg/explosion.svg",
                "transfer": false,
                "flags": {
                    "xjzl-system": {
                        "slug": "suiwu",
                        "stackable": true,
                        "maxStacks": 5
                    }
                },
                "description": "武器耐久计数"
            }
        ]
    }
]