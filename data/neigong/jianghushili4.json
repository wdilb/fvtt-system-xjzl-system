[
    {
        "name": "《万法根源》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>霸刀堂绝技，也是高句丽镇国神功，以窃为核心，演化诸多变化，万事万法，见即所得，根源唯我，从而以假代真，号天地起源。</p>",
            "requirement": "悟性11",
            "automationNote": "窃取他人内功效果逻辑过于复杂，无法自动化。请玩家与DM协商手动处理窃取效果。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 22,
                        "shenfa": 22,
                        "tipo": 22,
                        "neixi": 22,
                        "qigan": 22,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效：你可以窃取被你击杀过敌人运转的内功效果，作为此内功的运功效果。<br>·你可以切换窃取的内功效果，每次切换需要花费半个时辰，你同时只能运转一个窃取的内功效果</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 44,
                        "shenfa": 44,
                        "tipo": 44,
                        "neixi": 44,
                        "qigan": 44,
                        "shencai": 20
                    },
                    "description": "<p>小成运功特效：你可以窃取被你击败过（打入濒死）的敌人运转的内功效果，作为此内功的运功效果。<br>·你可以切换窃取的内功效果，每次切换需要花费半个时辰，你同时只能运转一个窃取的内功效果</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 66,
                        "shenfa": 66,
                        "tipo": 66,
                        "neixi": 66,
                        "qigan": 66,
                        "shencai": 30
                    },
                    "description": "<p>修满特效：修满[永久]：气血+60，内力+60。<br>圆满运功特效：你可以窃取与你交手过（互相造成伤害）的敌人运转的内功效果，作为此内功的运功效果。<br>·你可以切换窃取的内功效果，每次切换需要花费半个时辰，你同时只能运转一个窃取的内功效果</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 60
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 60
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《神女赋》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
        "system": {
            "tier": 3,
            "element": "yin",
            "sect": "jianghushili",
            "description": "<p>瑶池宫顶级内功，具体从何而来不得而知。如情义缠柔，似绵绵相思，令人难以呼吸，无法自拔。</p>",
            "requirement": "悟性11",
            "automationNote": "‘湘水’状态已预设在特效列表中，请玩家手动添加给范围内的敌人。攻击命中带‘湘水’敌人的回蓝与扣蓝效果已自动化。免疫水负面影响需手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 10,
                        "tipo": 15,
                        "neixi": 30,
                        "qigan": 25,
                        "shencai": 30
                    },
                    "description": "<p>领悟运功特效：进战后在你的周身 1 米范围内生成‘湘水’，以你为中心移动，持续到脱战。<br>·攻击命中具有“湘水”状态的角色，若暴击使其流失20 内力，并恢复自身 20 内力。<br>湘水：你的敌人处于该范围内时，内功防御下降 10 点，自身存在状态时，受到伤害提高 30 点。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "神女赋-吸蓝",
                            "trigger": "hit",
                            "script": "if (args.isCrit) {\n    const hasXiangshui = args.target.effects.some(e => e.name === \"湘水\");\n    if (hasXiangshui) {\n        await actor.applyHealing({ amount: 20, type: \"mp\", showScrolling: true });\n        const targetMp = args.target.system.resources.mp.value;\n        if (targetMp > 0) {\n            const newMp = Math.max(0, targetMp - 20);\n            await args.target.update({ \"system.resources.mp.value\": newMp });\n             if (args.target.token?.object) {\n                 canvas.interface.createScrollingText(args.target.token.object.center, \"内力 -20\", { fill: \"#0000FF\", stroke: \"#000000\", strokeThickness: 4 });\n            }\n        }\n        ui.notifications.info(`${actor.name} 触发神女赋，吸取了 ${args.target.name} 的内力！`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 20,
                        "tipo": 30,
                        "neixi": 60,
                        "qigan": 40,
                        "shencai": 60
                    },
                    "description": "<p>小成运功特效：进战后在你的周身 3 米范围内生成‘湘水’，以你为中心移动，持续到脱战。<br>·攻击命中具有“湘水”状态的角色，若暴击使其流失20 内力，并恢复自身 20 内力。<br>湘水：你的敌人处于该范围内时，内功防御下降 10 点，自身存在状态时，受到伤害提高 30 点。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "神女赋-吸蓝",
                            "trigger": "hit",
                            "script": "if (args.isCrit) {\n    const hasXiangshui = args.target.effects.some(e => e.name === \"湘水\");\n    if (hasXiangshui) {\n        await actor.applyHealing({ amount: 20, type: \"mp\", showScrolling: true });\n        const targetMp = args.target.system.resources.mp.value;\n        if (targetMp > 0) {\n            const newMp = Math.max(0, targetMp - 20);\n            await args.target.update({ \"system.resources.mp.value\": newMp });\n             if (args.target.token?.object) {\n                 canvas.interface.createScrollingText(args.target.token.object.center, \"内力 -20\", { fill: \"#0000FF\", stroke: \"#000000\", strokeThickness: 4 });\n            }\n        }\n        ui.notifications.info(`${actor.name} 触发神女赋，吸取了 ${args.target.name} 的内力！`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 50,
                        "tipo": 45,
                        "neixi": 85,
                        "qigan": 75,
                        "shencai": 75
                    },
                    "description": "<p>修满特效：修满[永久]：气血+80，内力+50。<br>·你将免疫因为水带来的负面影响。<br>圆满运功特效：进战后在你的周身 5 米范围内生成‘湘水’，以你为中心移动，持续到脱战。<br>·攻击命中具有“湘水”状态的角色，若暴击使其流失20 内力，并恢复自身 20 内力。<br>湘水：你的敌人处于该范围内时，内功防御下降 10 点，自身存在状态时，受到伤害提高 30 点。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "神女赋-吸蓝",
                            "trigger": "hit",
                            "script": "if (args.isCrit) {\n    const hasXiangshui = args.target.effects.some(e => e.name === \"湘水\");\n    if (hasXiangshui) {\n        await actor.applyHealing({ amount: 20, type: \"mp\", showScrolling: true });\n        const targetMp = args.target.system.resources.mp.value;\n        if (targetMp > 0) {\n            const newMp = Math.max(0, targetMp - 20);\n            await args.target.update({ \"system.resources.mp.value\": newMp });\n             if (args.target.token?.object) {\n                 canvas.interface.createScrollingText(args.target.token.object.center, \"内力 -20\", { fill: \"#0000FF\", stroke: \"#000000\", strokeThickness: 4 });\n            }\n        }\n        ui.notifications.info(`${actor.name} 触发神女赋，吸取了 ${args.target.name} 的内力！`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 50
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "湘水",
                "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
                "description": "内功防御下降10点，受到伤害提高30点。",
                "changes": [
                    {
                        "key": "system.combat.def_neigong",
                        "mode": 2,
                        "value": "-10"
                    }
                ],
                "flags": {
                    "xjzl-system": {
                        "slug": "xiangshui",
                        "stackable": false,
                        "scripts": [
                            {
                                "label": "湘水-易伤",
                                "trigger": "preTake",
                                "script": "if (args.output.damage > 0) {\n    args.output.damage += 30;\n}",
                                "active": true
                            }
                        ]
                    }
                }
            }
        ]
    },
    {
        "name": "《水成花》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 2,
            "element": "yin",
            "sect": "jianghushili",
            "description": "<p>瑶池宫地级内功，具体从何而来不得而知。可引导液体甚至是敌人血液化作水花绽放，极为美丽可怖。</p>",
            "requirement": "悟性4",
            "automationNote": "对无架招敌人的流失伤害已自动化。圆满阶段的AOE流失无法自动判断距离，仅对主目标生效，周围敌人请手动处理。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 2,
                        "shenfa": 6,
                        "tipo": 11,
                        "neixi": 11,
                        "qigan": 11,
                        "shencai": 7
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 4,
                        "shenfa": 12,
                        "tipo": 22,
                        "neixi": 22,
                        "qigan": 22,
                        "shencai": 14
                    },
                    "description": "<p>小成运功特效：你击中无架招敌人时，使目标流失10气血。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "水成花-流失",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await args.target.applyDamage({ amount: 10, type: \"liushi\", isHit: true });\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 8,
                        "shenfa": 18,
                        "tipo": 32,
                        "neixi": 33,
                        "qigan": 32,
                        "shencai": 21
                    },
                    "description": "<p>修满特效：修满[永久]：气血+40，内力+20。<br>圆满运功特效：你击中无架招敌人时，使目标和其周围1米范围的敌人流失20气血。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "水成花-流失(AOE手动)",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await args.target.applyDamage({ amount: 20, type: \"liushi\", isHit: true });\n    ui.notifications.info(\"水成花触发：主目标已流失20气血。请GM手动处理周围1米内敌人的流失伤害。\");\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《无前功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖4.png",
        "system": {
            "tier": 2,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>洛阳张家内功，讲究既出无悔。直抒“唯有向前，后无退路”的气势，突破阻碍，威胁极强。</p>",
            "requirement": "悟性5",
            "automationNote": "伤害次数计数与增伤已完全自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 10,
                        "tipo": 8,
                        "neixi": 5,
                        "qigan": 5,
                        "shencai": 5
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 20,
                        "tipo": 16,
                        "neixi": 10,
                        "qigan": 10,
                        "shencai": 10
                    },
                    "description": "<p>小成运功特效：在你的回合，你造成两次伤害后，下一次出招伤害+20。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "无前功-重置计数",
                            "trigger": "turnStart",
                            "script": "await actor.setFlag(\"xjzl-system\", \"neigong_wuqian_count\", 0);",
                            "active": true
                        },
                        {
                            "label": "无前功-造成伤害计数",
                            "trigger": "hit",
                            "script": "if (args.type === 'attack' && args.finalDamage > 0) {\n    let count = actor.getFlag(\"xjzl-system\", \"neigong_wuqian_count\") || 0;\n    count += 1;\n    await actor.setFlag(\"xjzl-system\", \"neigong_wuqian_count\", count);\n}",
                            "active": true
                        },
                        {
                            "label": "无前功-应用增伤",
                            "trigger": "calc",
                            "script": "const count = actor.getFlag(\"xjzl-system\", \"neigong_wuqian_count\") || 0;\nif (count >= 2) {\n    args.output.damage += 20;\n    args.output.bonusDesc.push(\"无前功(+20)\");\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 45,
                        "shenfa": 30,
                        "tipo": 24,
                        "neixi": 15,
                        "qigan": 15,
                        "shencai": 15
                    },
                    "description": "<p>修满特效：[修满]永久：气血+40，内力+20。<br>圆满运功特效：在你的回合，你造成两次伤害后，下一次出招伤害+40。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "无前功-重置计数",
                            "trigger": "turnStart",
                            "script": "await actor.setFlag(\"xjzl-system\", \"neigong_wuqian_count\", 0);",
                            "active": true
                        },
                        {
                            "label": "无前功-造成伤害计数",
                            "trigger": "hit",
                            "script": "if (args.type === 'attack' && args.finalDamage > 0) {\n    let count = actor.getFlag(\"xjzl-system\", \"neigong_wuqian_count\") || 0;\n    count += 1;\n    await actor.setFlag(\"xjzl-system\", \"neigong_wuqian_count\", count);\n}",
                            "active": true
                        },
                        {
                            "label": "无前功-应用增伤",
                            "trigger": "calc",
                            "script": "const count = actor.getFlag(\"xjzl-system\", \"neigong_wuqian_count\") || 0;\nif (count >= 2) {\n    args.output.damage += 40;\n    args.output.bonusDesc.push(\"无前功(+40)\");\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《化魔功诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>魔道万化门无上秘传。可引自身心魔为薪，烹炼阴阳二气。人魔同炉，无分彼我。练至大成后可自身化魔，魔气癫狂为甲，双目尽染魔纹。<br>注意：此内功开始修炼，但未修炼圆满时，每晚休整都会陷入走火入魔，持续十个回合。</p>",
            "requirement": "悟性11",
            "automationNote": "走火入魔免疫需手动忽略。太极属性转化已自动。圆满阶段的暴击增伤已自动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 35,
                        "shenfa": 20,
                        "tipo": 15,
                        "neixi": 20,
                        "qigan": 15,
                        "shencai": 15
                    },
                    "description": "<p>领悟运功特效：你陷入走火入魔时可不受影响。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 70,
                        "shenfa": 40,
                        "tipo": 30,
                        "neixi": 40,
                        "qigan": 30,
                        "shencai": 30
                    },
                    "description": "<p>小成运功特效：你陷入走火入魔时可不受影响。<br>·你无视招式的属性，全部将之视作太极。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "化魔-太极转化",
                            "trigger": "calc",
                            "script": "args.move.element = 'taiji';",
                            "active": true
                        },
                        {
                            "label": "化魔-太极转化(Check)",
                            "trigger": "check",
                            "script": "args.move.element = 'taiji';",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 105,
                        "shenfa": 60,
                        "tipo": 45,
                        "neixi": 60,
                        "qigan": 45,
                        "shencai": 45
                    },
                    "description": "<p>修满特效：[修满]永久：气血+80，内力+40，身法+10。<br>圆满运功特效：你陷入走火入魔时可不受影响。<br>·你无视招式的属性，全部将之视作太极。<br>·你出招时若造成暴击，招式伤害提高50%。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "化魔-太极转化",
                            "trigger": "calc",
                            "script": "args.move.element = 'taiji';",
                            "active": true
                        },
                        {
                            "label": "化魔-太极转化(Check)",
                            "trigger": "check",
                            "script": "args.move.element = 'taiji';",
                            "active": true
                        },
                        {
                            "label": "化魔-暴击增伤",
                            "trigger": "preDamage",
                            "script": "if (args.outcome.isCrit) {\n    args.config.amount = Math.floor(args.config.amount * 1.5);\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "stats.shenfa.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《噬神录》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>魔道秘典，合欢派大乘功法。此功诡谲，令真气交融，阴阳相噬，更以正派内家罡气为养分。大成后，如修罗临世，欲念不绝，取人精元补己身，乃魔道巅峰邪功。<br>注意：此功圆满后，每月需以一对童男童女祭养，血为媒，魂为引，否则阴阳二气反噬暴毙而亡。</p>",
            "requirement": "悟性11",
            "automationNote": "完全自动化",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 14,
                        "tipo": 18,
                        "neixi": 35,
                        "qigan": 15,
                        "shencai": 18
                    },
                    "description": "<p>领悟运功特效：出招或受伤时获得一层“噬元”，至多两层，持续到战斗脱离。<br>噬元：当你气血归零后（残疾检定后），移除所有噬元，每层为你回复气血上限10%的气血。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "噬神录-获得噬元(Attack)",
                            "trigger": "attack",
                            "script": "const effectData = thisItem.effects.getName(\"噬元\").toObject();\ndelete effectData._id;\neffectData.origin = thisItem.uuid;\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 2);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        },
                        {
                            "label": "噬神录-获得噬元(Damaged)",
                            "trigger": "damaged",
                            "script": "const effectData = thisItem.effects.getName(\"噬元\").toObject();\ndelete effectData._id;\neffectData.origin = thisItem.uuid;\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 2);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 28,
                        "tipo": 36,
                        "neixi": 80,
                        "qigan": 30,
                        "shencai": 36
                    },
                    "description": "<p>小成运功特效：出招或受伤时获得一层“噬元”，至多三层，持续到战斗脱离。<br>噬元：当你气血归零后（残疾检定后），移除所有噬元，每层为你回复气血上限10%的气血。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "噬神录-获得噬元(Attack)",
                            "trigger": "attack",
                            "script": "const effectData = thisItem.effects.getName(\"噬元\").toObject();\ndelete effectData._id;\neffectData.origin = thisItem.uuid;\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 3);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        },
                        {
                            "label": "噬神录-获得噬元(Damaged)",
                            "trigger": "damaged",
                            "script": "const effectData = thisItem.effects.getName(\"噬元\").toObject();\ndelete effectData._id;\neffectData.origin = thisItem.uuid;\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 3);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 40,
                        "shenfa": 40,
                        "tipo": 56,
                        "neixi": 120,
                        "qigan": 50,
                        "shencai": 54
                    },
                    "description": "<p>修满特效：修满[永久]：气血+60，内力+60，神采+10。<br>圆满运功特效：出招或受伤时获得一层“噬元”，至多五层，持续到战斗脱离。<br>噬元：当你气血归零后（残疾检定后），移除所有噬元，每层为你回复气血上限10%的气血。<br>·当你拥有五层“噬元”时，你每次出招吸取造成伤害（未扣除防御格挡）20%的气血。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "噬神录-获得噬元(Attack)",
                            "trigger": "attack",
                            "script": "const effectData = thisItem.effects.getName(\"噬元\").toObject();\ndelete effectData._id;\neffectData.origin = thisItem.uuid;\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 5);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        },
                        {
                            "label": "噬神录-获得噬元(Damaged)",
                            "trigger": "damaged",
                            "script": "const effectData = thisItem.effects.getName(\"噬元\").toObject();\ndelete effectData._id;\neffectData.origin = thisItem.uuid;\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 5);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        },
                        {
                            "label": "噬神录-满层吸血",
                            "trigger": "hit",
                            "script": "const shiyuan = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"shiyuan\");\nif (shiyuan && shiyuan.getFlag(\"xjzl-system\", \"stacks\") >= 5) {\n    const heal = Math.floor(args.baseDamage * 0.2);\n    if (heal > 0) {\n        await actor.applyHealing({ amount: heal, type: \"hp\", showScrolling: true });\n        ui.notifications.info(\"噬神录：吸取气血\");\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 60
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 60
                },
                {
                    "key": "stats.shencai.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "噬元",
                "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
                "description": "濒死时每层回复10%最大气血并移除。",
                "changes": [],
                "flags": {
                    "xjzl-system": {
                        "slug": "shiyuan",
                        "stackable": true,
                        "maxStacks": 5,
                        "scripts": [
                            {
                                "label": "噬元-濒死回血",
                                "trigger": "dying",
                                "script": "const heal = Math.floor(S.resources.hp.max * 0.1 * thisEffect.stacks);\nconst stacks = thisEffect.stacks;\n// 1. 先发送剧情卡片\nconst content = `<div class=\"xjzl-chat-card item-card\">\n    <header class=\"card-header\" style=\"border-left: 4px solid #8e44ad; background: rgba(0,0,0,0.05); padding: 5px; display: flex; align-items: center; gap: 10px;\">\n        <img src=\"${thisEffect.img}\" style=\"border:none; width: 36px; height: 36px; object-fit: cover;\" />\n        <div style=\"flex: 1;\">\n            <h3 style=\"margin: 0; color: #333;\">噬元护体</h3>\n            <div style=\"font-size: 0.8em; color: #666;\">被动触发</div>\n        </div>\n    </header>\n    <div class=\"card-content-wrapper\" style=\"padding: 10px; font-size: 0.9em; color: #444;\">\n        <p><strong>${actor.name}</strong> 受到致命伤害，噬元真气自动护主！</p>\n        <div style=\"margin-top:5px; padding:5px; background:#f3e5f5; border-radius:4px; color:#8e44ad;\">\n            <i class=\"fas fa-shield-alt\"></i> 消耗 <b>${stacks}</b> 层，从濒死恢复。\n        </div>\n    </div>\n</div>`;\n\nawait ChatMessage.create({\n    user: game.user.id,\n    speaker: ChatMessage.getSpeaker({ actor: actor }),\n    content: content\n});\n\n// 2. 再执行治疗 (会自动发送回血卡并处理濒死移除)\nawait actor.applyHealing({ amount: heal, type: 'hp', showScrolling: true });\n\n// 3. 删除特效\nawait thisEffect.delete();",
                                "active": true
                            }
                        ]
                    }
                }
            }
        ]
    },
    {
        "name": "《天魔策-总纲》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>西汉时期，第一任魔道圣君——颢渊收集天下奇典，创无上心法《天魔策》。但不久后魔门分裂，使《天魔策》一分为六。几经战乱、武林争霸，不断失散遗落。据传闻，此功练至大成之时，可由魔入道，武碎虚空。</p>",
            "requirement": "悟性25",
            "automationNote": "属性对抗无法自动处理。请手动进行定力对抗，若对手失败，请手动为其添加内功自带的【混沌】特效。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 15,
                        "tipo": 20,
                        "neixi": 25,
                        "qigan": 20,
                        "shencai": 20
                    },
                    "description": "<p>领悟运功特效：当你出招选中目标后，与敌人进行[定力]对抗，如对方失败，他的精神陷入混沌，主动解除架招，失去闪避，直到你命中他。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 30,
                        "tipo": 40,
                        "neixi": 50,
                        "qigan": 50,
                        "shencai": 40
                    },
                    "description": "<p>小成运功特效：当你出招选中目标后，与敌人进行[定力]对抗，如对方失败，他的精神陷入混沌，主动解除架招，失去闪避，直到你命中他。<br>·你的这次[定力]对抗检定结果+3。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 50,
                        "shenfa": 45,
                        "tipo": 60,
                        "neixi": 75,
                        "qigan": 70,
                        "shencai": 60
                    },
                    "description": "<p>修满特效：[修满]永久：气血+80，内力+40，全属性+10。<br>圆满运功特效：当你出招选中目标后，与敌人进行[定力]对抗，如对方失败，他的精神陷入混沌，主动解除架招，失去闪避，直到你命中他。<br>·你的这次[定力]对抗检定结果+5。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "stats.liliang.mod",
                    "value": 10
                },
                {
                    "key": "stats.shenfa.mod",
                    "value": 10
                },
                {
                    "key": "stats.tipo.mod",
                    "value": 10
                },
                {
                    "key": "stats.neixi.mod",
                    "value": 10
                },
                {
                    "key": "stats.qigan.mod",
                    "value": 10
                },
                {
                    "key": "stats.shencai.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "混沌",
                "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
                "description": "无法开启架招，闪避归零。受伤后移除。",
                "changes": [
                    {
                        "key": "flags.xjzl-system.blockStance",
                        "mode": 5,
                        "value": "true"
                    },
                    {
                        "key": "flags.xjzl-system.forceDodgeZero",
                        "mode": 5,
                        "value": "true"
                    }
                ],
                "flags": {
                    "xjzl-system": {
                        "slug": "hundun",
                        "stackable": false,
                        "scripts": [
                            {
                                "label": "混沌-受击移除",
                                "trigger": "damaged",
                                "script": "await thisEffect.delete();",
                                "active": true
                            }
                        ]
                    }
                }
            }
        ]
    },
    {
        "name": "《千山法》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖4.png",
        "system": {
            "tier": 1,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《千机变》专用，由风尘无涯撰写。<br>千机门入门内功，为千机门祖师年轻时所学，再经由改编而得。</p>",
            "requirement": "悟性2",
            "automationNote": "位置判定需手动。若满足条件，请手动勾选攻击配置中的“无视防御”。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 5,
                        "shenfa": 5,
                        "tipo": 3,
                        "neixi": 3,
                        "qigan": 1,
                        "shencai": 1
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 10,
                        "tipo": 6,
                        "neixi": 6,
                        "qigan": 2,
                        "shencai": 2
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 15,
                        "tipo": 9,
                        "neixi": 9,
                        "qigan": 3,
                        "shencai": 3
                    },
                    "description": "<p>修满特效：修满[永久]：气血+10，内力+10，【探查】+1。<br>圆满运功特效：若你回合开始时与上回合结束时所处位置一致，你下次出招无视对方内外攻防御。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 10
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 10
                },
                {
                    "key": "skills.tancha.mod",
                    "value": 1
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": []
    },
    {
        "name": "《万衍书》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 2,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《千机变》专用，由风尘无涯撰写。<br>千机门核心内功。千机门祖师所悟，结合其一生所感书写而成，推演千机，模仿衍算万物规律。</p>",
            "requirement": "悟性4",
            "automationNote": "破衍层数叠加、满层封招缚身已完全自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 12,
                        "tipo": 10,
                        "neixi": 5,
                        "qigan": 5,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 24,
                        "shenfa": 24,
                        "tipo": 20,
                        "neixi": 10,
                        "qigan": 10,
                        "shencai": 8
                    },
                    "description": "<p>小成运功特效：招式命中目标时，自身进行一次悟性检定（难度20），成功给目标添加一层“破衍”，最高三层，持续到战斗结束。<br>·破衍：每层使你看破值-1。当积累满五层“破衍”时，陷入“封招”“缚身”一回合，并移除所有“破衍”。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "万衍书-添加破衍(Lv3)",
                            "trigger": "hit",
                            "script": "const roll = await actor.rollAttributeTest(\"wuxing\", { skipDialog: true });\nif (roll.total >= 20) {\n    const effectData = thisItem.effects.getName(\"破衍\").toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    foundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 3);\n    const addedEffect = await game.xjzl.api.effects.addEffect(args.target, effectData);\n    \n    // 检查满层惩罚 (小成上限3层，描述说满5层触发惩罚。根据规则，小成无法触发5层效果)\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 36,
                        "shenfa": 36,
                        "tipo": 30,
                        "neixi": 15,
                        "qigan": 15,
                        "shencai": 12
                    },
                    "description": "<p>修满特效：修满[永久]：气血+20，内力+40，【巧手】+2。<br>圆满运功特效：招式命中目标时，自身进行一次悟性检定（难度20），成功给目标添加一层“破衍”，最高五层，持续到战斗结束。<br>·破衍：每层使你看破值-1。当积累满五层“破衍”时，陷入“封招”“缚身”一回合，并移除所有“破衍”。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "万衍书-添加破衍(Lv5)",
                            "trigger": "hit",
                            "script": "const roll = await actor.rollAttributeTest(\"wuxing\", { skipDialog: true });\nif (roll.total >= 20) {\n    const effectData = thisItem.effects.getName(\"破衍\").toObject();\n    delete effectData._id;\n    effectData.origin = thisItem.uuid;\n    foundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 5);\n    const addedEffect = await game.xjzl.api.effects.addEffect(args.target, effectData);\n    \n    // 检查满层惩罚\n    if (addedEffect && addedEffect.getFlag(\"xjzl-system\", \"stacks\") >= 5) {\n        // 使用系统Slug\n        const fengzhaoData = CONFIG.statusEffects.find(e => e.id === \"fengzhao\");\n        const fushenData = CONFIG.statusEffects.find(e => e.id === \"fushen\");\n        if (fengzhaoData) await game.xjzl.api.effects.addEffect(args.target, { ...fengzhaoData, duration: {rounds: 1} });\n        if (fushenData) await game.xjzl.api.effects.addEffect(args.target, { ...fushenData, duration: {rounds: 1} });\n        \n        await addedEffect.delete();\n        ui.notifications.info(`${args.target.name} 破衍满层，陷入封招缚身！`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryEffect": "",
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 20
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "skills.qiaoshou.mod",
                    "value": 2
                }
            ],
            "xpInvested": 0,
            "active": false,
            "sourceBreakdown": {
                "general": 0,
                "specific": 0
            }
        },
        "effects": [
            {
                "name": "破衍",
                "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
                "description": "每层使你看破值-1。",
                "changes": [
                    {
                        "key": "system.combat.kanpo",
                        "mode": 2,
                        "value": "-1"
                    }
                ],
                "flags": {
                    "xjzl-system": {
                        "slug": "poyan",
                        "stackable": true,
                        "maxStacks": 5,
                        "scripts": []
                    }
                }
            }
        ]
    },
    {
        "name": "《大道化一诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《千机变》专用，由风尘无涯撰写。<br>千机万变，天算无穷。千机门至高秘典，以太极化生万物为基，穷尽天地机变之理。修习者需通晓阴阳五行，心算如天道轮转，可预判乾坤之变，衍化周天杀机，功成时万物皆可为刃，一念起则风云色变。</p>",
            "requirement": "悟性12",
            "automationNote": "完全自动化。回合开始自动获取【天衍】，回合结束自动结算回血。出招时弹出对话框询问是否消耗层数增伤。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 30,
                        "tipo": 20,
                        "neixi": 20,
                        "qigan": 10,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效：你的每个回合初，获得当前回合数层的“天衍”，最多三层，持续到战斗结束。你的回合结束时，移除所有“天衍”，回复其层数*5的血量。<br>天衍：出招时可以消耗任意层数，每消耗一层使招式伤害+5。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "天衍-回合开始",
                            "trigger": "turnStart",
                            "script": "const round = game.combat ? game.combat.round : 1;\nconst stacksToAdd = Math.min(3, round);\nif (stacksToAdd > 0) {\n    const source = thisItem.effects.getName(\"天衍\");\n    for(let i=0; i<stacksToAdd; i++) {\n        await game.xjzl.api.effects.addEffect(actor, source);\n    }\n}",
                            "active": true
                        },
                        {
                            "label": "天衍-回合结束",
                            "trigger": "turnEnd",
                            "script": "const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_tianyan\");\nif (effect) {\n    const stacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 1;\n    const healAmount = stacks * 5;\n    await actor.applyHealing({ amount: healAmount, type: \"hp\", showScrolling: true });\n    await effect.delete();\n}",
                            "active": true
                        },
                        {
                            "label": "天衍-出招增伤",
                            "trigger": "attack",
                            "script": "const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_tianyan\");\nif (effect) {\n    const currentStacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 0;\n    if (currentStacks > 0) {\n        const useStacks = await foundry.applications.api.DialogV2.confirm({\n            window: { title: \"大道化一诀\" },\n            content: `<p>当前拥有 ${currentStacks} 层【天衍】。</p><p>是否消耗层数以增加伤害？</p>`,\n            yes: { label: \"消耗全部\", callback: () => true },\n            no: { label: \"不消耗\", callback: () => false }\n        });\n        if (useStacks) {\n            const bonus = currentStacks * 5;\n            await game.xjzl.api.effects.removeEffect(actor, \"neigong_tianyan\", currentStacks);\n            const source = thisItem.effects.getName(\"天衍爆发\");\n            const buffData = source.toObject();\n            buffData.changes[0].value = bonus;\n            await game.xjzl.api.effects.addEffect(actor, buffData);\n            ui.notifications.info(`消耗 ${currentStacks} 层天衍，伤害 +${bonus}`);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 60,
                        "shenfa": 60,
                        "tipo": 40,
                        "neixi": 40,
                        "qigan": 20,
                        "shencai": 20
                    },
                    "description": "<p>小成运功特效：你的每个回合初，获得当前回合数层的“天衍”，最多六层，持续到战斗结束。你的回合结束时，移除所有“天衍”，回复其层数*10的血量。<br>天衍：出招时可以消耗任意层数，每消耗一层使招式伤害+5。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "天衍-回合开始",
                            "trigger": "turnStart",
                            "script": "const round = game.combat ? game.combat.round : 1;\nconst stacksToAdd = Math.min(6, round);\nif (stacksToAdd > 0) {\n    const source = thisItem.effects.getName(\"天衍\");\n    for(let i=0; i<stacksToAdd; i++) {\n        await game.xjzl.api.effects.addEffect(actor, source);\n    }\n}",
                            "active": true
                        },
                        {
                            "label": "天衍-回合结束",
                            "trigger": "turnEnd",
                            "script": "const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_tianyan\");\nif (effect) {\n    const stacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 1;\n    const healAmount = stacks * 10;\n    await actor.applyHealing({ amount: healAmount, type: \"hp\", showScrolling: true });\n    await effect.delete();\n}",
                            "active": true
                        },
                        {
                            "label": "天衍-出招增伤",
                            "trigger": "attack",
                            "script": "const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_tianyan\");\nif (effect) {\n    const currentStacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 0;\n    if (currentStacks > 0) {\n        const confirm = await foundry.applications.api.DialogV2.confirm({\n             window: { title: \"大道化一诀\" },\n             content: `<p>当前拥有 ${currentStacks} 层【天衍】。</p><p>是否消耗全部层数以增加伤害？(每层+5)</p>`,\n             rejectClose: false\n        });\n        if (confirm) {\n            const bonus = currentStacks * 5;\n            await game.xjzl.api.effects.removeEffect(actor, \"neigong_tianyan\", currentStacks);\n            const source = thisItem.effects.getName(\"天衍爆发\");\n            const buffData = source.toObject();\n            buffData.changes[0].value = bonus;\n            await game.xjzl.api.effects.addEffect(actor, buffData);\n            ui.notifications.info(`消耗 ${currentStacks} 层天衍，伤害 +${bonus}`);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 90,
                        "shenfa": 90,
                        "tipo": 60,
                        "neixi": 60,
                        "qigan": 30,
                        "shencai": 30
                    },
                    "description": "<p>圆满运功特效：你的每个回合初，获得当前回合数层的“天衍”，最多九层，持续到战斗结束。你的回合结束时，移除所有“天衍”，回复其层数*10的血量。<br>天衍：出招时可以消耗任意层数，每消耗一层使招式伤害+10。<br><strong>修满特效：</strong>修满[永久]：气血+40，内力+80。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "天衍-回合开始",
                            "trigger": "turnStart",
                            "script": "const round = game.combat ? game.combat.round : 1;\nconst stacksToAdd = Math.min(9, round);\nif (stacksToAdd > 0) {\n    const source = thisItem.effects.getName(\"天衍\");\n    for(let i=0; i<stacksToAdd; i++) {\n        await game.xjzl.api.effects.addEffect(actor, source);\n    }\n}",
                            "active": true
                        },
                        {
                            "label": "天衍-回合结束",
                            "trigger": "turnEnd",
                            "script": "const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_tianyan\");\nif (effect) {\n    const stacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 1;\n    const healAmount = stacks * 10;\n    await actor.applyHealing({ amount: healAmount, type: \"hp\", showScrolling: true });\n    await effect.delete();\n}",
                            "active": true
                        },
                        {
                            "label": "天衍-出招增伤",
                            "trigger": "attack",
                            "script": "const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_tianyan\");\nif (effect) {\n    const currentStacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 0;\n    if (currentStacks > 0) {\n        const confirm = await foundry.applications.api.DialogV2.confirm({\n             window: { title: \"大道化一诀\" },\n             content: `<p>当前拥有 ${currentStacks} 层【天衍】。</p><p>是否消耗全部层数以增加伤害？(每层+10)</p>`,\n             rejectClose: false\n        });\n        if (confirm) {\n            const bonus = currentStacks * 10;\n            await game.xjzl.api.effects.removeEffect(actor, \"neigong_tianyan\", currentStacks);\n            const source = thisItem.effects.getName(\"天衍爆发\");\n            const buffData = source.toObject();\n            buffData.changes[0].value = bonus;\n            await game.xjzl.api.effects.addEffect(actor, buffData);\n            ui.notifications.info(`消耗 ${currentStacks} 层天衍，伤害 +${bonus}`);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 80
                }
            ],
            "xpInvested": 0,
            "active": false,
            "effects": [
                {
                    "name": "天衍",
                    "img": "icons/magic/light/explosion-star-glow-yellow.webp",
                    "description": "大道化一诀运功状态，可消耗增伤，回合结束回血。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_tianyan",
                            "stackable": true,
                            "maxStacks": 9
                        }
                    },
                    "changes": []
                },
                {
                    "name": "天衍爆发",
                    "img": "icons/magic/light/explosion-star-glow-yellow.webp",
                    "description": "消耗天衍层数获得的临时伤害加成。",
                    "transfer": false,
                    "duration": {
                        "turns": 1
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.skill.mod",
                            "mode": 2,
                            "value": "0"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "《风云散》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本资源为模组《千机变》专用，由风尘无涯撰写。<br>流风散尽处，云破见天心。一日观云，一夜追风，心意动，身所至。悟此逍遥法，平生自在活。</p>",
            "requirement": "悟性15",
            "automationNote": "完全手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 33,
                        "shenfa": 42,
                        "tipo": 15,
                        "neixi": 10,
                        "qigan": 10,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效： 当获得任意状态时，你可以消耗次要动作与15移动速度消除此状态。并使下次招式伤害提升5（一回合只能使用1次），</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 65,
                        "shenfa": 85,
                        "tipo": 30,
                        "neixi": 20,
                        "qigan": 20,
                        "shencai": 20
                    },
                    "description": "<p>小成运功特效： 当获得任意状态时，你可以消耗次要动作与10移动速度消除此状态。并使下次招式伤害提升10（一回合只能使用1次）。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 100,
                        "shenfa": 125,
                        "tipo": 45,
                        "neixi": 30,
                        "qigan": 30,
                        "shencai": 30
                    },
                    "description": "<p>圆满运功特效： 当获得任意状态时，你可以消耗次要动作与5移动速度消除此状态。并使下次招式伤害提升15（一回合只能使用1次）。<br>·你不受任何状态对减少你移动速度的影响<br><strong>修满特效：</strong>修满[永久]：气血+80，内力+40，[轻功]+4。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "skills.qinggong.mod",
                    "value": 4
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《博采众长》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖4.png",
        "system": {
            "tier": 2,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《初历江湖》专用，由咖啡祭祀撰写。</p>",
            "requirement": "悟性11，至少领悟4门地级百家学说的内功",
            "automationNote": "完全手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 8,
                        "shenfa": 8,
                        "tipo": 8,
                        "neixi": 8,
                        "qigan": 8,
                        "shencai": 8
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 16,
                        "tipo": 16,
                        "neixi": 16,
                        "qigan": 16,
                        "shencai": 16
                    },
                    "description": "<p>小成运功特效：消耗反应动作切换百家学说武学套路<br>百家学说：包括儒，墨，道，法，纵横，名，阴阳，理学以及杂家等</p>",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 24,
                        "shenfa": 24,
                        "tipo": 24,
                        "neixi": 24,
                        "qigan": 24,
                        "shencai": 24
                    },
                    "description": "<p>圆满运功特效：消耗简要动作切换百家学说武学套路<br>百家学说：包括儒，墨，道，法，纵横，名，阴阳，理学以及杂家等<br><strong>修满特效：</strong>修满[永久]：增加气血60点，内力30点。</p>",
                    "xpCostRatio": 1
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 60
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 30
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《兼容并蓄》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《初历江湖》专用，由咖啡祭祀撰写。</p>",
            "requirement": "悟性20，至少圆满4门地级百家学说的内功",
            "automationNote": "完全手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 20,
                        "tipo": 20,
                        "neixi": 20,
                        "qigan": 20,
                        "shencai": 20
                    },
                    "description": "<p>领悟运功特效：随机获得一项已经小成百家学说的内功特效，不可切换<br>百家学说：包括儒，墨，道，法，纵横，名，阴阳，理学以及杂家等（不重复获得）</p>",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 40,
                        "shenfa": 40,
                        "tipo": 40,
                        "neixi": 40,
                        "qigan": 40,
                        "shencai": 40
                    },
                    "description": "<p>小成运功特效：随机再获得一项已经小成的百家学说的内功特效，不可切换<br>百家学说：包括儒，墨，道，法，纵横，名，阴阳，理学以及杂家等（不重复获得）</p>",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 60,
                        "shenfa": 60,
                        "tipo": 60,
                        "neixi": 60,
                        "qigan": 60,
                        "shencai": 60
                    },
                    "description": "<p>圆满运功特效：随机再获得一项已经小成的地级百家学说的内功特效，不可切换<br>百家学说：包括儒，墨，道，法，纵横，名，阴阳，理学以及杂家等（不重复获得）<br><strong>修满特效：</strong>修满[永久]：增加气血80点，内力40点。</p>",
                    "xpCostRatio": 1
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《东皇神火诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 3,
            "element": "yang",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《初历江湖》专用，由咖啡祭祀撰写。<br>以《东皇太一》巫祝文为引，吸纳朝阳初诞的九道真火。功法大成时，可凝赤金神焰，其光如日轮垂天，能焚尽三垣二十八宿虚妄投影。</p>",
            "requirement": "悟性11，《太阴归藏诀》圆满",
            "automationNote": "完全自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 16,
                        "tipo": 20,
                        "neixi": 38,
                        "qigan": 20,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效：每次命中获得一层劲力（最高二层）<br>·你在白日，战斗开始时，获得一层养血、聚气，持续到战斗脱离。正午（午时）改劲力为获得一层劲气<br>·白日（卯时至酉时）<br>养血：每层使你回合末回复10点气血。<br>聚气：每层使你回合末回复5点内力。<br>劲力：每层提高招式伤害5点<br>劲气：每层提高招式伤害10点</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "东皇-战斗开始",
                            "trigger": "combatStart",
                            "script": "const hour = game.time.worldTime / 3600 % 24;\n// 白日：卯时(5-7) 至 酉时(17-19) -> 约 05:00 - 19:00\nif (hour >= 5 && hour < 19) {\n    await game.xjzl.api.effects.addEffect(actor, \"yangxue\");\n    await game.xjzl.api.effects.addEffect(actor, \"juqi\");\n}",
                            "active": true
                        },
                        {
                            "label": "东皇-命中叠加",
                            "trigger": "hit",
                            "script": "if (!args.isHit) return;\nconst hour = game.time.worldTime / 3600 % 24;\n// 午时 (11:00 - 13:00)\nif (hour >= 11 && hour < 13) {\n    const source = thisItem.effects.getName(\"劲气\");\n    if (source) await game.xjzl.api.effects.addEffect(actor, source);\n} else {\n    const source = thisItem.effects.getName(\"劲力\");\n    // 修改最大层数为2\n    const effectData = source.toObject();\n    foundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 2);\n    await game.xjzl.api.effects.addEffect(actor, effectData);\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 32,
                        "shenfa": 32,
                        "tipo": 40,
                        "neixi": 76,
                        "qigan": 40,
                        "shencai": 20
                    },
                    "description": "<p>小成运功特效：每次命中获得一层劲力（最高三层）<br>·你在白日，战斗开始时，获得二层养血、聚气，持续到战斗脱离。正午（午时）改劲力为获得一层劲气</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "东皇-战斗开始",
                            "trigger": "combatStart",
                            "script": "const hour = game.time.worldTime / 3600 % 24;\nif (hour >= 5 && hour < 19) {\n    await game.xjzl.api.effects.addEffect(actor, \"yangxue\");\n    await game.xjzl.api.effects.addEffect(actor, \"yangxue\");\n    await game.xjzl.api.effects.addEffect(actor, \"juqi\");\n    await game.xjzl.api.effects.addEffect(actor, \"juqi\");\n}",
                            "active": true
                        },
                        {
                            "label": "东皇-命中叠加",
                            "trigger": "hit",
                            "script": "if (!args.isHit) return;\nconst hour = game.time.worldTime / 3600 % 24;\nif (hour >= 11 && hour < 13) {\n    const source = thisItem.effects.getName(\"劲气\");\n    if (source) await game.xjzl.api.effects.addEffect(actor, source);\n} else {\n    const source = thisItem.effects.getName(\"劲力\");\n    const effectData = source.toObject();\n    foundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 3);\n    await game.xjzl.api.effects.addEffect(actor, effectData);\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 48,
                        "shenfa": 48,
                        "tipo": 60,
                        "neixi": 114,
                        "qigan": 60,
                        "shencai": 30
                    },
                    "description": "<p>圆满运功特效：每次命中获得一层劲力（最高五层）<br>·你在白日，战斗开始时，获得三层养血、聚气，持续到战斗脱离。正午（午时）改劲力为获得一层劲气<br><strong>修满特效：</strong>修满[永久]：气血+80，内力+40。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "东皇-战斗开始",
                            "trigger": "combatStart",
                            "script": "const hour = game.time.worldTime / 3600 % 24;\nif (hour >= 5 && hour < 19) {\n    for(let i=0; i<3; i++) { await game.xjzl.api.effects.addEffect(actor, \"yangxue\"); }\n    for(let i=0; i<3; i++) { await game.xjzl.api.effects.addEffect(actor, \"juqi\"); }\n}",
                            "active": true
                        },
                        {
                            "label": "东皇-命中叠加",
                            "trigger": "hit",
                            "script": "if (!args.isHit) return;\nconst hour = game.time.worldTime / 3600 % 24;\nif (hour >= 11 && hour < 13) {\n    const source = thisItem.effects.getName(\"劲气\");\n    if (source) await game.xjzl.api.effects.addEffect(actor, source);\n} else {\n    const source = thisItem.effects.getName(\"劲力\");\n    const effectData = source.toObject();\n    foundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 5);\n    await game.xjzl.api.effects.addEffect(actor, effectData);\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                }
            ],
            "xpInvested": 0,
            "active": false,
            "effects": [
                {
                    "name": "劲力",
                    "img": "icons/svg/explosion.svg",
                    "description": "东皇神火诀特效：招式伤害提升。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_jinli",
                            "stackable": true,
                            "maxStacks": 5
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.skill.mod",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                },
                {
                    "name": "劲气",
                    "img": "icons/svg/aura.svg",
                    "description": "东皇神火诀午时特效：招式伤害提升。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_jinqi",
                            "stackable": true,
                            "maxStacks": 5
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.skill.mod",
                            "mode": 2,
                            "value": "10"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "《太阴归藏诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 2,
            "element": "yin",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《初历江湖》专用，由咖啡祭祀撰写。<br>功法运行时，奇经八脉化作周天星斗图，以北斗天权星为引，将太阴寒精纳入紫府。修炼者每至月满，功力便增三分。</p>",
            "requirement": "悟性4，《九霄引星诀》圆满",
            "automationNote": "完全自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 6,
                        "shenfa": 8,
                        "tipo": 8,
                        "neixi": 12,
                        "qigan": 9,
                        "shencai": 5
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 16,
                        "tipo": 16,
                        "neixi": 24,
                        "qigan": 18,
                        "shencai": 10
                    },
                    "description": "<p>小成运功特效：每次命中获得一层绵劲（最高三层）<br>·你在夜晚，战斗开始时，获得一层养血，持续到战斗脱离。月圆之夜（每月十五）额外获得一层乘风<br>·夜晚（戌时至寅时）<br>绵劲：每层使你的柔属性武学招式伤害+5。<br>养血：每层使你回合末回复10点气血。<br>聚气：每层使你回合末回复5点内力。<br>眼力：每层使你的命中+5。<br>乘风：每层速度+1。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "太阴-战斗开始",
                            "trigger": "combatStart",
                            "script": "const hour = game.time.worldTime / 3600 % 24;\n// 夜晚：戌时(19-21) 至 寅时(3-5) -> 19:00 - 05:00\nif (hour >= 19 || hour < 5) {\n    await game.xjzl.api.effects.addEffect(actor, \"yangxue\");\n}",
                            "active": true
                        },
                        {
                            "label": "太阴-命中叠加",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const source = CONFIG.statusEffects.find(e => e.id === \"mianjin\");\n    const effectData = Object.assign({}, source, { flags: { \"xjzl-system\": { maxStacks: 3 } } });\n    await game.xjzl.api.effects.addEffect(actor, effectData);\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 18,
                        "shenfa": 24,
                        "tipo": 24,
                        "neixi": 36,
                        "qigan": 27,
                        "shencai": 15
                    },
                    "description": "<p>圆满运功特效：每次命中获得一层绵劲（最高五层），<br>·你在夜晚，战斗开始时，获得一层养血、聚气，持续到战斗脱离。月圆之夜（每月十五）额外获得一层眼力、乘风<br><strong>修满特效：</strong>修满[永久]：气血+40，内力+20。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "太阴-战斗开始",
                            "trigger": "combatStart",
                            "script": "const hour = game.time.worldTime / 3600 % 24;\nif (hour >= 19 || hour < 5) {\n    await game.xjzl.api.effects.addEffect(actor, \"yangxue\");\n    await game.xjzl.api.effects.addEffect(actor, \"juqi\");\n}",
                            "active": true
                        },
                        {
                            "label": "太阴-命中叠加",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const source = CONFIG.statusEffects.find(e => e.id === \"mianjin\");\n    const effectData = Object.assign({}, source, { flags: { \"xjzl-system\": { maxStacks: 5 } } });\n    await game.xjzl.api.effects.addEffect(actor, effectData);\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《九霄引星诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖4.png",
        "system": {
            "tier": 1,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《初历江湖》专用，由咖啡祭祀撰写。<br>此诀暗藏\"追星赶月\"步法，可预判对手轨迹。</p>",
            "requirement": "悟性1，熟背《甘石星经》",
            "automationNote": "部分自动化。修满特效的趁虚而入增伤需手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 1,
                        "shenfa": 9,
                        "tipo": 9,
                        "neixi": 5,
                        "qigan": 4,
                        "shencai": 2
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 2,
                        "shenfa": 6,
                        "tipo": 6,
                        "neixi": 10,
                        "qigan": 8,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 3,
                        "shenfa": 3,
                        "tipo": 3,
                        "neixi": 15,
                        "qigan": 12,
                        "shencai": 6
                    },
                    "description": "<p>圆满运功特效：不会被【趁虚而入】<br><strong>修满特效：</strong>修满[永久]：气血+10，内力+10，趁虚而入伤害+5</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "免疫趁虚而入",
                            "trigger": "preDefense",
                            "script": "if (args.move && (args.move.id === \"opportunity-attack\" || args.move.id === \"opportunity\")) {\n    ui.notifications.info(`${actor.name} 的九霄引星诀识破了趁虚而入！`);\n    // 免疫伤害\n    args.output.abort = true;\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 10
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《幻墨心经》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
        "system": {
            "tier": 2,
            "element": "yin",
            "sect": "jianghushili",
            "description": "<p>本资源为模组《画卷奇案》专用，由传奇级战棋新手撰写。<br>由阎时以外物入墨为引，开创的幻墨决所对应的心法，用于降低幻墨决对使用者的伤害，但仍然会对修行者本身造成一定伤害。</p>",
            "requirement": "悟性4",
            "automationNote": "完全手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 6,
                        "shenfa": 6,
                        "tipo": 7,
                        "neixi": 14,
                        "qigan": 10,
                        "shencai": 5
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 12,
                        "tipo": 14,
                        "neixi": 28,
                        "qigan": 20,
                        "shencai": 10
                    },
                    "description": "<p>小成运功特效：《幻墨决》功法对自身伤害降低10点。</p>",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 18,
                        "shenfa": 18,
                        "tipo": 21,
                        "neixi": 42,
                        "qigan": 30,
                        "shencai": 15
                    },
                    "description": "<p>圆满运功特效：《幻墨决》功法对自身伤害固定为10点。可以修炼《幻墨决》内天级招式。<br><strong>修满特效：</strong>修满[永久]：减少气血20点，增加内力30点。可以修炼《幻墨决》内天级招式。</p>",
                    "xpCostRatio": 1
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": -20
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 30
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《灵巫神功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 3,
            "element": "yang",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《乌蒙旧怨》专用，由Alex.C撰写。<br>巫族首领蚺结合万灵功与巫体创造出的功法。取万灵之神力，辅以大成巫体的极强体魄，方可修炼。此功法可使巫纹（战纹）固化，将其融入皮肤化作图腾。圆满后举手投足之间充满力道，以一力破万法，如战神降临。</p>",
            "requirement": "悟性11，万灵功圆满，巫体修炼至三阶段：兽体",
            "automationNote": "部分自动化。免疫控制已实现。D20投出1视为20需手动判定。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 32,
                        "shenfa": 20,
                        "tipo": 25,
                        "neixi": 16,
                        "qigan": 15,
                        "shencai": 12
                    },
                    "description": "<p>领悟运功特效：你的命中、属性检定的 D20 投掷出 1时，视作20；你可同时绘制三种战纹。</p>",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 64,
                        "shenfa": 40,
                        "tipo": 50,
                        "neixi": 32,
                        "qigan": 30,
                        "shencai": 24
                    },
                    "description": "<p>小成运功特效：你的命中、属性检定的 D20 投掷出 1，2时，视作20；你可同时绘制五种战纹。</p>",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 94,
                        "shenfa": 60,
                        "tipo": 75,
                        "neixi": 48,
                        "qigan": 45,
                        "shencai": 36
                    },
                    "description": "<p>圆满运功特效：你的命中、属性检定的 D20 投掷出 1，2时，视作20；你可同时绘制五种战纹；你免疫击飞、击退、击倒。<br><strong>修满特效：</strong>修满【永久】：气血+80，内力+40，力量+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "免疫控制",
                            "trigger": "passive",
                            "script": "if (actor.xjzlStatuses.prone) actor.xjzlStatuses.prone = false;\n// 击飞击退目前没有统一的status flag，通常通过描述实现",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "stats.liliang.mod",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《销骨焚心决》（失传）",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 2,
            "element": "yang",
            "sect": "jianghushili",
            "description": "<p>本资源为模组《千斛担》专用，由浅蓝的孢子撰写。<br>已经完全失传的武功，以心为柴，以身为灶，焚却奇经八脉，五脏六腑，以获取极人之力。</p>",
            "requirement": "悟性4",
            "automationNote": "部分自动化。需手动添加【焚心】状态。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 7,
                        "tipo": 7,
                        "neixi": 7,
                        "qigan": 6,
                        "shencai": 5
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 26,
                        "shenfa": 15,
                        "tipo": 15,
                        "neixi": 12,
                        "qigan": 12,
                        "shencai": 8
                    },
                    "description": "<p>小成运功特效：战斗中以次要动作启动，立即获得一层“焚心”状态，持续3回合。焚心状态结束后，你立即陷入濒死状态并立即进行一次残疾检定。<br>焚心：招式伤害提升10点，获得10点内功防御与外功防御。在持续时间里，你免疫剧痛、疲劳带来的影响。当你获得焚心状态时，你获得等同2x焚心层数的怒气。</p>",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 40,
                        "shenfa": 21,
                        "tipo": 22,
                        "neixi": 18,
                        "qigan": 18,
                        "shencai": 11
                    },
                    "description": "<p>圆满运功特效：战斗中以次要动作启动，立即获得二层“焚心”状态，持续3回合，并在下一回合再获得一层“焚心”，持续1回合。三层焚心状态结束后，你立即因经脉俱断，五脏皆焚而死。<br><strong>修满特效：</strong>修满[永久]：气血+40，内力+20</p>",
                    "xpCostRatio": 1
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                }
            ],
            "xpInvested": 0,
            "active": false,
            "effects": [
                {
                    "name": "焚心",
                    "img": "icons/magic/fire/dagger-rune-enchant-flame-strong-red.webp",
                    "description": "销骨焚心决状态：增伤、增防。结束时副作用严重。",
                    "transfer": false,
                    "duration": {
                        "rounds": 3
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.skill.mod",
                            "mode": 2,
                            "value": "10"
                        },
                        {
                            "key": "system.combat.def_waigong",
                            "mode": 2,
                            "value": "10"
                        },
                        {
                            "key": "system.combat.def_neigong",
                            "mode": 2,
                            "value": "10"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_fenxin",
                            "stackable": true,
                            "scripts": [
                                {
                                    "label": "焚心副作用",
                                    "trigger": "turnEnd",
                                    "script": "if (effect.duration.remaining <= 0) {\n    ui.notifications.warn(`${actor.name} 焚心状态结束，经脉俱断！`);\n    await actor.toggleStatusEffect(\"dying\", { active: true, overlay: true });\n}",
                                    "active": true
                                },
                                {
                                    "label": "免疫痛苦",
                                    "trigger": "passive",
                                    "script": "if (actor.xjzlStatuses.pain) actor.xjzlStatuses.pain = false;\nif (actor.xjzlStatuses.fatigue) actor.xjzlStatuses.fatigue = false;",
                                    "active": true
                                }
                            ]
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "《曲水合契决》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
        "system": {
            "tier": 2,
            "element": "yin",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《玉阙书珍劫》专用，由笑鸫、黍鹀撰写。<br>人各怀志，或快意恩仇，或逐鹿商海，或醉心武学，趣舍万殊。此功之妙，在于觅得万殊之合契。功成时内力如水，收发随心，剑气丈余，掌风裂石，不在话下。只可惜时过境迁，如今只余残卷，小成之后再难寸进。</p>",
            "requirement": "悟性1",
            "automationNote": "完全手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 3,
                        "shenfa": 5,
                        "tipo": 7,
                        "neixi": 16,
                        "qigan": 10,
                        "shencai": 6
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 9,
                        "shenfa": 10,
                        "tipo": 14,
                        "neixi": 32,
                        "qigan": 20,
                        "shencai": 12
                    },
                    "description": "<p>小成运功特效：使用的招式与在场单位最近一次使用的招式类型相同时，招式距离增加3米。</p>",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 15,
                        "tipo": 21,
                        "neixi": 48,
                        "qigan": 30,
                        "shencai": 18
                    },
                    "description": "<p>圆满运功特效：使用的招式与在场单位最近一次使用的招式类型相同时，招式距离增加3米，同时根据招式类型获得以下增益：<br>实招/绝招：招式伤害增加10点。<br>虚招：看破值增加2点。<br>架招：获得10点护体真气。<br>气招：恢复10点气血。<br><strong>修满特效：</strong>修满[永久]：气血+30，内力+30。<br>[书写]+1，任选一个技艺再+1。(自行添加技艺)</p>",
                    "xpCostRatio": 1
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 30
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 30
                },
                {
                    "key": "arts.shuxie.value",
                    "value": 1
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《叠翠穿云功》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 2,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>本武功为模组《玉阙书珍劫》专用，由笑鸫、黍鹀撰写。<br>修习此功者需以江山辽阔入心，遍览大江奔流，亲见高岭入云，则心外再无地厚天高。功成之后，最擅辗转挪腾、长于登高远眺。</p>",
            "requirement": "悟性4",
            "automationNote": "完全自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 3,
                        "shenfa": 10,
                        "tipo": 7,
                        "neixi": 9,
                        "qigan": 12,
                        "shencai": 6
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 6,
                        "shenfa": 22,
                        "tipo": 13,
                        "neixi": 18,
                        "qigan": 25,
                        "shencai": 12
                    },
                    "description": "<p>小成运功特效：当你的回合开始时，剩余的移动速度减半保留。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "保留速度(半)",
                            "trigger": "turnStart",
                            "script": "const savedSpeed = actor.getFlag(\"xjzl-system\", \"neigong_savedSpeed\") || 0;\nif (savedSpeed > 0) {\n    ui.notifications.info(`叠翠穿云功生效，保留速度: ${savedSpeed}`);\n    const buff = { \n        name: \"速度保留\", \n        duration: { turns: 1 }, \n        changes: [{ key: \"system.combat.speed\", mode: 2, value: savedSpeed }] \n    };\n    await game.xjzl.api.effects.addEffect(actor, buff);\n    await actor.unsetFlag(\"xjzl-system\", \"neigong_savedSpeed\");\n}",
                            "active": true
                        },
                        {
                            "label": "记录速度",
                            "trigger": "turnEnd",
                            "script": "const currentSpeed = actor.system.combat.speedTotal;\nif (currentSpeed > 0) {\n    await actor.setFlag(\"xjzl-system\", \"neigong_savedSpeed\", Math.floor(currentSpeed / 2));\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 8,
                        "shenfa": 32,
                        "tipo": 19,
                        "neixi": 29,
                        "qigan": 39,
                        "shencai": 16
                    },
                    "description": "<p>圆满运功特效：当你的回合结束时，剩余的移动速度翻倍；当你的回合开始时，剩余的移动速度减半保留。<br><strong>修满特效：</strong>修满：[永久]：内力+20，气血+40，轻功+2。<br>当你进行山水画的[作画]的技能检定时，结果+2。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "保留速度(翻倍记录)",
                            "trigger": "turnEnd",
                            "script": "const currentSpeed = actor.system.combat.speedTotal;\nif (currentSpeed > 0) {\n    await actor.setFlag(\"xjzl-system\", \"neigong_savedSpeed\", currentSpeed);\n}",
                            "active": true
                        },
                        {
                            "label": "应用保留速度",
                            "trigger": "turnStart",
                            "script": "const savedSpeed = actor.getFlag(\"xjzl-system\", \"neigong_savedSpeed\") || 0;\nif (savedSpeed > 0) {\n    ui.notifications.info(`叠翠穿云功生效，保留速度: ${savedSpeed}`);\n    const buff = { \n        name: \"速度保留\", \n        duration: { turns: 1 }, \n        changes: [{ key: \"system.combat.speed\", mode: 2, value: savedSpeed }] \n    };\n    await game.xjzl.api.effects.addEffect(actor, buff);\n    await actor.unsetFlag(\"xjzl-system\", \"neigong_savedSpeed\");\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                },
                {
                    "key": "skills.qinggong.mod",
                    "value": 2
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "《归墟诀》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖4.png",
        "system": {
            "tier": 2,
            "element": "yang",
            "sect": "jianghushili",
            "description": "<p>本资源为模组《隐龙群侠传》专用，由阿抽撰写。</p>",
            "requirement": "悟性5",
            "automationNote": "部分自动化。心流10的攻击流失效果需手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 10,
                        "tipo": 16,
                        "neixi": 6,
                        "qigan": 4,
                        "shencai": 2
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 20,
                        "shenfa": 20,
                        "tipo": 32,
                        "neixi": 18,
                        "qigan": 2,
                        "shencai": 4
                    },
                    "description": "<p>小成特效：受到内/外功伤害后获得一层“专注”<br>专注：命中、闪避+1，暴击骰-1，上限10层，回合结束时失去3层</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "专注-受击",
                            "trigger": "damaged",
                            "script": "if ([\"waigong\", \"neigong\"].includes(args.type) && args.finalDamage > 0) {\n    const source = thisItem.effects.getName(\"专注\");\n    if (source) await game.xjzl.api.effects.addEffect(actor, source);\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 30,
                        "tipo": 48,
                        "neixi": 18,
                        "qigan": 12,
                        "shencai": 6
                    },
                    "description": "<p>圆满特效：受到内/外功伤害后获得一层“专注”，“专注”层数达到3/5/7/10时进入“心流”状态<br>心流3：格挡+10            心流5：内/外防+10<br>心流7：你无法被击退，击倒，击飞，禁足，缚身<br>心流10：攻击时额外造成自身50%外防的气血流失<br>·“专注”层数达到上限后，再次获得“专注”层数时可对伤害来源进行一次无消耗的普通攻击<br><strong>修满特效：</strong>修满[永久]：气血+60，内外功防御+5。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "专注-受击",
                            "trigger": "damaged",
                            "script": "if ([\"waigong\", \"neigong\"].includes(args.type) && args.finalDamage > 0) {\n    const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_zhuanzhu\");\n    const stacks = effect ? (effect.getFlag(\"xjzl-system\", \"stacks\") || 0) : 0;\n    \n    if (stacks >= 10 && args.attacker) {\n        ui.notifications.info(\"专注已满，触发反击！\");\n    } else {\n        const source = thisItem.effects.getName(\"专注\");\n        if (source) await game.xjzl.api.effects.addEffect(actor, source);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 60
                },
                {
                    "key": "combat.def_waigong",
                    "value": 5
                },
                {
                    "key": "combat.def_neigong",
                    "value": 5
                }
            ],
            "xpInvested": 0,
            "active": false,
            "effects": [
                {
                    "name": "专注",
                    "img": "icons/svg/eye.svg",
                    "description": "归墟诀特效。增加命中、闪避，降低暴击阈值。满层触发心流。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "system.combat.hit_waigong",
                            "mode": 2,
                            "value": "1"
                        },
                        {
                            "key": "system.combat.hit_neigong",
                            "mode": 2,
                            "value": "1"
                        },
                        {
                            "key": "system.combat.dodge",
                            "mode": 2,
                            "value": "1"
                        },
                        {
                            "key": "system.combat.crit_waigong",
                            "mode": 2,
                            "value": "-1"
                        },
                        {
                            "key": "system.combat.crit_neigong",
                            "mode": 2,
                            "value": "-1"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_zhuanzhu",
                            "stackable": true,
                            "maxStacks": 10,
                            "scripts": [
                                {
                                    "label": "专注流失",
                                    "trigger": "turnEnd",
                                    "script": "await game.xjzl.api.effects.removeEffect(actor, \"neigong_zhuanzhu\", 3);",
                                    "active": true
                                },
                                {
                                    "label": "心流计算",
                                    "trigger": "passive",
                                    "script": "const stacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 0;\nif (stacks >= 3) S.combat.block += 10;\nif (stacks >= 5) { S.combat.def_waigong += 10; S.combat.def_neigong += 10; }\nif (stacks >= 7) {\n    if(actor.xjzlStatuses.prone) actor.xjzlStatuses.prone = false;\n    if(actor.xjzlStatuses.root) actor.xjzlStatuses.root = false;\n    if(actor.xjzlStatuses.fushen) actor.xjzlStatuses.fushen = false;\n}",
                                    "active": true
                                },
                                {
                                    "label": "心流10攻击",
                                    "trigger": "hit",
                                    "script": "const stacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 0;\nif (stacks >= 10 && args.isHit) {\n    const dmg = Math.floor(S.combat.defWaigongTotal * 0.5);\n    await args.target.applyDamage({ amount: dmg, type: \"liushi\", isHit: true });\n}",
                                    "active": true
                                }
                            ]
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "《闪雷经》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 2,
            "element": "yang",
            "sect": "jianghushili",
            "description": "<p>本资源为模组《隐龙群侠传》专用，由阿抽撰写。</p>",
            "requirement": "悟性5",
            "automationNote": "半自动化。出招时需手动输入位移距离。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 8,
                        "shenfa": 16,
                        "tipo": 10,
                        "neixi": 4,
                        "qigan": 6,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 32,
                        "tipo": 20,
                        "neixi": 8,
                        "qigan": 12,
                        "shencai": 8
                    },
                    "description": "<p>小成特效：你的招式伤害增加3X（X为招式施展时的位移距离）</p>",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 24,
                        "shenfa": 48,
                        "tipo": 30,
                        "neixi": 12,
                        "qigan": 18,
                        "shencai": 12
                    },
                    "description": "<p>圆满特效：你的招式伤害增加3X（X为招式施展时的位移距离）<br>·若目标不在你的攻击范围内，出招前你可消耗X点速度朝目标冲刺X米，直至目标进入你的攻击范围后停下（视为招式施展时的位移距离）<br>·冲刺无法穿过障碍物<br>·若冲刺时受到【趁虚而入】攻击，冲刺结束后剩余速度归零<br><strong>修满特效：</strong>修满[永久]：气血+30，内力+30，速度+2。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "位移增伤",
                            "trigger": "calc",
                            "script": "const dist = await foundry.applications.api.DialogV2.prompt({\n    window: { title: \"闪雷经\" },\n    content: \"<p>请输入本回合出招前的位移距离(米):</p><input type='number' name='dist' value='0'>\",\n    ok: { callback: (e, b) => b.form.elements.dist.value }\n});\nif (dist > 0) {\n    const bonus = dist * 3;\n    args.output.damage += bonus;\n    args.output.bonusDesc.push(`闪雷位移(${dist}m) +${bonus}`);\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 30
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 30
                },
                {
                    "key": "combat.speed",
                    "value": 2
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "摩罗心经",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
        "system": {
            "tier": 2,
            "element": "yin",
            "sect": "jianghushili",
            "description": "<p>本资源为模组《隐龙群侠传》专用，由阿抽撰写。摩罗殿禁传秘术，以“执念为刃，业火焚心”强夺天地造化。修习者需主动激发自身七情六欲，凝为“业劫煞气”，然此功凶险，稍有不慎则遭反噬，沦为癫狂天魔傀儡。</p>",
            "requirement": "悟性5",
            "automationNote": "手动应用煞气。天魔化身已自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 6,
                        "shenfa": 9,
                        "tipo": 5,
                        "neixi": 16,
                        "qigan": 8,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 10,
                        "shenfa": 18,
                        "tipo": 12,
                        "neixi": 21,
                        "qigan": 16,
                        "shencai": 8
                    },
                    "description": "<p>小成运功特效：造成或受到伤害时，进行一次【DC5】检定，成功则获得一层“业劫煞气”，上限6层。<br>业劫煞气：出招时每有一层则自身伤害+5</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage3": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 27,
                        "tipo": 18,
                        "neixi": 48,
                        "qigan": 24,
                        "shencai": 15
                    },
                    "description": "<p>圆满运功特效：造成或受到伤害时，进行一次【DC5】检定，成功则获得一层“业劫煞气”，上限6层。<br>业劫煞气：出招时每有一层则自身伤害+5<br>·回合开始时，若自身“业劫煞气”达到6层，则移除所有“业劫煞气”且无法再获得，扣除自身10%最大生命值，进入“他化自在天魔”状态，持续至战斗结束。<br>他化自在天魔：将自身行动顺序调整为第一个，攻击时额外造成30点气血流失，自身受到的伤害增加10。<br><strong>修满特效：</strong>修满【永久】：气血+40，内力+20，【定力】-2</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "天魔化身检查",
                            "trigger": "turnStart",
                            "script": "const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_shaqi\");\nconst stacks = effect ? (effect.getFlag(\"xjzl-system\", \"stacks\") || 0) : 0;\nif (stacks >= 6) {\n    await effect.delete();\n    const dmg = Math.floor(S.resources.hp.max * 0.1);\n    await actor.applyDamage({ amount: dmg, type: \"liushi\", isHit: true });\n    const source = thisItem.effects.getName(\"他化自在天魔\");\n    await game.xjzl.api.effects.addEffect(actor, source);\n    ui.notifications.info(\"业劫煞气满盈，化身他化自在天魔！\");\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                },
                {
                    "key": "skills.dingli.mod",
                    "value": -2
                }
            ],
            "xpInvested": 0,
            "active": false,
            "effects": [
                {
                    "name": "业劫煞气",
                    "img": "icons/magic/death/skull-energy-light-purple.webp",
                    "description": "摩罗心经特效：增加招式伤害。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "system.combat.damages.skill.mod",
                            "mode": 2,
                            "value": "5"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_shaqi",
                            "stackable": true,
                            "maxStacks": 6
                        }
                    }
                },
                {
                    "name": "他化自在天魔",
                    "img": "icons/magic/control/silhouette-hold-beam-blue.webp",
                    "description": "摩罗心经满层煞气转化状态。",
                    "transfer": false,
                    "changes": [],
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_tianmo",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "天魔增伤",
                                    "trigger": "hit",
                                    "script": "if(args.type === 'attack' && args.isHit) { await args.target.applyDamage({ amount: 30, type: \"liushi\", isHit: true }); }",
                                    "active": true
                                },
                                {
                                    "label": "天魔易伤",
                                    "trigger": "preTake",
                                    "script": "args.output.damage += 10;",
                                    "active": true
                                }
                            ]
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "幻欲天魔功",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 3,
            "element": "yin",
            "sect": "jianghushili",
            "description": "<p>本资源为模组《隐龙群侠传》专用，由阿抽撰写。摩罗殿至高邪典，以魔罗幻惑众生之能为基，凝内力为“六欲天魔气”，出招时无形侵蚀对手五感六识。气劲所至，触发惑目、乱耳、灼体，更引破防、断势、噬魂，六重欲劫层层相扣，若六劫齐发，则堕“六欲沉沦”之境，祸心乱神，周身内力逆乱如坠无间。</p>",
            "requirement": "悟性15",
            "automationNote": "手动应用六欲状态。状态集齐后的特殊效果自动判定。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 22,
                        "tipo": 20,
                        "neixi": 36,
                        "qigan": 20,
                        "shencai": 10
                    },
                    "description": "<p>领悟运功特效：造成伤害后进行一次【DC6】检定，根据检定结果施加不同的“六欲天魔气”。</p>",
                    "xpCostRatio": 1,
                    "scripts": []
                },
                "stage2": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 44,
                        "tipo": 40,
                        "neixi": 66,
                        "qigan": 40,
                        "shencai": 20
                    },
                    "description": "<p>小成运功特效：...同时受到三种以上“六欲天魔气”的影响时，使自身陷入“迟滞”状态。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "六欲施加与判定",
                            "trigger": "hit",
                            "script": "if (!args.isHit || args.finalDamage <= 0) return;\nconst targetEffects = args.target.effects.filter(e => e.getFlag(\"xjzl-system\", \"slug\")?.startsWith(\"liuyu_\"));\nconst uniqueTypes = new Set(targetEffects.map(e => e.getFlag(\"xjzl-system\", \"slug\"))).size;\nif (uniqueTypes >= 3) {\n    await game.xjzl.api.effects.addEffect(args.target, \"chizhi\");\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 48,
                        "shenfa": 66,
                        "tipo": 60,
                        "neixi": 96,
                        "qigan": 60,
                        "shencai": 30
                    },
                    "description": "<p>圆满运功特效：...同时受到六种“六欲天魔气”的影响时，使自身陷入“走火入魔”状态。<br><strong>修满特效：</strong>修满【永久】：气血+80，内力+40，你的【说服】【欺瞒】具有优势</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "六欲全判定",
                            "trigger": "hit",
                            "script": "if (!args.isHit || args.finalDamage <= 0) return;\nconst targetEffects = args.target.effects.filter(e => e.getFlag(\"xjzl-system\", \"slug\")?.startsWith(\"liuyu_\"));\nconst uniqueTypes = new Set(targetEffects.map(e => e.getFlag(\"xjzl-system\", \"slug\"))).size;\nif (uniqueTypes >= 3) await game.xjzl.api.effects.addEffect(args.target, \"chizhi\");\nif (uniqueTypes >= 6) await game.xjzl.api.effects.addEffect(args.target, \"rage\");",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                },
                {
                    "key": "skills.shuofu.checkMod",
                    "value": 1
                },
                {
                    "key": "skills.qiman.checkMod",
                    "value": 1
                }
            ],
            "xpInvested": 0,
            "active": false,
            "effects": [
                {
                    "name": "色相迷障",
                    "img": "icons/svg/debuff.svg",
                    "description": "六欲之一。暴击骰+1。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "system.combat.crit_waigong",
                            "mode": 2,
                            "value": "1"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "liuyu_1",
                            "stackable": true
                        }
                    }
                },
                {
                    "name": "形骸溃散",
                    "img": "icons/svg/debuff.svg",
                    "description": "六欲之一。易伤+10。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "flags.xjzl-system.yishang",
                            "mode": 2,
                            "value": "10"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "liuyu_2",
                            "stackable": true
                        }
                    }
                },
                {
                    "name": "威仪崩殂",
                    "img": "icons/svg/debuff.svg",
                    "description": "六欲之一。回合结束内力流失。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "flags.xjzl-system.regenMpTurnEnd",
                            "mode": 2,
                            "value": "-5"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "liuyu_3",
                            "stackable": true
                        }
                    }
                },
                {
                    "name": "音声堕魂",
                    "img": "icons/svg/debuff.svg",
                    "description": "六欲之一。命中降低。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "system.combat.hit_waigong",
                            "mode": 2,
                            "value": "-5"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "liuyu_4",
                            "stackable": true
                        }
                    }
                },
                {
                    "name": "触孽焚身",
                    "img": "icons/svg/debuff.svg",
                    "description": "六欲之一。速度降低。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "system.combat.speed",
                            "mode": 2,
                            "value": "-1"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "liuyu_5",
                            "stackable": true
                        }
                    }
                },
                {
                    "name": "心魔具现",
                    "img": "icons/svg/debuff.svg",
                    "description": "六欲之一。回合结束气血流失。",
                    "transfer": false,
                    "changes": [
                        {
                            "key": "flags.xjzl-system.regenHpTurnEnd",
                            "mode": 2,
                            "value": "-10"
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "liuyu_6",
                            "stackable": true
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "《哀鸿录·真》",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 2,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>【2025年共创】哀鸿录·真（地级内功）<br>本资源为模组《归乡见闻录·卷一》专用，由书院十四先生撰写。<br>遍地哀鸿满城血，无非一念救苍生。</p>",
            "requirement": "悟性4",
            "automationNote": "部分自动化。移除“九流”需手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 8,
                        "shenfa": 8,
                        "tipo": 8,
                        "neixi": 8,
                        "qigan": 8,
                        "shencai": 8
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 16,
                        "tipo": 16,
                        "neixi": 16,
                        "qigan": 16,
                        "shencai": 16
                    },
                    "description": "<p>小成运功特效：你可以移除“九流”，敌方每有 1 点杀孽，移除“九流”时额外增加 5 点招式伤害。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "杀孽增伤",
                            "trigger": "calc",
                            "script": "const shanie = args.target?.system?.resources?.shanie || 0;\nif (shanie > 0) {\n    const bonus = shanie * 5;\n    args.output.bonusDesc.push(`敌方杀孽(${shanie}) 潜在增伤 +${bonus}`);\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 24,
                        "shenfa": 24,
                        "tipo": 24,
                        "neixi": 24,
                        "qigan": 24,
                        "shencai": 24
                    },
                    "description": "<p>圆满运功特效：你可以移除“九流”，敌方每有 1 点杀孽，移除“九流”时额外增加 10 点招式伤害。<br><strong>修满特效：</strong>修满（永久）：气血+60，侠义值-100，恶行值-100（只可触发一次）</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "杀孽增伤",
                            "trigger": "calc",
                            "script": "const shanie = args.target?.system?.resources?.shanie || 0;\nif (shanie > 0) {\n    const bonus = shanie * 10;\n    args.output.bonusDesc.push(`敌方杀孽(${shanie}) 潜在增伤 +${bonus}`);\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 60
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "合灵篇",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖3.png",
        "system": {
            "tier": 1,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>狩魂者入门法门。讲究形灵相契，肉体为灵之容器，灵藏于内、肉守于外。修炼者借星象调息，使灵随气血周流无滞，直至灵与肉的界限消弭。</p>",
            "requirement": "悟性1",
            "automationNote": "完全自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 2,
                        "shenfa": 2,
                        "tipo": 3,
                        "neixi": 2,
                        "qigan": 7,
                        "shencai": 2
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 4,
                        "shenfa": 4,
                        "tipo": 6,
                        "neixi": 4,
                        "qigan": 14,
                        "shencai": 4
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage3": {
                    "stats": {
                        "liliang": 6,
                        "shenfa": 6,
                        "tipo": 10,
                        "neixi": 6,
                        "qigan": 20,
                        "shencai": 6
                    },
                    "description": "<p>圆满运功特效：进入战斗时，获得等同于你【气感+神采】数值的护体真气，持续到战斗脱离。<br><strong>修满特效：</strong>修满[永久]：气血+10，内力+10。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "战斗护体",
                            "trigger": "combatStart",
                            "script": "const amount = (S.stats.qigan.total || 0) + (S.stats.shencai.total || 0);\nawait actor.applyHealing({ amount: amount, type: \"huti\" });",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 10
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 10
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "通灵篇",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖2.png",
        "system": {
            "tier": 2,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>狩魂者核心法门。大至星辰运转，小至草木生息，皆以灵为本，阴邪秽物亦源于灵的失衡。此功奉“天人共灵”为旨，引动自身灵识，通感万物。</p>",
            "requirement": "悟性4",
            "automationNote": "完全自动化。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 6,
                        "shenfa": 6,
                        "tipo": 6,
                        "neixi": 6,
                        "qigan": 12,
                        "shencai": 12
                    },
                    "description": "",
                    "xpCostRatio": 1
                },
                "stage2": {
                    "stats": {
                        "liliang": 12,
                        "shenfa": 12,
                        "tipo": 12,
                        "neixi": 12,
                        "qigan": 24,
                        "shencai": 24
                    },
                    "description": "<p>小成运功特效：你的命中和招式伤害提升等同于你【[探查]等级】的数值。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "探查加成",
                            "trigger": "passive",
                            "script": "const bonus = actor.system.skills.tancha.total || 0;\nS.combat.hit_waigong += bonus;\nS.combat.hit_neigong += bonus;\nS.combat.damages.skill.mod += bonus;",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 16,
                        "shenfa": 16,
                        "tipo": 16,
                        "neixi": 16,
                        "qigan": 40,
                        "shencai": 40
                    },
                    "description": "<p>圆满运功特效：你的命中和招式伤害提升等同于你【[探查]等级+[定力]等级】的数值。<br><strong>修满特效：</strong>修满[永久]：气血+40，内力+20。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "双技能加成",
                            "trigger": "passive",
                            "script": "const bonus = (actor.system.skills.tancha.total || 0) + (actor.system.skills.dingli.total || 0);\nS.combat.hit_waigong += bonus;\nS.combat.hit_neigong += bonus;\nS.combat.damages.skill.mod += bonus;",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 40
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 20
                }
            ],
            "xpInvested": 0,
            "active": false
        }
    },
    {
        "name": "镇灵篇",
        "type": "neigong",
        "img": "systems/xjzl-system/assets/icons/neigong/江湖1.png",
        "system": {
            "tier": 3,
            "element": "taiji",
            "sect": "jianghushili",
            "description": "<p>此功为钦天监初代监正所创，取鬼谷子《伏魔七十二诀》精要，含大量驱邪法门，集“术、阵、器”于一体，非真传难以窥其全貌。</p>",
            "requirement": "悟性11",
            "automationNote": "部分自动化。对[恶][邪]增伤已实现（需目标名称含关键字或侠义恶行值符合条件）。移除状态免疫需手动。",
            "config": {
                "stage1": {
                    "stats": {
                        "liliang": 15,
                        "shenfa": 15,
                        "tipo": 15,
                        "neixi": 15,
                        "qigan": 25,
                        "shencai": 35
                    },
                    "description": "<p>领悟运功特效：每次出招或使用物品后，获得一层“破魂”，至多一层，持续到战斗脱离。<br>破魂：每层使你对[恶][邪]目标的招式伤害+10。<br>·当你被他人添加状态时，可消耗反应动作移除一层破魂，使你不被添加该状态。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "破魂-出招",
                            "trigger": "attack",
                            "script": "const source = thisItem.effects.getName(\"破魂\");\nconst effectData = source.toObject();\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 1);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        },
                        {
                            "label": "邪恶增伤",
                            "trigger": "preDamage",
                            "script": "const targetSys = args.target?.system;\nlet isEvil = false;\nif (targetSys && targetSys.social) {\n    const exing = targetSys.social.exing || 0;\n    const xiayi = targetSys.social.xiayi || 0;\n    if (exing >= 100 && xiayi <= 50) isEvil = true;\n}\nif (args.target && (args.target.name.includes(\"恶\") || args.target.name.includes(\"邪\"))) isEvil = true;\n\nif (isEvil) {\n    const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_pohun\");\n    const stacks = effect ? (effect.getFlag(\"xjzl-system\", \"stacks\") || 1) : 0;\n    if (stacks > 0) {\n        args.config.amount += stacks * 10;\n        ui.notifications.info(`破魂生效：对邪恶目标增伤 +${stacks * 10}`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage2": {
                    "stats": {
                        "liliang": 30,
                        "shenfa": 30,
                        "tipo": 30,
                        "neixi": 30,
                        "qigan": 50,
                        "shencai": 70
                    },
                    "description": "<p>小成运功特效：每次出招或使用物品后，获得一层“破魂”，至多二层，持续到战斗脱离。</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "破魂-出招",
                            "trigger": "attack",
                            "script": "const source = thisItem.effects.getName(\"破魂\");\nconst effectData = source.toObject();\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 2);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        },
                        {
                            "label": "邪恶增伤",
                            "trigger": "preDamage",
                            "script": "const targetSys = args.target?.system;\nlet isEvil = false;\nif (targetSys && targetSys.social) {\n    const exing = targetSys.social.exing || 0;\n    const xiayi = targetSys.social.xiayi || 0;\n    if (exing >= 100 && xiayi <= 50) isEvil = true;\n}\nif (args.target && (args.target.name.includes(\"恶\") || args.target.name.includes(\"邪\"))) isEvil = true;\n\nif (isEvil) {\n    const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_pohun\");\n    const stacks = effect ? (effect.getFlag(\"xjzl-system\", \"stacks\") || 1) : 0;\n    if (stacks > 0) {\n        args.config.amount += stacks * 10;\n        ui.notifications.info(`破魂生效：对邪恶目标增伤 +${stacks * 10}`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                "stage3": {
                    "stats": {
                        "liliang": 45,
                        "shenfa": 45,
                        "tipo": 45,
                        "neixi": 45,
                        "qigan": 75,
                        "shencai": 105
                    },
                    "description": "<p>圆满运功特效：每次出招或使用物品后，获得一层“破魂”，至多三层，持续到战斗脱离。<br><strong>修满特效：</strong>修满[永久]：气血+80，内力+40</p>",
                    "xpCostRatio": 1,
                    "scripts": [
                        {
                            "label": "破魂-出招",
                            "trigger": "attack",
                            "script": "const source = thisItem.effects.getName(\"破魂\");\nconst effectData = source.toObject();\nfoundry.utils.setProperty(effectData, \"flags.xjzl-system.maxStacks\", 3);\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        },
                        {
                            "label": "邪恶增伤",
                            "trigger": "preDamage",
                            "script": "const targetSys = args.target?.system;\nlet isEvil = false;\nif (targetSys && targetSys.social) {\n    const exing = targetSys.social.exing || 0;\n    const xiayi = targetSys.social.xiayi || 0;\n    if (exing >= 100 && xiayi <= 50) isEvil = true;\n}\nif (args.target && (args.target.name.includes(\"恶\") || args.target.name.includes(\"邪\"))) isEvil = true;\n\nif (isEvil) {\n    const effect = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"neigong_pohun\");\n    const stacks = effect ? (effect.getFlag(\"xjzl-system\", \"stacks\") || 1) : 0;\n    if (stacks > 0) {\n        args.config.amount += stacks * 10;\n        ui.notifications.info(`破魂生效：对邪恶目标增伤 +${stacks * 10}`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            },
            "masteryChanges": [
                {
                    "key": "resources.hp.bonus",
                    "value": 80
                },
                {
                    "key": "resources.mp.bonus",
                    "value": 40
                }
            ],
            "xpInvested": 0,
            "active": false,
            "effects": [
                {
                    "name": "破魂",
                    "img": "icons/magic/symbols/rune-sigil-hook-white-pink.webp",
                    "description": "镇灵篇特效：增加对恶/邪目标的伤害。",
                    "transfer": false,
                    "changes": [],
                    "flags": {
                        "xjzl-system": {
                            "slug": "neigong_pohun",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    }
                }
            ]
        }
    }
]