[
    {
        "name": "翠竹镖（人）",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "category": "wuxue",
            "sect": "tangmen",
            "tier": 1,
            "description": "<p>唐家堡弟子以竹削成镖，俯拾即是，表面犹可示人以不用暗器，而后冷然举手发箭，人不易防。</p>",
            "requirements": "暗器-飞镖",
            "moves": [
                {
                    "name": "葱翠挺拔",
                    "type": "stance",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "weaponType": "hidden",
                    "description": "<p>次要动作，堂正而立，竹箭藏袖，开启架招。格挡成功后为目标添加一层“笨拙”，持续到脱战。</p><p>笨拙：每层使你的闪避-5。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "targetInfo": "自身",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": []
                    },
                    "scripts": [
                        {
                            "label": "架招：施加笨拙",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args) && args.attacker) {\n    const effectData = {\n        name: \"笨拙\",\n        icon: \"icons/svg/anchor.svg\",\n        changes: [{ key: \"system.combat.dodge\", mode: 2, value: \"-5\" }],\n        flags: { \"xjzl-system\": { slug: \"benzhuo\", stackable: true, maxStacks: 0 } }\n    };\n    await game.xjzl.api.effects.addEffect(args.attacker, effectData);\n}"
                        }
                    ]
                },
                {
                    "name": "竹涛起舞",
                    "type": "feint",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，甩手绿影而出，对目标造成 0.4 身法点外功伤害。命中无架招目标时，为其添加一层“流血”，持续到战斗脱离。</p><p>消耗：飞镖*1</p>",
                    "actionCost": "主要动作",
                    "range": "6米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招施加流血",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await game.xjzl.api.effects.addEffect(args.target, \"bleed_stack\");\n    ui.notifications.info(`${args.target.name} 被施加了流血`);\n}"
                        }
                    ]
                },
                {
                    "name": "竹影婆娑",
                    "type": "counter",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招。压制虚招，反手射出翠绿飞镖，对其造成 0.5 身法点外功伤害。</p><p>若目标处于“流血”，招式伤害+10 点。</p><p>消耗：飞镖*1</p>",
                    "actionCost": "反应动作",
                    "range": "6米",
                    "targetInfo": "单体",
                    "automationNote": "手动：反应动作。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "流血加伤",
                            "trigger": "preDamage",
                            "script": "const hasBleed = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"bleed_stack\");\nif (hasBleed) {\n    args.config.amount += 10;\n    ui.notifications.info(\"流血加成 +10\");\n}"
                        }
                    ]
                },
                {
                    "name": "势如破竹",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "isUltimate": true,
                    "description": "<p>主要动作，双手飞舞，前后射出两道绿芒。对目标造成两次 0.4 身法点外功伤害。（投掷一次命中）</p><p>·若目标的闪避低于你的命中，招式暴击骰-1。</p><p>消耗：飞镖*2</p>",
                    "actionCost": "主要动作",
                    "range": "10米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            0,
                            2,
                            4
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "压制暴击",
                            "trigger": "attack",
                            "script": "const target = game.user.targets.first()?.actor;\nif (target) {\n    const myHit = args.attacker.system.combat.hitWaigongTotal;\n    const targetDodge = target.system.combat.dodgeTotal;\n    if (targetDodge < myHit) {\n        args.flags.critThresholdMod += 1; // 阈值-1即更容易暴击，add 1\n        ui.notifications.info(\"势如破竹：命中压制，暴击率提升\");\n    }\n}"
                        },
                        {
                            "label": "第二段伤害",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    // 造成第二段伤害，数值与第一段（面板结算后）相同\n    // args.damage 是第一段计算后的数值\n    await args.target.applyDamage({\n        amount: args.damage,\n        type: args.move.damageType,\n        attacker: args.attacker,\n        isHit: true,\n        isCrit: args.isCrit,\n        applyCritDamage: true,\n        isBroken: args.isBroken,\n        ignoreBlock: args.ignoreBlock,\n        ignoreDefense: args.ignoreDefense,\n        ignoreStance: args.ignoreStance\n    });\n    ui.notifications.info(\"势如破竹：第二道绿芒\");\n}"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "盘蛇刺（人）",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "category": "wuxue",
            "sect": "tangmen",
            "tier": 1,
            "description": "<p>唐门入门武学，静则盘而不发，动则势若龙蛇。</p>",
            "requirements": "匕首、暗器-飞刀",
            "moves": [
                {
                    "name": "金鳞暗潜",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "description": "<p>主要动作，弯腰戳刺，对目标造成 0.4 力量点外功伤害。</p><p>·如果处于“随行”状态，招式伤害提高 5 点。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "随行加伤",
                            "trigger": "calc",
                            "script": "if (actor.effects.find(e => e.name === \"随行\")) {\n    args.output.damage += 5;\n    args.output.bonusDesc.push(\"随行加成 +5\");\n}"
                        }
                    ]
                },
                {
                    "name": "飞蛇吐信",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，袖甩飞刀，直逼命门，对目标造成 0.4 身法点外功伤害。</p><p>·若目标无架招，为其添加禁足，持续 1 回合。</p><p>消耗：飞刀*1</p>",
                    "actionCost": "主要动作",
                    "range": "5米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招禁足",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await game.xjzl.api.effects.addEffect(args.target, \"root\");\n    ui.notifications.info(`${args.target.name} 被禁足`);\n}"
                        }
                    ]
                },
                {
                    "name": "蛇影随行",
                    "type": "qi",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "none",
                    "actionType": "buff",
                    "weaponType": "dagger",
                    "description": "<p>次要动作，气灌四肢，迅捷如风，进入“随行”状态，持续一回合。</p><p>随行：速度+1，施展《盘蛇刺》招式时暴击骰-1。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "targetInfo": "自身",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0,
                        "scalings": []
                    },
                    "scripts": [
                        {
                            "label": "应用随行",
                            "trigger": "attack",
                            "script": "const lvl = args.move.computedLevel || 1;\nconst speedBonus = 1 + (lvl - 1);\nconst critBonus = 1 + (lvl - 1);\nconst effectData = {\n    name: \"随行\",\n    icon: \"icons/svg/wing.svg\",\n    duration: { rounds: 1 },\n    changes: [{ key: \"system.combat.speed\", mode: 2, value: speedBonus }],\n    flags: { \"xjzl-system\": { slug: \"suixing\", stackable: false } },\n    scripts: [{\n        label: \"盘蛇刺暴击加成\",\n        trigger: \"attack\",\n        script: \"if (item && item.name.includes('盘蛇刺')) args.flags.critThresholdMod += \" + critBonus + \";\"\n    }]\n};\n// 气招attack阶段对attacker(自己)应用\nawait game.xjzl.api.effects.addEffect(args.attacker, effectData);\nargs.flags.autoApplied = true;"
                        }
                    ]
                },
                {
                    "name": "巨蟒吞天",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "isUltimate": true,
                    "description": "<p>主要动作，气吞山河，连戳要害，对目标造成 0.6 力量点外功伤害。</p><p>如果处于“随行”状态，该招式伤害提高 10 点。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            0,
                            2,
                            4
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "随行加伤",
                            "trigger": "calc",
                            "script": "if (actor.effects.find(e => e.name === \"随行\")) {\n    args.output.damage += 10;\n    args.output.bonusDesc.push(\"随行加成 +10\");\n}"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "唐家拳（人）",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "category": "wuxue",
            "sect": "tangmen",
            "tier": 1,
            "description": "<p>唐家堡弟子世代研习贴身防护拳术，搏斗巧妙。</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "毒蛇绕梁",
                    "type": "stance",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "weaponType": "unarmed",
                    "description": "<p>次要动作，盘腿微蹲，开启架招。格挡成功后可消耗反应动作蹬腿，不消耗速度朝任意方向前扑 1 米，然后再给周围 1 米范围内的敌人添加“下盘不稳”，持续一回合。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "targetInfo": "自身",
                    "automationNote": "手动：位移、AOE范围下盘不稳。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": []
                    },
                    "scripts": [
                        {
                            "label": "架招反击",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args)) {\n    // 自动对攻击者生效\n    if (args.attacker) {\n        await game.xjzl.api.effects.addEffect(args.attacker, \"unstable\");\n    }\n    ui.notifications.info(`${actor.name} 触发毒蛇绕梁，请手动位移并检查周围敌人状态。`);\n}"
                        }
                    ]
                },
                {
                    "name": "蝎子甩尾",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "description": "<p>主要动作，双手撑地，脚踢喉骨，对目标造成 0.4 力量点外功伤害。你可以消耗自身剩余速度将目标击退，每消耗 5 米，击退目标 1 米。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "targetInfo": "单体",
                    "automationNote": "手动：击退。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "蜈蚣捕蝉",
                    "type": "feint",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "description": "<p>主要动作，拳脚左右连环出击，对目标造成 0.3 力量点外功伤害。击破架招时，为其添加一层“乏力”，至多三层，持续到脱战。</p><p>乏力：招式伤害降低 10 点。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "破架应用乏力",
                            "trigger": "hit",
                            "script": "if (args.isHit && args.isBroken) {\n    const effectData = {\n        name: \"乏力\",\n        icon: \"icons/svg/downgrade.svg\",\n        changes: [{ key: \"system.combat.damages.skill.mod\", mode: 2, value: \"-10\" }],\n        flags: { \"xjzl-system\": { slug: \"fali\", stackable: true, maxStacks: 3 } }\n    };\n    await game.xjzl.api.effects.addEffect(args.target, effectData);\n    ui.notifications.info(`${args.target.name} 乏力层数+1`);\n}"
                        }
                    ]
                },
                {
                    "name": "壁虎断尾",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "none",
                    "actionType": "buff",
                    "weaponType": "unarmed",
                    "isUltimate": true,
                    "description": "<p>当你受到招式伤害时，可消耗反应动作释放此招，不消耗速度借力后撤 1 米，减免 30 点伤害，并给攻击者添加“禁足”，持续一回合。</p>",
                    "actionCost": "反应动作",
                    "range": "自身",
                    "targetInfo": "攻击者",
                    "automationNote": "手动：反应动作触发。手动：位移与伤害减免。",
                    "costs": {
                        "mp": [
                            0,
                            2,
                            4
                        ],
                        "rage": [
                            5,
                            4,
                            3
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 30,
                        "growth": 10,
                        "scalings": []
                    },
                    "scripts": [
                        {
                            "label": "施加禁足",
                            "trigger": "hit",
                            "script": "await game.xjzl.api.effects.addEffect(args.target, \"root\");\nui.notifications.info(`${args.target.name} 被禁足`);"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "隐空匕（地）",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "category": "wuxue",
            "sect": "tangmen",
            "tier": 2,
            "description": "<p>唐门匕首绝技，以巧劲使匕首于手心旋转，来回飞舞，难以防备。</p>",
            "requirements": "匕首",
            "moves": [
                {
                    "name": "轮回刃",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "description": "<p>蓄力动作，隐匕虚空，将匕首朝空格处旋转掷出，对直线路径上的敌人造成 0.4 力量点外功伤害，若命中无架招目标，将其击飞 1 米。</p><p>·匕首飞行至空格处后，在你的回合末直线飞回你手中，并对返回直线路径上敌人造成 20 点气血流失，并使无架招目标击飞（返回距离无限制）。</p>",
                    "actionCost": "蓄力动作",
                    "range": "5米",
                    "targetInfo": "直线/空地",
                    "automationNote": "手动：击飞。手动：返回伤害。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "旋舞刃",
                    "type": "feint",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "description": "<p>主要动作，蹲身旋刃，造成 0.4 力量点外功伤害。击破对方架招时，给目标添加“五毒”，持续到战斗脱离。</p><p>五毒：你在每回合末受到 20 点毒素伤害。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "应用五毒",
                            "trigger": "hit",
                            "script": "if (args.isHit && args.isBroken) {\n    const effectData = {\n        name: \"五毒\",\n        icon: \"icons/svg/acid.svg\",\n        changes: [{ key: \"flags.xjzl-system.regenHpTurnEnd\", mode: 2, value: \"-20\" }],\n        flags: { \"xjzl-system\": { slug: \"wudu\", stackable: false } }\n    };\n    await game.xjzl.api.effects.addEffect(args.target, effectData);\n    ui.notifications.info(`${args.target.name} 中了五毒`);\n}"
                        }
                    ]
                },
                {
                    "name": "狂绞刃",
                    "type": "counter",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招。压制目标虚招，上步戳背，飞身翻摔，对目标造成 0.5 力量点外功伤害。</p>",
                    "actionCost": "反应动作",
                    "range": "2米",
                    "targetInfo": "单体",
                    "automationNote": "手动：反应动作。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "旷雷刃",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "description": "<p>当有目标处于半空中时，消耗反应动作释放此招，瞬身闪击至目标周围空格的半空中，对其造成 0.5 力量点外功伤害。</p><p>·命中无架招目标时，使其禁足一回合。</p>",
                    "actionCost": "反应动作",
                    "range": "10米",
                    "targetInfo": "单体",
                    "automationNote": "手动：反应动作。手动：位移。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招禁足",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await game.xjzl.api.effects.addEffect(args.target, \"root\");\n    ui.notifications.info(`${args.target.name} 被禁足`);\n}"
                        }
                    ]
                },
                {
                    "name": "翻魂刃",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "isUltimate": true,
                    "description": "<p>主要动作，转身飞踹，刃旋翔击，对目标造成 0.8 力量点外功伤害，同时击飞目标 3 米。</p>",
                    "actionCost": "主要动作",
                    "range": "2米",
                    "targetInfo": "单体",
                    "automationNote": "手动：击飞。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "scripts": []
                }
            ]
        }
    },
    {
        "name": "离魂镖（地）",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "category": "wuxue",
            "sect": "tangmen",
            "tier": 2,
            "description": "<p>唐门暗器绝技，以飞镖淬毒击敌，中者浑浑噩噩，脚步紊乱，死于不明不白。</p>",
            "requirements": "暗器-飞镖",
            "moves": [
                {
                    "name": "星魂赶月",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，眼疾手快，飞速一镖，对目标造成 0.5 身法点外功伤害。</p><p>消耗：飞镖*1</p>",
                    "actionCost": "主要动作",
                    "range": "15米",
                    "targetInfo": "单体",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "离魂去魄",
                    "type": "stance",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "weaponType": "hidden",
                    "description": "<p>次要动作，反手握镖，开启架招。当你每次成功格挡后，获得“游魂”，持续三回合或被击破架招。</p><p>游魂：速度+3，免疫下盘不稳。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "targetInfo": "自身",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": []
                    },
                    "scripts": [
                        {
                            "label": "获得游魂",
                            "trigger": "damaged",
                            "script": "// 获取当前架招等级\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\n\n    if (Macros.checkStance(actor, args)) {\n    const lvl = lvl || 1;\n    const speedBonus = 3 + (lvl - 1);\n    const effectData = {\n        name: \"游魂\",\n        icon: \"icons/svg/spirit.svg\",\n        duration: { rounds: 3 },\n        changes: [{ key: \"system.combat.speed\", mode: 2, value: speedBonus }],\n        scripts: [{\n            label: \"免疫不稳\",\n            trigger: \"turnStart\",\n            script: \"await game.xjzl.api.effects.removeEffect(actor, 'unstable', 99);\"\n        }]\n    };\n    await game.xjzl.api.effects.addEffect(actor, effectData);\n}"
                        }
                    ]
                },
                {
                    "name": "亡魂丧魄",
                    "type": "feint",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，巧劲一镖，对目标造成 0.4 身法点外功伤害，击破对方架招时，给目标添加“错乱”，持续一回合。</p><p>错乱：自己的每个回合末，朝 D4 随机方向不消耗速度走出一步，然后倒地。</p><p>消耗：飞镖*1</p>",
                    "actionCost": "主要动作",
                    "range": "10米",
                    "targetInfo": "单体",
                    "automationNote": "手动：错乱随机移动。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "应用错乱",
                            "trigger": "hit",
                            "script": "if (args.isHit && args.isBroken) {\n    const lvl = args.move.computedLevel || 1;\n    const rounds = 1 + (lvl - 1);\n    await game.xjzl.api.effects.addEffect(args.target, { id: \"cuoluan\", duration: { rounds: rounds } });\n    ui.notifications.info(`${args.target.name} 陷入错乱`);\n}"
                        }
                    ]
                },
                {
                    "name": "神魂颠倒",
                    "type": "qi",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "yin",
                    "damageType": "none",
                    "actionType": "buff",
                    "weaponType": "hidden",
                    "isUltimate": true,
                    "description": "<p>次要动作，阴劲勃发，侵染自身获得“神魂颠倒”，持续一回合。</p><p>神魂颠倒：施展《离魂镖》套路时，招式额外造成 0.4 内息点毒素伤害。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "targetInfo": "自身",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            5,
                            4,
                            3
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0,
                        "scalings": []
                    },
                    "effects": [
                        {
                            "name": "神魂颠倒",
                            "icon": "icons/svg/daze.svg",
                            "flags": {
                                "xjzl-system": {
                                    "slug": "shenhundao",
                                    "scripts": [
                                        {
                                            "label": "离魂镖加伤",
                                            "trigger": "hit",
                                            "script": "if (item && item.name.includes('离魂镖') && args.isHit) { const lvl = thisItem.system.moves.find(m => m.name === '神魂颠倒')?.computedLevel || 1; const extraDmg = 20 * (lvl - 1); const dmg = Math.floor(actor.system.stats.neixi.total * 0.4) + extraDmg; await args.target.applyDamage({ amount: dmg, type: 'poison', attacker: actor, isHit: true }); ui.notifications.info('神魂颠倒附加毒素伤害'); }"
                                        }
                                    ]
                                }
                            }
                        }
                    ],
                    "scripts": [
                        {
                            "label": "应用Buff",
                            "trigger": "attack",
                            "script": "const lvl = args.move.computedLevel || 1;\nconst rounds = 1 + (lvl - 1);\nconst effectData = thisItem.effects.getName(\"神魂颠倒\").toObject();\neffectData.duration = { rounds: rounds };\nawait game.xjzl.api.effects.addEffect(args.attacker, effectData);\nargs.flags.autoApplied = true;"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "泣血飞刀（地）",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "category": "wuxue",
            "sect": "tangmen",
            "tier": 2,
            "description": "<p>唐门绝技，杜鹃啼血惊夜半，触人离恨断愁肠，中者立刻血流而尽。</p>",
            "requirements": "暗器-飞刀",
            "moves": [
                {
                    "name": "悲痛无声",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>蓄力动作，飞刀默然而出，静谧无声，对直线上所有敌人造成 0.4 身法点外功伤害。</p><p>若目标处于“耳鸣”，招式伤害提高 20 点。</p><p>消耗：飞刀*1</p>",
                    "actionCost": "蓄力动作",
                    "range": "10米",
                    "targetInfo": "直线",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "耳鸣加伤",
                            "trigger": "preDamage",
                            "script": "if (args.target.statuses.has(\"deaf\") || args.target.effects.find(e => e.name === \"耳鸣\")) {\n    args.config.amount += 20;\n    ui.notifications.info(\"悲痛无声：耳鸣加伤\");\n}"
                        }
                    ]
                },
                {
                    "name": "泪如血涌",
                    "type": "stance",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "weaponType": "hidden",
                    "description": "<p>次要动作，刀尖饮血，开启架招。当你每次成功格挡后，获得“泣血”，持续一回合。</p><p>泣血：你的暗器招式命中目标后，额外给目标添加一层“流血”，持续到战斗脱离。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "targetInfo": "自身",
                    "automationNote": "完全自动化。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": []
                    },
                    "effects": [
                        {
                            "name": "泣血",
                            "icon": "icons/svg/blood.svg",
                            "flags": {
                                "xjzl-system": {
                                    "slug": "qixue",
                                    "scripts": [
                                        {
                                            "label": "暗器施加流血",
                                            "trigger": "hit",
                                            "script": "if (args.move.weaponType === 'hidden' && args.isHit) { await game.xjzl.api.effects.addEffect(args.target, 'bleed_stack'); ui.notifications.info('泣血触发：施加流血'); }"
                                        }
                                    ]
                                }
                            }
                        }
                    ],
                    "scripts": [
                        {
                            "label": "获得泣血",
                            "trigger": "damaged",
                            "script": "// 获取当前架招等级\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\n\n    if (Macros.checkStance(actor, args)) {\n    const lvl = lvl || 1;\n    const rounds = 1 + (lvl - 1);\n    const effectData = thisItem.effects.getName(\"泣血\").toObject();\n    effectData.duration = { rounds: rounds };\n    await game.xjzl.api.effects.addEffect(actor, effectData);\n}"
                        }
                    ]
                },
                {
                    "name": "哀鸣荡野",
                    "type": "counter",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招。压制目标虚招，飞刀射出，尖锐激鸣，对目标造成 0.6 身法点外功伤害，同时为目标周围 3 米内所有敌人添加“耳鸣”，持续一回合。</p><p>消耗：飞刀*1</p>",
                    "actionCost": "反应动作",
                    "range": "10米",
                    "targetInfo": "单体",
                    "automationNote": "手动：反应动作。手动：AOE耳鸣。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加耳鸣",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const lvl = args.move.computedLevel || 1;\n    const rounds = 1 + (lvl - 1);\n    await game.xjzl.api.effects.addEffect(args.target, { id: \"deaf\", duration: { rounds: rounds } });\n    ui.notifications.info(\"目标被施加耳鸣，请检查周围3米敌人手动添加\");\n}"
                        }
                    ]
                },
                {
                    "name": "杜鹃啼血",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "isUltimate": true,
                    "description": "<p>主要动作，绝命飞刀，触之断肠，对目标造成 0.7 身法点外功伤害。若目标处于“流血”，额外对其造成流血层数*10 的气血流失，并为其添加一层“失血”。</p><p>·若该飞刀抹毒，命中敌人时韧性检定难度+2。</p><p>消耗：飞刀*1</p>",
                    "actionCost": "主要动作",
                    "range": "15米",
                    "targetInfo": "单体",
                    "automationNote": "手动：抹毒检定。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "流血结算",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const bleedEffect = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"bleed_stack\");\n    if (bleedEffect) {\n        const stacks = bleedEffect.getFlag(\"xjzl-system\", \"stacks\") || 1;\n        const dmg = stacks * 10;\n        await args.target.applyDamage({ amount: dmg, type: \"liushi\", isHit: true });\n        await game.xjzl.api.effects.addEffect(args.target, \"bloodloss\");\n        ui.notifications.info(`杜鹃啼血结算流血：造成 ${dmg} 伤害并施加失血`);\n    }\n}"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "凤凰翎（天）",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "category": "wuxue",
            "sect": "tangmen",
            "tier": 3,
            "description": "<p>天下暗器中最可怕的就是凤凰翎。唐门绝技，但遗失多年。</p><p>注：该套路必须用特制暗器凤凰翎施展。</p>",
            "requirements": "暗器-凤凰翎",
            "moves": [
                {
                    "name": "凤凰展翅",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>蓄力动作，按下枢纽，暗器飞射而出，辉煌灿烂，选择范围内敌人造成 0.7 身法点外功伤害。（每名敌人消耗一根翎羽）</p><p>若目标无架招，需进行[定力]检定（难度 20），失败则陷入“自闭”一回合，成功无事。</p>",
                    "actionCost": "蓄力动作",
                    "range": "20米",
                    "targetInfo": "范围",
                    "automationNote": "手动：AOE多目标。",
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24,
                            32
                        ],
                        "rage": [
                            4,
                            3,
                            2,
                            1
                        ],
                        "hp": [
                            0,
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "发起定力检定",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await Macros.requestSave({\n        target: args.target,\n        attacker: actor,\n        type: \"dingli\",\n        dc: 20,\n        label: \"抵抗自闭\",\n        onFail: { id: \"zibi\", duration: { rounds: 1 } }\n    });\n}"
                        }
                    ]
                },
                {
                    "name": "凤鸣朝阳",
                    "type": "feint",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，翎羽激射而出，目瞪神迷，对目标造成 0.7 身法点外功伤害。</p><p>若你本场战斗的先攻顺序高于对方，这次虚招检定具有优势，且本招式无法被反击招式响应。</p><p>消耗：青翎或红翎*1</p>",
                    "actionCost": "主要动作",
                    "range": "15米",
                    "targetInfo": "单体",
                    "automationNote": "手动：禁反。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ],
                        "rage": [
                            4,
                            3,
                            2,
                            1
                        ],
                        "hp": [
                            0,
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "先攻判断",
                            "trigger": "attack",
                            "script": "const target = game.user.targets.first()?.actor;\nif (target && game.combat) {\n    const myInit = game.combat.combatants.find(c => c.actorId === actor.id)?.initiative || 0;\n    const targetInit = game.combat.combatants.find(c => c.actorId === target.id)?.initiative || 0;\n    if (myInit > targetInit) {\n        args.flags.feintLevel += 1;\n        ui.notifications.info(\"先攻压制：虚招优势\");\n    }\n}"
                        }
                    ]
                },
                {
                    "name": "云锦飞羽",
                    "type": "stance",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "weaponType": "hidden",
                    "description": "<p>次要动作，抽出一根翎羽，作金丝绕手，引而不发开启架招。</p><p>格挡成功后，可不消耗速度后撤一米，然后使用反应动作施展【凤鸣朝阳】。</p><p>消耗：青翎或红翎*1</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "targetInfo": "自身",
                    "automationNote": "手动：位移、反应动作。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ],
                        "rage": [
                            0,
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": []
                    },
                    "scripts": []
                },
                {
                    "name": "万鸟来朝",
                    "type": "real",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "hidden",
                    "isUltimate": true,
                    "description": "<p>全回合动作，杀机四溢，释放青红凤凰翎，横扫周围敌人造成 1.0 身法点外功伤害。</p><p>·你对所有敌方目标同时造成青翎和红翎的效果。</p><p>·你可以射出更多的凤凰翎，每多射出一根，本招式伤害提高 25 点。</p><p>消耗：青翎、红翎各一根</p>",
                    "actionCost": "全回合动作",
                    "range": "25米",
                    "targetInfo": "范围",
                    "automationNote": "手动：AOE范围。手动：额外翎羽加伤。",
                    "costs": {
                        "mp": [
                            16,
                            32,
                            48,
                            64
                        ],
                        "rage": [
                            6,
                            5,
                            4,
                            3
                        ],
                        "hp": [
                            0,
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 1.0
                            }
                        ]
                    },
                    "scripts": []
                }
            ]
        }
    },
    {
        "name": "暗器秘录",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "sect": "tangmen",
            "category": "sanshou",
            "tier": 2,
            "description": "<p>唐门弟子暗器不离手，日夜锻炼掷、索、射、喷、埋等各类暗器，以求无声无息间索敌之命。</p><p>需求：《潜渊心法》圆满</p><p>你选择一种暗器-子武器，作为你的秘密暗器，选择之后无法再更改。</p><ul><li>你施展秘密暗器武学套路时，招式伤害+10。</li><li>你为秘密暗器抹毒时，[韧性]检定难度+1。</li></ul><p>升级：可额外选择一种暗器；抹毒韧性难度+1。</p>",
            "requirements": "《潜渊心法》圆满",
            "moves": [],
            "scripts": [],
            "automationNote": "伤害加成已自动化。抹毒检定难度增加需GM手动处理。"
        },
        "effects": [
            {
                "name": "暗器秘录",
                "icon": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                "transfer": true,
                "disabled": false,
                "description": "秘密暗器伤害+10。",
                "changes": [
                    {
                        "key": "system.combat.damages.weaponTypes.hidden.mod",
                        "mode": 2,
                        "value": "10"
                    }
                ],
                "flags": {
                    "xjzl-system": {
                        "slug": "anqi-milu",
                        "stackable": false
                    }
                }
            }
        ]
    },
    {
        "name": "唐花",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "sect": "tangmen",
            "category": "sanshou",
            "tier": 1,
            "description": "<p>暗器手法，唐门所制成名暗器，外形如金属牡丹，花瓣炸开之时威力巨大。</p><p>消耗：唐花-银 400 两（消耗品）</p>",
            "requirements": "暗器-唐花",
            "moves": [
                {
                    "name": "唐花",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "type": "real",
                    "element": "yin",
                    "damageType": "poison",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，投向范围内空格，如花瓣般爆散开来，空格周围 3 米的所有敌人和其他友方进行[轻功]检定（难度 15），失败受到造成 40 点毒素伤害。</p><p>升级：毒素伤害+10，释放距离+5，内力消耗+2。</p>",
                    "range": "5",
                    "targetInfo": "圆形3米",
                    "actionCost": "主要动作",
                    "automationNote": "完全自动化：需手动选中范围内所有目标。自动请求轻功检定，失败自动应用伤害。",
                    "calculation": {
                        "base": 40,
                        "growth": 10,
                        "scalings": []
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [],
                        "hp": []
                    },
                    "scripts": [
                        {
                            "label": "唐花机制",
                            "trigger": "calc",
                            "script": "args.output.damage = 0; // 面板显示0，伤害通过脚本应用",
                            "active": true
                        },
                        {
                            "label": "轻功检定",
                            "trigger": "hit",
                            "script": "const lvl = args.move.computedLevel || 1;\nconst dmg = 40 + (lvl - 1) * 10;\nawait Macros.requestSave({\n    target: args.target,\n    attacker: actor,\n    type: 'qinggong',\n    dc: 15,\n    label: '躲避唐花',\n    onFail: async () => {\n        await args.target.applyDamage({\n            amount: dmg,\n            type: 'poison',\n            attacker: actor,\n            isHit: true\n        });\n        ui.notifications.info(`${args.target.name} 被唐花击中！`);\n    }\n});",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "暴雨梨花针",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "sect": "tangmen",
            "category": "sanshou",
            "tier": 2,
            "description": "<p>暗器手法，号称天下第一暗器，以银制成，外观扁平如匣，长七寸，厚三寸。小心保管，切记切记。</p><p>消耗：暴雨梨花针-银 500 两（消耗品）</p>",
            "requirements": "暗器-暴雨梨花针",
            "moves": [
                {
                    "name": "暴雨梨花针",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "type": "real",
                    "element": "yin",
                    "damageType": "poison",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，开启后二十七枚银钉势急力猛，每根能够造成 4 点毒素伤害，共一次性造成 108 点毒素伤害，无需投掷命中，敌人无法闪避。</p><ul><li>目标每有一级[轻功]，便能抵消一根银钉的毒素伤害（即减少 4 点毒素伤害）。</li><li>偷袭敌人时，可造成双倍伤害。</li></ul><p>升级：每根银钉造成的毒素伤害+1，内力消耗+2。</p>",
                    "range": "10",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "automationNote": "完全自动化：全局必中。自动化：轻功减伤逻辑已实现。手动：偷袭双倍伤害需手动修正。",
                    "calculation": {
                        "base": 108,
                        "growth": 27,
                        "scalings": []
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [],
                        "hp": []
                    },
                    "scripts": [
                        {
                            "label": "全局必中",
                            "trigger": "attack",
                            "script": "args.flags.forceHit = true;",
                            "active": true
                        },
                        {
                            "label": "轻功抵消",
                            "trigger": "preDamage",
                            "script": "const qg = args.target.system.skills?.qinggong?.total || 0;\nconst lvl = args.move.computedLevel || 1;\nconst needleDmg = 4 + (lvl - 1) * 1;\nconst reduction = qg * needleDmg;\nif (reduction > 0) {\n    args.config.amount = Math.max(0, args.config.amount - reduction);\n    if (args.attacker.token?.object) {\n        args.attacker.showFloatyText(`轻功抵挡 -${reduction}`, { fill: '#cccccc', stroke: '#000000', strokeThickness: 4 });\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "阎王帖",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "sect": "tangmen",
            "category": "sanshou",
            "tier": 2,
            "description": "<p>暗器手法，阎王要你三更死，谁敢留你到五更。此器一出，上天入地皆无活路，只得等死。</p><p>消耗：阎王帖-银 300 两（消耗品）</p>",
            "requirements": "暗器-阎王",
            "moves": [
                {
                    "name": "阎王帖",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "type": "real",
                    "element": "yin",
                    "damageType": "poison",
                    "weaponType": "hidden",
                    "description": "<p>蓄力动作，毒化流雨，自身周围敌人进行[轻功]检定（难度 17），失败受到 40 点毒素伤害，并被添加“冤魂”，持续一回合。</p><p>冤魂：命中-10，移动速度-5。</p><p>升级：难度+2，毒素伤害+10，冤魂持续回合+1，内力消耗+4。</p>",
                    "range": "10",
                    "targetInfo": "自身周围",
                    "actionCost": "蓄力动作",
                    "automationNote": "完全自动化：自动请求检定，失败自动扣血并应用冤魂Debuff。",
                    "calculation": {
                        "base": 40,
                        "growth": 10,
                        "scalings": []
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [],
                        "hp": []
                    },
                    "scripts": [
                        {
                            "label": "伤害置零",
                            "trigger": "calc",
                            "script": "args.output.damage = 0;",
                            "active": true
                        },
                        {
                            "label": "阎王索命",
                            "trigger": "hit",
                            "script": "const lvl = args.move.computedLevel || 1;\nconst dmg = 40 + (lvl - 1) * 10;\nconst dc = 17 + (lvl - 1) * 2;\nconst durationRounds = 1 + (lvl - 1);\n\nawait Macros.requestSave({\n    target: args.target,\n    attacker: actor,\n    type: 'qinggong',\n    dc: dc,\n    label: '躲避阎王帖',\n    onFail: async () => {\n        await args.target.applyDamage({\n            amount: dmg,\n            type: 'poison',\n            attacker: actor,\n            isHit: true\n        });\n        // 获取并克隆特效数据\n        const sourceEffect = thisItem.effects.getName('冤魂');\n        if (sourceEffect) {\n            const effectData = sourceEffect.toObject();\n            delete effectData._id;\n            effectData.duration = { rounds: durationRounds };\n            effectData.origin = thisItem.uuid;\n            await game.xjzl.api.effects.addEffect(args.target, effectData);\n            ui.notifications.warn(`${args.target.name} 被冤魂缠身！`);\n        }\n    }\n});",
                            "active": true
                        }
                    ]
                }
            ]
        },
        "effects": [
            {
                "name": "冤魂",
                "icon": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                "transfer": false,
                "disabled": false,
                "description": "命中-10，移动速度-5。",
                "changes": [
                    {
                        "key": "system.combat.hit_waigong",
                        "mode": 2,
                        "value": "-10"
                    },
                    {
                        "key": "system.combat.hit_neigong",
                        "mode": 2,
                        "value": "-10"
                    },
                    {
                        "key": "system.combat.speed",
                        "mode": 2,
                        "value": "-5"
                    }
                ],
                "flags": {
                    "xjzl-system": {
                        "slug": "yuanhun",
                        "stackable": false
                    }
                }
            }
        ]
    },
    {
        "name": "七步绝命针",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "sect": "tangmen",
            "category": "sanshou",
            "tier": 2,
            "description": "<p>暗器手法，唐门绝技，极小极细，射出只极轻微声响，察觉之际，已中招矣！</p><p>消耗：七步绝情针-银 700 两（消耗品）</p>",
            "requirements": "暗器-七步绝命针",
            "moves": [
                {
                    "name": "七步绝命针",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "type": "real",
                    "element": "yin",
                    "damageType": "poison",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，不动声色，夺命无形，为敌人添加“七步绝命”两回合。无需投掷命中，敌人无法闪避。</p><p>七步绝命：持续期间，你累计消耗速度移动 7 米以上的距离后，每多移动 1 米便受到 10 点毒素伤害，毒素伤害在状态持续时间结束时一次性生效。</p><ul><li>目标无法知晓自身被添加了“七步绝命”，除非花费主要动作进行一个[医术]或[毒术]检定（难度 11）且成功，方能知晓相关效果。</li></ul><p>升级：七步绝命持续回合数+1，内力消耗+2。</p>",
                    "range": "10",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "automationNote": "完全自动化：全局必中。自动化：状态施加。手动：移动距离追踪与伤害结算需手动处理。",
                    "calculation": {
                        "base": 0,
                        "growth": 0,
                        "scalings": []
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [],
                        "hp": []
                    },
                    "scripts": [
                        {
                            "label": "全局必中",
                            "trigger": "attack",
                            "script": "args.flags.forceHit = true;",
                            "active": true
                        },
                        {
                            "label": "施加绝命",
                            "trigger": "hit",
                            "script": "const lvl = args.move.computedLevel || 1;\nconst durationRounds = 2 + (lvl - 1);\n\nconst sourceEffect = thisItem.effects.getName('七步绝命');\nif (sourceEffect) {\n    const effectData = sourceEffect.toObject();\n    delete effectData._id;\n    effectData.duration = { rounds: durationRounds };\n    effectData.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.target, effectData);\n    ui.notifications.info(`已对 ${args.target.name} 施加七步绝命。`);\n}",
                            "active": true
                        }
                    ]
                }
            ]
        },
        "effects": [
            {
                "name": "七步绝命",
                "icon": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                "transfer": false,
                "disabled": false,
                "description": "累计移动超过7米后，每多1米受到10点毒素伤害（结束时结算）。需要医术/毒术(DC11)检定发现。",
                "changes": [],
                "flags": {
                    "xjzl-system": {
                        "slug": "qibu-jueming",
                        "stackable": false
                    }
                }
            }
        ]
    },
    {
        "name": "满天花雨",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "sect": "tangmen",
            "category": "sanshou",
            "tier": 3,
            "description": "<p>暗器手法，此物毒性极强，且不稳定，极难制作，曾有百年无人制成，甚至被污蔑为凭空捏造。</p><p>消耗：满天花雨-金 3000 两（消耗品）</p>",
            "requirements": "暗器-满天花雨",
            "moves": [
                {
                    "name": "满天花雨",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "type": "real",
                    "element": "yin",
                    "damageType": "poison",
                    "weaponType": "hidden",
                    "description": "<p>蓄力动作，机匣射出五色奇毒，于空中如花伞般炸开，范围内一个空格周围 5 米的所有敌人和其他友方进行[轻功]检定（难度 20），失败则受到 150 点毒素伤害，并被添加“五毒”，持续到脱战。</p><p>五毒：你在每回合末受到 20 点毒素伤害。</p><p>升级：难度+3，暗器造成的毒素伤害+50，内力消耗+8。</p>",
                    "range": "20",
                    "targetInfo": "圆形5米",
                    "actionCost": "蓄力动作",
                    "automationNote": "完全自动化：自动请求检定，失败自动扣血并施加五毒DOT。",
                    "calculation": {
                        "base": 150,
                        "growth": 50,
                        "scalings": []
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24,
                            32
                        ],
                        "rage": [],
                        "hp": []
                    },
                    "scripts": [
                        {
                            "label": "伤害置零",
                            "trigger": "calc",
                            "script": "args.output.damage = 0;",
                            "active": true
                        },
                        {
                            "label": "花雨毒爆",
                            "trigger": "hit",
                            "script": "const lvl = args.move.computedLevel || 1;\nconst dmg = 150 + (lvl - 1) * 50;\nconst dc = 20 + (lvl - 1) * 3;\n\nawait Macros.requestSave({\n    target: args.target,\n    attacker: actor,\n    type: 'qinggong',\n    dc: dc,\n    label: '躲避满天花雨',\n    onFail: async () => {\n        await args.target.applyDamage({\n            amount: dmg,\n            type: 'poison',\n            attacker: actor,\n            isHit: true\n        });\n        const sourceEffect = thisItem.effects.getName('五毒');\n        if (sourceEffect) {\n            const effectData = sourceEffect.toObject();\n            delete effectData._id;\n            effectData.origin = thisItem.uuid;\n            await game.xjzl.api.effects.addEffect(args.target, effectData);\n            ui.notifications.info(`${args.target.name} 身中五色奇毒！`);\n        }\n    }\n});",
                            "active": true
                        }
                    ]
                }
            ]
        },
        "effects": [
            {
                "name": "五毒",
                "icon": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                "transfer": false,
                "disabled": false,
                "description": "每回合末受到 20 点毒素伤害。",
                "duration": {
                    "seconds": 9999
                },
                "changes": [
                    {
                        "key": "flags.xjzl-system.regenHpTurnEnd",
                        "mode": 2,
                        "value": "-20"
                    }
                ],
                "flags": {
                    "xjzl-system": {
                        "slug": "wudu",
                        "stackable": false
                    }
                }
            }
        ]
    },
    {
        "name": "观音泪",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
        "system": {
            "sect": "tangmen",
            "category": "sanshou",
            "tier": 3,
            "description": "<p>暗器手法，唐门排名第一的暗器。一方圆润、一方尖锥，细细小小。以三十二种回力激发，含有七种毒性相克，中此器者不使用内力，方可保平安。</p><p>消耗：观音泪-金 7000 两（消耗品）</p>",
            "requirements": "暗器-观音泪",
            "moves": [
                {
                    "name": "观音泪",
                    "img": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                    "type": "real",
                    "element": "yin",
                    "damageType": "poison",
                    "weaponType": "hidden",
                    "description": "<p>主要动作，观音有泪，泪众生苦，对敌人造成 50 点毒素伤害，并为其添加“观音泪”，持续一日，无需投掷命中，敌人无法闪避。</p><p>观音泪：你每消耗 1 点内力受到 5 点毒素伤害。</p><p>升级：暗器造成的毒素伤害+50，每消耗 1 内力受到的毒素伤害+5，内力消耗+4。</p>",
                    "range": "20",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "automationNote": "完全自动化：全局必中。自动化：状态施加。手动：内力消耗触发伤害需手动结算。",
                    "calculation": {
                        "base": 50,
                        "growth": 50,
                        "scalings": []
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ],
                        "rage": [],
                        "hp": []
                    },
                    "scripts": [
                        {
                            "label": "全局必中",
                            "trigger": "attack",
                            "script": "args.flags.forceHit = true;",
                            "active": true
                        },
                        {
                            "label": "施加观音泪",
                            "trigger": "hit",
                            "script": "const lvl = args.move.computedLevel || 1;\nconst dotDmg = 5 + (lvl - 1) * 5;\n\nconst sourceEffect = thisItem.effects.getName('观音泪');\nif (sourceEffect) {\n    const effectData = sourceEffect.toObject();\n    delete effectData._id;\n    effectData.description = `每消耗1点内力，受到${dotDmg}点毒素伤害。`;\n    effectData.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.target, effectData);\n    ui.notifications.info(`${args.target.name} 被种下观音泪！`);\n}",
                            "active": true
                        }
                    ]
                }
            ]
        },
        "effects": [
            {
                "name": "观音泪",
                "icon": "systems/xjzl-system/assets/icons/wuxue/唐门.png",
                "transfer": false,
                "disabled": false,
                "description": "消耗内力时受到毒素伤害。",
                "duration": {
                    "seconds": 86400
                },
                "changes": [],
                "flags": {
                    "xjzl-system": {
                        "slug": "guanyin-lei",
                        "stackable": false
                    }
                }
            }
        ]
    }
]