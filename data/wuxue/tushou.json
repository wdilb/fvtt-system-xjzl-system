[
    {
        "name": "沾衣十八跌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>传统武术，历史悠久，总诀：抽身换影，乘势借力，脱化移形，引进落空，避锋藏锐，闪转走化，以斜击正，以横破正，以巧制拙。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "抽身换影",
                    "type": "qi",
                    "actionType": "default",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，抽身换影，乘势借力，进入“十八跌”状态，持续到战斗结束或者切换武学套路。</p><p><strong>十八跌：</strong>自身闪避+5，每次闪避成功后，下一次出招伤害增加 5 点（此效果重复闪避时不叠加）。</p><p><strong>升级:</strong>闪避成功后伤害再增加 5 点，内力消耗+1。</p>",
                    "automationNote": "应用获得BUFF。BUFF内含监听脚本：闪避后自动获得增伤BUFF。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得十八跌",
                            "trigger": "hit",
                            "script": "// 1. 计算增伤数值 (基础5 + 成长5)\nconst lvl = Math.max(1, args.move.computedLevel || 1);\nconst bonus = 5 + (lvl - 1) * 5;\n\n// 2. 获取特效模板\nconst eff = thisItem.effects.getName(\"十八跌\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\n\n// 3. 将计算好的增伤数值存入 Flag，供后续脚本使用\nfoundry.utils.setProperty(eff, \"flags.xjzl-system.storedBonus\", bonus);\n\n// 4. 应用\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "玉女穿梭",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，右掌掴面，左掌挑臂，对敌人造成伤害。击破架招后，上步套足，以掌穿胸，将目标击倒。</p><p><strong>升级:</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破击倒自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破击倒",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n    ui.notifications.info(`${args.target.name} 被击倒！`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "拧腰砸臂",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当受到以你为目标的招式攻击后，可消耗反应动作，甩腰右闪，拧身上步，移动到敌人身后，双臂下砸，造成伤害。</p><p>·若成功闪避了本次攻击，还可以击倒目标。</p><p><strong>升级:</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "反应动作条件手动。闪避检测手动。击倒手动（因在回合外无法自动检测前置闪避）。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "扣腕粘肘",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当受到以你为目标的招式攻击后，可消耗反应动作，扣其手背，抓腕内压，勾绊敌脚，造成伤害，然后将其抛飞（半空）到 3 米范围内任意 1 米，并陷入倒地。</p><p>若自身存在“十八跌”，且成功闪避目标攻击，可以消耗“十八跌”状态，使目标武器脱手，需要花费一个主要动作捡起。</p><p><strong>升级:</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "反应动作条件手动。击倒自动。抛飞移动手动。十八跌缴械判定手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "命中击倒与提示",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    // 1. 自动击倒\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n    ui.notifications.info(\"目标被抛飞并倒地（请手动处理位移）。\");\n    \n    // 2. 十八跌检测提示\n    const hasShiba = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"shibadie\");\n    if (hasShiba) {\n        ChatMessage.create({\n             content: `<div class=\"xjzl-chat-card\"><p><b>十八跌检测：</b></p><p>若本次攻击是闪避反击，请手动消耗 [十八跌] 状态，并给目标添加 [缴械]。</p></div>`,\n             speaker: ChatMessage.getSpeaker({actor: actor})\n        });\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "十八跌",
                    "icon": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
                    "description": "闪避增加，闪避后下一次伤害增加。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "shibadie",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "闪避触发增伤",
                                    "trigger": "avoided",
                                    "active": true,
                                    "script": "// 1. 通过 origin 反查源物品 (比 name 查找更稳健)\n// thisEffect.origin 指向的是施加该状态的 Item UUID\nconst originItem = await fromUuid(thisEffect.origin);\nif (!originItem) return;\n\n// 2. 读取之前存入的增伤数值 (Flag)\nconst bonus = thisEffect.getFlag(\"xjzl-system\", \"storedBonus\") || 5;\n\n// 3. 获取“借力”模板并应用\nconst buff = originItem.effects.getName(\"借力\").toObject();\ndelete buff._id;\nbuff.origin = originItem.uuid;\nbuff.changes[0].value = String(bonus);\n\nawait game.xjzl.api.effects.addEffect(actor, buff);\nui.notifications.info(\"十八跌：闪避成功，蓄势待发！\");"
                                }
                            ]
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.dodge",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                },
                {
                    "name": "借力",
                    "icon": "icons/svg/up.svg",
                    "description": "下一次出招伤害增加（出招后消失）。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "shibadie_jieli",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "消耗借力",
                                    "trigger": "attack",
                                    "active": true,
                                    "script": "await thisEffect.delete();"
                                }
                            ]
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.global.mod",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "八卦掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>又称游身八卦掌，因出招身随步动，掌随身变，纵横交错，与卦象相似，故名八卦。因其每一掌都可以衍化，素有一掌生八掌、八八六十四掌之说。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "单双换掌",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，掌心里外，双脚摆扣，开启架招。格挡成功后，获得“八卦”，持续到脱战或解除架招。</p><p><strong>八卦：</strong>招式伤害+10，受到内外功伤害减免 10 点。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "开启自动。格挡获得八卦自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获八卦",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"八卦\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "顺势穿掌",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，气沉腰塌，顺势掌摆，步上推掌，对目标造成伤害。命中无架招目标时，将其击飞 1 米。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击飞手动提示。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(`${args.target.name} 被击飞 1 米。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "背身掌",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破虚招时，可消耗反应动作使用此招，压制对方虚招，转身探掌，造成伤害，并将目标击倒。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中击倒自动。反应动作条件手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "翻身掌",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，右足外摆，身仰左翻，双掌拍出，造成伤害，击破架招时，为其添加“禁实”，持续两回合。</p><p><strong>禁实：</strong>无法施展实招。</p><p>·自身存在“八卦”时，虚招值+1。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破禁实自动。八卦加成预览和判定自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "八卦加成预览",
                            "trigger": "calc",
                            "script": "const hasBagua = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"baguazhang_bagua\");\nif (hasBagua) {\n    args.output.feint += 1;\n    args.output.bonusDesc.push(\"八卦: 虚招值 +1\");\n}",
                            "active": true
                        },
                        {
                            "label": "八卦加成判定",
                            "trigger": "attack",
                            "script": "const hasBagua = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"baguazhang_bagua\");\nif (hasBagua) {\n    args.flags.bonusFeint += 1;\n}",
                            "active": true
                        },
                        {
                            "label": "击破禁实",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"jinshi\");\n    if(eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 2 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 被禁实！`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "回身掌",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>蓄力动作，脚掌为轴，双掌旋臂一圈，转腕拍掌，对周围敌人造成伤害。</p><p>·自身存在“八卦”时，击飞所有敌人 2 米。</p><p>·当受到 5 米以外攻击时，可消耗反应释放此招，偏斜对方攻击，视作闪避成功。若如此做，此招也不会造成任何伤害。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "击飞手动提示。偏斜攻击为反应动作，需手动处理闪避结果。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit_once",
                            "script": "const hasBagua = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"baguazhang_bagua\");\nif (hasBagua && args.hitCount > 0) {\n    ui.notifications.info(\"八卦劲力：击飞所有命中敌人 2 米。\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "八卦",
                    "icon": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
                    "description": "招式伤害+10，内外功伤害减免+10。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "baguazhang_bagua",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.skill.mod",
                            "mode": 2,
                            "value": "10"
                        },
                        {
                            "key": "system.combat.resistances.global.mod",
                            "mode": 2,
                            "value": "10"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "铁头功",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>硬功外壮，头坚于石，触石石立碎，触铁板亦能深陷。需谨慎修炼，否则伤己头颅，成脑震荡。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "童子拜佛",
                    "type": "real",
                    "element": "gang",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，足趾抓地，拼掌合十，提肛调息，进入“铁头”状态，持续到战斗脱离。</p><p><strong>铁头：</strong>你受到的内外功伤害减少 10 点。受伤后，可消耗反应动作朝 5 米内一目标扬头奔撞而去，对其造成伤害，之后解除“铁头”，并停留在目标周围空格。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "本招式为施加状态。反应攻击需手动再次施展本招式（或另做宏），本招式不直接造成伤害。铁头状态自动添加。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "添加铁头",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"铁头\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);\nui.notifications.info(\"已开启铁头状态。若触发反应攻击，请移除此状态并手动造成伤害。\");",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "金童击鼓",
                    "type": "qi",
                    "actionType": "default",
                    "element": "gang",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，双手拍打头顶，呼气喊出“嘿”声。自身添加“金头”状态，持续到下次受伤后结束。</p><p><strong>金头：</strong>你受到的伤害必定暴击，但攻击者需要投掷一个 D20，结果为奇数时，攻击者打中你坚硬的头部，你减免 50 点内外功伤害。</p><p><strong>升级：</strong>打中头部再减免 50 点伤害，内力消耗+1。</p>",
                    "automationNote": "受击时自动判暴击，自动投D20判定减伤。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "添加金头",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"金头\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\n// 动态写入升级后的减伤值 (50 + (Lv-1)*50)\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst reduce = 50 + (lvl - 1) * 50;\neff.flags[\"xjzl-system\"].reduceAmount = reduce;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "罗汉抱肚",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，双掌拍打，笼罩目标全身，对其造成伤害。</p><p>·若自身处于“铁头”，击破架招后，以头顶肺，击退目标三米，使目标浑身麻木，怒气清空。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击退手动。清空怒气自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破特效",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const hasTietou = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"tietou\");\n    if (hasTietou) {\n        // 清空怒气\n        await args.target.update({\"system.resources.rage.value\": 0});\n        ui.notifications.info(`${args.target.name} 怒气被清空！请手动击退 3 米。`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "金刚撞钟",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>蓄力动作，两手叉腰，意想千斤重物压于头顶。以头捶地！对周围 3 米范围内目标造成伤害，并将他们击倒在地。</p><p>·若自身处于“铁头”，可选择消耗铁头，招式伤害+10。</p><p><strong>升级：</strong>招式伤害+10，消耗铁头招式伤害再+10点，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "击倒自动。消耗铁头增伤预览和决策自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        },
                        {
                            "label": "铁头增伤预览",
                            "trigger": "calc",
                            "script": "const hasTietou = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"tietou\");\nif (hasTietou) {\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const bonus = 10 + (lvl - 1) * 10;\n    args.output.damage += bonus;\n    args.output.bonusDesc.push(`铁头加伤 +${bonus} (需消耗)`);\n}",
                            "active": true
                        },
                        {
                            "label": "铁头消耗决策",
                            "trigger": "attack",
                            "script": "const tietou = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"tietou\");\n\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst bonus = 10 + (lvl - 1) * 10;\n\nif (tietou) {\n    const confirm = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"金刚撞钟\" },\n        content: `<p>是否消耗 [铁头] 以增加 <b>${bonus}</b> 点伤害？</p>`,\n        yes: { label: \"消耗\", icon: \"fas fa-check\" },\n        no: { label: \"不消耗\", icon: \"fas fa-times\" }\n    });\n    if (confirm) {\n        await tietou.delete();\n        ui.notifications.info(\"铁头已消耗，伤害提升！\");\n    } else {\n        args.flags.damageResult.damage -= bonus;\n        args.flags.damageResult.breakdown += `\\n- 未消耗铁头：移除加成 (-${bonus})`;\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "铁头",
                    "icon": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
                    "description": "内外功伤害减免 10 点。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "tietou",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.resistances.global.mod",
                            "mode": 2,
                            "value": "10"
                        }
                    ]
                },
                {
                    "name": "金头",
                    "icon": "icons/svg/skull.svg",
                    "description": "必定暴击。受击判定减伤。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jintou",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "强制暴击",
                                    "trigger": "preDefense",
                                    "active": true,
                                    "script": "args.config.isCrit = true;"
                                },
                                {
                                    "label": "头部判定",
                                    "trigger": "preTake",
                                    "active": true,
                                    "script": "// 投掷 D20\nconst r = await new Roll(\"1d20\").evaluate();\nif (game.dice3d) game.dice3d.showForRoll(r, game.user, true);\nconst result = r.total;\n\nif (result % 2 !== 0) {\n    // 奇数，打中头部\n    const reduce = thisEffect.getFlag(\"xjzl-system\", \"reduceAmount\") || 50;\n    args.output.damage = Math.max(0, args.output.damage - reduce);\n    ui.notifications.info(`金头护体！(骰值 ${result}) 伤害减免 ${reduce} 点。`);\n} else {\n    ui.notifications.warn(`金头失效！(骰值 ${result}) 未击中坚硬部位。`);\n}\n\n// 移除特效 (一次性)\nawait thisEffect.delete();"
                                }
                            ]
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "谭腿",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>俗话说：练拳不练腿，如同冒失鬼。手是两扇门，全凭腿打人，谭腿四只手，人怕鬼见愁。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>柔</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "出马一条鞭",
                    "type": "real",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，屈膝、弓腿、下砸！对目标造成伤害。</p><p>·若有敌人处于半空中，你可以跃至半空中施展此招，鹞子翻身，劈腿下砸，造成伤害并将其击倒。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "对空击倒手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "十字蹦脚尖",
                    "type": "feint",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，寸步抬腿，攻上三路，对目标造成伤害。击破架招时，一脚蹬在目标胸口，将其击飞 1 米。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    ui.notifications.info(`${args.target.name} 被击飞 1 米。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "狮子双戏水",
                    "type": "stance",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，垂臂直立，稳扎弓马，开启架招。</p><p>格挡成功后，可选择解除本架招，然后消耗反应动作施展一次【十字蹦脚尖】，这次十字蹦脚尖的施展距离+1 米。</p><p><strong>升级：</strong>格挡值+5，施展距离+1，内力消耗+1。</p>",
                    "automationNote": "反击提示自动。若选择反击，请手动点击十字蹦脚尖，并注意距离增加。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "反击提示",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst moveData = thisItem.system.moves.find(m => m.name === \"狮子双戏水\");\nconst lvl = Math.max(1, moveData?.computedLevel || 1);\nconst rangeBonus = 1 + (lvl - 1);\n\nconst confirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"狮子双戏水\" },\n    content: `<p>格挡成功！是否消耗架招进行反击？</p><p>反击招式：<b>十字蹦脚尖</b> (距离+${rangeBonus})</p>`,\n    yes: { label: \"反击\", icon: \"fas fa-fist-raised\" },\n    no: { label: \"维持架招\", icon: \"fas fa-shield-alt\" }\n});\n\nif (confirm) {\n    await actor.stopStance();\n    ui.notifications.info(`架招已解除。请手动施展 [十字蹦脚尖] (距离增加 ${rangeBonus} 米)。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鸳鸯巧连环",
                    "type": "real",
                    "isUltimate": true,
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，足背紧绷，连环撩踢两脚，对目标造成 2 次伤害（只需投掷一次命中）。</p><p>·若目标无架招，则箭步而上，两脚猛踢目标下颚，将其击飞 3 米。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "伤害倍率自动计算(已包含在公式中)。无架招击飞自动提示。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招击飞",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(`${args.target.name} 被击飞 3 米。`);\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "王八拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>流传万年不衰的武学，据说乃是世间第一套武功，自猿人时代便有人修习。历经万年传承，稍微有点悟性的皆能领悟。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "王八探头",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，如车轮般挥舞手臂，原本是小孩子过家家般的拳法动作，却返璞归真，威力巨大。对敌人造成伤害。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "瓮中捉鳖",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，双手击打对方耳廓，对敌人造成伤害，击中无架招的敌人时，获得一层“王八劲”。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "获劲自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得王八劲",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"王八劲\").toObject();\n    delete eff._id;\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "龟龙片甲",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，身体蜷缩，开启架招。成功格挡后，获得一层“王八劲”，最多可叠加三层，在战斗脱离后消失。</p><p><strong>升级：</strong>格挡值+5，叠加层数+1，内力消耗+1。</p>",
                    "automationNote": "格挡获劲自动。层数上限自动计算。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获劲",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"王八劲\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\n\n// 动态上限: 3 + (Lv-1)\nconst stanceId = actor.system.martial.stance;\nconst moveData = thisItem.system.moves.find(m => m.id === stanceId);\nconst lvl = Math.max(1, moveData?.computedLevel || 1);\nconst max = 3 + (lvl - 1);\neff.flags[\"xjzl-system\"].maxStacks = max;\n\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "王八缩壳",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，双手抱头，消耗所有王八劲，每一层王八劲使你获得一层“王八壳”，持续到战斗脱离。</p><p><strong>王八壳：</strong>每层使你提升 2 点内外功防御、提升 2 点韧性、回合末回复 1 点生命值。</p><p><strong>升级：</strong>每层“王八壳”提供的内外功防御+1，韧性+1，生命值回复+1，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "完全自动化。消耗层数转化BUFF。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "转化王八壳",
                            "trigger": "hit",
                            "script": "const jin = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"wangbajin\");\nif (!jin) return ui.notifications.warn(\"无王八劲可消耗！\");\n\nconst stacks = jin.getFlag(\"xjzl-system\", \"stacks\") || 1;\nawait jin.delete();\n\n// 获取壳模板\nconst ke = thisItem.effects.getName(\"王八壳\").toObject();\ndelete ke._id;\nke.origin = thisItem.uuid;\n\n// 动态数值: (2 + (Lv-1)) * stacks\n// 这里我们不乘stacks写入change，而是直接把stacks设为当前层数\n// 因为AE配置里是ADD模式，且stackable=true，系统会自动乘\n// 但这里稍微特殊：壳的数值随招式等级变化。\n// 方案：修改 baseChanges 的值，然后让系统叠层。\n\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst defBase = 2 + (lvl - 1);\nconst resBase = 2 + (lvl - 1);\nconst hpBase = 1 + (lvl - 1);\n\nke.changes[0].value = String(defBase);\nke.changes[1].value = String(defBase);\nke.changes[2].value = String(resBase);\nke.changes[3].value = String(hpBase);\n\n// 强制设置层数\nke.flags[\"xjzl-system\"].stacks = stacks;\n\n// 使用 addEffect (它会处理覆盖或叠加，这里我们直接覆盖或新增)\nawait game.xjzl.api.effects.addEffect(actor, ke);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "王八劲",
                    "icon": "icons/svg/up.svg",
                    "description": "蓄力，可转化为防御。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "wangbajin",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": []
                },
                {
                    "name": "王八壳",
                    "icon": "icons/creatures/reptiles/turtle-shell-green.webp",
                    "description": "增加防御、韧性、生命回复。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "wangbake",
                            "stackable": true,
                            "maxStacks": 0
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.def_waigong",
                            "mode": 2,
                            "value": "2"
                        },
                        {
                            "key": "system.combat.def_neigong",
                            "mode": 2,
                            "value": "2"
                        },
                        {
                            "key": "system.skills.renxing.mod",
                            "mode": 2,
                            "value": "2"
                        },
                        {
                            "key": "flags.xjzl-system.regenHpTurnEnd",
                            "mode": 2,
                            "value": "1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "太祖长拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>据说源于宋太祖训练士卒的遗法真传，综合战场上真拼实杀而成三十二势长拳。套路严谨，动作舒展，招式鲜明，爆发力很强。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "弓步冲打",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>提地擎天，撂手单炮，对目标造成伤害。若命中无架招目标，则将目标击飞 1 米。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击飞手动提示。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(`${args.target.name} 被击飞 1 米。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "虚步断肘",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>十字闯步，抓臂冲拳，对目标造成伤害，若击破架招，将目标击倒。</p><p>·若目标架招为徒手招式，虚招值+2。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破击倒自动。克制徒手架招自动判定。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        },
                        {
                            "label": "克制徒手",
                            "trigger": "check",
                            "script": "if (args.target) {\n    const stanceId = args.target.system.martial.stance;\n    if (stanceId) {\n        // 使用 targetStanceItem 避免与全局 item 冲突\n        const targetStanceItem = args.target.items.get(args.target.system.martial.stanceItemId);\n        if (targetStanceItem) {\n            const moveData = targetStanceItem.system.moves.find(m => m.id === stanceId);\n            if (moveData?.weaponType === \"unarmed\") {\n                args.flags.grantFeint += 2;\n            }\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "海底捞沙",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双手抱拳，迎面扳手，开启架招。</p><p>格挡成功后获得一层“蓄劲”，至多三层，持续到脱战。</p><p><strong>蓄劲：</strong>每层使你暴击骰-1。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "格挡获劲自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获蓄劲",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"蓄劲\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "朝天一蹬",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破目标虚招，可消耗反应动作释放此招，压制目标虚招，右腿伸直，直上一脚，对其造成伤害，并将其击飞 1 米</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击飞手动提示。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    ui.notifications.info(`${args.target.name} 被击飞 1 米。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "翻天劈地",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>上步横靠身连进，长短拳循环无端，对目标造成伤害。若你以此招在切磋比武将对手击败，对手对你的好感上升 10 点。（仅一次）</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "好感度需DM手动处理。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": []
                }
            ],
            "effects": [
                {
                    "name": "蓄劲",
                    "icon": "icons/svg/target.svg",
                    "description": "降低暴击骰点数。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "taizuchangquan_xujin",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.crit_waigong",
                            "mode": 2,
                            "value": "-1"
                        },
                        {
                            "key": "system.combat.crit_neigong",
                            "mode": 2,
                            "value": "-1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "四诊要诀",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>药师行医时归纳出的一套中医武学，无甚威力。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "望闻问切",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，探双指，观其色，闻其声，开启架招。</p><p>格挡成功后，获得“坐诊”，持续到战斗脱离。</p><p><strong>坐诊：</strong>你的[医术]检定结果+2。</p><p><strong>升级：</strong>格挡值+5，医术检定额外+2，内力消耗+1。</p>",
                    "automationNote": "格挡获诊自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获诊",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"坐诊\").toObject();\n// 动态计算加值: 2 + (Lv-1)*2\nconst stanceId = actor.system.martial.stance;\nconst moveData = thisItem.system.moves.find(m => m.id === stanceId);\nconst lvl = Math.max(1, moveData?.computedLevel || 1);\nconst bonus = 2 + (lvl - 1) * 2;\n\neff.changes[0].value = String(bonus);\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "开方抓药",
                    "type": "qi",
                    "actionType": "default",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "全回合动作",
                    "description": "<p>全回合动作，你诊断一名友方的病症，并从自己行囊内掏出一份药品，内力化之（消耗），然后为该友方添加“药方-药品名”，持续到战斗脱离。</p><p><strong>药方-药品名：</strong>你可以消耗次要动作移除此状态，视作你立即服用了同名药品。</p><p><strong>升级：</strong>施展本招式的动作下降一级（全回合-蓄力- 主要），招式的释放距离+2，内力消耗+1。</p>",
                    "automationNote": "纯手动。请自行在背包中扣除药品。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "点喉催吐",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，一指点向目标咽喉，对目标造成伤害。</p><p>击破架招时，若目标具有药品状态，将其移除。</p><p><strong>升级:</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破后需手动移除目标的药品状态。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "按嘱服药",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "全回合动作",
                    "description": "<p>全回合动作，从行囊内掏出一份药品，然后给目标喂下，目标获得药品原有效果，并额外回复 10 点气血内力。</p><p>·每有 1 级[医术]，额外回复 2 点气血内力。</p><p>·若你的[医术]达到 5 级，还可以移除目标身上一个地级及以下的状态。</p><p><strong>升级：</strong>释放距离+1，额外回复 10 点气血内力，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "喂药效果手动。额外回血自动。移除状态手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "额外回复",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    // 基础回复: 10 + (Lv-1)*10\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const baseHeal = 10 + (lvl - 1) * 10;\n    \n    // 医术加成: Skill * 2\n    const yishu = actor.system.arts.yishu?.total || 0;\n    const extra = yishu * 2;\n    \n    const total = baseHeal + extra;\n    \n    await args.target.applyHealing({amount: total, type: 'hp', showScrolling: true});\n    await args.target.applyHealing({amount: total, type: 'mp', showScrolling: true});\n    \n    if (yishu >= 5) {\n        ui.notifications.info(\"医术精湛：请手动移除目标一个地级及以下状态。\");\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "坐诊",
                    "icon": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
                    "description": "医术检定加成。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zuozhen",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.arts.yishu.checkMod",
                            "mode": 2,
                            "value": "2"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "虎爪手",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>传统拳术，擒拿手法之一。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "虎目圆瞪",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，两臂屈肘，掌心向下，开启架招。</p><p>格挡成功后，可消耗反应动作施展【虎入羊群】。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "反击提示自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "反击提示",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n\nconst confirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"虎目圆瞪\" },\n    content: `<p>格挡成功！是否消耗反应动作施展 <b>虎入羊群</b>？</p>`,\n    yes: { label: \"施展\", icon: \"fas fa-fist-raised\" },\n    no: { label: \"跳过\", icon: \"fas fa-times\" }\n});\n\nif (confirm) {\n    ui.notifications.info(\"请手动施展 [虎入羊群]。\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "虎入羊群",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>蓄力动作，左掌前推，右掌横爪，对自身周围敌人造成伤害，并将无架招目标击倒。</p><p><strong>升级:</strong>招式伤害+5，内力消耗+2。</p>",
                    "automationNote": "无架招击倒自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招击倒",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "为虎作伥",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，十指提抓，攻其要害，对目标造成伤害。</p><p>命中无架招目标时，为其添加“错骨”一回合。</p><p><strong>升级:</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "无架招施加错骨自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "错骨",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\n    if(eff) {\n       const data = foundry.utils.deepClone(eff);\n       data.duration = { rounds: 1 };\n       await game.xjzl.api.effects.addEffect(args.target, data);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "虎啸风生",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>蓄力动作，双爪旋圈，刚劲连绵，对周围目标造成伤害。</p><p>若目标处于“错骨”状态，将其击倒，并添加“禁足”，持续三回合。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "错骨追击自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "错骨追击",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const hasCuogu = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"cuogu\");\n    if (hasCuogu) {\n        // 击倒\n        const prone = CONFIG.statusEffects.find(e => e.id === \"prone\");\n        if(prone) await game.xjzl.api.effects.addEffect(args.target, prone);\n        \n        // 禁足 3回合\n        const root = CONFIG.statusEffects.find(e => e.id === \"root\");\n        if(root) {\n            const data = foundry.utils.deepClone(root);\n            data.duration = { rounds: 3 };\n            await game.xjzl.api.effects.addEffect(args.target, data);\n        }\n        ui.notifications.info(`${args.target.name} 被击倒并禁足！`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "农夫三拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>别小看土里刨食儿的下里巴人，即便是庄稼把式，也能把你打趴下。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "春耕田",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，挺身握拳，收于腰侧，开启架招。</p><p>格挡成功后，可以消耗反应动作应声而倒，陷入倒地，并使受到的内外功伤害减少 4 点。</p><p><strong>升级：</strong>格挡值+5，额外减少 3 点，内力消耗+1。</p>",
                    "automationNote": "反应提示自动。倒地自动。减伤自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "倒地减伤",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst moveData = thisItem.system.moves.find(m => m.name === \"春耕田\");\nconst lvl = Math.max(1, moveData?.computedLevel || 1);\nconst reduce = 4 + (lvl - 1) * 3;\n\nconst confirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"春耕田\" },\n    content: `<p>格挡成功！是否应声倒地以减少 <b>${reduce}</b> 点伤害？</p>`,\n    yes: { label: \"倒地\", icon: \"fas fa-arrow-down\" },\n    no: { label: \"硬撑\", icon: \"fas fa-times\" }\n});\n\nif (confirm) {\n    // 添加倒地\n    const prone = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(prone) await game.xjzl.api.effects.addEffect(actor, prone);\n    \n    // 动态恢复 HP (变相减伤)\n    // 因为 damaged 阶段伤害已扣除，这里我们把减免的量加回去\n    // 注意：如果是致死伤害，这里加回去可能救活。\n    await actor.applyHealing({amount: reduce, type: 'hp', showScrolling: true});\n    ui.notifications.info(`春耕田：倒地减免了 ${reduce} 点伤害（已回复）。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "推土耙",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，双拳紧握，变掌推出，如同耕田，对目标造成伤害，命中无架招目标时，将其击飞 1 米。</p><p><strong>升级:</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击飞手动提示。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(`${args.target.name} 被击飞 1 米。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "秋收忙",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，向前踢腿，高高举拳，狠狠砸下，对目标造成伤害。并为自身添加“秋收”，持续三回合。</p><p><strong>秋收：</strong>在你的每回合初，获得一点怒气。</p><p>·若你的背景是农户，本招式消耗怒气减少 2 点。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "添加BUFF自动。农户背景判定手动（玩家需自行注意消耗）。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "秋收",
                            "trigger": "hit_once",
                            "script": "const eff = thisItem.effects.getName(\"秋收\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "老实人",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，挠头憨厚微笑，不知所措，忽然出拳，对目标造成伤害。</p><p>·若自身处于“秋收”和倒地状态，招式必定命中。</p><p><strong>升级:</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "必中判定自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "必中判定",
                            "trigger": "attack",
                            "script": "const hasQiushou = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"qiushou\");\nconst isProne = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"prone\");\n\nif (hasQiushou && isProne) {\n    args.flags.forceHit = true;\n    ui.notifications.info(\"老实人爆发：必定命中！\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "秋收",
                    "icon": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
                    "description": "回合初获得怒气。",
                    "transfer": false,
                    "duration": {
                        "rounds": 3
                    },
                    "flags": {
                        "xjzl-system": {
                            "slug": "qiushou",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.regenRageTurnStart",
                            "mode": 2,
                            "value": "1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "腐血掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>掌风中带着一股血腥气，树木中之立即树叶枯黄而死，人中之如不得解药，只能活四十九日，即使武林高手中此掌后亦会受到极重的内伤。进阶此掌招式需消耗一份蛇毒。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "毒尊合掌",
                    "type": "real",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，凝掌合拍，对目标造成伤害。掌风携带毒劲，给无架招的敌人造成额外 10 点毒素伤害。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "额外毒伤自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "额外毒伤",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await args.target.applyDamage({ amount: 10, type: \"poison\", attacker: actor, isHit: true, ignoreDefense: true });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "腐骨蚀心",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，以毒护心，开启架招。格挡成功时，为其添加一层“毒”，至多三层，持续到战斗脱离。</p><p><strong>毒：</strong>每层每回合末受到 5 点毒素伤害。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "格挡挂毒自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡挂毒",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args) || !args.attacker) return;\n\n// 获取毒药AE\nconst poison = thisItem.effects.getName(\"毒\").toObject();\ndelete poison._id;\npoison.origin = thisItem.uuid;\n\nawait game.xjzl.api.effects.addEffect(args.attacker, poison);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "血凝五步",
                    "type": "feint",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，移步击发，掌掌破肤，对敌人造成伤害，击破架招时为其添加“蚀心”，持续两回合。</p><p><strong>蚀心：</strong>速度减半，每次受到毒素伤害时额外受到 5 点伤害，同时倒地。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破添加蚀心自动。蚀心效果：倒地、减速自动；毒素易伤需配合其他毒素脚本（目前未实现通用易伤，仅文字提示）。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "蚀心",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"蚀心\").toObject();\n    delete eff._id;\n    eff.origin = thisItem.uuid;\n    // 持续2回合\n    eff.duration = { rounds: 2 };\n    \n    await game.xjzl.api.effects.addEffect(args.target, eff);\n    \n    // 倒地\n    const prone = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if(prone) await game.xjzl.api.effects.addEffect(args.target, prone);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "荼毒恶雾",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "10米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，凝练毒劲，螺旋飞出，对目标造成伤害，并为其添加“错骨”状态，持续一回合。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "错骨自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "错骨",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\n    if(eff) {\n       const data = foundry.utils.deepClone(eff);\n       data.duration = { rounds: 1 };\n       await game.xjzl.api.effects.addEffect(args.target, data);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "毒",
                    "icon": "icons/svg/poison.svg",
                    "description": "回合末受到毒素伤害。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "fuxuezhang_du",
                            "stackable": true,
                            "maxStacks": 3,
                            "scripts": [
                                {
                                    "label": "回合末毒伤",
                                    "trigger": "turnEnd",
                                    "active": true,
                                    "script": "// 5 * 层数\nconst stacks = thisEffect.getFlag(\"xjzl-system\", \"stacks\") || 1;\nconst dmg = 5 * stacks;\n\n// 检查蚀心易伤\nconst shixin = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"shixin\");\nconst finalDmg = shixin ? (dmg + 5) : dmg;\n\nawait actor.applyDamage({ amount: finalDmg, type: 'poison', isHit: true, ignoreDefense: true });\nui.notifications.info(`${actor.name} 毒发！受到 ${finalDmg} 点毒素伤害。`);"
                                }
                            ]
                        }
                    },
                    "changes": []
                },
                {
                    "name": "蚀心",
                    "icon": "icons/svg/degen.svg",
                    "description": "速度减半，受到毒素伤害增加。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "shixin",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.unstable",
                            "mode": 5,
                            "value": "true"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "山秋指法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>山民之间代代相传的爬山技巧，一身功力全在十指之间，威力巨大。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "层楼问愁",
                    "type": "real",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>强运指劲轰击对手肩胛，对目标造成 0.4 内息点内功伤害，同时使自身和目标一起陷入“错骨”状态，持续一回合。</p><p>若有敌人处于半空中，你可以消耗反应动作释放此招，飞至半空，攻击目标。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中后自动给双方施加错骨。对空/反应动作需手动处理。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "双重错骨",
                            "trigger": "hit",
                            "script": "const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\nif (eff) {\n    const data = foundry.utils.deepClone(eff);\n    data.duration = { rounds: 1 };\n    // 给自己\n    await game.xjzl.api.effects.addEffect(actor, data);\n    // 给目标\n    if (args.isHit) {\n        await game.xjzl.api.effects.addEffect(args.target, data);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "山雨欲来",
                    "type": "feint",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>虚攻双目，实为攻击膻中穴道，对目标造成 0.3 内息点内功伤害，若击破架招，可以对目标进行一次的点穴检定，这次检定结果-5。</p><p>若对方“错骨”，则你的此次点穴检定结果不-5，而是+5。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破后发送卡片提示进行对抗，并自动计算修正值。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "点穴提示",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const isCuogu = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"cuogu\");\n    const mod = isCuogu ? \"+5\" : \"-5\";\n    const content = `<div class=\"xjzl-chat-card\">\n        <div class=\"card-header\" style=\"border-bottom:1px solid #ccc; font-weight:bold;\">山雨欲来 - 击破效果</div>\n        <div style=\"padding:5px; font-size:0.9em;\">\n            <p>请对目标进行 <b>点穴检定</b>。</p>\n            <p>检定修正: <b style=\"color:${isCuogu ? 'green' : 'red'}\">${mod}</b> ${isCuogu ? '(因错骨)' : ''}</p>\n        </div>\n    </div>`;\n    ChatMessage.create({ user: game.user.id, speaker: ChatMessage.getSpeaker({actor: actor}), content: content });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "说天休地",
                    "type": "counter",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破虚招时，可消耗反应动作使用此招，压制对方虚招，双指击目标膝盖，击倒目标，并造成 0.5 内息点内功伤害。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中后自动施加击倒(倒地)状态。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if (eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "妄影入秋",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>内力外放，遥击太阳穴，对目标造成 0.6 内息点内功伤害。</p><p>·若对方处于“错骨”，额外对其造成 20 点精神伤害。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "命中时检测目标错骨状态，若有则自动追加精神伤害。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "额外精神伤害",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const isCuogu = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"cuogu\");\n    if (isCuogu) {\n        await args.target.applyDamage({\n            amount: 20,\n            type: \"mental\",\n            attacker: actor,\n            isHit: true,\n            isCrit: false\n        });\n        ui.notifications.info(\"错骨触发额外精神伤害！\");\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "碎石脚",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>江湖腿法，威力巨大，开砖裂石说的就是它。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "震天击",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>莽撞一击，对目标造成 0.3 力量点外功伤害，击破对方架招时，击飞对手 3 米。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破后提示手动击飞。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    ui.notifications.info(`${args.target.name} 被击飞 3 米 (请手动移动)`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "裂石开砖",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>飞身一脚，对目标造成 0.4 力量点外功伤害，击中无架招敌人可击飞 3 米。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中且无架招提示手动击飞。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(`${args.target.name} 被击飞 3 米 (请手动移动)`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "水滴石穿",
                    "type": "counter",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破虚招时，可消耗反应动作使用此招，压制对方虚招，脚尖连点，对其造成 3 次 0.2 力量点外功伤害。（一次命中，三次伤害，三点怒气）</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "系统结算第一次伤害。脚本自动追加后两次伤害。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.2
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "三连击",
                            "trigger": "hit",
                            "script": "// 第一次伤害已由系统处理。此处申请额外两次。\nif (args.isHit) {\n    // 重新计算一次伤害(因为baseDamage是面板值，finalDamage是实际结算值)\n    // 这里取面板值作为基础，或者直接取 finalDamage？\n    // 按照逻辑，应该是每次独立结算防御，所以取面板伤害更合理，但这里简化直接造成伤害\n    // 为了准确，我们复用 finalDamage (假设三次伤害一致)\n    const amount = args.finalDamage;\n    \n    // 第二次\n    await args.target.applyDamage({ amount: amount, type: \"waigong\", attacker: actor, isHit: true, isCrit: args.isCrit });\n    // 第三次\n    await args.target.applyDamage({ amount: amount, type: \"waigong\", attacker: actor, isHit: true, isCrit: args.isCrit });\n    \n    ui.notifications.info(\"水滴石穿：三连踢！\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "碎石开山",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>连环踢，对目标造成 0.6 力量点外功伤害。</p><p>·若招式范围内有敌人处于半空中，可消耗反应动作释放此招，跃起（半空）连环飞踢击，对其造成伤害并击倒。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "对空/反应动作/击倒效果完全手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    }
                }
            ]
        }
    },
    {
        "name": "电光毒龙钻",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>一种江湖上的阴险功夫，再难的角度也钻得进去。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "迅影似电",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>低身疾行，来似无影，宛若一道闪电踢向目标，造成 0.4 力量点外功伤害。若击中下盘不稳的目标，将其击倒。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中检测下盘不稳，若有则自动击倒。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "追击击倒",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const isUnstable = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"unstable\");\n    if (isUnstable) {\n        const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n        if (eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n        ui.notifications.info(`${args.target.name} 被击倒 (因下盘不稳)`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "闪逝如光",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>借力而动，去若无踪，开启架招。成功格挡后，可以借力移动 1 米，并让对方陷入“下盘不稳”，持续一回合。</p><p><strong>升级：</strong>格挡值+5，移动距离+1，内力消耗+1。</p>",
                    "automationNote": "格挡反击自动施加下盘不稳。移动手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡反击",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = CONFIG.statusEffects.find(e => e.id === \"unstable\");\nif (eff && args.attacker) {\n    const data = foundry.utils.deepClone(eff);\n    data.duration = { rounds: 1 };\n    await game.xjzl.api.effects.addEffect(args.attacker, data);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "附骨化毒",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>快、准、狠，踢打目标腿部与下阴，造成 0.3 力量点外功伤害。若击破架招，令对方陷入“疼痛难耐”，持续三回合。</p><p><strong>疼痛难耐：</strong>每次出招时自身流失 5 点气血。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破后自动施加疼痛难耐状态。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加疼痛",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"疼痛难耐\").toObject();\n    delete eff._id;\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "一跃成龙",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "10米",
                    "targetInfo": "直线",
                    "actionCost": "蓄力动作",
                    "description": "<p>消耗所有移动速度，身体犹如陀螺般高速旋转，将全身力量集中在脚上，如毒龙一般在电光火石之间突破防御，朝一个未被占据的空格一脚踢去，对路径上所有敌人造成 0.5 力量点外功伤害。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "路径伤害范围手动。清空速度手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    }
                }
            ],
            "effects": [
                {
                    "name": "疼痛难耐",
                    "icon": "icons/svg/lightning.svg",
                    "description": "每次出招时流失5点气血。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "pain",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "出招流失",
                                    "trigger": "attack",
                                    "active": true,
                                    "script": "await actor.applyHealing({amount: -5, type: 'hp'});"
                                }
                            ]
                        }
                    },
                    "duration": {
                        "rounds": 3
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "黑心掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>诡秘歹毒，中招之后，肌肤溃烂，若不排出掌力和内蕴含之毒，会逐渐发展至五脏六腑，衰弱而死。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "炼毒掌",
                    "type": "qi",
                    "actionType": "default",
                    "element": "yang",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>内力运转，掌心发黑，为自己下 1 次攻击添加“毒掌”效果，持续到战斗脱离。</p><p><strong>毒掌：</strong>命中敌人后添加一层“黑神毒”，若敌人无架招，额外添加一层。黑神毒最多叠加 9 层，持续到战斗脱离。</p><p><strong>黑神毒：</strong>每层使你的[韧性]等级-1（最低 0）。</p><p><strong>升级：</strong>“毒掌”可攻击次数+1，内力消耗+1。</p>",
                    "automationNote": "应用Buff自动。毒掌触发黑神毒自动。黑神毒效果自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "应用毒掌",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"毒掌\").toObject();\ndelete eff._id; eff.origin = thisItem.uuid;\n\n// 动态计算次数 (1 + Lv-1)\nconst lvl = Math.max(1, move.computedLevel || 1);\neff.flags[\"xjzl-system\"].maxStacks = lvl;\neff.flags[\"xjzl-system\"].stacks = lvl; // 初始给满次数\n\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "黑魔护体",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>黑气萦绕，开启架招。格挡成功时，给对方添加 1 层“黑神毒”，持续到战斗脱离。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "格挡自动给攻击者施加黑神毒。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡附毒",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst poison = thisItem.effects.getName(\"黑神毒\").toObject();\ndelete poison._id; poison.origin = thisItem.uuid;\nif (args.attacker) {\n    await game.xjzl.api.effects.addEffect(args.attacker, poison);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "万物俱散",
                    "type": "real",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>黑心掌击出，造成 0.4 力量点外功伤害。</p><p>·若目标当前的[韧性]为 0，招式暴击骰-3。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "自动检测目标韧性并修正暴击阈值。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "韧性检测",
                            "trigger": "attack",
                            "script": "const targets = Array.from(game.user.targets).map(t => t.document.actor);\n// 仅检测首要目标\nif (targets.length > 0) {\n    const target = targets[0];\n    const renxing = target.system.skills.renxing.total;\n    if (renxing <= 0) {\n        args.flags.critThresholdMod = (args.flags.critThresholdMod || 0) + 3;\n        ui.notifications.info(\"目标韧性归零，暴击率提升！\");\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "黑神爆体",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双掌拍出，造成 0.3 力量+0.3 内息点外功伤害，引爆目标体内毒素，目标每有一层“黑神毒”，流失 5 点内力。</p><p>·若目标中此招后内力低于内力上限的 50%，则在内力值恢复至 50%之前，受到《黑心掌》招式伤害时，变为受到毒素伤害。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "自动引爆毒素消减内力。内力过低变伤效果需手动处理。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "爆毒",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const poison = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"heishendu\");\n    if (poison) {\n        const stacks = poison.getFlag(\"xjzl-system\", \"stacks\") || 1;\n        const mpDrain = stacks * 5;\n        await args.target.applyHealing({amount: -mpDrain, type: 'mp', showScrolling: true});\n        ui.notifications.info(`引爆 ${stacks} 层黑神毒，消减 ${mpDrain} 内力！`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "毒掌",
                    "icon": "icons/magic/death/hand-withered-green.webp",
                    "description": "攻击附带黑神毒。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "duzhang",
                            "stackable": true,
                            "scripts": [
                                {
                                    "label": "附毒",
                                    "trigger": "hit",
                                    "active": true,
                                    "script": "// 仅对攻击招式生效\nif (args.type === 'attack' && args.isHit) {\n    // 扣除次数\n    await game.xjzl.api.effects.removeEffect(actor, \"duzhang\", 1);\n    \n    // 施加黑神毒\n    const poisonName = \"黑神毒\";\n    // 从来源物品里找毒的模板\n    const poisonTemplate = thisItem.effects.getName(poisonName);\n    if (poisonTemplate) {\n        const pData = poisonTemplate.toObject();\n        delete pData._id; pData.origin = thisItem.uuid;\n        \n        // 基础1层\n        let layers = 1;\n        // 无架招+1层\n        if (!args.target.system.martial.stanceActive) layers++;\n        \n        for(let i=0; i<layers; i++) {\n            await game.xjzl.api.effects.addEffect(args.target, pData);\n        }\n        ui.notifications.info(`${args.target.name} 中毒 ${layers} 层`);\n    }\n}"
                                }
                            ]
                        }
                    },
                    "changes": []
                },
                {
                    "name": "黑神毒",
                    "icon": "icons/creatures/invertebrates/spider-face-purple.webp",
                    "description": "每层韧性-1。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "heishendu",
                            "stackable": true,
                            "maxStacks": 9
                        }
                    },
                    "changes": [
                        {
                            "key": "system.skills.renxing.mod",
                            "mode": 2,
                            "value": "-1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "踏歌舞",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>又名《踏金莲》，以金壁涂麝香，又凿金为莲花，镶贴地上，行走其上，边走边舞，华丽无比。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p><p>·每有 1 级[表演]，该套路的招式伤害提升 3 点。</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "香尘如泥",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>舒展四肢，悠然开启架招，同时进入“妙舞”，持续一回合。</p><p><strong>妙舞：</strong>你的命中、闪避提升等同于你[表演]等级的数值。</p><p><strong>升级：</strong>格挡值+5，妙舞持续回合+1，内力消耗+1。</p>",
                    "automationNote": "开启自动获得妙舞。数值为开启瞬间的表演等级快照。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得妙舞",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"妙舞\").toObject();\ndelete eff._id; eff.origin = thisItem.uuid;\n\n// 动态持续时间\nconst lvl = Math.max(1, move.computedLevel || 1);\neff.duration = { rounds: 1 + (lvl - 1) };\n\n// 动态数值 (表演等级)\nconst val = actor.system.skills.biaoyan.total || 0;\neff.changes[0].value = String(val);\neff.changes[1].value = String(val);\neff.changes[2].value = String(val);\n\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "花舞寒鬓",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>手臂柔转，旋转自身，轻拂周围敌人，对他们造成 0.1 内息点内功伤害。并添加一层“失准”，至多三层，持续到战斗脱离。</p><p><strong>失准：</strong>每层使你的命中-5</p><p><strong>升级：</strong>招式伤害+5，内力消耗+2。</p>",
                    "automationNote": "自动应用失准状态。表演等级伤害加成自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.1
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "表演加成",
                            "trigger": "calc",
                            "script": "const val = actor.system.skills.biaoyan.total || 0;\nargs.output.damage += val * 3;",
                            "active": true
                        },
                        {
                            "label": "失准",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = thisItem.effects.getName(\"失准\").toObject();\n    delete eff._id; eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "高楼夜静",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>轻轻踮脚，跃至半空，婉转身姿，扑入目标怀中，对目标造成 0.3 内息点内功伤害。击破架招时，将目标推倒在地。</p><p>·若你存在妙舞，目标还会陷入“错乱”一回合。</p><p><strong>错乱：</strong>自己的每个回合末，朝 D4 随机方向不消耗速度走出一步，然后倒地。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破推倒自动。妙舞施加错乱自动。错乱的具体效果需手动处理。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "表演加成",
                            "trigger": "calc",
                            "script": "const val = actor.system.skills.biaoyan.total || 0;\nargs.output.damage += val * 3;",
                            "active": true
                        },
                        {
                            "label": "推倒与错乱",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    // 推倒\n    const prone = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if (prone) await game.xjzl.api.effects.addEffect(args.target, prone);\n\n    // 错乱检测\n    const hasMiaoWu = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"miaowu\");\n    if (hasMiaoWu) {\n        const chaos = CONFIG.statusEffects.find(e => e.id === \"cuoluan\");\n        if (chaos) {\n            const data = foundry.utils.deepClone(chaos);\n            data.duration = { rounds: 1 };\n            await game.xjzl.api.effects.addEffect(args.target, data);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "步步生莲",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>脚踏朝露，唱音袅袅，对周围敌人造成 0.5 内息点内功伤害。</p><p>·此招可移动释放，对移动路径上周围 2 米范围内的敌人造成伤害。（不会重复造成伤害）</p><p>·在你释放此招时移动过的路径空格上形成‘踏莲’，持续一回合。</p><p><strong>踏莲：</strong>第一次进入此区域的敌人陷入禁足一回合；第一次进入此区域的友方回复 10 气血。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "移动路径伤害、地表效果均需手动处理。伤害加成自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "表演加成",
                            "trigger": "calc",
                            "script": "const val = actor.system.skills.biaoyan.total || 0;\nargs.output.damage += val * 3;",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "妙舞",
                    "icon": "icons/magic/life/cross-worn-green.webp",
                    "description": "命中闪避提升。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "miaowu",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.hit_waigong",
                            "mode": 2,
                            "value": "0"
                        },
                        {
                            "key": "system.combat.hit_neigong",
                            "mode": 2,
                            "value": "0"
                        },
                        {
                            "key": "system.combat.dodge",
                            "mode": 2,
                            "value": "0"
                        }
                    ]
                },
                {
                    "name": "失准",
                    "icon": "icons/svg/blind.svg",
                    "description": "命中-5。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "shizhun",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.hit_waigong",
                            "mode": 2,
                            "value": "-5"
                        },
                        {
                            "key": "system.combat.hit_neigong",
                            "mode": 2,
                            "value": "-5"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "一点红",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>以医入武，出指如风，直指敌人周身几大要穴和主要经脉，往往一指便能了结敌人性命。尸体上只留一个血洞潺潺流血，故称“一点红”。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>柔</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "掌中莲花",
                    "type": "stance",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双手相合，置于胸前，开启架招，并进入“莲花”状态，持续到脱战或切换武学套路。</p><p><strong>莲花：</strong>你的[韧性]等级+5。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "开启自动获得莲花状态。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得莲花",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"莲花\").toObject();\ndelete eff._id; eff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "指生芍药",
                    "type": "real",
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>指尖沾血，戳向敌人要害，对目标造成 0.4 内息点内功伤害。若命中无架招目标，则给予自身“芍药”状态，持续到战斗脱离。</p><p><strong>芍药：</strong>出招回复气血时，回复量提高 10 点。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中且目标无架招时，自动获得芍药。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得芍药",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"芍药\").toObject();\n    delete eff._id; eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "相思桃花",
                    "type": "qi",
                    "actionType": "heal",
                    "element": "rou",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>手指在伤患身上轻点，注入真气，回复目标 0.2 内息点的气血。（无法造成暴击）</p><p>·此招中的内息是施展本招式者的内息属性。</p><p>·每有 1 级[疗伤]，提高 1 点气血回复。</p><p><strong>升级：</strong>气血回复+5，内力消耗+1。</p>",
                    "automationNote": "自动计算治疗量（含疗伤等级和芍药加成）。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.2
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "计算治疗量",
                            "trigger": "calc",
                            "script": "// 疗伤技能加成\nconst liaoshang = actor.system.skills.liaoshang.total || 0;\nargs.output.damage += liaoshang;\n\n// 芍药加成\nconst hasPeony = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"shaoyao\");\nif (hasPeony) {\n    args.output.damage += 10;\n    args.output.bonusDesc.push(\"芍药加成 +10\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "解语海棠",
                    "type": "real",
                    "isUltimate": true,
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>指节点向敌人的太阳穴，对目标造成 0.6 内息点内功伤害，之后，你可以选择消耗“莲花”与“芍药”状态，使用次要动作施展一次【相思桃花】。</p><p>·若此招将敌人打入濒死，则敌人的身体上会盛开一朵血花，血花会使敌人的[韧性]永久-1（最低 0）。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "连招与击杀特效完全手动。命中提示连招机会。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "连招提示",
                            "trigger": "hit",
                            "script": "const hasLotus = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"lianhua\");\nconst hasPeony = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"shaoyao\");\n\nif (hasLotus && hasPeony) {\n    ui.notifications.info(\"可手动消耗 [莲花] 与 [芍药] 连招 [相思桃花]\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "莲花",
                    "icon": "icons/magic/nature/flower-lotus-pink.webp",
                    "description": "韧性+5。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "lianhua",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.skills.renxing.mod",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                },
                {
                    "name": "芍药",
                    "icon": "icons/magic/nature/flower-rose-red.webp",
                    "description": "治疗量+10。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "shaoyao",
                            "stackable": false
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "倒踢天罡",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>倒踢天罡逆反常理，为人所不为，攻人所不备。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "无动于衷",
                    "type": "stance",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>放弃应对对手招式，不为眼前的任何招式所动，开启架招，并且获得“无动于衷”状态，持续到战斗脱离或者切换武学套路。</p><p><strong>无动于衷：</strong>在攻击你时，实招视为虚招，虚招视为实招。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "自动获得状态图标，具体效果需玩家手动裁定。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得状态",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"无动于衷\").toObject();\ndelete eff._id; eff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "旱地拔葱",
                    "type": "real",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你因为身处半空中被人以反应动作攻击时可以消耗反应动作施展此招，身体猛地又拔高一寸，接着头脚倒置，一脚踢在来人下巴，对目标造成 0.3 力量点外功伤害，若目标无架招，则将对方击飞 1 米，对方在他的下个回合开始时落地。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中且无架招时提示手动击飞。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(`${args.target.name} 被击飞 1 米 (滞空) - 请手动处理`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "倒打翻身",
                    "type": "qi",
                    "actionType": "default",
                    "element": "yin",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "自身",
                    "actionCost": "反应动作",
                    "description": "<p>当你处于倒地状态而被攻击时，可以消耗反应动作释放，鲤鱼打挺，随后鹞子翻身，向后飞跃 2 米，若离开目标的攻击距离，则对你的这次攻击丢失。</p><p><strong>升级：</strong>飞跃距离+1，内力消耗+1。</p>",
                    "automationNote": "完全手动。请自行移动并判定攻击是否失效。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    }
                },
                {
                    "name": "头重脚轻",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>出其不意，冲天而发，正中下巴，对目标造成 0.3 力量点外功伤害。</p><p>·若目标没有见过这招，则招式伤害+20。</p><p>·若目标没见过此招且无架招，则造成伤害后，一脚升天将其踢飞 1 米，并倒地，目标还会失去对本招的记忆（视为没见过此招）。</p><p>·若目标没见过此招且无架招且本招式暴击，则目标还会陷入脑震荡状态，持续到战斗脱离。</p><p><strong>脑震荡：</strong>速度减半，每回合初怒气-1。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "初见加伤、击飞倒地、脑震荡均需手动判定和处理。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "脑震荡",
                            "trigger": "hit",
                            "script": "// 仅供参考，条件需手动判断\nif (args.isHit && args.isCrit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(\"若符合初见条件，请手动添加 [脑震荡] (Brain Concussion)\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "无动于衷",
                    "icon": "icons/svg/mystery-man.svg",
                    "description": "颠倒实虚。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "wudongyuzhong",
                            "stackable": false
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "七十二路地煞拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>一伙山贼听了说书人的评书，仰慕前朝梁山泊好汉的风采，将自己的招式冠以地煞好汉的名头，汇成一套，但仍脱不开下九流风气。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "孙立跨乌骓",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>扎稳马步，屹立不动，开启架招。获得“病尉迟”状态，持续到战斗脱离或架招被破。</p><p><strong>病尉迟：</strong>免疫一次击退或击飞，然后移除此状态。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "开启自动获得BUFF。免疫效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得病尉迟",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"病尉迟\").toObject();\ndelete eff._id; eff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "金犬窃宝驹",
                    "type": "counter",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作释放此招，压制目标虚招，一手攻敌，一手向对方囊中探去，对其造成 0.4 力量点外功伤害，若目标无架招，则选择对方背包内一件铜品物品，偷至自己行囊中。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中且无架招时提示手动窃取。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "窃取提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(\"可手动窃取一件铜品物品！\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "朱武破八阵",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>洞察弱点，一掌击出，对目标造成 0.3 力量点外功伤害。击破架招时，使自身获得一层“神机”状态，至多三层，持续到战斗脱离。</p><p><strong>神机：</strong>每层使招式释放距离+1，伤害+5。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破自动获得神机。神机加成手动计算。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得神机",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"神机\").toObject();\n    delete eff._id; eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "项充持团牌",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>单手紧握，似持团牌，一拳打出，对目标造成 0.5 力量点外功伤害，同时你获得团牌状态，持续到战斗脱离。</p><p><strong>团牌：</strong>你受到来自箭矢，暗器的伤害时，可以移除这个状态，减免 50 点伤害。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "出招自动获得BUFF。减伤逻辑手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得团牌",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"团牌\").toObject();\ndelete eff._id; eff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "病尉迟",
                    "icon": "icons/svg/shield.svg",
                    "description": "免疫击退/击飞。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "bingweichi",
                            "stackable": false
                        }
                    },
                    "changes": []
                },
                {
                    "name": "神机",
                    "icon": "icons/svg/upgrade.svg",
                    "description": "距离+1，伤害+5。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "shenji",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": []
                },
                {
                    "name": "团牌",
                    "icon": "icons/items/shields/round-wooden-brown.webp",
                    "description": "抵挡箭矢暗器。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "tuanpai",
                            "stackable": false
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "玉体横陈掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>本是江湖杂耍把式，花哨无用，但经高人改良，专取敌人衣物，深受登徒浪子所爱。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "宽衣解带",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>挥手虚探，掠向目标衣衫，造成 0.3 内息点内功伤害，击破架招时可以选择让目标陷入“宽衣”或“解带”状态，持续三回合。</p><p>·<strong>宽衣：</strong>你的上衣被解开，失去上衣效果，可以花费一个主要动作穿好，然后移除该状态。</p><p>·<strong>解带：</strong>你的下衣被扯落，失去下衣效果，可以花费一个主要动作穿好，然后移除该状态。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破后提示手动添加状态。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "选择状态",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const content = `<div class=\"xjzl-chat-card\">\n        <div class=\"card-header\" style=\"border-bottom:1px solid #ccc;\">宽衣解带 - 击破</div>\n        <div style=\"padding:5px;\">\n            <p>请手动给目标添加状态：</p>\n            <ul>\n                <li><b>宽衣</b> (Top disabled)</li>\n                <li><b>解带</b> (Bottom disabled)</li>\n            </ul>\n        </div>\n    </div>`;\n    ChatMessage.create({ user: game.user.id, speaker: ChatMessage.getSpeaker({actor: actor}), content: content });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "拨云撩雨",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>缠衣欺身，抚摸目标肌肤，造成 0.4 内息点内功伤害，若目标存在“宽衣”或“解带”或“脱靴”状态，可消耗次要动作，将目标上衣（对应宽衣）或下衣（对应解带）或鞋子（对应脱靴）夺走。</p><p>·被夺走衣物后，目标失去该装备。你的一只手会被这件衣物占用（不可丢弃），直到衣物的主人花费一个主要动作，从你手中抢回这件衣物，他还需要再花费一个主要动作才能穿好这件衣物。</p><p>·若你的两只手都被目标衣物占据，则无法出招。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "夺取装备逻辑手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    }
                },
                {
                    "name": "力士脱靴",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作，压制对方虚招，揽身撩踝，造成 0.5 内息点内功伤害，击中无架招目标可顺势“脱靴”。</p><p>·<strong>脱靴：</strong>你的鞋子被脱下，失去鞋子效果，可以花费一个主要动作穿好，然后移除该状态。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中且无架招提示手动脱靴。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "脱靴提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(\"目标无架招，可手动施加 [脱靴]\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "小鹿乱撞",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>当你手上被敌方衣物占据时，才能施展此招。</p><p>眉眼巧逗弄，指尖悄抹粉，物归原主！</p><p>·你将夺取的衣物还给目标。同时目标只需要花费一个次要动作就能穿好这件衣物。</p><p>·若目标重新穿上这件装备，就会沾染春粉，心神荡漾，忐忑不安，并进行一个[定力]检定（难度 12），失败则陷入“荡漾”状态，持续三回合。</p><p><strong>荡漾：</strong>你在每回合初获得 1 点怒气，你无法以状态添加者为攻击目标。</p><p><strong>升级：</strong>[定力]检定难度+2，怒气-1，内力消耗+2。</p>",
                    "automationNote": "前置条件/归还物品手动。命中后自动发起定力检定，失败自动施加荡漾。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            5,
                            4,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "定力检定",
                            "trigger": "hit",
                            "script": "const lvl = Math.max(1, move.computedLevel || 1);\nconst dc = 12 + (lvl - 1) * 2;\nawait Macros.requestSave({\n    target: args.target,\n    attacker: actor,\n    type: \"dingli\",\n    dc: dc,\n    label: \"抵抗荡漾\",\n    onFail: {\n        name: \"荡漾\",\n        changes: [{ key: \"flags.xjzl-system.regenRageTurnStart\", mode: 2, value: \"1\" }],\n        duration: { rounds: 3 }\n    }\n});",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "蜚蠊掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>恶臭老人三大绝技之一，攻击之时，身上饲养的蜚蠊顺着攻击爬满对手全身，骇人恐怖。</p><p><strong>需求：</strong>徒手 神采低于 10</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手；神采低于10",
            "moves": [
                {
                    "name": "飞蠊入怀",
                    "type": "feint",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>自袖口甩出数十只蜚蠊，对目标造成 0.3 内息点内功伤害，若击破目标架招，蜚蠊爬入目标衣裤，将招式伤害变为精神伤害。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破后自动将伤害类型转为精神伤害。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "转精神伤害",
                            "trigger": "preDamage",
                            "script": "if (args.outcome.isBroken) {\n    args.config.type = \"mental\";\n    ui.notifications.info(\"蜚蠊入怀：转为精神伤害！\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "双蠊噬心",
                    "type": "real",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双掌齐出，蜚蠊爬满手背，对目标造成 0.4 内息点内功伤害，击中使用徒手招式架招的目标，蜚蠊噬咬，额外造成 5 点精神伤害。</p><p>·若击中无架招目标，蜚蠊爬上目标面目，额外再造成 10 点精神伤害。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "命中且无架招时自动额外伤害。徒手架招判定需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "额外精神伤",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    let extraDmg = 0;\n    if (!args.target.system.martial.stanceActive) {\n        extraDmg = 10;\n    } \n    // 徒手架招检测复杂，略\n\n    if (extraDmg > 0) {\n        await args.target.applyDamage({ amount: extraDmg, type: 'mental', attacker: actor, isHit: true, isCrit: false });\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "群蠊护身",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>蜚蠊迅速爬满全身，蠢蠢欲动，并且在周围地板上爬行，开启架招，格挡成功后，群蠊反噬，使自身周围 2 米内的敌人陷入“下盘不稳”，持续一回合。</p><p><strong>升级：</strong>格挡值+5，内力消耗+1。</p>",
                    "automationNote": "格挡自动触发，且自动检测2米范围施加下盘不稳。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "反噬",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nif (!args.attacker) return;\n\n// 距离检测 (2m)\nconst t1 = actor.token?.object || actor.getActiveTokens()[0];\nconst t2 = args.attacker.token?.object || args.attacker.getActiveTokens()[0];\nlet inRange = false;\nif (t1 && t2) {\n    const dist = canvas.grid.measurePath([t1.center, t2.center]).distance;\n    if (dist <= 2.1) inRange = true;\n}\n\nif (inRange) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"unstable\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 1 };\n        await game.xjzl.api.effects.addEffect(args.attacker, data);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "掌蠊天地",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>浑身飞出上百只蜚蠊，并且呼唤周围地下的蜚蠊，遮天蔽日，使自身周围 1 米的空间变为‘蜚蠊地狱’，下回合可继续消耗蓄力动作施展（不消耗怒气内力），每蓄力 1 回合招式范围+1。</p><p><strong>蜚蠊地狱：</strong>在区域内开始回合的敌人受到 20 点毒素伤害，并且进行[定力]检定（难度 5），检定失败，陷入“眩晕”，持续一回合。</p><p><strong>升级：</strong>招式范围+2，毒素伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "区域生成与地狱效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    }
                }
            ]
        }
    },
    {
        "name": "醉拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>打起来如酒后醉汉，颠颠又倒倒，好比浪涛。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>刚</p><p>注：若侠士处于“醉倒”，《醉拳》招式可将对方击倒，且招式伤害+5。</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "提膝斟酒",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>掌心朝下，直臂平摆作酒杯状，开启架招，格挡成功后，获得 10 点醉意。</p><p>·处于“醉倒”时，该架招提供的格挡值翻倍。</p><p><strong>升级：</strong>格挡值+5。</p>",
                    "automationNote": "开启消耗醉意自动。格挡获醉意自动。醉倒翻倍格挡需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗醉意",
                            "trigger": "attack",
                            "script": "const current = actor.system.resources.alcohol.value || 0;\nconst cost = 5;\nif (current < cost) {\n    ui.notifications.warn(\"醉意不足！\");\n    args.flags.abort = true;\n    return;\n}\nawait actor.update({\"system.resources.alcohol.value\": current - cost});",
                            "active": true
                        },
                        {
                            "label": "格挡获醉",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst current = actor.system.resources.alcohol.value || 0;\nawait actor.update({\"system.resources.alcohol.value\": current + 10});\nui.notifications.info(\"格挡成功，醉意+10\");",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "叠臂栽碑",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>两脚直起，向前倒地，踢脚对目标造成 0.4 力量点外功伤害。</p><p>·当有敌人靠近你 2 米内或在你周围 2 米范围内移动时，可消耗反应动作施展此招，拖行耸肩至目标身边，踢脚造成伤害。</p><p><strong>升级：</strong>招式伤害+5。</p>",
                    "automationNote": "自动消耗醉意。醉倒时自动加伤与击倒。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗醉意",
                            "trigger": "attack",
                            "script": "const current = actor.system.resources.alcohol.value || 0;\nconst cost = 5;\nif (current < cost) {\n    ui.notifications.warn(\"醉意不足！\");\n    args.flags.abort = true;\n    return;\n}\nawait actor.update({\"system.resources.alcohol.value\": current - cost});",
                            "active": true
                        },
                        {
                            "label": "醉倒加成",
                            "trigger": "calc",
                            "script": "const isDrunk = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"zuidao\");\nif (isDrunk) {\n    args.output.damage += 5;\n    args.output.bonusDesc.push(\"醉倒加伤 +5\");\n}",
                            "active": true
                        },
                        {
                            "label": "醉倒击倒",
                            "trigger": "hit",
                            "script": "const isDrunk = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"zuidao\");\nif (isDrunk && args.isHit) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\n    if (eff) await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "跃步挑打",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>蹬地跳起（处于半空中），翻身两臂前摆，砸向目标，造成 0.3 力量点外功伤害。击破架招时，自身醉意+10，并给对方添加与自身醉意相同数值的醉意。</p><p><strong>升级：</strong>招式伤害+5。</p>",
                    "automationNote": "自动消耗醉意。击破自动加醉意。给敌方添加醉意需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗醉意",
                            "trigger": "attack",
                            "script": "const current = actor.system.resources.alcohol.value || 0;\nconst cost = 5;\nif (current < cost) {\n    ui.notifications.warn(\"醉意不足！\");\n    args.flags.abort = true;\n    return;\n}\nawait actor.update({\"system.resources.alcohol.value\": current - cost});",
                            "active": true
                        },
                        {
                            "label": "击破获醉",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const current = actor.system.resources.alcohol.value || 0;\n    await actor.update({\"system.resources.alcohol.value\": current + 10});\n    ui.notifications.info(\"击破架招，醉意+10\");\n    ui.notifications.info(`请手动给目标添加 ${current + 10} 点醉意`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鲤鱼反蹦",
                    "type": "counter",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破目标虚招后，可消耗反应动作释放此招，压制目标虚招，屈膝落步，滚地至目标周围空格，右手变握杯拳击出，对目标造成 0.5 力量点外功伤害。</p><p><strong>升级：</strong>招式伤害+5。</p>",
                    "automationNote": "自动消耗醉意。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗醉意",
                            "trigger": "attack",
                            "script": "const current = actor.system.resources.alcohol.value || 0;\nconst cost = 5;\nif (current < cost) {\n    ui.notifications.warn(\"醉意不足！\");\n    args.flags.abort = true;\n    return;\n}\nawait actor.update({\"system.resources.alcohol.value\": current - cost});",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "劝酒换杯",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>右持杯手，弧行击出，对目标造成 0.6 力量点外功伤害。若处于“醉倒”，暴击骰-2。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1。</p>",
                    "automationNote": "自动消耗醉意。醉倒自动修正暴击。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗醉意",
                            "trigger": "attack",
                            "script": "const current = actor.system.resources.alcohol.value || 0;\nconst cost = 10;\nif (current < cost) {\n    ui.notifications.warn(\"醉意不足！\");\n    args.flags.abort = true;\n    return;\n}\nawait actor.update({\"system.resources.alcohol.value\": current - cost});",
                            "active": true
                        },
                        {
                            "label": "暴击修正",
                            "trigger": "attack",
                            "script": "const isDrunk = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"zuidao\");\nif (isDrunk) {\n    args.flags.critThresholdMod = (args.flags.critThresholdMod || 0) + 2;\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "双龙指",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 1,
            "description": "<p>指法阴损毒辣，其意在双龙夺珠，攻人眼球，此武学为江湖人所不齿。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "游龙探目",
                    "type": "feint",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>一手攻向面门，一手伸出两指趁其不备插向敌方双瞳，对其造成 0.3 身法点外功伤害，击破架招时，使其陷入“目盲”，持续三回合。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "击破后自动施加目盲状态。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破目盲",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"blind\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 3 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "双龙夺珠",
                    "type": "real",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双手连环，四指攻向目标双眼，对其造成 0.4 身法点外功伤害。</p><p>若此招被对方架招格挡，则你的手指受弯折疼痛，你流失 10 点气血，获得 1 点怒气，且下回合无法再使用《双龙指》套路。</p><p><strong>升级：</strong>招式伤害+5，内力消耗+1。</p>",
                    "automationNote": "被格挡自动反噬。封锁套路需手动记忆。",
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡反噬",
                            "trigger": "hit",
                            "script": "if (!args.isHit && args.target.system.martial.stanceActive && !args.ignoreStance) {\n    await actor.applyHealing({amount: -10, type: 'hp', showScrolling: true});\n    await actor.update({\"system.resources.rage.value\": (actor.system.resources.rage.value || 0) + 1});\n    ui.notifications.warn(\"双龙夺珠被格挡！手指折断！\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "毒龙护指",
                    "type": "stance",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>呵气于指，开启架招。成功格挡后，为自身添加“戳目”，持续一回合。</p><p><strong>戳目：</strong>下次使用【双龙夺珠】时，若目标无架招且处于目盲状态，则使其目盲持续到战斗脱离。</p><p><strong>升级：</strong>格挡值+5，戳目持续回合数+1，消耗+1。</p>",
                    "automationNote": "格挡自动获戳目BUFF。BUFF效果需手动配合。",
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获戳目",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"戳目\").toObject();\ndelete eff._id; eff.origin = thisItem.uuid;\n// 动态持续时间\nconst stanceId = actor.system.martial.stance;\nconst moveData = thisItem.system.moves.find(m => m.id === stanceId);\nconst lvl = Math.max(1, moveData?.computedLevel || 1);\neff.duration = { rounds: 1 + (lvl - 1) };\n\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鱼目混珠",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>呼喝喊叫，声东击西，对目标造成 0.6 身法点外功伤害。</p><p>·若目标处于“目盲”状态，则此招必定命中。</p><p>·若目标的“目盲”状态由你添加，招式伤害提升 10 点。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "对目盲必中自动。来源检测复杂，加伤请手动修正。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "shenfa",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "目盲必中",
                            "trigger": "attack",
                            "script": "const targets = Array.from(game.user.targets).map(t => t.document.actor);\nif (targets.length > 0) {\n    const target = targets[0];\n    const isBlind = target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"blind\");\n    if (isBlind) {\n        args.flags.forceHit = true;\n        ui.notifications.info(\"目标目盲，攻击必中！\");\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "戳目",
                    "icon": "icons/svg/target.svg",
                    "description": "强化双龙夺珠。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "chuomu",
                            "stackable": false
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "八极拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>武有八极定乾坤，江湖短打拳法，刚猛脆烈，劲如崩弓，发如炸雷，爆发力极强。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "阎王三点手",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，弓步冲拳，接双劈拳，对目标造成 0.5 力量点外功伤害。若本回合在招式命中前直线移动满 5 米，招式暴击骰-1，且获得一层“拳势”，至多三层，持续到脱战或更换其他武器的武学套路。</p><p><strong>拳势：</strong>每层使徒手武学命中+10。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "移动判断手动(弹窗询问)。获得拳势需手动确认移动条件。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "移动检测与拳势",
                            "trigger": "attack",
                            "script": "const confirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"移动检测\" },\n    content: `<p>本回合是否直线移动满 5 米？</p>`,\n    yes: { label: \"是\", icon: \"fas fa-check\" },\n    no: { label: \"否\", icon: \"fas fa-times\" }\n});\nif (confirm) {\n    args.flags.critThresholdMod += 1;\n    ui.notifications.info(\"移动满5米：暴击骰-1\");\n    // 标记后续hit脚本\n    args.flags.moved5m = true;\n}",
                            "active": true
                        },
                        {
                            "label": "获得拳势",
                            "trigger": "hit",
                            "script": "if (args.isHit && args.attacker.flags?.moved5m) {\n    const eff = thisItem.effects.getName(\"拳势\").toObject();\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "霸王硬折缠",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，左冲拳砸头，右肘撞心窝，对目标造成 0.4 力量点外功伤害。击破架招时，为目标添加“破甲”，持续三回合。</p><p><strong>破甲：</strong>你的外功防御归零。</p><p>·你可以消耗至多一层“拳势”，使虚招值+1。</p><p><strong>升级：</strong>招式伤害+10，增加的虚招值+1，消耗+2。</p>",
                    "automationNote": "击破施加破甲自动。消耗拳势增强虚招手动(弹窗询问)。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗拳势",
                            "trigger": "attack",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"quanshi\");\nif (buff) {\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const bonus = 1 + (lvl - 1);\n    const confirm = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"霸王硬折缠\" },\n        content: `<p>是否消耗 1 层 [拳势] 使虚招值 <b>+${bonus}</b>？</p>`,\n        yes: { label: \"消耗\", icon: \"fas fa-check\" },\n        no: { label: \"不消耗\", icon: \"fas fa-times\" }\n    });\n    if (confirm) {\n        await game.xjzl.api.effects.removeEffect(actor, \"quanshi\", 1);\n        args.flags.bonusFeint += bonus;\n        ui.notifications.info(`已消耗拳势，虚招值 +${bonus}`);\n    }\n}",
                            "active": true
                        },
                        {
                            "label": "击破破甲",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"pojia\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 3 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 被破甲！`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "迎封朝阳手",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，含胸收腹，开启架招。格挡 1 米内攻击时，可以消耗反应动作刁扣手腕，拳砸关节，为其添加“错骨”，持续一回合，也可以选择不添加错骨，而是获得一层“拳势”。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2</p>",
                    "automationNote": "格挡后弹窗选择效果(错骨或拳势)。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡触发",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n\n// 简单距离判断\nconst t1 = actor.token?.object || actor.getActiveTokens()[0];\nconst t2 = args.attacker.token?.object || args.attacker.getActiveTokens()[0];\nif (t1 && t2) {\n    const dist = canvas.grid.measurePath([t1.center, t2.center]).distance;\n    if (dist > 1.1) return;\n}\n\nnew Dialog({\n    title: \"迎封朝阳手\",\n    content: \"<p>格挡成功(1米内)！请选择效果：</p>\",\n    buttons: {\n        cuogu: {\n            label: \"施加错骨\",\n            callback: async () => {\n                const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\n                if (eff) {\n                    const data = foundry.utils.deepClone(eff);\n                    data.duration = { rounds: 1 };\n                    await game.xjzl.api.effects.addEffect(args.attacker, data);\n                    ChatMessage.create({content: `${args.attacker.name} 被施加错骨`, speaker: ChatMessage.getSpeaker({actor: actor})});\n                }\n            }\n        },\n        quanshi: {\n            label: \"获得拳势\",\n            callback: async () => {\n                const eff = thisItem.effects.getName(\"拳势\").toObject();\n                eff.origin = thisItem.uuid;\n                await game.xjzl.api.effects.addEffect(actor, eff);\n            }\n        }\n    }\n}).render(true);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "迎门三不顾",
                    "type": "counter",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破虚招时，可消耗反应动作使用此招，压制对方虚招，穿喉击肋，寸截寸拿，对目标造成 0.6 力量点外功伤害，并为其添加“迟滞”两回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "命中自动施加迟滞。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加迟滞",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"chizhi\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 2 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 陷入迟滞`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "立地通天炮",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，横劈斜打，挺肘直顶，对目标造成 0.8 力量点外功伤害，并将其击飞 3 米后倒地。</p><p>·若本回合在招式命中前直线移动满 5 米，暴击骰-1，你可以再消耗一层“拳势”，使招式必定暴击。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "击飞倒地手动。移动判定与必中消耗手动确认。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "移动与拳势消耗",
                            "trigger": "attack",
                            "script": "// 1. 移动检测\nconst moveConfirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"移动检测\" },\n    content: `<p>本回合是否直线移动满 5 米？</p>`,\n    yes: { label: \"是\", icon: \"fas fa-check\" },\n    no: { label: \"否\", icon: \"fas fa-times\" }\n});\nif (moveConfirm) {\n    args.flags.critThresholdMod += 1;\n    ui.notifications.info(\"移动满5米：暴击骰-1\");\n\n    // 2. 拳势消耗 (仅当移动满5米时可选)\n    const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"quanshi\");\n    if (buff) {\n        const critConfirm = await foundry.applications.api.DialogV2.confirm({\n            window: { title: \"立地通天炮\" },\n            content: `<p>是否消耗 1 层 [拳势] 使招式 <b>必定暴击</b>？</p>`,\n            yes: { label: \"消耗\", icon: \"fas fa-check\" },\n            no: { label: \"不消耗\", icon: \"fas fa-times\" }\n        });\n        if (critConfirm) {\n            await game.xjzl.api.effects.removeEffect(actor, \"quanshi\", 1);\n            args.flags.critThresholdMod += 20; // 强行拉低阈值以实现必爆\n            ui.notifications.info(\"已消耗拳势，招式必定暴击！\");\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "拳势",
                    "icon": "icons/skills/melee/unarmed-punch-fist.webp",
                    "description": "提升徒手武学命中。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "quanshi",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.hit_waigong",
                            "mode": 2,
                            "value": "10"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "鸳鸯腿",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>腿法绝技，起脚如鸳鸯上翘尾，腿出连环紧扣，左右换势，恰似鸳鸯形影相随，故而得名。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "虎下坡",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，身稳桩实，猛而无虞，开启架招。格挡成功获得一层“蓄劲”，至多三层，持续到脱战。</p><p><strong>蓄劲：</strong>每层使你暴击骰-1。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "格挡获蓄劲自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获蓄劲",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"蓄劲\").toObject();\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鹰追",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，踏步上前，寸脚点翻目标造成 0.4 力量点外功伤害。命中无架招目标时，为其添加“禁足”，持续两回合，同时自身获得一层“蓄劲”，持续到战斗脱离。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "命中无架招施加禁足、自身获蓄劲自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "效果处理",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    // 1. 目标禁足\n    const rootEff = CONFIG.statusEffects.find(e => e.id === \"root\");\n    if (rootEff) {\n        const data = foundry.utils.deepClone(rootEff);\n        data.duration = { rounds: 2 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 被禁足`);\n    }\n    // 2. 自身蓄劲\n    const buff = thisItem.effects.getName(\"蓄劲\").toObject();\n    buff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, buff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "古蛇炼月",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，双掌撑地，双脚侧踢，对目标造成 0.5 力量点外功伤害，命中无架招目标时，将其击飞 1 米并倒地。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击飞倒地手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "玉环步",
                    "type": "qi",
                    "actionType": "default",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "自身",
                    "actionCost": "反应动作",
                    "description": "<p>当你受到内外功伤害时，可消耗反应动作释放此招，提腿勾脚，连环踏步，不消耗速度朝任意方向移动 1 米，然后获得“连击”，持续到战斗脱离。</p><p><strong>连击：</strong>你施展消耗主要动作的招式后，可以消耗反应动作，再次释放该招式，然后移除“连击”。</p><p><strong>升级：</strong>移动距离+2，怒气消耗-1，内力消耗+2。</p>",
                    "automationNote": "点击应用获得连击。移动手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            3,
                            2,
                            1
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得连击",
                            "trigger": "hit",
                            "script": "const eff = CONFIG.statusEffects.find(e => e.id === \"lianji\");\nif (eff) {\n    await game.xjzl.api.effects.addEffect(actor, eff);\n    ui.notifications.info(\"获得 [连击]\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鸳鸯脚",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，双脚高低四环上下合一，连翻旋踢，对目标造成 0.3 力量点外功伤害，若招式造成暴击，则可不消耗动作，不消耗怒气再次施展此招。</p><p>·刚领悟时，你一回合至多施展一次【鸳鸯脚】</p><p><strong>升级：</strong>招式伤害+20，可施展次数+1，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "暴击重置手动操作（通过手动配置弹窗勾选无消耗）。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "暴击提示",
                            "trigger": "hit",
                            "script": "if (args.isCrit) {\n    ui.notifications.info(\"鸳鸯脚暴击！可免费再次施展。\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "蓄劲",
                    "icon": "icons/svg/target.svg",
                    "description": "降低暴击骰。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "xujin",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.crit_waigong",
                            "mode": 2,
                            "value": "-1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "咏春拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>以寸劲快速制服敌人，又可自由收力的高深拳法。招式多变，出拳弹性，防守紧密，极难对付。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>柔</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "小念头",
                    "type": "stance",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，短桥窄马，开二字钳羊马，开启架招。架招开启期间你免疫“下盘不稳”。当你被击飞时，击飞距离-1，如果减少到 0，则改为被击倒。</p><p><strong>升级：</strong>格挡值+10，击飞距离-1，内力消耗+2</p>",
                    "automationNote": "免疫效果为文本说明，需手动忽略下盘不稳状态。击飞减免手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "冲拳撑掌",
                    "type": "real",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，拳打中线，旋变立掌，不消耗速度奔袭至目标面前空格，对其造成 0.5 力量点外功伤害，若目标无架招，将其击飞至三米内任意空格处。</p><p>·你可以移除三层“绵劲”，消耗反应动作再施展一次【冲拳撑掌】。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击飞手动。消耗绵劲手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗绵劲提示",
                            "trigger": "attack",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"mianjin\");\nconst stacks = buff ? (buff.getFlag(\"xjzl-system\", \"stacks\") || 1) : 0;\nif (stacks >= 3) {\n    const confirm = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"冲拳撑掌\" },\n        content: `<p>检测到 3 层 [绵劲]。是否消耗以触发重置？</p>`,\n        yes: { label: \"消耗\", icon: \"fas fa-check\" },\n        no: { label: \"不消耗\", icon: \"fas fa-times\" }\n    });\n    if (confirm) {\n        await game.xjzl.api.effects.removeEffect(actor, \"mianjin\", 3);\n        ui.notifications.info(\"已消耗绵劲，请手动再次施展\");\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "寻桥截打",
                    "type": "counter",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破虚招时，可消耗反应动作使用此招，压制对方虚招，追形拦臂，寸击目标造成 0.6 力量点外功伤害。同时将目标击倒并添加“禁足”一回合。</p><p><strong>升级：</strong>招式伤害+10，禁足回合数+1，消耗+2。</p>",
                    "automationNote": "命中施加禁足自动。击倒手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加禁足",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const rounds = 1 + (lvl - 1);\n    const eff = CONFIG.statusEffects.find(e => e.id === \"root\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: rounds };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 被禁足`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "标指贴打",
                    "type": "feint",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，以消带打，逢空必进，险中求胜，对目标造成 0.4 力量点外功伤害。击破架招时，自身获得一层“绵劲”，持续到战斗脱离。</p><p><strong>绵劲：</strong>每层使你的柔属性武学招式伤害+5</p><p><strong>升级：</strong>招式伤害+10，额外获得一层，消耗+2。</p>",
                    "automationNote": "击破获绵劲自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破获绵劲",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const amount = 1 + (lvl - 1);\n    const eff = thisItem.effects.getName(\"绵劲\").toObject();\n    eff.origin = thisItem.uuid;\n    // 循环添加多次以叠加层数\n    for(let i=0; i<amount; i++) {\n        await game.xjzl.api.effects.addEffect(actor, eff);\n    }\n    ui.notifications.info(`击破架招，获得 ${amount} 层绵劲`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "寸发无止",
                    "type": "real",
                    "isUltimate": true,
                    "element": "rou",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，不露拳意，动静无碍，见手追形，朝形破敌，有手则留，无手破中，来留去送，甩手直冲，进入“咏春”，持续三回合。</p><p><strong>咏春：</strong>你每次施展《咏春拳》时，可以消耗 1 怒气，不消耗动作进行两次普通攻击。</p><p>·你的普通攻击伤害+10，且暴击骰-1。</p><p><strong>升级：</strong>普通攻击伤害+20，怒气-1，消耗+4。</p>",
                    "automationNote": "获得BUFF自动。普攻连击手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            5,
                            4,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "开启咏春",
                            "trigger": "hit",
                            "script": "const lvl = Math.max(1, move.computedLevel || 1);\n    const bonus = 10 + (lvl - 1) * 10;\n    \n    const eff = thisItem.effects.getName(\"咏春\").toObject();\n    eff.origin = thisItem.uuid;\n    // 动态写入普攻伤害\n    eff.changes[0].value = String(bonus);\n    await game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "绵劲",
                    "icon": "icons/svg/ice-aura.svg",
                    "description": "提升柔属性招式伤害。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "mianjin",
                            "stackable": true
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.rou.mod",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                },
                {
                    "name": "咏春",
                    "icon": "icons/svg/combat.svg",
                    "description": "普攻增强，可连击。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "yongchun",
                            "stackable": false
                        }
                    },
                    "duration": {
                        "rounds": 3
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.normal.mod",
                            "mode": 2,
                            "value": "10"
                        },
                        {
                            "key": "system.combat.crit_waigong",
                            "mode": 2,
                            "value": "-1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "通背拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>北方拳种，冷弹脆快硬，沉长活柔巧，重猛轻灵抖，涵虚粘连随，极富盛名。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "猿猴抖臂",
                    "type": "real",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，右引左掸，旋腕击出。抖劲袭敌造成 0.5 力量点外功伤害。如果目标与你间隔 1 米，招式伤害+10。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "距离判断手动，请使用手动伤害修正。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "低雀地龙",
                    "type": "feint",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，抖翎拍掌，臂由肩出，轰击目标，造成 0.4 力量点外功伤害。击破架招时，自身获得“抖翎劲”，持续到战斗脱离。</p><p><strong>抖翎劲:</strong>当你被反应动作释放的招式命中时，消耗抖翎劲，化去目标力量，使对方出招视作未命中。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破获抖翎劲自动。消耗抖翎劲化解攻击需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破获劲",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"抖翎劲\").toObject();\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "三步引手",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，侧搂横手，前后相援，开启架招。格挡成功时，可不消耗速度朝任意方向移动 1 米，然后使目标陷入“下盘不稳”，持续一回合。</p><p><strong>升级：</strong>格挡值+10，额外移动 1 米，消耗+2。</p>",
                    "automationNote": "格挡后自动施加下盘不稳。移动手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡反制",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n\n// 施加下盘不稳\nconst eff = CONFIG.statusEffects.find(e => e.id === \"unstable\");\nif (eff && args.attacker) {\n    const data = foundry.utils.deepClone(eff);\n    data.duration = { rounds: 1 };\n    await game.xjzl.api.effects.addEffect(args.attacker, data);\n    ui.notifications.info(`${args.attacker.name} 下盘不稳`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "劈山断海",
                    "type": "counter",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作释放此招，伸手伏地，抬掌升拳，对目标造成 0.6 力量点外功伤害。如果你自身存在抖翎劲，还可消耗抖翎劲，将目标击飞 5 米并使其倒地。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "消耗抖翎劲击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗提示",
                            "trigger": "attack",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"doulingjin\");\nif (buff) {\n    const confirm = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"劈山断海\" },\n        content: `<p>是否消耗 [抖翎劲] 击飞目标？</p>`,\n        yes: { label: \"消耗\", icon: \"fas fa-check\" },\n        no: { label: \"不消耗\", icon: \"fas fa-times\" }\n    });\n    if (confirm) {\n        await buff.delete();\n        ui.notifications.info(\"已消耗抖翎劲，请手动击飞 5 米并击倒\");\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "披身冲炮",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，重猛快硬，抖拳冲击目标，造成 0.7 力量点外功伤害，然后你获得“抖翎劲”，持续到战斗脱离。</p><p>·如果你自身存在抖翎劲，还会冷拳摆刺，双拳寸击目标经络，使其流失 30 点内力。</p><p>如果目标与你间隔 1 米，招式伤害+20 点。</p><p><strong>升级：</strong>招式伤害+20，怒气-1，消耗+4。</p>",
                    "automationNote": "获得抖翎劲自动。消耗抖翎劲流失内力自动。距离增伤手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "抖翎劲逻辑",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    // 检查是否有劲\n    const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"doulingjin\");\n    \n    if (buff) {\n        // 有：流失内力\n        await args.target.applyHealing({ amount: -30, type: \"mp\" });\n        ui.notifications.info(`${args.target.name} 流失 30 点内力`);\n    } else {\n        // 无：获得\n        const eff = thisItem.effects.getName(\"抖翎劲\").toObject();\n        eff.origin = thisItem.uuid;\n        await game.xjzl.api.effects.addEffect(actor, eff);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "抖翎劲",
                    "icon": "icons/svg/wing.svg",
                    "description": "消耗以化解反应攻击，或增强招式。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "doulingjin",
                            "stackable": false
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "醉雪推梦手",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>藏原雪山之上传闻有位奇人，武功卓绝，在山峰之巅刻画一套武学于巨石之上，偶有路人经过，拓写下来，得以流传。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "醉里贪笑",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，回身行步间指肘破敌，被击中者往往筋断骨折，对目标造成 0.5 内息点内功伤害。若对方气血低于一半，则陷入错骨状态，持续一回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "低血施加错骨自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "低血错骨",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const hp = args.target.system.resources.hp.value;\n    const max = args.target.system.resources.hp.max;\n    if (hp < max / 2) {\n        const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\n        if (eff) {\n            const data = foundry.utils.deepClone(eff);\n            data.duration = { rounds: 1 };\n            await game.xjzl.api.effects.addEffect(args.target, data);\n            ui.notifications.info(`${args.target.name} 筋断骨折 (错骨)`);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "撕书破障",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破虚招时，可消耗反应动作使用此招，压制对方虚招，同时内劲入其体内，在全身肆虐游荡，对目标造成 0.6 内息点内功伤害，若击中无架招目标，目标失去内功特效一回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "失去内功特效无法自动化，请GM手动处理。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "傲寒凌雪",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，周身形成掌风，踏入者稍有不慎就会失去平衡。格挡成功后，给攻击者添加“下盘不稳”状态，持续一回合。</p><p><strong>升级：</strong>格挡值+10，持续回合数+1，内力消耗+2。</p>",
                    "automationNote": "格挡施加下盘不稳自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡反制",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n\n// 获取当前架招等级\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\nconst rounds = 1 + (lvl - 1);\nconst eff = CONFIG.statusEffects.find(e => e.id === \"unstable\");\nif (eff && args.attacker) {\n    const data = foundry.utils.deepClone(eff);\n    data.duration = { rounds: rounds };\n    await game.xjzl.api.effects.addEffect(args.attacker, data);\n    ui.notifications.info(`${args.attacker.name} 下盘不稳`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "岁月无痕",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，明亮双眼，看破时光虚妄，获得“醉梦”，持续三回合。</p><p><strong>醉梦：</strong>自身闪避提高【气感等级】*1 的数值。</p><p><strong>升级：</strong>提高系数+0.5，怒气-1，内力消耗+4。</p>",
                    "automationNote": "获得醉梦自动 (快照当前气感)。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "应用醉梦",
                            "trigger": "attack",
                            "script": "const qigan = Math.floor(actor.system.stats.qigan.total / 10);\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst ratio = 1 + (lvl - 1) * 0.5;\nconst bonus = Math.floor(qigan * ratio);\n\nconst eff = thisItem.effects.getName(\"醉梦\").toObject();\neff.origin = thisItem.uuid;\neff.changes[0].value = String(bonus);\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "醉梦",
                    "icon": "icons/magic/time/clock-stopwatch-white.webp",
                    "description": "基于气感提高闪避。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zuimeng",
                            "stackable": false
                        }
                    },
                    "duration": {
                        "rounds": 3
                    },
                    "changes": [
                        {
                            "key": "system.combat.dodge",
                            "mode": 2,
                            "value": "0"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "螳螂拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>模仿螳螂动作演变而来的传统拳法，长短兼备、勇猛快速，极具特色。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "螳螂展翅",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，展臂护体，开启架招。格挡成功后，进入“展翅”状态，持续一回合。</p><p><strong>展翅：</strong>自身处于半空中时，闪避+5。</p><p><strong>升级：</strong>格挡值+10，展翅持续回合数+1，消耗+2。</p>",
                    "automationNote": "格挡获展翅自动。空中闪避需手动确认条件。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获展翅",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n// 获取当前架招等级\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\nconst rounds = 1 + (lvl - 1);\n\nconst eff = thisItem.effects.getName(\"展翅\").toObject();\neff.origin = thisItem.uuid;\neff.duration = { rounds: rounds };\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "螳螂叩首",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，刁钻连击，对目标造成 0.4 力量点外功伤害。若目标倒地，可消耗反应动作释放此招，造成伤害并给目标添加“错骨”，持续一回合。</p><p>·若自身处在“展翅”状态，此招可凌空释放。</p><p><strong>螳螂叩首（空中）：</strong>距离5米。蓄力动作，昂首张臂，飞跃扑击至目标周围空格。对目标及其周围 1 米内敌人造成 0.4 力量点外功伤害，并将他们全部击倒，然后移除“展翅”。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "倒地错骨自动。空中变招及AOE手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "倒地错骨",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    // 检查目标是否有倒地状态\n    const isProne = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"prone\");\n    if (isProne) {\n        const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\n        if (eff) {\n            const data = foundry.utils.deepClone(eff);\n            data.duration = { rounds: 1 };\n            await game.xjzl.api.effects.addEffect(args.target, data);\n            ui.notifications.info(\"目标倒地追击：施加错骨\");\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "螳螂捕蝉",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，拳意突发而至，对目标造成 0.4 力量点外功伤害。击破架招时，自身进入“激怒”状态，持续一回合。</p><p><strong>激怒:</strong>回合初获得 1 怒气，《螳螂拳》套路招式伤害提高 10 点。</p><p><strong>升级：</strong>招式伤害+10，激怒持续回合+1，消耗+2。</p>",
                    "automationNote": "击破获激怒自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破获激怒",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const rounds = 1 + (lvl - 1);\n    const eff = thisItem.effects.getName(\"激怒\").toObject();\n    eff.origin = thisItem.uuid;\n    eff.duration = { rounds: rounds };\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "螳臂破车",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "蓄力动作",
                    "description": "<p>蓄力动作，弓身弹打，凝力一击，对目标造成 0.8 力量点外功伤害。</p><p>·若目标处于“错骨”状态，则错其筋骨，使他立即进行一次伤残检定，同时延长错骨持续时间，直到对方脱离战斗才会消失。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "错骨伤残检定需手动发起。延长错骨时间需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "错骨提示",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const isCuogu = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"cuogu\");\n    if (isCuogu) {\n        ui.notifications.warn(\"目标处于错骨状态：请令其进行伤残检定，并延长错骨时间至脱战。\");\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "展翅",
                    "icon": "icons/svg/wing.svg",
                    "description": "空中闪避增加。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zhanchi",
                            "stackable": false
                        }
                    },
                    "changes": []
                },
                {
                    "name": "激怒",
                    "icon": "icons/svg/explosion.svg",
                    "description": "回合初回怒，螳螂拳伤害增加。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jinu",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.regenRageTurnStart",
                            "mode": 2,
                            "value": "1"
                        },
                        {
                            "key": "system.combat.damages.global.mod",
                            "mode": 2,
                            "value": "10"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "降龙十巴掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>江湖上曾出现过一位姓洪的高人，以此功冒充丐帮绝学。但没多久就被戳穿，成了人人喊打的骗子。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "乌龙摆尾",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，姿势拉风，开启架招。格挡成功时，给目标添加“贱龙”，持续一回合。</p><p><strong>贱龙：</strong>命中-5，闪避-5。</p><p><strong>升级：</strong>格挡值+10，持续回合+1，内力消耗+2。</p>",
                    "automationNote": "格挡施加贱龙自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡施加贱龙",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n// 获取当前架招等级\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\nconst rounds = 1 + (lvl - 1);\nconst eff = thisItem.effects.getName(\"贱龙\").toObject();\neff.origin = thisItem.uuid;\neff.duration = { rounds: rounds };\nawait game.xjzl.api.effects.addEffect(args.attacker, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "群龙摆手",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，狂扇目标巴掌，对其造成 0.5 力量点外功伤害，若目标存在“贱龙”，使其“缚身”一回合。</p><p>·若有目标倒地，可消耗反应动作对目标释放。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "贱龙触发缚身自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "触发缚身",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const hasJianlong = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"jianlong\");\n    if (hasJianlong) {\n        const eff = CONFIG.statusEffects.find(e => e.id === \"fushen\");\n        if (eff) {\n            const data = foundry.utils.deepClone(eff);\n            data.duration = { rounds: 1 };\n            await game.xjzl.api.effects.addEffect(args.target, data);\n            ui.notifications.info(`${args.target.name} 被缚身`);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "潜龙无用",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，大力戳眼，对目标造成 0.4 力量点外功伤害。击破架招时，再将目标拍脸击飞 1 米，使其旋转一圈后脸部着地摔倒。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破后击飞倒地手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "飞龙栽地",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作，压制对方虚招，抡起巴掌对敌人造成 0.6 力量点外功伤害。</p><p>·目标存在“贱龙”时，可将其拍飞 3 米。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "贱龙触发击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "const hasJianlong = args.target.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"jianlong\");\nif (hasJianlong) {\n    ui.notifications.info(`目标有贱龙：请手动拍飞 3 米`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "坑龙有悔",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，脚踢目标膝盖，狂抽其脸，对其造成 0.7 力量点外功伤害，并将其抡倒在地。</p><p>·若目标存在“贱龙”，被此招攻击后，脸被抽肿，面目全非，持续一整天。同时最后一脚猛踢敌人裆部，将其踹飞 3 米，对方一周之内无法行房。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "倒地、击飞、RP效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": []
                }
            ],
            "effects": [
                {
                    "name": "贱龙",
                    "icon": "icons/svg/degen.svg",
                    "description": "命中闪避降低。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jianlong",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.hit_waigong",
                            "mode": 2,
                            "value": "-5"
                        },
                        {
                            "key": "system.combat.hit_neigong",
                            "mode": 2,
                            "value": "-5"
                        },
                        {
                            "key": "system.combat.dodge",
                            "mode": 2,
                            "value": "-5"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "心魔连环掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>诡异邪功，威力可怖，但修炼者不仅毒素腐蚀皮肤躯干，更是时常心神不定，命难长久。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "魔随心生",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，欲念横生，将目标向自身方向拉扯 3 米，并对其造成 0.5 力量点外功伤害。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "拉扯手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "迷踪魔掌",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，瞬间出掌，对目标造成 0.4 力量点外功伤害，击破架招给其添加“迷踪”，持续三回合。</p><p><strong>迷踪：</strong>受到‘魔气’的毒素伤害翻倍。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破施加迷踪自动。伤害翻倍逻辑手动（因魔气来源复杂）。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破迷踪",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"迷踪\").toObject();\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "邪魔纷飞",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，魔气环绕，开启架招。格挡成功时，若自身具有“魔临”状态或处于‘魔气’范围，则进入“魔影”状态，持续 1 回合。</p><p><strong>魔影：</strong>速度+2，免疫下盘不稳、击飞、击倒。</p><p><strong>升级：</strong>格挡值+10，持续回合+1，内力消耗+2。</p>",
                    "automationNote": "格挡检测魔临/魔气并获得魔影自动。免疫效果为文本说明，需手动操作。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获魔影",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n// 检测魔临\nconst hasMolin = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"molin\");\n// 检测魔气 (假设用 flag 标记，或者此处弹窗询问)\n// 简化处理：弹窗确认是否在魔气中\nlet inMoqi = false;\nif (!hasMolin) {\n    inMoqi = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"邪魔纷飞\" },\n        content: \"<p>当前是否处于 [魔气] 范围？</p>\",\n        yes: { label: \"是\" },\n        no: { label: \"否\" }\n    });\n}\n\nif (hasMolin || inMoqi) {\n    // 获取当前架招等级\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\n    const rounds = 1 + (lvl - 1);\n    const eff = thisItem.effects.getName(\"魔影\").toObject();\n    eff.origin = thisItem.uuid;\n    eff.duration = { rounds: rounds };\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "魔气纵横",
                    "type": "qi",
                    "actionType": "default",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "范围",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，内力腐蚀侵害周围，形成‘魔气’，持续到战斗脱离、再次施展本招式或施展其它套路。</p><p><strong>魔气：</strong>区域内敌人视作处于困难地形，且无法使用轻功，敌人的每回合初，他受到 20 点毒素伤害。</p><p>·魔气区域以你为中心跟随你移动，你只能拥有一个魔气，如果你形成新的魔气，之前的消失。</p><p><strong>升级：</strong>魔气区域范围+1，内力消耗+4。</p>",
                    "automationNote": "完全手动。请自行放置区域模板或标记。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "魔念横行",
                    "type": "qi",
                    "actionType": "default",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，心神坠入魔道，进入“魔临”两回合。</p><p><strong>魔临：</strong>你陷入走火入魔，期间受到的内外功伤害（扣除防御格挡后）只生效 50%，剩下的 50%累积起来，在魔临结束后爆发，对周围 3 米所有人（包括友方和自己）造成累积数值的毒素伤害。</p><p>·你受到爆发毒素伤害时减少 20 点。</p><p>·若魔临期间你被打入濒死，则立即爆发伤害。</p><p><strong>升级：</strong>受到爆发伤害再-20 点，怒气-1，消耗+4。</p>",
                    "automationNote": "伤害减免自动。伤害储存自动。爆发伤害请手动查看 Flag 并执行。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "魔临",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"魔临\").toObject();\neff.origin = thisItem.uuid;\n\n// 升级减伤计算\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst reduction = 20 + (lvl - 1) * 20;\neff.flags[\"xjzl-system\"].reduction = reduction;\n\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "迷踪",
                    "icon": "icons/svg/skull.svg",
                    "description": "受到魔气伤害翻倍。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "mizong",
                            "stackable": false
                        }
                    },
                    "duration": {
                        "rounds": 3
                    },
                    "changes": []
                },
                {
                    "name": "魔影",
                    "icon": "icons/svg/shadow.svg",
                    "description": "速度+2，免疫部分控制。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "moying",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.speed",
                            "mode": 2,
                            "value": "2"
                        }
                    ]
                },
                {
                    "name": "魔临",
                    "icon": "icons/svg/fire.svg",
                    "description": "伤害延迟结算。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "molin",
                            "stackable": false,
                            "storedDmg": 0,
                            "scripts": [
                                {
                                    "label": "储伤",
                                    "trigger": "preTake",
                                    "active": true,
                                    "script": "if (args.type === 'waigong' || args.type === 'neigong') {\n    const stored = Number(thisEffect.getFlag('xjzl-system', 'storedDmg')) || 0;\n    const absorbed = Math.floor(args.calcDamage * 0.5);\n    const newDamage = args.calcDamage - absorbed;\n    const newTotal = stored + absorbed;\n    \n    await thisEffect.setFlag('xjzl-system', 'storedDmg', newTotal);\n    args.output.damage = newDamage;\n    ChatMessage.create({\n        content: `<div class=\"xjzl-chat-card\"><div style=\"padding:5px; background:#333; color:#fff;\"><b>魔临触发</b><br>减免伤害: ${absorbed}<br>当前储存: ${newTotal}</div></div>`,\n        speaker: ChatMessage.getSpeaker({actor: actor})\n    });\n}"
                                }
                            ]
                        }
                    },
                    "duration": {
                        "rounds": 2
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "七伤诀",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>江湖拳掌口诀，伤人伤己，每次出招含有七股不同劲力，敌人抵挡不住便会深受内伤。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>注：</strong>若你内力上限不足 200，每次施展《七伤诀》招式前，先流失 50 点气血。</p>",
            "requirements": "徒手-拳掌",
            "scripts": [
                {
                    "label": "内力反噬",
                    "trigger": "attack",
                    "script": "if (actor.system.resources.mp.max < 200) {\n    await actor.applyHealing({amount: -50, type: \"hp\", showScrolling: true});\n    ui.notifications.warn(\"内力不足 200，七伤诀反噬！\");\n}",
                    "active": true
                }
            ],
            "moves": [
                {
                    "name": "失意恍惚",
                    "type": "stance",
                    "element": "none",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，神无定散，开启架招。格挡成功后，为目标添加一层“伤”，至多七层，持续到脱战。</p><p><strong>伤：</strong>叠至七层后全部移除并使目标陷入“封招”，持续一回合。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "格挡施加伤自动。七层爆发封招自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡施伤",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"伤\").toObject();\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(args.attacker, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "损心伤肺",
                    "type": "real",
                    "element": "none",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，双拳飘忽不定击出，对目标造成 0.7 力量点外功伤害。同时给目标添加一层“伤”，持续到战斗脱离。</p><p>·若招式造成暴击，额外添加一层“伤”。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "命中施伤自动。暴击额外施伤自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加伤",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = thisItem.effects.getName(\"伤\").toObject();\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n    if (args.isCrit) {\n        await game.xjzl.api.effects.addEffect(args.target, eff);\n        ui.notifications.info(\"暴击！额外施加一层伤\");\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "摧肝断肠",
                    "type": "counter",
                    "element": "none",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作释放此招，压制虚招，寸拳刚柔，对其造成 0.8 力量点外功伤害。同时给目标添加三层“伤”。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "命中施加3层伤自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加三层伤",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = thisItem.effects.getName(\"伤\").toObject();\n    eff.origin = thisItem.uuid;\n    for(let i=0; i<3; i++) {\n        await game.xjzl.api.effects.addEffect(args.target, eff);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "藏离精失",
                    "type": "feint",
                    "element": "none",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，势如雷霆，对目标造成 0.6 力量点外功伤害。命中无架招目标时，给其添加两层“伤”。</p><p><strong>升级：</strong>招式伤害+10，额外添加一层伤，消耗+2。</p>",
                    "automationNote": "命中无架招施加2层伤自动 (升级+1伤需手动添加)。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招施伤",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"伤\").toObject();\n    eff.origin = thisItem.uuid;\n    // 基础2层，升级暂不处理\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "七伤齐聚",
                    "type": "real",
                    "isUltimate": true,
                    "element": "none",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，大喝一声，左右双拳连续击出七拳，威猛无敌，对目标造成 1.0 力量点外功伤害。</p><p>·目标每存在一层“伤”便额外流失 10 点气血。</p><p><strong>升级：</strong>招式伤害+20，每层伤额外流失气血+5，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "根据伤层数流失气血自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 1.0
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "引爆伤",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const shang = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"qishang_shang\");\n    if (shang) {\n        const stacks = shang.getFlag(\"xjzl-system\", \"stacks\") || 1;\n        const lvl = Math.max(1, move.computedLevel || 1);\n        const damagePerStack = 10 + (lvl - 1) * 5;\n        const totalLoss = stacks * damagePerStack;\n        await args.target.applyHealing({ amount: -totalLoss, type: \"hp\", showScrolling: true });\n        ui.notifications.info(`七伤引爆：${stacks}层 x ${damagePerStack} = ${totalLoss} 气血流失`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "伤",
                    "icon": "icons/svg/blood.svg",
                    "description": "七伤劲力，叠满爆发。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "qishang_shang",
                            "stackable": true,
                            "maxStacks": 7,
                            "scripts": [
                                {
                                    "label": "七层封招",
                                    "trigger": "turnStart",
                                    "active": true,
                                    "script": "const stacks = thisEffect.getFlag('xjzl-system', 'stacks') || 1;\nif (stacks >= 7) {\n    const fengzhao = CONFIG.statusEffects.find(e => e.id === 'fengzhao');\n    if (fengzhao) {\n        const data = foundry.utils.deepClone(fengzhao);\n        data.duration = { rounds: 1 };\n        await game.xjzl.api.effects.addEffect(actor, data);\n        ui.notifications.info(`${actor.name} 七伤爆发：封招！`);\n        await thisEffect.delete();\n    }\n}"
                                }
                            ]
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "佛山无影脚",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>南方著名拳种，以快制敌，方寸不乱，踢出时声东击西，扰乱敌人，眼花缭乱，所以叫做无影脚。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "防不胜防",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，以拳做幌，暗腿侧踢，对目标造成 0.5 力量点外功伤害，同时获得一层“无影”，至多五层，持续到战斗脱离。</p><p><strong>无影：</strong>每层使你速度+1，闪避+1。</p><p>·若有敌人在半空中，可消耗反应动作施展此招，跃至半空回身侧踢，造成伤害并将其再击飞 3 米。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "获得无影自动。空中变招及击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得无影",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"无影\").toObject();\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "声东击西",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>主要动作，两脚连环，后发先至。对目标造成 0.4 力量点外功伤害。击破架招时，获得两层“无影”，并将目标击飞 1 米。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破获无影自动。击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破获无影",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"无影\").toObject();\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, eff);\n    await game.xjzl.api.effects.addEffect(actor, eff);\n    ui.notifications.info(\"击破架招：获得2层无影，请手动击飞1米\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "猝不及防",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>次要动作，提单腿，手后背。格挡成功时，获得一层“无影”，并可消耗反应动作，对 1 米内的攻击者施展【声东击西】。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "格挡获无影自动。反击声东击西手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获无影",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"无影\").toObject();\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "无影连环",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "蓄力动作",
                    "description": "<p>蓄力动作，蹬步跃起（处于半空中），连环飞踢目标胸膛，并造成 0.7 力量点外功伤害。</p><p>·招式释放过程中，你无法被击退、击倒、断招。</p><p>·招式释放过程中，可将目标不断往后击退（直到碰到障碍物或其他目标），最远 5 米。每击退 1 米，招式伤害+5，释放结束后你落地在目标周围空格处。</p><p>·自身每存在一层“无影”，可额外击退 1 米，若自身“无影”达到五层，释放招式时，迅如闪电，无法被敌方选中。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "连续击退加伤手动 (请使用手动伤害修正)。无法被选中效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": []
                }
            ],
            "effects": [
                {
                    "name": "无影",
                    "icon": "icons/svg/wing.svg",
                    "description": "速度和闪避增加。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuying",
                            "stackable": true,
                            "maxStacks": 5
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.speed",
                            "mode": 2,
                            "value": "1"
                        },
                        {
                            "key": "system.combat.dodge",
                            "mode": 2,
                            "value": "1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "化骨掌法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>一种极阴毒的功夫，看似飘柔无力，中者全身骨骼极软如绵，处处寸断，最后脏腑破裂，惨不堪言。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>柔</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "阴风刺骨",
                    "type": "real",
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>掌劲看似无力，飘然打出，对目标造成伤害。</p><p>·同时为其添加一层“绵骨”，持续到战斗脱离。</p><p><strong>绵骨：</strong>每层使气血上限降低 10 点（最低到 1）。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "施加绵骨自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加绵骨",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"绵骨\").toObject();\nawait game.xjzl.api.effects.addEffect(args.target, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "毒泷恶雾",
                    "type": "feint",
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>掌聚阴毒，拍击目标造成伤害。击破架招时，目标的某块肺腑被震碎，气血最大值-15。</p><p>·你每有一层“绵劲”，虚招对抗结果+1。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破减少上限(使用手动修正组)自动。绵劲加成自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "绵劲加成",
                            "trigger": "calc",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"mianjin\");\nif (buff) {\n    const stacks = buff.getFlag(\"xjzl-system\", \"stacks\") || 1;\n    args.output.feint += stacks;\n    args.output.bonusDesc.push(`绵劲加成: 虚招值 +${stacks}`);\n}",
                            "active": true
                        },
                        {
                            "label": "击破震碎肺腑",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const modifiers = foundry.utils.deepClone(args.target.system.customModifiers || []);\n    modifiers.push({\n        id: foundry.utils.randomID(),\n        name: '肺腑震碎',\n        enabled: true,\n        changes: [{key: 'resources.hp.max', value: -15}]\n    });\n    await args.target.update({'system.customModifiers': modifiers});\n    ui.notifications.info(`${args.target.name} 肺腑被震碎，气血上限永久-15！`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "赤手绵骨",
                    "type": "stance",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双掌绵软无比，开启架招。获得一层“绵劲”，至多叠加三层，持续到脱战。</p><p><strong>绵劲：</strong>每层使你的柔属性武学招式伤害+5</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "开启获绵劲自动。伤害加成自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得绵劲",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"绵劲\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "不毒不发",
                    "type": "counter",
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招的时候，消耗反应动作，压制对方虚招，掌影未现，印其胸口，对其造成伤害。同时为其添加三层“绵骨”，持续到战斗脱离。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "施加3层绵骨自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加三层绵骨",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"绵骨\").toObject();\nfor(let i=0; i<3; i++) {\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}\nui.notifications.info(`${args.target.name} 被施加 3 层绵骨！`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "积毁销骨",
                    "type": "real",
                    "isUltimate": true,
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>绵掌软骨，狠断拍击，对目标造成伤害。目标每有一层“绵骨”，额外受到 10 点毒素伤害。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "额外毒伤自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            5,
                            4,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "额外毒伤",
                            "trigger": "hit",
                            "script": "const debuff = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"miangu\");\nif (debuff) {\n    const stacks = debuff.getFlag(\"xjzl-system\", \"stacks\") || 1;\n    const extraDmg = stacks * 10;\n    await args.target.applyDamage({\n        amount: extraDmg,\n        type: \"poison\",\n        attacker: actor,\n        isHit: true,\n        ignoreDefense: false\n    });\n    ui.notifications.info(`积毁销骨触发：因 ${stacks} 层绵骨，额外造成 ${extraDmg} 毒素伤害`);\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "绵骨",
                    "icon": "icons/svg/bones.svg",
                    "description": "气血上限降低。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "miangu",
                            "stackable": true
                        }
                    },
                    "changes": [
                        {
                            "key": "system.resources.hp.bonus",
                            "mode": 2,
                            "value": "-10"
                        }
                    ]
                },
                {
                    "name": "绵劲",
                    "icon": "icons/magic/water/wave-water-blue.webp",
                    "description": "柔属性招式伤害增加。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "mianjin",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.rou.mod",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "洛神赋",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>“若轻云之蔽月，若流风之回雪”传闻神女受伤后所创，以泪水修炼的内家武学，阴冷至极，练到极致可冰封万里。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "凝泪成雪",
                    "type": "qi",
                    "actionType": "default",
                    "element": "yin",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>眼泪附着内力，获得“冰泪”，持续到战斗脱离。</p><p><strong>冰泪：</strong>出招造成伤害时为目标添加一层“回雪”，至多三层，持续到战斗脱离。</p><p><strong>回雪：</strong>叠加至三层时全部移除，流失 10 点气血，并陷入禁足一回合。</p><p><strong>升级：</strong>回雪三层时，流失的气血+10。</p>",
                    "automationNote": "获得冰泪自动。冰泪施加回雪及回雪爆发自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得冰泪",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"冰泪\").toObject();\n// 关键：显式写入来源，以便后续脚本能找到源物品\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "泪泉喷涌",
                    "type": "real",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>真气阴寒爆发，对目标造成伤害，若目标无架招，将其击飞 1 米。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "流水成冰",
                    "type": "real",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "多个",
                    "actionCost": "蓄力动作",
                    "description": "<p>内力如水，选择范围内至多 3 个目标，造成伤害。若某 2 个目标之间的距离为 1，对他们的招式伤害+20。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "距离判断增伤手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "scripts": [
                        {
                            "label": "增伤提示",
                            "trigger": "attack",
                            "script": "ui.notifications.info(\"若目标间距为1，请手动添加 +20 伤害修正\");",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "洛神之怒",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "10米",
                    "targetInfo": "区域",
                    "actionCost": "蓄力动作",
                    "description": "<p>寒月波涛，在目标及其周围 2 米范围内汇聚内力结成‘水牢’，持续三回合。</p><p><strong>水牢：</strong>在区域中开始回合或第一次进入水牢的敌人受到 50 点气血流失。（必中但不造成暴击）</p><p>·水牢区域视为困难地形。</p><p>·水牢形成在原地，不会跟随你移动，你只能拥有一个水牢，如果你形成新的水牢，之前的消失。</p><p><strong>升级：</strong>气血流失+50，持续回合数+1，怒气消耗-1，内力消耗+8。</p>",
                    "automationNote": "水牢区域效果及流失手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "创建水牢",
                            "trigger": "hit",
                            "script": "const lvl = Math.max(1, move.computedLevel || 1);\nconst dmg = 50 + (lvl - 1) * 50;\nconst rounds = 3 + (lvl - 1);\nui.notifications.info(`已生成 [水牢] (2米范围)。持续 ${rounds} 回合。\\n进入/回合开始流失 ${dmg} 气血。`);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "冰泪",
                    "icon": "icons/magic/water/drop-ice-freeze.webp",
                    "description": "出招造成伤害时施加回雪。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "binglei",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "施加回雪",
                                    "trigger": "hit",
                                    "active": true,
                                    "script": "// 仅攻击命中且造成伤害时触发\nif (args.type === 'attack' && args.isHit && args.finalDamage > 0) {\n    // 1. 获取源物品 (优先通过 UUID，回退到名称查找)\n    let sourceItem = await fromUuid(thisEffect.origin);\n    if (!sourceItem) sourceItem = actor.items.find(i => i.name === \"洛神赋\");\n    if (!sourceItem) return;\n    \n    // 2. 获取回雪模板\n    const huixue = sourceItem.effects.getName(\"回雪\");\n    if (!huixue) return;\n    \n    // 3. 检查目标现有层数\n    const targetEff = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"huixue\");\n    const currentStacks = targetEff ? (targetEff.getFlag(\"xjzl-system\", \"stacks\") || 1) : 0;\n    \n    if (currentStacks >= 2) {\n        // === 爆层逻辑 (3层) ===\n        if (targetEff) await targetEff.delete();\n        \n        // 计算流失量 (基础10 + 升级)\n        const moveData = sourceItem.system.moves.find(m => m.name === \"凝泪成雪\");\n        const lvl = Math.max(1, moveData?.computedLevel || 1);\n        const loss = 10 + (lvl - 1) * 10;\n        \n        // 应用流失伤害\n        await args.target.applyDamage({amount: loss, type: \"liushi\", attacker: actor, isHit: true});\n        \n        // 禁足1回合\n        const root = CONFIG.statusEffects.find(e => e.id === \"root\");\n        if (root) {\n            const rootData = foundry.utils.deepClone(root);\n            rootData.duration = {rounds: 1};\n            await game.xjzl.api.effects.addEffect(args.target, rootData);\n        }\n        ui.notifications.info(`${args.target.name} 回雪爆发！流失 ${loss} 气血并禁足。`);\n    } else {\n        // === 正常叠加 ===\n        const effData = huixue.toObject();\n        delete effData._id;\n        effData.origin = sourceItem.uuid; // 传递源头 UUID\n        await game.xjzl.api.effects.addEffect(args.target, effData);\n    }\n}"
                                }
                            ]
                        }
                    },
                    "changes": []
                },
                {
                    "name": "回雪",
                    "icon": "icons/magic/water/snowflake-ice-blue.webp",
                    "description": "叠满三层爆发。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "huixue",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "惊涛骇浪掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>郭氏家传武功，威力刚猛，瞬间调动全身的阳气，也可积蓄气力，爆发掌力。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "排山倒海",
                    "type": "real",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "蓄力动作",
                    "description": "<p>双掌调动全身气劲，齐掌拍出，造成伤害，若击中无架招敌人，使自己获得 1 层“惊涛”，持续一回合。</p><p>·你可以在本回合持续蓄力而不攻击，下回合继续消耗蓄力动作再释放（无需再消耗怒气内力）若如此，则每蓄力 1 回合，造成伤害+50，最多+150。</p><p><strong>升级：</strong>招式伤害+10，惊涛持续回合+1，消耗+2。</p>",
                    "automationNote": "无架招获惊涛自动。蓄力增伤手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            1,
                            1,
                            1
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获惊涛",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"惊涛\").toObject();\n    const lvl = Math.max(1, move.computedLevel || 1);\n    eff.duration = { rounds: 1 + (lvl - 1) };\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "大浪淘沙",
                    "type": "feint",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "蓄力动作",
                    "description": "<p>双手混元，仿佛巨浪，排击而出，造成伤害。击破架招时击飞目标 3 米。</p><p>·若有敌人处于半空中，你可以消耗反应动作和 1 层“惊涛”释放此招，飞身攻击目标。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破击飞手动。半空释放逻辑手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破提示",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    ui.notifications.info(`${args.target.name} 被击飞 3 米`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "暗流涌动",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>内力游走全身，感知气劲流动，开启架招。格挡成功时，获得“骇浪”，持续 1 回合。</p><p><strong>升级：</strong>格挡值+10，骇浪持续回合+1，消耗+2。</p>",
                    "automationNote": "格挡获骇浪自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获骇浪",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"骇浪\").toObject();\n// 获取当前架招等级\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\neff.duration = { rounds: 1 + (lvl - 1) };\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "翻江倒海",
                    "type": "counter",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>看破虚招时，消耗反应动作释放，压制对手虚招，内力倒卷，将对手拉扯至身边空格击倒，造成伤害。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "拉扯击倒手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "惊涛骇浪",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "周围",
                    "actionCost": "蓄力动作",
                    "description": "<p>内力如江河汹涌，掀起滔天巨浪，对周围敌人造成伤害且击飞 1 米。</p><p>·你可以选择消耗“惊涛”和“骇浪”使释放距离+4，且给敌人添加“震伤”，持续两回合。</p><p><strong>震伤：</strong>每次被攻击都会流失 10 点气血，若在此期间出招三次后，还会被添加“内伤”两回合。</p><p><strong>内伤：</strong>陷入“禁实”“禁虚”“禁足”。</p><p><strong>升级：</strong>招式伤害+20，怒气-1，内力消耗+8。</p>",
                    "automationNote": "击飞手动。消耗惊涛骇浪及效果均为手动。震伤后续效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "震伤施加提示",
                            "trigger": "hit",
                            "script": "ui.notifications.info(\"如已手动消耗[惊涛][骇浪]，请手动施加[震伤]BUFF。\");",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "惊涛",
                    "icon": "icons/magic/water/wave-water-blue.webp",
                    "description": "惊涛骇浪掌特效标记。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jingtao",
                            "stackable": true
                        }
                    },
                    "changes": []
                },
                {
                    "name": "骇浪",
                    "icon": "icons/magic/water/wave-water-teal.webp",
                    "description": "惊涛骇浪掌特效标记。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "hailang",
                            "stackable": true
                        }
                    },
                    "changes": []
                },
                {
                    "name": "震伤",
                    "icon": "icons/svg/ruins.svg",
                    "description": "每次被攻击流失气血。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zhenshang",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "受击流失",
                                    "trigger": "damaged",
                                    "active": true,
                                    "script": "await actor.applyDamage({amount: 10, type: \"liushi\", attacker: args.attacker, isHit: true});"
                                }
                            ]
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "火树银花不夜天",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>雷家几代人呕心沥血创造，以秘传火灼之术，发挥火药之威，但因修炼时伤亡过大，已被禁止修炼。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "凭地一声雷",
                    "type": "real",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "周围",
                    "actionCost": "蓄力动作",
                    "description": "<p>横旋甩臂，烈火昭昭，对周围敌方造成伤害。</p><p>·若武器具有“火灼”，可选择移除至多一层，使招式暴击骰-2。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "需手动给角色添加“火灼”BUFF。消耗及暴击修正自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗火灼",
                            "trigger": "attack",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"huozhuo\");\nif (buff) {\n    const confirm = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"凭地一声雷\" },\n        content: \"<p>消耗 1 层 [火灼] 使暴击骰 -2？</p>\",\n        yes: { label: \"消耗\", icon: \"fas fa-fire\" },\n        no: { label: \"不消耗\", icon: \"fas fa-times\" }\n    });\n    if (confirm) {\n        await game.xjzl.api.effects.removeEffect(actor, \"huozhuo\", 1);\n        args.flags.critThresholdMod = (args.flags.critThresholdMod || 0) + 2; \n        ui.notifications.info(\"消耗火灼，暴击率提升！\");\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "风火雷烟炮",
                    "type": "feint",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>振臂一推，焰贯长空，对敌人造成伤害。击破架招时，若武器具有“火灼”，则释放熏烟，使目标及其周围 2 米范围内的所有敌人陷入“目盲”一回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破检测火灼并施加目盲自动。AOE目盲需手动处理其他目标。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破目盲",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const hasBuff = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"huozhuo\");\n    if (hasBuff) {\n        const blind = CONFIG.statusEffects.find(e => e.id === \"blind\");\n        if (blind) {\n            const data = foundry.utils.deepClone(blind);\n            data.duration = { rounds: 1 };\n            await game.xjzl.api.effects.addEffect(args.target, data);\n            ui.notifications.info(`${args.target.name} 被致盲！(周围目标请手动处理)`);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "霹雳如弦惊",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>引火不发，以静制动，开启架招，并进入“惊炎”状态，持续一回合。</p><p><strong>惊炎：</strong>当你被选为攻击目标时，可爆发出巨响惊敌，使周围两米的所有敌人陷入“耳鸣”一回合。</p><p><strong>升级：</strong>格挡值+10，惊炎持续回合+1，内力消耗+2。</p>",
                    "automationNote": "开启获惊炎自动。惊炎触发手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获惊炎",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"惊炎\").toObject();\nconst lvl = Math.max(1, move.computedLevel || 1);\neff.duration = { rounds: 1 + (lvl - 1) };\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "天火流星坠",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "周围",
                    "actionCost": "蓄力动作",
                    "description": "<p>飞天炸散，武器引爆，碎如火雨，对周围范围内所有敌人造成伤害。</p><p>·若武器具有三层“火灼”，可以全部移除，使招式伤害类型改为火焰伤害。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，消耗+8。</p>",
                    "automationNote": "询问消耗。若消耗则转为火焰伤害。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "转火焰伤害",
                            "trigger": "preDamage",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"huozhuo\");\nconst stacks = buff ? (buff.getFlag(\"xjzl-system\", \"stacks\") || 1) : 0;\n\nif (stacks >= 3) {\n    if (args.isManual) { return; }\n    \n    const confirm = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"天火流星坠\" },\n        content: \"<p>消耗 3 层 [火灼] 将伤害转为 <b>火焰</b> 类型？</p>\",\n        yes: { label: \"消耗\", icon: \"fas fa-fire\" },\n        no: { label: \"不消耗\", icon: \"fas fa-times\" }\n    });\n    \n    if (confirm) {\n        await game.xjzl.api.effects.removeEffect(actor, \"huozhuo\", 3);\n        args.config.type = \"fire\";\n        ui.notifications.info(\"伤害已转化为火焰！\");\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "惊炎",
                    "icon": "icons/svg/sound.svg",
                    "description": "被选为目标时可爆发响声致盲。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jingyan",
                            "stackable": false
                        }
                    },
                    "changes": []
                },
                {
                    "name": "火灼",
                    "icon": "icons/svg/fire.svg",
                    "description": "火树银花不夜天特效标记，手动添加。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "huozhuo",
                            "stackable": true,
                            "maxStacks": 5
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "空明掌法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>掌法空旷澄澈，需内心清明无垢方能发挥最大力量，若敌人心机过重，必陷囫囵。</p><p>注：该武学悟性大于等于 15 后无法领悟，施展此武学时，你无法开启架招，若有，则立即解除。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>柔</p>",
            "requirements": "徒手-拳掌",
            "automationNote": "施展时自动解除架招。",
            "scripts": [
                {
                    "label": "自动解除架招",
                    "trigger": "attack",
                    "script": "if (actor.system.martial.stanceActive) {\n    await actor.stopStance();\n    ui.notifications.warn(\"空明掌法特性触发：架招已自动解除。\");\n}",
                    "active": true
                }
            ],
            "moves": [
                {
                    "name": "探虚掏空",
                    "type": "feint",
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>一掌绵绵递出，劲道空虚，看似不能穿纸，造成伤害。</p><p>若目标上回合受到过虚招攻击，则本招虚招值+1。</p><p><strong>升级：</strong>招式伤害+10，虚招值再+1，内力消耗+2。</p>",
                    "automationNote": "上回合状态判断手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "升级虚招值加成",
                            "trigger": "calc",
                            "script": "const lvl = Math.max(1, move.computedLevel || 1);\nif (lvl > 1) {\n    const bonus = lvl - 1;\n    args.output.feint += bonus;\n    args.output.bonusDesc.push(`升级虚招加值 +${bonus}`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "两手皆空",
                    "type": "qi",
                    "actionType": "default",
                    "element": "rou",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>左手空，右手空，获得“明”状态，持续到脱战，并移除“空”状态。</p><p><strong>明：</strong>他人观察你时，认为你处于开启架招的状态（实际上你无架招），你受到虚招以外的内外功伤害-10，开启架招后此状态消散。</p><p>·敌方对你施展虚招时，无需进行虚招对抗（因为你处于无架招），直接结算伤害，你移除“明”状态，获得“空”状态，持续到战斗脱离，同时敌方陷入“不明”，持续到战斗脱离。</p><p><strong>升级：</strong>伤害额外减免提高 10 点，内力消耗+2。</p>",
                    "automationNote": "获明去空自动。明减伤自动。明被虚招互换状态需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "状态切换",
                            "trigger": "hit",
                            "script": "await game.xjzl.api.effects.removeEffect(actor, \"kong\");\nconst eff = thisItem.effects.getName(\"明\").toObject();\nconst lvl = Math.max(1, move.computedLevel || 1);\n// 基础减伤10 + 升级(Lv-1)*10\nconst reduction = 10 + (lvl - 1) * 10;\neff.changes[0].value = `-${reduction}`;\neff.changes[1].value = `-${reduction}`;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "空无一人",
                    "type": "qi",
                    "actionType": "default",
                    "element": "rou",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双手后背，中门大开，身体柔韧，获得“空”状态，持续到脱战，并移除“明”状态。</p><p><strong>空：</strong>受到招式攻击时，自身流失 40 点气血，但若对方招式会给你添加状态，将该状态转移给对方。</p><p>·你只能转移人级、地级的状态，转移后，“空”结束，获得“明”，持续到战斗脱离，同时敌方陷入“不空”，持续到战斗脱离。</p><p><strong>升级：</strong>流失的气血减少 10 点，内力消耗+2。</p>",
                    "automationNote": "获空去明自动。空受击流失自动。状态转移及后续切换手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "状态切换",
                            "trigger": "hit",
                            "script": "await game.xjzl.api.effects.removeEffect(actor, \"ming\");\nconst eff = thisItem.effects.getName(\"空\").toObject();\n// 写入升级后的流失值到 Flag，供 damaged 脚本使用\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst loss = Math.max(0, 40 - (lvl - 1) * 10);\neff.flags[\"xjzl-system\"].lossAmount = loss;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "司空见惯",
                    "type": "real",
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你受到以反应动作释放的招式攻击时，可消耗反应动作与目标进行一次[武学内功]的对抗，若胜利，则压制对方招式，双掌虚握，柔中带韧对目标造成伤害。</p><p>·若对方存在“不空”或“不明”，对抗检定+1。</p><p>·若对方同时存在“不空”和“不明”，你获胜时，对方彻底迷茫，陷入“封招”，持续一回合。</p><p><strong>升级：</strong>招式伤害+10，对抗检定+1，内力消耗+2。</p>",
                    "automationNote": "对抗手动。检定加值及封招需人工判断。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            1,
                            1,
                            1
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "空空如也",
                    "type": "real",
                    "isUltimate": true,
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>若有若无，似实似虚。不明不白地击出一掌，造成伤害。</p><p>·若对方身上同时有“不空”和“不明”，则懵懵懂懂迷迷糊糊，陷入“一忘皆空”，持续到脱战。</p><p><strong>一忘皆空：</strong>不可再施展当前使用的武学套路。</p><p>·若你受到绝招攻击，可消耗反应动作释放此招，与目标进行一次[武学内功]的对抗，若胜利，则压制对方绝招，并造成伤害和效果，失败则此招释放失败（消耗对应的怒气和内力）。</p><p>·若对方同时存在“不空”和“不明”，招式对抗检定+1。</p><p><strong>升级：</strong>招式伤害+20，对抗检定+1，怒气-1，内力消耗+4。</p>",
                    "automationNote": "特殊状态判定及施加手动。对抗流程手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": []
                }
            ],
            "effects": [
                {
                    "name": "明",
                    "icon": "icons/magic/light/beam-rays-yellow-orange.webp",
                    "description": "受到虚招以外伤害减少。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "ming",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.def_waigong",
                            "mode": 2,
                            "value": "10"
                        },
                        {
                            "key": "system.combat.def_neigong",
                            "mode": 2,
                            "value": "10"
                        }
                    ]
                },
                {
                    "name": "空",
                    "icon": "icons/magic/air/wind-tornado-wall-blue.webp",
                    "description": "受击流失气血，可转移状态。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "kong",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "受击流失",
                                    "trigger": "damaged",
                                    "active": true,
                                    "script": "const loss = Number(thisEffect.getFlag('xjzl-system', 'lossAmount')) || 40;\nawait actor.applyDamage({amount: loss, type: 'liushi', attacker: args.attacker, isHit: true});\nui.notifications.info(`${actor.name} 触发[空]：流失 ${loss} 气血。若有状态可转移，请手动操作。`);"
                                }
                            ]
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "焚天神掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>以纯阳内力驱动，中掌者伤口皲裂脱落，如同烧伤。修炼此功法需要在日照充足之地，于烈阳之下挥汗如雨，故而江南久雨之地很难修习。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "焦金流石",
                    "type": "real",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>将内力流转于手腕，双掌抓向目标肢体，对目标造成伤害，使目标身体灼伤，陷入“错骨”，持续一回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "施加错骨自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加错骨",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 1 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "烈日炎炎",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>内力运转，流转全身，体表隐隐泛红，仿佛火人，开启架招，持续期间：</p><p>格挡拳脚攻击后，令攻击者流失 4 点气血。</p><p>格挡金属武器攻击时，额外减免 4 点伤害。</p><p><strong>升级：</strong>格挡值+10，流失+3，减免+3，消耗+2。</p>",
                    "automationNote": "反伤/减伤自动(基于武器类型判断)。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡特效",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n\n// 获取等级成长\nconst stanceId = actor.system.martial.stance;\nconst moveData = thisItem.system.moves.find(m => m.id === stanceId);\nconst lvl = Math.max(1, moveData?.computedLevel || 1);\n\n// 检查攻击者武器类型\nconst wType = args.item?.system?.type || \"unarmed\";\n\nif (wType === \"unarmed\") {\n    // 拳脚: 流失 4 + (Lv-1)*3\n    const dmg = 4 + (lvl - 1) * 3;\n    await args.attacker.applyDamage({amount: dmg, type: \"liushi\", attacker: actor, isHit: true});\n    ui.notifications.info(`${args.attacker.name} 触碰烈日，流失 ${dmg} 气血`);\n} else {\n    // 金属武器(非unarmed视为金属): 暂无法直接减免\"本次\"已造成的伤害，\n    // 只能通过 preTake 实现减伤。但架招是在 damaged 触发的。\n    // 修正：将减伤逻辑移至 preTake。\n}",
                            "active": true
                        },
                        {
                            "label": "格挡减伤",
                            "trigger": "preTake",
                            "script": "// 仅处理架招减伤逻辑\nif (!actor.system.martial.stanceActive) return;\n// 检查是否被无视\nif (args.config.ignoreStance) return;\n\nconst wType = args.item?.system?.type || \"unarmed\";\nif (wType !== \"unarmed\") {\n    // 假设非徒手均为金属武器\n    const stanceId = actor.system.martial.stance;\n    const moveData = thisItem.system.moves.find(m => m.id === stanceId);\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\n    const reduc = 4 + (lvl - 1) * 3;\n    \n    args.output.damage = Math.max(0, args.output.damage - reduc);\n    ui.notifications.info(`烈日炎炎减免 ${reduc} 点伤害`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "海天云蒸",
                    "type": "counter",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招，压制对方虚招，一跃而起（半空中），双掌相抵，宛若莲花吐火，对目标造成伤害，并为其添加一层“乏力”，持续到脱战。</p><p><strong>乏力：</strong>每层使招式伤害-10。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "施加乏力自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加乏力",
                            "trigger": "hit",
                            "script": "const eff = CONFIG.statusEffects.find(e => e.id === \"fali\");\nif (eff) {\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "火云如烧",
                    "type": "feint",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>掌如烈火，对目标造成伤害，击破架招时，使对手获得一层“乏力”，持续到脱战。</p><p><strong>乏力：</strong>每层使招式伤害-10。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破施加乏力自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破乏力",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"fali\");\n    if (eff) {\n        await game.xjzl.api.effects.addEffect(args.target, eff);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "大日焚天",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当自己虚招被对方反击压制时，可消耗反应动作释放，压制目标反击。双臂毛孔瞬间迸发热浪，使虚招正常造成伤害，招式伤害+50，使其浑身烧伤皮肤开裂，陷入“焚身”持续到脱战。</p><p><strong>焚身：</strong>你无法施展架招。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "增伤自动(反应反击逻辑需手动触发本招)。施加焚身自动。",
                    "calculation": {
                        "base": 50,
                        "growth": 20
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加焚身",
                            "trigger": "hit",
                            "script": "const data = {\n    name: \"焚身\",\n    icon: \"icons/svg/fire.svg\",\n    description: \"你无法施展架招。\",\n    changes: [{key: \"flags.xjzl-system.blockStance\", mode: 5, value: \"true\"}],\n    flags: {\"xjzl-system\": {slug: \"fenshen\", stackable: false}}\n};\nawait game.xjzl.api.effects.addEffect(args.target, data);\nui.notifications.info(`${args.target.name} 陷入焚身，无法开启架招！`);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": []
        }
    },
    {
        "name": "绝户爪法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>模仿虎爪变化而来的擒拿手法，招招拿人腰眼，能使敌人损阴绝嗣。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "隐虎藏爪",
                    "type": "feint",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>两手成虎爪后藏于腰，身直而眼向前望，突然出爪，造成伤害，给敌人添加一层“绝户”，持续到战斗脱离。</p><p>·击破架招后获得“恶虎”，持续到战斗脱离。</p><p><strong>恶虎：</strong>《绝户爪法》暴击骰-2。</p><p><strong>绝户：</strong>累计绝户层数大于等于五后，移除所有绝户，对其造成肾精损伤，失去生育能力，需花费 500 两，疗养三年方能治好。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "施加绝户及层数检测自动。击破获恶虎自动。恶虎暴击修正需配合calc/attack脚本实现。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加绝户",
                            "trigger": "hit",
                            "script": "// 添加绝户并检测\nconst eff = thisItem.effects.getName(\"绝户\").toObject();\nawait game.xjzl.api.effects.addEffect(args.target, eff);\n\n// 检测层数\nsetTimeout(() => {\n    const targetEff = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"juehu\");\n    if (targetEff && (targetEff.getFlag(\"xjzl-system\", \"stacks\") || 1) >= 5) {\n        targetEff.delete();\n        const msg = `<div class=\"xjzl-chat-card\"><div style=\"color:red;font-weight:bold;\">断子绝孙！</div><p>${args.target.name} 绝户叠满 5 层！</p><p>失去生育能力，需花费 500 两疗养三年。</p></div>`;\n        ChatMessage.create({content: msg, speaker: ChatMessage.getSpeaker({actor: args.target})});\n        // 标记永久损伤Flag\n        args.target.setFlag(\"xjzl-system\", \"wuxue_juehu_sterilized\", true);\n    }\n}, 200);\n\n// 击破获恶虎\nif (args.isBroken) {\n    const ehu = thisItem.effects.getName(\"恶虎\").toObject();\n    ehu.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, ehu);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "侧虎破肋",
                    "type": "real",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>侧身出爪，左高右低两爪连环，直攻两肋，造成伤害。命中无架招的敌人时，为其添加一层“绝户”，持续到战斗脱离。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "无架招施加绝户自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加绝户",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"绝户\").toObject();\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n    \n    // 同样的层数检测逻辑，此处略去重复代码，建议封装\n    setTimeout(() => {\n        const targetEff = args.target.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"juehu\");\n        if (targetEff && (targetEff.getFlag(\"xjzl-system\", \"stacks\") || 1) >= 5) {\n            targetEff.delete();\n            const msg = `<div class=\"xjzl-chat-card\"><div style=\"color:red;font-weight:bold;\">断子绝孙！</div><p>${args.target.name} 绝户叠满 5 层！</p></div>`;\n            ChatMessage.create({content: msg, speaker: ChatMessage.getSpeaker({actor: args.target})});\n            args.target.setFlag(\"xjzl-system\", \"wuxue_juehu_sterilized\", true);\n        }\n    }, 200);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "猛虎回头",
                    "type": "counter",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>识破虚招后消耗反应动作，扭身回首，双手虎爪从上往下划，对敌人造成伤害。同时为其添加一层“绝户”，持续到战斗脱离。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "施加绝户自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加绝户",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"绝户\").toObject();\nawait game.xjzl.api.effects.addEffect(args.target, eff);\n// 层数检测略",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "猛虎下山",
                    "type": "stance",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>下桩需稳，如猛虎下山，气势凶狠，头昂而目视高，开启架招。格挡成功时，击倒目标，若其已经存在“绝户”，给他再添加一层。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "格挡击倒手动。格挡添加绝户自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡特效",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nui.notifications.info(\"格挡成功！请手动击倒目标。\");\n\nconst hasJuehu = args.attacker.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"juehu\");\nif (hasJuehu) {\n    const eff = thisItem.effects.getName(\"绝户\").toObject();\n    await game.xjzl.api.effects.addEffect(args.attacker, eff);\n    ui.notifications.info(`${args.attacker.name} 已有绝户，层数+1`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "虎跃千山",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>纵身猛扑，俩爪搂腰，双臂不动，指尖发力，造成伤害。</p><p>·若目标已经失去生育能力，为其添加“禁绝”，持续三回合。</p><p><strong>禁绝：</strong>无法施展绝招。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "检测永久损伤并施加禁绝自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加禁绝",
                            "trigger": "hit",
                            "script": "const isSterilized = args.target.getFlag(\"xjzl-system\", \"wuxue_juehu_sterilized\");\nif (isSterilized) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"jinjue\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 3 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} (已绝户) 被禁绝 3 回合！`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "绝户",
                    "icon": "icons/svg/skull.svg",
                    "description": "叠满5层造成永久损伤。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "juehu",
                            "stackable": true
                        }
                    },
                    "changes": []
                },
                {
                    "name": "恶虎",
                    "icon": "icons/creatures/mammals/cat-tiger-snarl-orange.webp",
                    "description": "绝户爪法暴击修正。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "ehu",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "暴击修正",
                                    "trigger": "attack",
                                    "active": true,
                                    "script": "// 仅对绝户爪法生效\nif (item.name === \"绝户爪法\") {\n    args.flags.critThresholdMod += 2; // 骰子-2等于阈值+2\n}"
                                }
                            ]
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "太阴掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>江湖绝技，冰寒无比，中者浑身结冰冻僵，气血败坏凝死。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "冰封枯城",
                    "type": "real",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双掌齐出，造成伤害，击中无架招目标使其寒气入体，进入“冰冻”状态，持续一回合。</p><p><strong>冰冻：</strong>每次流失气血时额外流失 10 点。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "无架招施加冰冻自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加冰冻",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"冰冻\").toObject();\n    eff.duration = { rounds: 1 };\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "寒冬腊月",
                    "type": "feint",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>冰冷一掌，寒气四溢，造成伤害，击破架招使目标寒气入体，为其添加“冰冻”状态，持续三回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破施加冰冻自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破冰冻",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"冰冻\").toObject();\n    eff.duration = { rounds: 3 };\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "天寒地冻",
                    "type": "stance",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>寒气凝集皮肤，开启架招。格挡成功后，攻击者因寒气流失 5 点气血。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "格挡反伤自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡反伤",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nawait args.attacker.applyDamage({amount: 5, type: \"liushi\", attacker: actor, isHit: true});\nui.notifications.info(`${args.attacker.name} 触碰寒气，流失 5 气血`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "六月飞雪",
                    "type": "counter",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>看破虚招消耗反应释放，连拍数掌，寒气如刀，轰击至目标身躯，造成伤害，为其添加“冰冻”状态，持续两回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "施加冰冻自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加冰冻",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"冰冻\").toObject();\neff.duration = { rounds: 2 };\nawait game.xjzl.api.effects.addEffect(args.target, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "冰魄镇狱",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>寒气入掌，打入目标体内，造成伤害，并添加“寒气肆虐”10 回合。</p><p><strong>寒气肆虐：</strong>你每回合开始时流失 4 点气血。</p><p><strong>升级：</strong>招式伤害+20，流失气血+3，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "施加寒气肆虐自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "寒气肆虐",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"寒气肆虐\").toObject();\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst dmg = 4 + (lvl - 1) * 3;\neff.changes[0].value = `-${dmg}`;\nawait game.xjzl.api.effects.addEffect(args.target, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "冰冻",
                    "icon": "icons/magic/water/ice-snowflake-blue.webp",
                    "description": "流失气血时额外流失。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "bingdong",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.bleedOnHit",
                            "mode": 2,
                            "value": "10"
                        }
                    ]
                },
                {
                    "name": "寒气肆虐",
                    "icon": "icons/magic/water/ice-shards-blue.webp",
                    "description": "回合开始流失气血。",
                    "transfer": false,
                    "duration": {
                        "rounds": 10
                    },
                    "flags": {
                        "xjzl-system": {
                            "slug": "hanqisinue",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.regenHpTurnStart",
                            "mode": 2,
                            "value": "-4"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "雪驼山掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>西域掌法，飘忽无定，施掌毒辣。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "乌云盖雪",
                    "type": "stance",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>身影飘忽，开启架招。被击破架招时，进入“飞鸿踏雪”状态，持续到敌人该回合结束。</p><p><strong>飞鸿踏雪：</strong>自身免疫所有你不想要的状态。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "击破提示飞鸿踏雪。免疫效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "被击破提示",
                            "trigger": "damaged",
                            "script": "if (args.isBroken) {\n    ui.notifications.info(`${actor.name} 架招被破，进入 [飞鸿踏雪] 状态！(本回合免疫状态，请手动处理)`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "白骨皑皑",
                    "type": "qi",
                    "actionType": "default",
                    "element": "yin",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "反应动作",
                    "description": "<p>运气凝势，飘忽身影折出一道虚影，额外获得 4 点闪避，持续到敌人该回合结束。</p><p><strong>升级：</strong>额外闪避+3，内力消耗+2。</p>",
                    "automationNote": "获得闪避自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得闪避",
                            "trigger": "hit",
                            "script": "const lvl = Math.max(1, move.computedLevel || 1);\nconst dodge = 4 + (lvl - 1) * 3;\n\nconst data = {\n    name: \"白骨皑皑\",\n    icon: \"icons/magic/air/wind-stream-purple.webp\",\n    description: \"额外获得闪避。\",\n    changes: [{key: \"system.combat.dodge\", mode: 2, value: String(dodge)}],\n    flags: {\"xjzl-system\": {slug: \"baigu\", stackable: false}}\n};\n// 持续到回合结束(1轮)\ndata.duration = { rounds: 1 };\nawait game.xjzl.api.effects.addEffect(actor, data);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "骆驼踏谷",
                    "type": "real",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双掌拍击，攻势连绵不绝，对目标造成伤害，击中无架招角色，可以消耗次要动作，再次对目标施展一次【骆驼踏谷】。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "连击提示手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "连击提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(\"击中无架招目标，可消耗次要动作再次施展！\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "神驼夺命",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>单掌破空，直击胸膛，对目标造成伤害，并使目标陷入“震伤”，持续两回合。</p><p><strong>震伤：</strong>每次被攻击都会流失 10 点气血，若在此期间出招三次后，还会被添加“内伤”两回合。</p><p><strong>内伤：</strong>陷入“禁实”“禁虚”“禁足”。</p><p>若击中无架招目标，则额外使目标陷入“血流不止”状态，持续两回合。</p><p>·<strong>血流不止：</strong>在此期间内力归零，你的死亡检定必定为 1</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+4。</p>",
                    "automationNote": "震伤施加自动。震伤后续效果手动。无架招施加血流不止(清空内力)自动。死检必定1手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加状态",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    // 震伤\n    const zhenshang = thisItem.effects.getName(\"震伤\").toObject();\n    zhenshang.duration = { rounds: 2 };\n    await game.xjzl.api.effects.addEffect(args.target, zhenshang);\n    \n    // 血流不止\n    if (!args.target.system.martial.stanceActive) {\n        // 1. 清空内力\n        await args.target.update({\"system.resources.mp.value\": 0});\n        \n        // 2. 施加持续清空效果 (防止回复)\n        const xueliu = thisItem.effects.getName(\"血流不止\").toObject();\n        xueliu.duration = { rounds: 2 };\n        await game.xjzl.api.effects.addEffect(args.target, xueliu);\n        ui.notifications.info(`${args.target.name} 血流不止：内力归零！`);\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "震伤",
                    "icon": "icons/svg/ruins.svg",
                    "description": "受击流失气血。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zhenshang",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "受击流失",
                                    "trigger": "damaged",
                                    "active": true,
                                    "script": "await actor.applyDamage({amount: 10, type: \"liushi\", attacker: args.attacker, isHit: true});"
                                }
                            ]
                        }
                    },
                    "changes": []
                },
                {
                    "name": "血流不止",
                    "icon": "icons/svg/blood.svg",
                    "description": "内力清空，死检必败。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "xueliu",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.noRecoverNeili",
                            "mode": 5,
                            "value": "true"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "圣世龙拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>乃是唐朝皇帝所创，非身具龙气者不能修炼。</p><p><strong>需求：</strong>徒手，天子血脉</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手；天子血脉",
            "moves": [
                {
                    "name": "梨园戏子",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>内力犹如实质，抓向目标肩膀，对敌人造成伤害，可以选择消耗 1 层“锦鲤”，使此次攻击的暴击骰-3。</p><p>·击中无架招敌人，则可以将其拉至身前。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "询问消耗锦鲤。拉人手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗锦鲤",
                            "trigger": "attack",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"jinli\");\nif (buff) {\n    const confirm = await foundry.applications.api.DialogV2.confirm({\n        window: { title: \"梨园戏子\" },\n        content: \"<p>消耗 1 层 [锦鲤] 使暴击骰 -3？</p>\",\n        yes: { label: \"消耗\", icon: \"fas fa-check\" },\n        no: { label: \"不消耗\", icon: \"fas fa-times\" }\n    });\n    if (confirm) {\n        await game.xjzl.api.effects.removeEffect(actor, \"jinli\", 1);\n        args.flags.critThresholdMod = (args.flags.critThresholdMod || 0) + 3;\n        ui.notifications.info(\"已消耗锦鲤，暴击率大幅提升！\");\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "木子千宠",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>单掌抓出，造成伤害，击破架招时，内力如网流窜全身，使目标“禁足”一回合，若你额外消耗 10 内力，可以使目标额外陷入“缚身”一回合，若你消耗一层“锦鲤”，还可以移除自己身上一个状态。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破禁足自动。额外消耗及移除状态手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破禁足",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const root = CONFIG.statusEffects.find(e => e.id === \"root\");\n    if (root) {\n        const data = foundry.utils.deepClone(root);\n        data.duration = { rounds: 1 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 被禁足！`);\n        ui.notifications.info(\"可选：手动消耗10内力施加缚身；手动消耗锦鲤解控。\");\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "锦鲤成风",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双臂掸袖，内力挥舞，开启架招，并为自己增加 2 层“锦鲤”，至多 5 层，持续到脱战。</p><p><strong>锦鲤：</strong>每层使你的闪避+3，每次损失气血值时，减少一层“锦鲤”。</p><p><strong>升级：</strong>格挡值+10，额外增加 1 层锦鲤，消耗+2。</p>",
                    "automationNote": "开启获锦鲤自动。锦鲤效果及受损减少自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得锦鲤",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"锦鲤\").toObject();\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst amount = 2 + (lvl - 1);\n\nfor(let i=0; i<amount; i++) {\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}\nui.notifications.info(`获得 ${amount} 层锦鲤`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "僖昭废哀",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招，压制对方虚招，为自己增加三层“锦鲤”状态，回复自身相当于当前内力值一半的气血。</p><p><strong>升级：</strong>额外增加一层“锦鲤”，内力消耗+2。</p>",
                    "automationNote": "获锦鲤自动。回血自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "效果应用",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"锦鲤\").toObject();\nconst lvl = Math.max(1, move.computedLevel || 1);\nconst amount = 3 + (lvl - 1);\n\n// 加锦鲤\nfor(let i=0; i<amount; i++) {\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}\n\n// 回血 (当前内力/2)\nconst heal = Math.floor(actor.system.resources.mp.value / 2);\nawait actor.applyHealing({amount: heal, type: \"hp\", showScrolling: true});\nui.notifications.info(`增加 ${amount} 层锦鲤，回复 ${heal} 气血`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "贞观治世",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "7米",
                    "targetInfo": "范围",
                    "actionCost": "主要动作",
                    "description": "<p>消耗所有“锦鲤”，进入“盛世”状态，持续两回合。</p><p><strong>盛世：</strong>范围内有角色受伤时，你可以消耗反应动作使此次伤害减少，数值为消耗锦鲤层数*30。</p><p><strong>升级：</strong>持续时间+1 回合，怒气消耗-1，消耗+4。</p>",
                    "automationNote": "消耗锦鲤获盛世自动。盛世减伤手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "开启盛世",
                            "trigger": "hit",
                            "script": "const buff = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"jinli\");\nif (buff) {\n    const stacks = buff.getFlag(\"xjzl-system\", \"stacks\") || 1;\n    await buff.delete();\n    \n    const lvl = Math.max(1, move.computedLevel || 1);\n    const rounds = 2 + (lvl - 1);\n    \n    // 创建盛世BUFF提示\n    const data = {\n        name: `盛世 (${stacks*30}减免)`,\n        icon: \"icons/magic/light/beam-rays-yellow.webp\",\n        duration: { rounds: rounds },\n        description: `可消耗反应减免 ${stacks*30} 伤害`,\n        flags: {\"xjzl-system\": {slug: \"shengshi\", stackable: false}}\n    };\n    await game.xjzl.api.effects.addEffect(actor, data);\n    ui.notifications.info(`消耗 ${stacks} 层锦鲤，开启盛世！`);\n} else {\n    ui.notifications.warn(\"无锦鲤层数，无法开启盛世！\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "锦鲤",
                    "icon": "icons/creatures/fish/fish-carp-orange.webp",
                    "description": "闪避增加，受击减少层数。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jinli",
                            "stackable": true,
                            "maxStacks": 5,
                            "scripts": [
                                {
                                    "label": "受击掉层",
                                    "trigger": "damaged",
                                    "active": true,
                                    "script": "if (args.hpLost > 0) {\n    await game.xjzl.api.effects.removeEffect(actor, \"jinli\", 1);\n    ui.notifications.info(\"受到气血伤害，锦鲤层数 -1\");\n}"
                                }
                            ]
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.dodge",
                            "mode": 2,
                            "value": "3"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "灭神掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>中掌之人双目失明，黑气缠绕不散，且能损伤气血根基，江湖之上人人避之不及。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "毁天",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双掌翻转，对敌人造成伤害，若目标处于下盘不稳，则击飞 1 米。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "// 优化：直接读取系统计算好的状态Flags\nif (args.isHit && args.target.xjzlStatuses.unstable) {\n    ui.notifications.info(`${args.target.name} 下盘不稳，被击飞 1 米！`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "灭地",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "周围",
                    "actionCost": "蓄力动作",
                    "description": "<p>单掌击地，内力随地面传至周围，对所有敌人造成伤害，使目标“下盘不稳”三回合。击破架招时，击飞目标 1 米。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "施加下盘不稳自动。击破击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "scripts": [
                        {
                            "label": "下盘不稳",
                            "trigger": "hit",
                            "script": "const eff = CONFIG.statusEffects.find(e => e.id === \"unstable\");\nif (eff) {\n    const data = foundry.utils.deepClone(eff);\n    data.duration = { rounds: 3 };\n    await game.xjzl.api.effects.addEffect(args.target, data);\n}\nif (args.isBroken) {\n    ui.notifications.info(`${args.target.name} 被击飞 1 米`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "苍生尽灭",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "周围",
                    "actionCost": "蓄力动作",
                    "description": "<p>双掌回环，内力奔涌，对周围敌人造成伤害。若范围内有敌人处于空中，则可以消耗反应动作或次要动作施展，飞身击敌，不造成伤害，但使其最大气血上限永久-5。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "空中释放效果需手动调整（手动归零伤害并扣除上限）。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "scripts": [
                        {
                            "label": "空中释放提示",
                            "trigger": "attack",
                            "script": "ui.notifications.info(\"若作为对空反击，请手动将伤害调整为 0，并手动扣除目标 HP 上限。 (使用手动修正组)\");",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "暗无天日",
                    "type": "qi",
                    "actionType": "default",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双掌成爪化为乌黑，进入“暗掌”状态，持续到战斗脱离。</p><p><strong>暗掌：</strong>下次攻击命中后内力流入其头颅，额外造成 5 点精神伤害并使目标陷入“目盲”三回合。</p><p><strong>升级：</strong>造成精神伤害+5，内力消耗+2。</p>",
                    "automationNote": "获暗掌自动。暗掌效果触发自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得暗掌",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"暗掌\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "大日黑天",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招，压制对方虚招，内力顺着对方肢体打入奇经八脉，汇聚脑部，对目标造成伤害，若目标处于目盲，则使目标陷入永久的“黑暗”状态。</p><p><strong>黑暗：</strong>失去所有视力，所有需要视力的能力均失效。此效果无法被任何效果驱散，只有受到《天阳指》治疗七次后，此效果结束。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "目盲转黑暗自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.1
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "黑暗",
                            "trigger": "hit",
                            "script": "// 优化：直接读取系统计算好的状态Flags\nif (args.target.xjzlStatuses.blind) {\n    const eff = thisItem.effects.getName(\"黑暗\").toObject();\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n    ui.notifications.info(`${args.target.name} 陷入永久黑暗！`);\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "暗掌",
                    "icon": "icons/magic/death/hand-undead-skeleton-fire-purple.webp",
                    "description": "下次攻击造成精神伤害并致盲。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "anzhang",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "暗掌触发",
                                    "trigger": "hit",
                                    "active": true,
                                    "script": "// 修正：直接使用 thisItem，无需遍历查找\nif (args.type === \"attack\" && args.isHit) {\n    // 消耗暗掌\n    await thisEffect.delete();\n    \n    // 计算额外伤害\n    // 从 thisItem (武学书) 中查找 \"暗无天日\" 招式的数据来计算等级\n    const moveData = thisItem.system.moves.find(m => m.name === \"暗无天日\");\n    const lvl = Math.max(1, moveData?.computedLevel || 1);\n    const extra = 5 + (lvl - 1) * 5;\n    \n    await args.target.applyDamage({amount: extra, type: \"mental\", attacker: actor, isHit: true});\n    \n    // 施加目盲\n    const blind = CONFIG.statusEffects.find(e => e.id === \"blind\");\n    if (blind) {\n        const data = foundry.utils.deepClone(blind);\n        data.duration = { rounds: 3 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n    }\n    ui.notifications.info(`暗掌触发：${extra} 精神伤害 + 目盲`);\n}"
                                }
                            ]
                        }
                    },
                    "changes": []
                },
                {
                    "name": "黑暗",
                    "icon": "icons/svg/blind.svg",
                    "description": "永久失明。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "heian",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.attackLevel",
                            "mode": 2,
                            "value": "-1"
                        },
                        {
                            "key": "flags.xjzl-system.feintLevel",
                            "mode": 2,
                            "value": "-1"
                        },
                        {
                            "key": "flags.xjzl-system.grantAttackLevel",
                            "mode": 2,
                            "value": "1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "号天神拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>代天而行，号令天下。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "代天宣化",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>高呼奉天，开启架招，进入“承运”状态，持续到被击破架招。</p><p><strong>承运：</strong>当你的一个投掷具有优势时，你可以选择消耗承运状态，使此次投掷结果取 20。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "开启架招获得承运自动。消耗承运改投掷结果需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得承运",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"承运\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        },
                        {
                            "label": "移除承运(被破)",
                            "trigger": "damaged",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.removeEffect(actor, \"chengyun\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "代天行伐",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>单掌拍出，内力震入敌人体内，造成伤害，击中无架招敌人，代天而行，使其陷入缚身状态，持续一回合。当你处于“承运”状态，你此招的命中具有优势。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "承运优势",
                            "trigger": "attack",
                            "script": "const hasStatus = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"chengyun\");\nif (hasStatus) {\n    args.flags.level += 1;\n}",
                            "active": true
                        },
                        {
                            "label": "施加缚身",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"fushen\");\n    if(eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 1 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 陷入缚身！`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "代天领物",
                    "type": "qi",
                    "actionType": "default",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "6米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当有角色获得任何状态时，你可以选择消耗反应和承运状态，号令天地，将此状态转夺为己用，在你的回合中，你可以消耗次要动作将由此获得的状态赏赐给范围内的一个目标。</p><p><strong>升级：</strong>释放距离+8，内力消耗+2。</p>",
                    "automationNote": "效果处理手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "臣服万物",
                    "type": "counter",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破敌人虚招时，可消耗反应动作施展此招，压制对方虚招，拳摆出手，击倒目标，并对其造成伤害，你可以选择不造成伤害，改为对目标进行[点穴]检定，此次检定具有优势。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\nif(eff) await game.xjzl.api.effects.addEffect(args.target, eff);",
                            "active": true
                        },
                        {
                            "label": "点穴选择",
                            "trigger": "attack",
                            "script": "const confirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"臣服万物\" },\n    content: \"<p>是否放弃伤害，改为进行优势[点穴]检定？</p>\",\n    yes: { label: \"改为点穴\" },\n    no: { label: \"造成伤害\" }\n});\n\nif (confirm) {\n    args.flags.damageResult.damage = 0;\n    args.flags.damageResult.breakdown += \"\\n(放弃伤害，转为点穴)\";\n    // 临时标记，供hit阶段读取\n    thisItem.temp_isDianxue = true;\n} else {\n    thisItem.temp_isDianxue = false;\n}",
                            "active": true
                        },
                        {
                            "label": "执行点穴",
                            "trigger": "hit",
                            "script": "if (thisItem.temp_isDianxue) {\n    await Macros.requestSave({\n        target: args.target,\n        attacker: actor,\n        type: \"dianxue\",\n        dc: 15,\n        label: \"臣服万物-点穴\",\n        level: 1,\n        onFail: \"stun\"\n    });\n    thisItem.temp_isDianxue = false; // 重置\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "取天代神",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "4米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>飞身而起（处于半空中），内劲轰击地面，对周围敌人造成伤害，并且击倒所有敌人。</p><p>·若自身处于“承运”状态，你可以选择消耗“承运”状态，获得 2 点怒气。</p><p><strong>升级：</strong>造成伤害+20，内力消耗+8，怒气消耗-1。</p>",
                    "automationNote": "击倒自动。消耗承运回怒需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            4,
                            3,
                            2
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "const eff = CONFIG.statusEffects.find(e => e.id === \"prone\");\nif(eff) await game.xjzl.api.effects.addEffect(args.target, eff);",
                            "active": true
                        },
                        {
                            "label": "提示回怒",
                            "trigger": "hit_once",
                            "script": "const hasStatus = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"chengyun\");\nif (hasStatus) {\n    ui.notifications.info(\"提示：若消耗 [承运] 状态，请手动增加 2 点怒气。\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "承运",
                    "icon": "icons/magic/symbols/runes-star-blue.webp",
                    "description": "消耗此状态可使优势投掷取20。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "chengyun",
                            "stackable": false
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "十神恶掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>十神本是生辰八字算法术语，并无明显善恶，但却有一命格极差之人，以血气演化此掌法，便使得此掌法变成了天下数得着的凶邪武学。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "枭神现天干",
                    "type": "feint",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>以血气凝恶神于天干，掌风猎猎，对目标造成伤害，若击破架招，你可以给予目标“枭神”状态，持续到战斗脱离。</p><p><strong>枭神：</strong>你的[韧性]检定具有劣势，你受到毒素伤害时伤害额外提高 10 点。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "hp": [
                            10,
                            10,
                            10
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加枭神",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"枭神\").toObject();\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "伤官断业",
                    "type": "real",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>掌中现血煞，直击心脉，对目标造成伤害。若目标受到此招后气血不足最大气血的 10%，他需要进行一次伤残检定。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "伤残检定提示自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "hp": [
                            10,
                            10,
                            10
                        ]
                    },
                    "scripts": [
                        {
                            "label": "伤残检测",
                            "trigger": "hit",
                            "script": "const targetHp = args.target.system.resources.hp.value;\nconst targetMax = args.target.system.resources.hp.max;\nif (targetHp < (targetMax * 0.1)) {\n    ChatMessage.create({\n        content: `<div class=\"xjzl-chat-card\"><p><b>${args.target.name}</b> 气血低于 10%，需进行伤残检定！</p></div>`,\n        speaker: ChatMessage.getSpeaker({actor: actor})\n    });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "七杀灭生",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>将自身血气化于掌中，双掌齐出，对目标造成伤害，根据目标所运行的内功属性，附加不同的效果。</p><p>阴柔：进行[韧性]检定（难度 15），失败则解除架招。</p><p>阳刚：招式可以攻击目标及其周围 2 米内所有敌人。</p><p>太极：命中后招式伤害变为毒素伤害。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，[韧性]检定难度+2，内力消耗+4。</p>",
                    "automationNote": "太极转毒自动。阴柔检定自动。阳刚AOE手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            20,
                            20,
                            20
                        ]
                    },
                    "scripts": [
                        {
                            "label": "太极转毒",
                            "trigger": "preDamage",
                            "script": "const activeNeigongId = args.target.system.martial.active_neigong;\nif (activeNeigongId) {\n    const neigong = args.target.items.get(activeNeigongId);\n    if (neigong && neigong.system.element === \"taiji\") {\n        args.config.type = \"poison\";\n        ui.notifications.info(\"目标运行太极内功，伤害转为毒素！\");\n    }\n}",
                            "active": true
                        },
                        {
                            "label": "属性效果",
                            "trigger": "hit",
                            "script": "const activeNeigongId = args.target.system.martial.active_neigong;\nif (activeNeigongId) {\n    const neigong = args.target.items.get(activeNeigongId);\n    const elem = neigong ? neigong.system.element : \"none\";\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const dc = 15 + (lvl - 1) * 2;\n\n    if (elem === \"yin\") {\n        await Macros.requestSave({\n            target: args.target,\n            attacker: actor,\n            type: \"renxing\",\n            dc: dc,\n            label: \"七杀灭生-破架\",\n            onFail: {\n                name: \"架招崩解\",\n                changes: [{ key: \"system.martial.stanceActive\", mode: 5, value: \"false\" }]\n            }\n        });\n    } else if (elem === \"yang\") {\n        ui.notifications.info(\"目标运行阳刚内功，请手动结算周围 2 米 AOE。\");\n    }\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "枭神",
                    "icon": "icons/magic/death/skull-horned-goat-purple.webp",
                    "description": "韧性检定劣势，受毒素伤害+10。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "xiaoshen",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "毒素易伤",
                                    "trigger": "preDefense",
                                    "script": "if (args.type === \"poison\") {\n    args.baseDamage += 10;\n    ui.notifications.info(`${actor.name} 枭神生效：毒素伤害+10`);\n}",
                                    "active": true
                                }
                            ]
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.renxingCheckLevel",
                            "mode": 2,
                            "value": "-1"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "登云八步",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>仿仙人登天之步法，招式刚猛强劲，而又仙气飘飘，据说练至大成之境，可在空中凭空连登八步。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "妖魔崩岩",
                    "type": "real",
                    "element": "gang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>抬脚正蹬，力能碎岩，对敌人造成伤害，若目标无架招，则使自己获得“轻身”状态，持续一回合。</p><p><strong>轻身：</strong>速度+5。</p><p><strong>升级：</strong>招式伤害+10，持续回合数+1，消耗+2。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得轻身",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"轻身\").toObject();\n    const lvl = Math.max(1, move.computedLevel || 1);\n    eff.duration = { rounds: 1 + (lvl - 1) };\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "仙人飞山",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双手背在身后，以灵妙的身法移动，开启架招，回合结束时，你每有一点未消耗的移动速度，格挡值+1，持续到下回合初。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "回合结束根据剩余速度手动添加格挡。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "青蛟摆尾",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>附身扫腿，左右连环，对目标造成伤害。若击破架招，则使对方下盘不稳，持续两回合，自身获得“青蛟”状态，持续两回合。</p><p><strong>青蛟：</strong>场上每有人因下盘不稳降低一点速度，你就上升一点速度。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击破下盘不稳自动。获青蛟自动。青蛟效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破效果",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    // 目标下盘不稳\n    const unstable = CONFIG.statusEffects.find(e => e.id === \"unstable\");\n    if(unstable) {\n        const data = foundry.utils.deepClone(unstable);\n        data.duration = { rounds: 2 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n    }\n    // 自身青蛟\n    const qingjiao = thisItem.effects.getName(\"青蛟\").toObject();\n    qingjiao.duration = { rounds: 2 };\n    await game.xjzl.api.effects.addEffect(actor, qingjiao);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "天神断海",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "10米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>下蹲蓄力，准备起跳，在范围中选择一块 3*3 的攻击区域，在这个区域中，所有速度低于你的目标陷入“禁足”状态，直到下个你的回合开始。下个你的回合开始时，一跃飞天，纵身一踢（半空中），对选定区域中所有敌人造成伤害。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+8。</p>",
                    "automationNote": "纯手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": []
                }
            ],
            "effects": [
                {
                    "name": "轻身",
                    "icon": "icons/magic/air/wind-stream-purple.webp",
                    "description": "速度+5。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "qingshen",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.speed",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                },
                {
                    "name": "青蛟",
                    "icon": "icons/creatures/reptiles/serpent-horned-green.webp",
                    "description": "场上每有人因下盘不稳减速1点，自身速度+1。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "qingjiao",
                            "stackable": false
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "五岳刚拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>一拳形同山岳压顶，断水破峰不在话下。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "泰山压顶",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "蓄力动作",
                    "description": "<p>将浑身力道汇于拳中，巨力锤击，对目标造成伤害，使自己陷入“错骨”状态，持续一回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加错骨",
                            "trigger": "hit",
                            "script": "const eff = CONFIG.statusEffects.find(e => e.id === \"cuogu\");\nif(eff) {\n    const data = foundry.utils.deepClone(eff);\n    data.duration = { rounds: 1 };\n    await game.xjzl.api.effects.addEffect(actor, data);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "落雁惊寒",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>身形飘忽，开启架招，格挡成功后，你可以不消耗速度向攻击目标移动 2 米。</p><p><strong>升级：</strong>格挡值+10，移动距离+1 米，内力消耗+2。</p>",
                    "automationNote": "格挡提示自动。移动手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡提示",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args)) {\n    const lvl = Math.max(1, (thisItem.system.moves.find(m=>m.id === actor.system.martial.stance)?.computedLevel || 1));\n    const dist = 2 + (lvl - 1);\n    ui.notifications.info(`格挡成功！可向目标移动 ${dist} 米。`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "祝融天峰",
                    "type": "counter",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>看破虚招时反应释放，压制目标虚招，一左一右，双拳齐出，对目标造成两次 0.4 力量点外功伤害，并击飞目标 5 米。</p><p>·若击中无架招目标，使其陷入“震伤”状态，持续三回合。</p><p><strong>震伤：</strong>每次被攻击都会流失 10 点气血，若在此期间出招三次后，还会被添加“内伤”两回合。</p><p><strong>内伤：</strong>陷入“禁实”“禁虚”“禁足”。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "击飞手动。震伤添加自动。震伤计数与内伤转化手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加震伤",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"震伤\").toObject();\n    eff.duration = { rounds: 3 };\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "虎啸皇拳",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "全回合动作",
                    "description": "<p>九拳连击，一拳猛于一拳，对目标造成伤害，若此招暴击且击中无架招目标，则击退目标 5 米，再对其造成 60 点气血流失。</p><p><strong>升级：</strong>招式伤害+20，气血流失+20，消耗+4，怒气消耗-1。</p>",
                    "automationNote": "气血流失自动。击退手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "额外流失",
                            "trigger": "hit",
                            "script": "if (args.isCrit && !args.target.system.martial.stanceActive) {\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const loss = 60 + (lvl - 1) * 20;\n    await args.target.applyHealing({ amount: -loss, type: \"hp\", showScrolling: true });\n    ui.notifications.info(`${args.target.name} 被击退 5 米并流失 ${loss} 气血！`);\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "震伤",
                    "icon": "icons/svg/ruins.svg",
                    "description": "每次受击流失10气血。出招3次后转为内伤(需手动计数)。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zhenshang",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "受击流血",
                                    "trigger": "damaged",
                                    "script": "await actor.applyHealing({ amount: -10, type: \"hp\", showScrolling: true });",
                                    "active": true
                                }
                            ]
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "垓下绝",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 2,
            "description": "<p>虞美人美甚，然全株剧毒，中者幻觉丛生，狂乱起舞。此武学取虞美人垓下舞别之意，以毒素行凄绝之舞，中者莫不垂涕。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>柔</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "朱颜改",
                    "type": "feint",
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>手指轻拂目标双眼，对目标造成伤害。命中无架招目标时，还会使毒侵入敌人双眼，使对方获得“青花毒”，持续三回合。</p><p><strong>青花毒：</strong>命中-5。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加青花毒",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"青花毒\").toObject();\n    eff.duration = { rounds: 3 };\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "离人影",
                    "type": "stance",
                    "element": "rou",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>身形若隐若现，开启架招，并且进入“离人”状态，持续到战斗脱离或者被破架招。</p><p><strong>离人：</strong>若敌人有“青花毒”且在你周围 1 米中结束回合，则按照以下三个阶段，向下叠加该敌人身上“青花毒”的效果。</p><p>入体：待一回合，初始阶段，无效果。</p><p>入肌：待二回合，“青花毒”的效果翻倍。</p><p>入骨：待三回合，攻击未命中时，使自身陷入“目盲”状态，持续两回合。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "开启获离人自动。毒素进阶判定需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得离人",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"离人\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        },
                        {
                            "label": "移除离人(被破)",
                            "trigger": "damaged",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.removeEffect(actor, \"liren\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "怜清影",
                    "type": "qi",
                    "actionType": "heal",
                    "element": "rou",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>真气凝成针线，刺在伤患各处穴道，回复目标气血（无法造成暴击），场上每有一个人处于“青花毒”状态，该招式可以指定的目标就多一个。</p><p>·此招中的内息是施展本招式者的内息属性。</p><p>·每有 1 级[疗伤]，提高 1 点气血回复。</p><p><strong>升级：</strong>气血回复+10，内力消耗+4。</p>",
                    "automationNote": "治疗计算自动。多目标选择需手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "scripts": [
                        {
                            "label": "疗伤加成",
                            "trigger": "calc",
                            "script": "const skillVal = actor.system.skills.liaoshang.total || 0;\nargs.output.damage += skillVal;\nargs.output.bonusDesc.push(`疗伤技能加成 +${skillVal}`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "萦新恨",
                    "type": "real",
                    "isUltimate": true,
                    "element": "rou",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>旧愁未去，新恨上心头，对周围敌人造成伤害，并且为其添加“青花毒”，持续到战斗脱离。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+8。</p>",
                    "automationNote": "施加青花毒自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加青花毒",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const eff = thisItem.effects.getName(\"青花毒\").toObject();\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "青花毒",
                    "icon": "icons/svg/poison.svg",
                    "description": "命中-5。受离人影响加深。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "qinghuadu",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.hit_waigong",
                            "mode": 2,
                            "value": "-5"
                        },
                        {
                            "key": "system.combat.hit_neigong",
                            "mode": 2,
                            "value": "-5"
                        }
                    ]
                },
                {
                    "name": "离人",
                    "icon": "icons/magic/perception/silhouette-stealth-shadow.webp",
                    "description": "加速青花毒效果。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "liren",
                            "stackable": false
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "野球拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 3,
            "description": "<p>天下无难事，只怕野球拳，江湖神功。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "石头",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>踏步直冲，飞拳重轰，造成伤害。招式伤害忽视内外功防御。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无视防御",
                            "trigger": "preDamage",
                            "script": "args.config.ignoreDefense = true;",
                            "active": true
                        },
                        {
                            "label": "藏招加成",
                            "trigger": "calc",
                            "script": "const hide = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"cangzhao\");\nif (hide) {\n    const cangMove = thisItem.system.moves.find(m => m.name === \"藏招\");\n    const cangLvlReal = Math.max(1, cangMove?.computedLevel || 1);\n    const bonus = 20 + (cangLvlReal - 1) * 10;\n    args.output.damage += bonus;\n    args.output.bonusDesc.push(`藏招加成 +${bonus}`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "剪刀",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>翻肘撤步，双指瞬出。造成伤害。击破架招时，你可以再次无消耗地释放【石头】【剪刀】【布】中的任意一招。(无法暴击)。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "击破提示连击自动。藏招加成自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "连击提示",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    ui.notifications.info(\"击破架招！可无消耗再释放一招(不可暴击)。\");\n}",
                            "active": true
                        },
                        {
                            "label": "藏招加成",
                            "trigger": "calc",
                            "script": "const hide = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"cangzhao\");\nif (hide) {\n    const cangMove = thisItem.system.moves.find(m => m.name === \"藏招\");\n    const cangLvlReal = Math.max(1, cangMove?.computedLevel || 1);\n    const bonus = 2 + (cangLvlReal - 1) * 1;\n    args.output.feint += bonus;\n    args.output.bonusDesc.push(`藏招虚招值 +${bonus}`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "布",
                    "type": "counter",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作释放此招，压制虚招，崩拳捣击，推掌盘打，造成伤害，然后自身进入“获胜”状态一回合。</p><p><strong>获胜：</strong>欢欣雀跃，你无法被击退，击倒，击飞，禁足，缚身，速度提高 5 米。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "获胜自动。藏招免疫手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得获胜",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"获胜\").toObject();\nconst hide = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"cangzhao\");\n\nif (hide) {\n    const cangMove = thisItem.system.moves.find(m => m.name === \"藏招\");\n    const cangLvlReal = Math.max(1, cangMove?.computedLevel || 1);\n    eff.duration = { rounds: 1 + (cangLvlReal - 1) }; // 藏招升级效果\n    ui.notifications.info(\"藏招加持：获胜期间免疫所有状态(请手动)！\");\n} else {\n    eff.duration = { rounds: 1 };\n}\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "藏招",
                    "type": "qi",
                    "actionType": "default",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>捏手于腰，乱其视听，扰其心步。你的速度归零，进入“藏”状态，持续到下回合初。</p><p><strong>藏：</strong>《野球拳》施展距离+5 米，然后强化你的《野球拳》招式，持续到你的下一个回合开始。</p><p>石头:招式伤害提高 20 点。</p><p>剪刀:虚招值提高 2 点。</p><p>布:“获胜”期间改为免疫所有敌人添加的状态。</p><p><strong>升级：</strong>石头的招式伤害再提升 10 点；剪刀的虚招值提高 1 点；若获胜，持续回合增加 1 回合。消耗内力+10。</p>",
                    "automationNote": "获得藏自动。禁足自动。强化效果自动。距离增加手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            10,
                            20,
                            30,
                            40
                        ],
                        "rage": [
                            1,
                            1,
                            1,
                            1
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得藏",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"藏\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "获胜",
                    "icon": "icons/magic/life/heart-glowing-yellow.webp",
                    "description": "免疫击退倒飞禁缚，速度+5。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "huosheng",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.speed",
                            "mode": 2,
                            "value": "5"
                        }
                    ]
                },
                {
                    "name": "藏",
                    "icon": "icons/magic/perception/eye-ringed-glow-purple.webp",
                    "description": "速度归零。强化野球拳。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "cangzhao",
                            "stackable": false
                        }
                    },
                    "duration": {
                        "turns": 1
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.forceSpeedZero",
                            "mode": 5,
                            "value": "true"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "连山六气掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 3,
            "description": "<p>源于易术功法，以四季六气为旺衰指引，以六甲值符为吉凶判辨之坐标，以三元九运为招式转换。此功法势大磅礴，但是却需要气运为辅。</p><p><strong>需求：</strong>徒手</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "起白印黑",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>一手平铺，一手打圆，以静养动，以动制静，开启架招。格挡成功后，随机获得一种“六气”状态。（投掷 D6 决定）</p><p><strong>升级：</strong>格挡值+10，内力消耗+4。</p>",
                    "automationNote": "格挡获六气自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "随机获气",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst roll = Math.floor(Math.random() * 6) + 1;\nconst map = {1:\"厥阴风木\", 2:\"少阴君火\", 3:\"太阴湿土\", 4:\"少阳相火\", 5:\"阳明燥金\", 6:\"太阳寒水\"};\nconst name = map[roll];\nconst eff = thisItem.effects.getName(name).toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);\nui.notifications.info(`格挡获得六气：${name}`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "画碧染绿",
                    "type": "qi",
                    "actionType": "default",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "次要动作",
                    "description": "<p>将汇集的“六气”之一晕化于周遭天地之间，根据释放的气息不同产生不同效果，同一时间只能存在一种六气效果。</p><p>厥阴风木：你的回合结束时，周围 3 米所有友方角色立即恢复 20 点气血，持续一回合。</p><p>少阴君火：周围 3 米所有友方角色造成外功伤害时，伤害提高 20 点，持续一回合。</p><p>太阴湿土：周围 3 米所有友方角色获得 10 点内功防御，持续一回合。</p><p>少阳相火：周围 3 米所有友方角色造成内功伤害时，伤害提高 20 点，持续一回合。</p><p>阳明燥金：周围 3 米所有战斗变得华丽异常，所有角色神采值增加 20 点，持续一回合。</p><p>太阳寒水：周围 3 米所有敌人内力窒碍，施展轻功额外消耗 10 点内力，持续一回合。</p><p><strong>升级：</strong>持续时间+1 回合，内力消耗+4。</p>",
                    "automationNote": "纯手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": []
                },
                {
                    "name": "通黄绣白",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>击敌手臂，产生吸力，将其臂膀擒入手中，绕至目标正前方空格，对其造成伤害，若击中开启架招的目标，你随机获得一层“六气”，若招式施展完毕后，存在“少阴君火”或“太阴湿土”，则可立即不消耗动作施展一次【惊赤流白】。然后消耗自身存在的“少阴君火”和“太阴湿土”状态。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "击中架招获气自动。连招判定与消耗手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "架招获气",
                            "trigger": "hit",
                            "script": "if (args.isHit && args.target.system.martial.stanceActive) {\n    const roll = Math.floor(Math.random() * 6) + 1;\n    const map = {1:\"厥阴风木\", 2:\"少阴君火\", 3:\"太阴湿土\", 4:\"少阳相火\", 5:\"阳明燥金\", 6:\"太阳寒水\"};\n    const name = map[roll];\n    const eff = thisItem.effects.getName(name).toObject();\n    await game.xjzl.api.effects.addEffect(actor, eff);\n    ui.notifications.info(`击中架招获得六气：${name}`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "惊赤流白",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>转身回旋，绕至目标身后空格，双掌连攻目标脊背。对其造成伤害，若击中开启架招的目标，则随机获得一层“六气”，若招式施展完毕后，存在“少阳相火”或“太阳寒水”，则可立即不消耗动作施展一次【通黄绣白】。然后消耗自身存在的“少阳相火”和“太阳寒水”状态。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "击中架招获气自动。连招判定与消耗手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "架招获气",
                            "trigger": "hit",
                            "script": "if (args.isHit && args.target.system.martial.stanceActive) {\n    const roll = Math.floor(Math.random() * 6) + 1;\n    const map = {1:\"厥阴风木\", 2:\"少阴君火\", 3:\"太阴湿土\", 4:\"少阳相火\", 5:\"阳明燥金\", 6:\"太阳寒水\"};\n    const name = map[roll];\n    const eff = thisItem.effects.getName(name).toObject();\n    await game.xjzl.api.effects.addEffect(actor, eff);\n    ui.notifications.info(`击中架招获得六气：${name}`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "九紫运来",
                    "type": "qi",
                    "actionType": "default",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "10米",
                    "targetInfo": "范围",
                    "actionCost": "次要动作",
                    "description": "<p>只有使用招式消耗过 6 种不同的“六气”状态才能施展，次要动作，在周围 10 米布下‘六丁六甲阵’，持续 3 回合。</p><p><strong>六丁六甲阵：</strong>区域内具有所有【画碧染绿】中的六气效果，且范围变为六丁六甲阵的范围，相关效果数值翻倍。</p><p><strong>升级：</strong>持续回合+1，内力消耗+8，怒气消耗-1。</p>",
                    "automationNote": "纯手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24,
                            32
                        ],
                        "rage": [
                            8,
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": []
                }
            ],
            "effects": [
                {
                    "name": "厥阴风木",
                    "icon": "icons/magic/nature/leaf-glow-green.webp",
                    "description": "回合结束周围友方回血20。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "six_qi_1",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "少阴君火",
                    "icon": "icons/magic/fire/flame-burning-orange.webp",
                    "description": "周围友方外功伤害+20。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "six_qi_2",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "太阴湿土",
                    "icon": "icons/magic/earth/rock-shatter-yellow.webp",
                    "description": "周围友方内防+10。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "six_qi_3",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "少阳相火",
                    "icon": "icons/magic/fire/explosion-fireball-red.webp",
                    "description": "周围友方内功伤害+20。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "six_qi_4",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "阳明燥金",
                    "icon": "icons/magic/light/beam-rays-gold.webp",
                    "description": "周围角色神采+20。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "six_qi_5",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "太阳寒水",
                    "icon": "icons/magic/water/wave-ice-blue.webp",
                    "description": "周围敌人轻功耗内+10。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "six_qi_6",
                            "stackable": false
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "芳菲指",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖4.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 3,
            "description": "<p>阴狠嗜血之指法，传为隐居杏林好手所创，弃医者之仁心，血气纵横，与敌人血战到底，战斗后留下的痕迹，好似桃花零落在地。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>阴</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "乱红如雨",
                    "type": "feint",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>血气凝于双指，如雨点般刺向敌人，对目标造成伤害，若击破架招，自身获得“乱红”状态，持续一回合。</p><p><strong>乱红：</strong>每当你周围 1 米内有敌人流失气血时，你可以消耗反应动作施展【相映红】攻击目标。</p><p><strong>升级：</strong>招式伤害+10，乱红持续回合+1，消耗+4。</p>",
                    "automationNote": "击破获乱红自动。乱红反击手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得乱红",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const eff = thisItem.effects.getName(\"乱红\").toObject();\n    const lvl = Math.max(1, move.computedLevel || 1);\n    eff.duration = { rounds: 1 + (lvl - 1) };\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "相映红",
                    "type": "real",
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>真气从双手食指涌出，对目标造成伤害。命中无架招目标后，给予目标“映红”状态，持续一回合。</p><p><strong>映红：</strong>每次受到内外功伤害时，流失 20 气血。</p><p><strong>升级：</strong>招式伤害+10，映红持续回合+1，消耗+4。</p>",
                    "automationNote": "施加映红自动。映红易伤自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加映红",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"映红\").toObject();\n    const lvl = Math.max(1, move.computedLevel || 1);\n    eff.duration = { rounds: 1 + (lvl - 1) };\n    await game.xjzl.api.effects.addEffect(args.target, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "灼灼其华",
                    "type": "stance",
                    "element": "yin",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>血色的真气在指间流动燃烧，光芒灼目，开启架招，并进入“灼灼其华”状态，持续到战斗脱离或者被破架招。</p><p><strong>灼灼其华：</strong>你的《芳菲指》套路的招式引起气血流失时会为你回复等额的气血。</p><p><strong>升级：</strong>格挡值+10，内力消耗+4。</p>",
                    "automationNote": "开启获BUFF自动。吸血手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得灼灼其华",
                            "trigger": "attack",
                            "script": "const eff = thisItem.effects.getName(\"灼灼其华\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        },
                        {
                            "label": "移除状态(被破)",
                            "trigger": "damaged",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.removeEffect(actor, \"zhuozhuo\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "春归无觅",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yin",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>引动残留真气，汇成无形杀招，对目标造成伤害。</p><p>为自身添加“芳菲尽”，持续到战斗脱离。</p><p><strong>芳菲尽：</strong>你的招式效果若引起敌人气血流失，气血流失会生效两次。</p><p><strong>升级：</strong>招式伤害+20，怒气-1，内力消耗+8。</p>",
                    "automationNote": "获得芳菲尽自动。双倍流失手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 1.0
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24,
                            32
                        ],
                        "rage": [
                            8,
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得芳菲尽",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"芳菲尽\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "乱红",
                    "icon": "icons/magic/fire/projectile-fireball-smoke-red.webp",
                    "description": "敌人流血时可反击。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "luanhong",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "映红",
                    "icon": "icons/magic/blood/splash-active-red.webp",
                    "description": "受击额外流失20血。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "yinghong",
                            "stackable": false,
                            "scripts": [
                                {
                                    "label": "受击流失",
                                    "trigger": "damaged",
                                    "script": "if ([\"waigong\", \"neigong\"].includes(args.type)) {\n    await actor.applyHealing({ amount: -20, type: \"hp\", showScrolling: true });\n}",
                                    "active": true
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "灼灼其华",
                    "icon": "icons/magic/life/heart-glowing-red.webp",
                    "description": "造成流血时回复自身。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zhuozhuo",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "芳菲尽",
                    "icon": "icons/magic/nature/flower-rose-red.webp",
                    "description": "造成流血生效两次。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "fangfeijin",
                            "stackable": false
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "跃龙关",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 3,
            "description": "<p>鱼跃龙关而化龙，从此褪去凡型，遨游天地。然龙生九子，各有不同。古之侠士以此为灵感，创出此武学，依势化形，拳路变化，以应万变。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>刚</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "狴犴争讼",
                    "type": "real",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双拳高举，挥动如风，舞动成云，对目标造成伤害，若击中无架招的角色，则将自己的“跃龙关”状态，转化为“狴犴”状态，持续到战斗脱离。</p><p><strong>狴犴：</strong>施展《跃龙关》招式时伤害提升 15 点。</p><p><strong>升级：</strong>招式伤害+10，狴犴伤害+5，内力消耗+4。</p>",
                    "automationNote": "状态转化自动。伤害加成自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "狴犴加成",
                            "trigger": "calc",
                            "script": "const bian = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"bian\");\nif (bian) {\n    const lvl = Math.max(1, move.computedLevel || 1);\n    const bonus = 15 + (lvl - 1) * 5;\n    args.output.damage += bonus;\n    args.output.bonusDesc.push(`狴犴加伤 +${bonus}`);\n}",
                            "active": true
                        },
                        {
                            "label": "转化狴犴",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    await game.xjzl.api.effects.removeEffect(actor, \"yuelongguan\");\n    await game.xjzl.api.effects.removeEffect(actor, \"yazi\");\n    await game.xjzl.api.effects.removeEffect(actor, \"chiwen\");\n    await game.xjzl.api.effects.removeEffect(actor, \"baxia\");\n    const eff = thisItem.effects.getName(\"狴犴\").toObject();\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "睚眦必报",
                    "type": "counter",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作释放此招，兵刃闪现睚眦花纹，以牙还牙，对目标造成相当于对方虚招伤害的外功伤害，并将自己的“跃龙关”状态，转化为“睚眦”状态，持续两回合。</p><p><strong>睚眦：</strong>手持拳套武器伤害+15，格挡值+15。</p><p><strong>升级：</strong>“睚眦”状态持续回合+1，内力消耗+4。</p>",
                    "automationNote": "伤害手动。状态转化自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "伤害提示",
                            "trigger": "calc",
                            "script": "args.output.bonusDesc.push(\"基础伤害为对方虚招伤害，请手动调整\");",
                            "active": true
                        },
                        {
                            "label": "转化睚眦",
                            "trigger": "hit",
                            "script": "await game.xjzl.api.effects.removeEffect(actor, \"yuelongguan\");\nawait game.xjzl.api.effects.removeEffect(actor, \"bian\");\nawait game.xjzl.api.effects.removeEffect(actor, \"chiwen\");\nawait game.xjzl.api.effects.removeEffect(actor, \"baxia\");\n\nconst eff = thisItem.effects.getName(\"睚眦\").toObject();\nconst lvl = Math.max(1, move.computedLevel || 1);\neff.duration = { rounds: 2 + (lvl - 1) };\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "饕餮贪形",
                    "type": "stance",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>犹饕餮般吸收敌人攻入之内力，纵使会伤到己身，也要加以利用，开启架招，格挡成功时，获得“跃龙关”状态，持续到战斗脱离。</p><p><strong>升级：</strong>格挡值+10，内力消耗+4。</p>",
                    "automationNote": "格挡获跃龙关自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获状态",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args)) {\n    const eff = thisItem.effects.getName(\"跃龙关\").toObject();\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鸱吻吞浪",
                    "type": "feint",
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>身如游龙，出掌连拍，造成伤害。击破架招后，将自己的“跃龙关”状态，转化为“鸱吻”，持续到脱战。</p><p><strong>鸱吻：</strong>《跃龙关》套路的施展距离+2。</p><p><strong>升级：</strong>招式伤害+10，鸱吻施展距离+1，消耗+4。</p>",
                    "automationNote": "状态转化自动。距离增加手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "转化鸱吻",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.removeEffect(actor, \"yuelongguan\");\n    await game.xjzl.api.effects.removeEffect(actor, \"bian\");\n    await game.xjzl.api.effects.removeEffect(actor, \"yazi\");\n    await game.xjzl.api.effects.removeEffect(actor, \"baxia\");\n    \n    const eff = thisItem.effects.getName(\"鸱吻\").toObject();\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "霸下驮碑",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>内力涌动，汇为山岳之型，打出一掌，力道磅礴，刚不可当，对目标造成伤害。将自己的“跃龙关”状态，转化为“霸下”状态，持续到战斗脱离。</p><p><strong>霸下：</strong>你不会被位移效果影响，若此期间架招被击破，则你可以选择失去反应动作，使你的格挡值继续生效。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+8。</p>",
                    "automationNote": "状态转化自动。霸下效果手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24,
                            32
                        ],
                        "rage": [
                            8,
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "转化霸下",
                            "trigger": "hit",
                            "script": "await game.xjzl.api.effects.removeEffect(actor, \"yuelongguan\");\nawait game.xjzl.api.effects.removeEffect(actor, \"bian\");\nawait game.xjzl.api.effects.removeEffect(actor, \"yazi\");\nawait game.xjzl.api.effects.removeEffect(actor, \"chiwen\");\n\nconst eff = thisItem.effects.getName(\"霸下\").toObject();\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "跃龙关",
                    "icon": "icons/creatures/fish/fish-leaping-orange.webp",
                    "description": "基础形态。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "yuelongguan",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "狴犴",
                    "icon": "icons/creatures/mammals/lion-roar-head-yellow.webp",
                    "description": "伤害提升15。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "bian",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "睚眦",
                    "icon": "icons/creatures/reptiles/dragon-horned-blue.webp",
                    "description": "拳套伤害+15，格挡+15。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "yazi",
                            "stackable": false
                        }
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.weaponTypes.unarmed.mod",
                            "mode": 2,
                            "value": "15"
                        },
                        {
                            "key": "system.combat.block",
                            "mode": 2,
                            "value": "15"
                        }
                    ]
                },
                {
                    "name": "鸱吻",
                    "icon": "icons/creatures/fish/fish-monster-green.webp",
                    "description": "施展距离+2。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "chiwen",
                            "stackable": false
                        }
                    }
                },
                {
                    "name": "霸下",
                    "icon": "icons/creatures/reptiles/turtle-snapping-green.webp",
                    "description": "防位移，架招击破保护。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "baxia",
                            "stackable": false
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "遮天蔽日掌",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖1.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 3,
            "description": "<p>习练此功，需以毒物浸泡双手，至毒素渗入表皮，化为无形。战斗时以内力发热，使双手皮下毒物化为黑雾，笼罩敌手，触者化为白骨，死状凄凉。</p><p><strong>需求：</strong>徒手-拳掌</p><p><strong>属性：</strong>阳</p>",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "乌云盖顶",
                    "type": "real",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>黑烟随着掌风弥漫向敌手，对目标造成伤害，并在目标所在空格产生一道‘黑烟’，持续到战斗脱离。</p><p>若有敌人处于半空中，你可以消耗反应动作释放此招，使招式距离+4，原地释放黑气伤敌。</p><p><strong>黑烟：</strong>处于区域中的角色，招式无法造成暴击，且在他回合开始时，受到 20 点毒素伤害。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "黑烟区域生成及效果手动。反应动作消耗及半空判定手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "提示生成黑烟",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    ChatMessage.create({\n        content: `<div class=\"xjzl-chat-card\">\n            <div style=\"padding:5px; font-size:0.9em; color:#555;\">\n                <p><b>黑烟产生</b></p>\n                <p>请在目标所在位置标记 [黑烟] 区域。</p>\n                <p>效果：区域内无法暴击，回合开始受20毒伤。</p>\n            </div>\n        </div>`,\n        speaker: ChatMessage.getSpeaker({actor: actor})\n    });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "黑云压城",
                    "type": "counter",
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作释放此招，压制目标虚招，黑烟笼罩敌手，对目标造成伤害，并在目标所在空格产生一道‘黑烟’，持续到战斗脱离。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "黑烟区域生成手动。反应动作消耗手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "提示生成黑烟",
                            "trigger": "hit",
                            "script": "ChatMessage.create({\n    content: `<div class=\"xjzl-chat-card\">\n        <div style=\"padding:5px; font-size:0.9em; color:#555;\">\n            <p><b>黑烟产生</b></p>\n            <p>请在目标所在位置标记 [黑烟] 区域。</p>\n        </div>\n    </div>`,\n    speaker: ChatMessage.getSpeaker({actor: actor})\n});",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "乌烟瘴气",
                    "type": "stance",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>毒掌之上笼罩层层黑气，开启架招，格挡成功时，在目标所在空格产生一道‘黑烟’，持续到战斗脱离。</p><p><strong>升级：</strong>格挡值+10，内力消耗+4。</p>",
                    "automationNote": "黑烟区域生成手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡生烟",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nif (args.attacker) {\n    ChatMessage.create({\n        content: `<div class=\"xjzl-chat-card\">\n            <div style=\"padding:5px; font-size:0.9em; color:#555;\">\n                <p><b>格挡成功</b></p>\n                <p>请在 ${args.attacker.name} 所在位置产生 [黑烟]。</p>\n            </div>\n        </div>`,\n        speaker: ChatMessage.getSpeaker({actor: actor})\n    });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "蒙心绝念",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>将周围的黑烟尽数收入掌中，再爆发而出，化为汹涌黑浪，吞噬一切，对周围敌人造成伤害。</p><p>·每吸纳一团‘黑烟’，招式伤害提高 10 点。</p><p>·若吸纳的‘黑烟’数量达到 7 团，则在攻击范围内的每个空格产生一道‘黑烟’，持续到战斗脱离。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，内力消耗+16。</p>",
                    "automationNote": "吸纳黑烟数量及对应伤害加成手动输入。黑烟区域生成手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            },
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            16,
                            32,
                            48,
                            64
                        ],
                        "rage": [
                            8,
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "黑烟计算提示",
                            "trigger": "attack",
                            "script": "const confirm = await foundry.applications.api.DialogV2.prompt({\n    window: { title: \"蒙心绝念 - 吸纳黑烟\" },\n    content: `<p>请输入吸纳的黑烟数量：</p><input type=\"number\" name=\"count\" value=\"0\" autofocus>`,\n    ok: { label: \"确定\", callback: (event, button) => new FormData(button.form).get(\"count\") }\n});\n\nconst count = parseInt(confirm) || 0;\nconst bonus = count * 10;\n\nargs.flags.damageResult.damage += bonus;\nargs.flags.damageResult.breakdown += `\\n+ 黑烟吸纳(${count}): ${bonus}`;\n\nif (count >= 7) {\n    ui.notifications.info(\"吸纳达到7团，请在范围内铺满黑烟！\");\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "九鼎步",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖2.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 3,
            "description": "<p>原为玄门正宗步法，内息绵长，中正淳和，乃古之炼丹士行走于鼎上，观鼎中丹药所用。</p><p><strong>需求：</strong>徒手-腿法</p><p><strong>属性：</strong>太极</p>",
            "requirements": "徒手-腿法",
            "moves": [
                {
                    "name": "化玉断金",
                    "type": "real",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>抬腿高扫，直击面门，金气皆化，对目标造成伤害，若对方无架招，则你获得一层“九鼎”，至多九层，持续到战斗脱离或者切换武学套路。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "检测目标无架招并获得九鼎自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            },
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招获鼎",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = thisItem.effects.getName(\"九鼎\").toObject();\n    delete eff._id;\n    eff.origin = thisItem.uuid;\n    await game.xjzl.api.effects.addEffect(actor, eff);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "玄黄所滞",
                    "type": "feint",
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>双腿连踢，木去土质，对目标造成伤害，若击破架招，则依照自身“九鼎”状态层数的奇偶，触发以下效果。</p><p><strong>奇数：</strong>额外造成相当于“九鼎”状态层数*30 的毒素伤害。</p><p><strong>偶数：</strong>回复相当于“九鼎”状态层数*15 的气血。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "击破检测、层数奇偶判断及对应效果自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            },
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "九鼎奇偶效果",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const jiuding = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"jiuding\");\n    const stacks = jiuding ? (jiuding.getFlag(\"xjzl-system\", \"stacks\") || 1) : 0;\n    \n    if (stacks > 0) {\n        if (stacks % 2 !== 0) {\n            // 奇数：毒伤\n            const poisonDmg = stacks * 30;\n            await args.target.applyDamage({\n                amount: poisonDmg,\n                type: \"poison\",\n                attacker: actor,\n                isHit: true,\n                ignoreDefense: true\n            });\n            ui.notifications.info(`九鼎(奇${stacks}): 造成 ${poisonDmg} 毒伤`);\n        } else {\n            // 偶数：回血\n            const healAmt = stacks * 15;\n            await actor.applyHealing({ amount: healAmt, type: \"hp\", showScrolling: true });\n            ui.notifications.info(`九鼎(偶${stacks}): 回复 ${healAmt} 气血`);\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "九鼎护身",
                    "type": "stance",
                    "element": "taiji",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>双手虚抱，以凌乱步法扰乱对方判断，开启架招，格挡成功时，获得一层“九鼎”状态，持续到战斗脱离或者切换武学套路。</p><p><strong>升级：</strong>格挡值+10，内力消耗+4。</p>",
                    "automationNote": "格挡获鼎自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡获鼎",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\nconst eff = thisItem.effects.getName(\"九鼎\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\nawait game.xjzl.api.effects.addEffect(actor, eff);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "阴阳所化",
                    "type": "real",
                    "isUltimate": true,
                    "element": "taiji",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "5米",
                    "targetInfo": "范围",
                    "actionCost": "次要动作",
                    "description": "<p>阴阳相化，纠缠而生，使周身 5 米的场地陷入‘阴阳变’状态，持续一回合。</p><p><strong>阴阳变：</strong>区域内所有目标（包括友方和自己）的武学属性变化，阴阳倒转，刚柔相化，太极不变。</p><p><strong>升级：</strong>持续回合数+1，怒气消耗-1，消耗+8。</p>",
                    "automationNote": "消耗九鼎自动。场地效果为文字提示（手动处理属性变化）。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24,
                            32
                        ],
                        "rage": [
                            10,
                            9,
                            8,
                            7
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗九鼎与提示",
                            "trigger": "attack",
                            "script": "const jiuding = actor.effects.find(e => e.getFlag(\"xjzl-system\", \"slug\") === \"jiuding\");\nconst stacks = jiuding ? (jiuding.getFlag(\"xjzl-system\", \"stacks\") || 0) : 0;\n\nif (stacks < 5) {\n    args.flags.abort = true;\n    args.flags.abortReason = `九鼎层数不足 (需5层，当前${stacks})`;\n    return;\n}\n\nawait game.xjzl.api.effects.removeEffect(actor, \"jiuding\", 5);\n\nconst lvl = Math.max(1, args.move.computedLevel || 1);\nconst rounds = 1 + (lvl - 1);\n\nChatMessage.create({\n    content: `<div class=\"xjzl-chat-card\">\n        <div style=\"padding:5px; font-weight:bold; color:black;\">阴阳所化 - 场地效果</div>\n        <div style=\"font-size:0.9em;\">\n            <p>已消耗 5 层九鼎。</p>\n            <p>周身 5 米陷入 [阴阳变] (持续 ${rounds} 回合)。</p>\n            <p><i>效果：阴阳倒转，刚柔相化。</i></p>\n        </div>\n    </div>`,\n    speaker: ChatMessage.getSpeaker({actor: actor})\n});",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "九鼎",
                    "icon": "icons/containers/kitchenware/pot-cauldron-engraved-bronze.webp",
                    "description": "出招或受击可消耗以触发特效。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jiuding",
                            "stackable": true,
                            "maxStacks": 9,
                            "scripts": [
                                {
                                    "label": "阴生 (出招消耗)",
                                    "trigger": "attack",
                                    "active": true,
                                    "script": "const confirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"九鼎 - 阴生\" },\n    content: `<p>是否消耗 1 层九鼎触发 [阴生]？</p><ul><li>敌我受到30毒伤</li><li>虚招值+3</li></ul>`,\n    rejectClose: false\n});\n\nif (confirm) {\n    await game.xjzl.api.effects.removeEffect(actor, \"jiuding\", 1);\n    args.flags.bonusFeint += 3;\n    // 毒伤自己\n    await actor.applyDamage({ amount: 30, type: \"poison\", isHit: true, ignoreDefense: true });\n    // 标记后续毒伤对方\n    actor.tempJiudingYin = true;\n    ui.notifications.info(\"九鼎·阴生：虚招+3，自身受毒伤\");\n}"
                                },
                                {
                                    "label": "阴生 (毒伤目标)",
                                    "trigger": "hit",
                                    "active": true,
                                    "script": "if (actor.tempJiudingYin) {\n    await args.target.applyDamage({ amount: 30, type: \"poison\", attacker: actor, isHit: true, ignoreDefense: true });\n    ui.notifications.info(`九鼎·阴生：${args.target.name} 受毒伤`);\n    actor.tempJiudingYin = false;\n}"
                                },
                                {
                                    "label": "阳增 (受击消耗)",
                                    "trigger": "preDefense",
                                    "active": true,
                                    "script": "const confirm = await foundry.applications.api.DialogV2.confirm({\n    window: { title: \"九鼎 - 阳增\" },\n    content: `<p>是否消耗 1 层九鼎触发 [阳增]？</p><ul><li>敌我受到30毒伤</li><li>看破值+3</li></ul>`,\n    rejectClose: false\n});\n\nif (confirm) {\n    await game.xjzl.api.effects.removeEffect(actor, \"jiuding\", 1);\n    // 毒伤双方\n    await actor.applyDamage({ amount: 30, type: \"poison\", isHit: true, ignoreDefense: true });\n    if (args.attacker) {\n        await args.attacker.applyDamage({ amount: 30, type: \"poison\", attacker: actor, isHit: true, ignoreDefense: true });\n    }\n    \n    // 临时增加看破\n    const buffData = {\n        name: \"九鼎·阳增\",\n        icon: \"icons/svg/eye.svg\",\n        changes: [{key: \"system.combat.kanpo\", mode: 2, value: \"3\"}],\n        duration: { turns: 1 }\n    };\n    await game.xjzl.api.effects.addEffect(actor, buffData);\n    ui.notifications.info(\"九鼎·阳增：双方毒伤，看破+3\");\n}"
                                }
                            ]
                        }
                    },
                    "changes": []
                }
            ]
        }
    },
    {
        "name": "无生十指",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/江湖3.png",
        "system": {
            "category": "wuxue",
            "sect": "jianghushili",
            "tier": 3,
            "description": "<p>“非先有生，后说无生，本自不生，故名无生”</p><p>源自《无生老母临凡普渡众生宝卷十指家书》，蕴含无生老母回归真空家乡之奥，被此功杀死的人，周身宛如干尸，一身精血修为尽数被夺取。</p><p>它的前四指是地级武学，后六指是天级武学。</p><p><strong>需求：</strong>徒手-指法</p><p><strong>属性：</strong>柔</p>",
            "requirements": "徒手-指法",
            "moves": [
                {
                    "name": "一指皇胎家早回 来时欢喜去时悲",
                    "type": "real",
                    "element": "rou",
                    "tier": 2,
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "1米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>面无表情，指尖轻点额头，造成伤害，此招将目标打入死亡检定的场合，不进行死亡检定，而是直接死亡，魂飞魄散。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+2。</p>",
                    "automationNote": "致死检测自动。若目标濒死则直接判定死亡。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "直接致死",
                            "trigger": "hit",
                            "script": "if (args.damageResult.isDying || args.damageResult.isDead) {\n    await args.target.toggleStatusEffect(\"dead\", { overlay: true, active: true });\n    ChatMessage.create({\n        content: `<div style=\"color:red; font-weight:bold;\">${args.target.name} 魂飞魄散，直接死亡！</div>`,\n        speaker: ChatMessage.getSpeaker({actor: actor})\n    });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "二指东方儿女来 皇胎子女母婴孩",
                    "type": "feint",
                    "element": "rou",
                    "tier": 2,
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>二指连弹，落尽思愁，造成伤害，击破架招时，自己回复等同于自身悟性*2 的气血值。</p><p><strong>升级：</strong>招式伤害+20，内力消耗+2。</p>",
                    "automationNote": "击破回血自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破回血",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const heal = actor.system.stats.wuxing.total * 2;\n    await actor.applyHealing({ amount: heal, type: \"hp\", showScrolling: true });\n    ui.notifications.info(`击破架招，回血 ${heal}`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "三指中华外国娃 午时三刻快回家",
                    "type": "stance",
                    "element": "rou",
                    "tier": 2,
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>指尖连点三下，开启架招，格挡成功后，选择获得 1 点怒气或让敌人减少 1 点怒气。</p><p><strong>升级：</strong>格挡值+10，内力消耗+2。</p>",
                    "automationNote": "格挡后弹窗选择自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "格挡怒气选择",
                            "trigger": "damaged",
                            "script": "if (!Macros.checkStance(actor, args)) return;\n\nconst choice = await foundry.applications.api.DialogV2.wait({\n    window: { title: \"三指 - 格挡效果\" },\n    content: `<p>格挡成功，请选择：</p>`,\n    buttons: [\n        { action: \"gain\", label: \"获得 1 怒气\", icon: \"fas fa-plus\", callback: () => \"gain\" },\n        { action: \"drain\", label: \"敌人减 1 怒气\", icon: \"fas fa-minus\", callback: () => \"drain\" }\n    ],\n    close: () => null\n});\n\nif (choice === \"gain\") {\n    const current = actor.system.resources.rage.value;\n    const max = actor.system.resources.rage.max;\n    if (current < max) {\n        await actor.update({ \"system.resources.rage.value\": current + 1 });\n        ui.notifications.info(\"获得 1 怒气\");\n    }\n} else if (choice === \"drain\" && args.attacker) {\n    const current = args.attacker.system.resources.rage.value;\n    if (current > 0) {\n        await args.attacker.update({ \"system.resources.rage.value\": current - 1 });\n        ui.notifications.info(`${args.attacker.name} 失去 1 怒气`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "四指皇胎家早还 阿娘想破慈心肝",
                    "type": "real",
                    "isUltimate": true,
                    "element": "rou",
                    "tier": 2,
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "范围",
                    "actionCost": "蓄力动作",
                    "description": "<p>射出真气，如巨网一般，对周围敌人造成伤害，同时击飞所有敌人 4 米。</p><p><strong>升级：</strong>招式伤害+10，怒气消耗-1，内力消耗+8。</p>",
                    "automationNote": "击飞手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.7
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "ui.notifications.info(`${args.target.name} 被击飞 4 米`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "五指元来返正中 亲来东土唤儿童",
                    "type": "qi",
                    "element": "rou",
                    "tier": 3,
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "次要动作",
                    "description": "<p>单掌铺开念诵“无生老母真空家乡”，本回合内，若是成功杀死敌人，则将其精血内力通过指尖吸收，对方每开一条第一关经脉，获得修为 50 点，对方每开一条第二关经脉，气血内力上限+5，对方每开一条第三关经脉，全属性+1。</p><p>·这些属性均以“真空家乡”状态永久存在于你身上，无法被其他武学内功效果移除。</p><p><strong>升级：</strong>修为+50，气血内力+5，全属性+1，消耗+4。</p>",
                    "automationNote": "奖励结算手动。点击应用获得提示状态。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "真空家乡提示",
                            "trigger": "hit",
                            "script": "const eff = thisItem.effects.getName(\"真空家乡\").toObject();\ndelete eff._id;\neff.origin = thisItem.uuid;\n// 仅作为提示状态，无实际效果，持续1回合\neff.duration = { rounds: 1 };\nawait game.xjzl.api.effects.addEffect(actor, eff);\n\nChatMessage.create({\n    content: `<div class=\"xjzl-chat-card\">\n        <div style=\"padding:5px; font-weight:bold;\">五指 - 杀敌吸收</div>\n        <div style=\"font-size:0.9em;\">\n            <p>本回合击杀敌人后，请检查其经脉：</p>\n            <ul>\n                <li>第一关每条：修为 +50</li>\n                <li>第二关每条：气血/内力上限 +5</li>\n                <li>第三关每条：全属性 +1</li>\n            </ul>\n            <p><i>请手动添加永久修正或修改属性。</i></p>\n        </div>\n    </div>`,\n    speaker: ChatMessage.getSpeaker({actor: actor})\n});",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "六指乾坤点六合 为娘教子早登科",
                    "type": "counter",
                    "isUltimate": true,
                    "element": "rou",
                    "tier": 3,
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你被绝招攻击时，可消耗反应动作施展此招，压制对方的绝招，六指合分，造成伤害，并为目标添加“禁气”，持续到脱战。</p><p><strong>禁气：</strong>无法施展气招。</p><p><strong>升级：</strong>招式伤害+20，怒气消耗-1，消耗+8。</p>",
                    "automationNote": "命中添加禁气自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 1.0
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24,
                            32
                        ],
                        "rage": [
                            8,
                            7,
                            6,
                            5
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加禁气",
                            "trigger": "hit",
                            "script": "await game.xjzl.api.effects.addEffect(args.target, \"jinqi\");\nui.notifications.info(`${args.target.name} 被施加禁气`);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "七指坤元妇道流 同登海上乐三洲",
                    "type": "qi",
                    "element": "rou",
                    "tier": 3,
                    "damageType": "none",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "反应动作",
                    "description": "<p>当被攻击时，可消耗反应动作释放，若攻击者与自身性别相同，本次攻击造成的伤害-20，若攻击者与自身性别不同，本次攻击命中-5。</p><p><strong>升级：</strong>减少的伤害+20，命中减少+5，消耗+4。</p>",
                    "automationNote": "性别判定及减值自动。若异性需手动判断未命中。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "性别防御",
                            "trigger": "preDefense",
                            "script": "const attGender = args.attacker.system.info?.gender;\nconst myGender = actor.system.info?.gender;\nconst moveData = thisItem.system.moves.find(m => m.name.startsWith(\"七指\"));\nconst computedLvl = moveData ? (moveData.computedLevel || 1) : 1;\n\nif (attGender && myGender) {\n    if (attGender === myGender) {\n        const dmgRed = 20 + (computedLvl - 1) * 20;\n        args.config.amount -= dmgRed;\n        ui.notifications.info(`七指(同性)：伤害减少 ${dmgRed}`);\n    } else {\n        const hitPen = 5 + (computedLvl - 1) * 5;\n        ui.notifications.warn(`七指(异性)：对方命中应 -${hitPen}。若因此未中，请手动忽略伤害。`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "八指南针定卦书 玉龙宝马负鸿图",
                    "type": "real",
                    "element": "rou",
                    "tier": 3,
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "2米",
                    "targetInfo": "单体",
                    "actionCost": "主要动作",
                    "description": "<p>一指击丹田，之后七指连出不差分毫，造成伤害，若击中无架招目标，击散目标丹田内储存的一半修为。</p><p>·若目标现在没有反应动作，则可以消耗次要动作对其再施展一次本招式。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "击散修为手动。连击判断手动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "效果提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ui.notifications.info(`命中无架招：请GM手动扣除目标一半修为！`);\n}\nui.notifications.info(\"若目标无反应动作，可消耗次要动作连击。\");",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "九指宫开天上学 西方佛子唤同胞",
                    "type": "counter",
                    "element": "rou",
                    "tier": 3,
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "range": "3米",
                    "targetInfo": "单体",
                    "actionCost": "反应动作",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作释放此招，压制目标虚招，九指齐出，对其造成伤害，若击中无架招目标，则为其添加“封招”，持续一回合。</p><p><strong>升级：</strong>招式伤害+10，内力消耗+4。</p>",
                    "automationNote": "命中无架招施加封招自动。",
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招封招",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const eff = CONFIG.statusEffects.find(e => e.id === \"fengzhao\");\n    if (eff) {\n        const data = foundry.utils.deepClone(eff);\n        data.duration = { rounds: 1 };\n        await game.xjzl.api.effects.addEffect(args.target, data);\n        ui.notifications.info(`${args.target.name} 被封招`);\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "十指家书天下闻 儿拆母信便知因",
                    "type": "stance",
                    "element": "rou",
                    "tier": 3,
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "range": "自身",
                    "targetInfo": "自身",
                    "actionCost": "主要动作",
                    "description": "<p>双手合十，开启架招。进入“天下闻”，持续到战斗脱离或解除架招。</p><p><strong>天下闻：</strong>你投掷 1 颗 d20 并记录，当敌人攻击骰投掷到相同数字时，视为丢出 1。</p><p><strong>升级：</strong>格挡值+10，多投掷一颗 d20，消耗+4。</p>",
                    "automationNote": "开启时自动投掷记录。防御时需人工比对数字。",
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12,
                            16
                        ]
                    },
                    "scripts": [
                        {
                            "label": "天下闻记录",
                            "trigger": "attack",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst diceCount = 1 + (lvl - 1);\nconst r = await new Roll(`${diceCount}d20`).evaluate();\nif (game.dice3d) game.dice3d.showForRoll(r, game.user, true);\n\nconst results = r.terms[0].results.map(res => res.result).join(\", \");\n\nChatMessage.create({\n    content: `<div class=\"xjzl-chat-card\">\n        <div style=\"padding:5px; font-weight:bold;\">天下闻 - 点数记录</div>\n        <div style=\"font-size:1.2em; text-align:center; color:darkred;\">${results}</div>\n        <div style=\"font-size:0.8em; color:#555;\">敌人若投出以上数字，视为大失败(1)。</div>\n    </div>`,\n    speaker: ChatMessage.getSpeaker({actor: actor})\n});",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "真空家乡",
                    "icon": "icons/magic/symbols/runes-star-blue.webp",
                    "description": "标记状态。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "zhenkongjiaxiang",
                            "stackable": false
                        }
                    },
                    "changes": []
                }
            ]
        }
    }
]