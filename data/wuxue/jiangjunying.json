[
    {
        "name": "兵家拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>集昂拳、南兵拳、三星拳等各洲军营卫所拳术之大成，每个动作都有技击含义，讲究一招制敌。</p>",
            "requirements": "徒手",
            "moves": [
                {
                    "name": "备战待敌",
                    "type": "stance",
                    "element": "yang",
                    "weaponType": "unarmed",
                    "description": "<p>次要动作，左拳抬起，右拳下护，开启架招。格挡成功时，获得 5 点士气。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "scripts": [
                        {
                            "label": "格挡回士气",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args) && S.combat.blockTotal > 0) {\n    const current = S.resources.morale.value;\n    await actor.update({ \"system.resources.morale.value\": current + 5 });\n    ui.notifications.info(\"格挡成功，士气+5\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "弓步冲拳",
                    "type": "real",
                    "element": "yang",
                    "weaponType": "unarmed",
                    "description": "<p>主要动作，左脚弓步，右拳旋出，对目标造成 0.4 力量点外功伤害，若目标无架招，将其击飞 1 米。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "无架招击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ChatMessage.create({ content: `${args.target.name} 未开启架招，被击飞 1 米！` });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "穿喉弹踢",
                    "type": "feint",
                    "element": "yang",
                    "weaponType": "unarmed",
                    "description": "<p>主要动作，左掌插喉，右腿弹踢，对目标造成 0.3 力量点外功伤害。击破架招时，目标痛苦捂喉，进行一次残疾检定，且具有劣势。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "残疾检定提示",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    ChatMessage.create({ content: `<div style='color:red;font-weight:bold'>击破架招！</div>${args.target.name} 痛苦捂喉，请手动进行一次 <b>残疾检定</b> (劣势)。` });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "弹裆顶肘",
                    "type": "counter",
                    "element": "yang",
                    "weaponType": "unarmed",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招。压制对方虚招，脚踢裆腹，肘顶心窝，给对方造成 0.5 力量点外功伤害。目标痛苦捂裆，进行一次残疾检定，且具有劣势。</p>",
                    "actionCost": "反应动作",
                    "range": "1米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "残疾检定提示",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    ChatMessage.create({ content: `${args.target.name} 痛苦捂裆，请手动进行一次 <b>残疾检定</b> (劣势)。` });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "击腰锁喉",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "weaponType": "unarmed",
                    "description": "<p>主要动作，击拳锁颈，回拉下压，对敌人造成 0.6 力量点外功伤害，并顺势将目标擒抱（挣脱难度 15）。</p>",
                    "actionCost": "主要动作",
                    "range": "2米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "施加擒抱(禁足)",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    await game.xjzl.api.effects.addEffect(args.target, \"root\");\n    ui.notifications.info(`${args.target.name} 被擒抱(禁足)！挣脱难度 15。`);\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "破锋八刀",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>西北军卒所修刀法，讲究快马轻刀，招招干净利落，刀刀中敌要害，专克枪剑等擅刺兵器。</p>",
            "requirements": "刀",
            "moves": [
                {
                    "name": "攻城拔寨",
                    "type": "real",
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>主要动作，迎面劈锋，跟步按刀，对目标造成 0.4 力量点外功伤害，若目标架招是剑或棍，招式伤害 +10 点。<br>·若在骑马时施展，将命中目标击退 1 米。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "克制剑棍伤害修正",
                            "trigger": "preDamage",
                            "script": "const targetWeapon = args.target.itemTypes.weapon.find(w => w.system.equipped);\nif (targetWeapon) {\n    const type = targetWeapon.system.type;\n    if (type === 'sword' || type === 'staff') {\n        args.config.amount += 10;\n        ui.notifications.info(\"克制剑/棍！伤害+10\");\n    }\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "若目标装备剑或棍，伤害自动+10。骑马击退效果需手动处理。"
                },
                {
                    "name": "连环提柳",
                    "type": "real",
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>当你受到剑或棍的招式攻击时，可消耗反应动作施展，撩刀削手，对目标造成 0.3 力量点外功伤害。<br>·若在骑马时施展，该招式不消耗动作。</p>",
                    "actionCost": "反应动作",
                    "range": "1米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "automationNote": "骑马不消耗动作需玩家手动处理（不扣除反应资源）。"
                },
                {
                    "name": "推门看山",
                    "type": "stance",
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>次要动作，掉手横刀，开启架招。格挡成功时，获得一层“刚劲”，至多三层，持续到战斗脱离。<br>刚劲：每层使你的刚属性武学招式伤害+5。<br>·若在骑马时格挡成功，额外获得一层刚劲。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "scripts": [
                        {
                            "label": "格挡获刚劲",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args) && S.combat.blockTotal > 0) {\n    await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"刚劲\"));\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "若骑马格挡成功，请手动额外添加一层刚劲。"
                },
                {
                    "name": "镇关守国",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>主要动作，力达一线，顶花劈刀，对敌人造成 0.6 力量点外功伤害，若目标手持剑或棍，为其添加“缴械”，持续一回合。<br>缴械：你无法施展徒手以外的武学。<br>·若在骑马时施展，招式变为范围招式，攻击周围敌人。</p>",
                    "actionCost": "主要动作",
                    "range": "2米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "克制缴械",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const targetWeapon = args.target.itemTypes.weapon.find(w => w.system.equipped);\n    if (targetWeapon) {\n        const type = targetWeapon.system.type;\n        if (type === 'sword' || type === 'staff') {\n            await game.xjzl.api.effects.addEffect(args.target, \"jiaoxie\");\n            ui.notifications.info(`${args.target.name} 被缴械！`);\n        }\n    }\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "检测到目标装备剑或棍时自动施加缴械状态。骑马变AOE需玩家手动选择多个目标。"
                }
            ],
            "effects": [
                {
                    "name": "刚劲",
                    "icon": "icons/svg/explosion.svg",
                    "description": "每层使你的刚属性武学招式伤害+5。",
                    "changes": [
                        {
                            "key": "system.combat.damages.gang.mod",
                            "mode": 2,
                            "value": 5
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "stackable": true,
                            "maxStacks": 3
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "破阵枪法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>南宋辛弃疾所传搏杀枪术，大开大合，气势迫人。</p>",
            "requirements": "棍-长枪",
            "moves": [
                {
                    "name": "醉里挑灯",
                    "type": "stance",
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>次要动作，直立挑枪，开启架招。每次成功格挡时，获得一层“挑灯”，至多百层，持续到脱战。<br>挑灯：外功防御+1。<br>·若在骑马时格挡成功，额外获得一层挑灯。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "scripts": [
                        {
                            "label": "格挡获挑灯",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args) && S.combat.blockTotal > 0) {\n    await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"挑灯\"));\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "若骑马格挡成功，请手动额外添加一层挑灯。"
                },
                {
                    "name": "风吹雪打",
                    "type": "real",
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>主要动作，长棍如鞭，砸击地面，对敌人造成 0.4 力量点外功伤害。<br>·若在骑马时施展，将命中的目标击倒。</p>",
                    "actionCost": "主要动作",
                    "range": "3米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "automationNote": "骑马击倒效果需手动添加状态 (系统状态: 倒地/Prone)。"
                },
                {
                    "name": "沙场点兵",
                    "type": "qi",
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "actionType": "buff",
                    "description": "<p>次要动作，枪指敌方，周围 5 米内每有一个敌人，自身获得一层“挑灯”，持续到战斗脱离。<br>·若在骑马时施展，招式范围提升 5 米。</p>",
                    "actionCost": "次要动作",
                    "range": "5米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "scripts": [
                        {
                            "label": "手动获得挑灯",
                            "trigger": "attack",
                            "script": "const count = await foundry.applications.api.DialogV2.prompt({\n    window: { title: \"沙场点兵\" },\n    content: \"<p>范围内有多少个敌人？</p><input type='number' value='1'>\",\n    ok: { callback: (e, b) => b.form.elements[0].value }\n});\nif (count > 0) {\n    for(let i=0; i<count; i++) await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"挑灯\"));\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "霹雳惊雷",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>主要动作，一声怒吼，持枪对目标造成 0.6 力量点外功伤害。<br>·若在骑马时施展，变招为横扫，对周围敌人造成伤害，且每击中一个目标，获得一层“挑灯”，持续到战斗脱离。</p>",
                    "actionCost": "主要动作",
                    "range": "3米",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "automationNote": "骑马变AOE需手动处理。若骑马命中，请手动给自己添加挑灯层数。"
                }
            ],
            "effects": [
                {
                    "name": "挑灯",
                    "icon": "icons/svg/light.svg",
                    "description": "外功防御+1。",
                    "changes": [
                        {
                            "key": "system.combat.def_waigong",
                            "mode": 2,
                            "value": 1
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "stackable": true,
                            "maxStacks": 100
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "大风弓",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>开弓时以“风”“大风”为号而得名，箭借风势，威力陡增，连绵不绝，由军中弓兵、游骑所习。</p>",
            "requirements": "奇门-弓",
            "moves": [
                {
                    "name": "弓马娴熟",
                    "type": "stance",
                    "element": "yang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>次要动作，握弓勾弦，开启架招，同时进入“游击”状态，持续到战斗脱离或被击破架招。<br>游击：你的移动速度+1；若在本场战斗中你未曾对一个目标造成过伤害，且该目标也未曾攻击过你，你对其攻击时伤害+10。<br>·若在骑马时，你的骑乘马匹也被添加“游击”。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "scripts": [
                        {
                            "label": "应用游击",
                            "trigger": "attack",
                            "script": "await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"游击\"));\nui.notifications.info(\"进入游击状态\");",
                            "active": true
                        }
                    ],
                    "automationNote": "对未交互目标的伤害加成 (+10) 需玩家手动判断并添加修正。马匹Buff需手动添加。"
                },
                {
                    "name": "风劲弓鸣",
                    "type": "real",
                    "element": "yang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>主要动作，策风搭箭，对目标造成 0.4 力量点外功伤害后获得一层“乘风”，至多三层持续到脱战。<br>乘风：每层使你速度+1。<br>·若在骑马时施展，招式提升马匹速度的伤害。</p>",
                    "actionCost": "主要动作",
                    "range": "10米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "命中获乘风",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    await game.xjzl.api.effects.addEffect(actor, \"chengfeng\");\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "骑马速度加伤需手动在弹窗中添加数值修正。"
                },
                {
                    "name": "暗箭难防",
                    "type": "counter",
                    "element": "yang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招。压制对方虚招，冷箭瞬发，给对方造成 0.5 力量点外功伤害。<br>若你处于“游击”状态，你每有 1 点移动速度，招式伤害+1。</p>",
                    "actionCost": "反应动作",
                    "range": "10米",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "游击速度加伤",
                            "trigger": "calc",
                            "script": "if (actor.effects.some(e => e.name === \"游击\")) {\n    const speed = S.combat.speedTotal || 0;\n    args.output.damage += speed;\n    args.output.bonusDesc.push(`游击速度加成: +${speed}`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "风旋羽掣",
                    "type": "real",
                    "isUltimate": true,
                    "element": "yang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>主要动作，大喊风！风！风！射出爆鸣，对目标造成 0.6 力量点外功伤害，同时将其击倒。<br>·若在骑马时施展，且你处于“游击”状态，你可以移除游击，不消耗动作施展一次【风劲弓鸣】。</p>",
                    "actionCost": "主要动作",
                    "range": "10米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒目标",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    await game.xjzl.api.effects.addEffect(args.target, \"prone\");\n    ui.notifications.info(`${args.target.name} 被击倒！`);\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "触发骑马连招时，请手动移除游击状态并施展【风劲弓鸣】（勾选免费施展）。"
                }
            ],
            "effects": [
                {
                    "name": "游击",
                    "icon": "icons/svg/wing.svg",
                    "description": "移动速度+1。",
                    "changes": [
                        {
                            "key": "system.combat.speed",
                            "mode": 2,
                            "value": 1
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "stackable": false
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "杨家枪法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>“夫长枪之法始于杨氏，谓之曰‘梨花’”，宋朝杨妙真所创马战枪法，也叫梨花枪法，其进锐，其势险，极受军中将军推崇。</p>",
            "requirements": "棍-长枪，骁骑营",
            "moves": [
                {
                    "name": "银蛇出洞",
                    "type": "real",
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>主要动作，左手摔后，右手举枪前刺，对目标造成 0.5 力量点外功伤害，然后自身进入“威风”，持续两回合。<br>威风：每次造成伤害时自身士气+5，敌人士气-5。<br>·若在骑马时，“威风”增减的士气再+5。</p>",
                    "actionCost": "主要动作",
                    "range": "2米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得威风",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"威风\"));\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "威风效果中的骑马额外加成需手动处理。"
                },
                {
                    "name": "长驱直入",
                    "type": "feint",
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>主要动作，枪尖布花，前倾疾刺，对至多两个目标造成 0.4 力量点外功伤害。击破架招时，使目标陷入“破甲”，持续三回合。<br>破甲：你的外功防御归零。<br>·若在骑马时施展，施展前每移动 5 米，虚招值+1（至多+3）。</p>",
                    "actionCost": "主要动作",
                    "range": "2米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破施加破甲",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.addEffect(args.target, \"pojia\");\n    // 破甲默认无持续时间，或根据配置。这里规则说持续三回合。系统通用破甲通常是永久或手动。如果需要3回合，应该修改 duration。\n    // 修正：调用 addEffect 后返回的是 Effect Document，可以 update duration。\n    // 但简单起见，这里假设系统破甲状态默认配置正确，或者让玩家手动管理。\n    // 如果需要严格3回合，应该自定义一个带时间的破甲或者 update。\n    // 鉴于 \"pojia\" 是系统通用状态，通常是被动。这里特殊赋予持续时间比较麻烦。建议在 automationNote 提示手动移除或 GM 修改。\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "破甲状态持续3回合需手动移除。骑马移动带来的虚招加值需手动在弹窗中调整。"
                },
                {
                    "name": "横江飞渡",
                    "type": "qi",
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "actionType": "buff",
                    "description": "<p>招式仅可在骑马时释放，主要动作，臂夹枪，腿夹马，进入“骠骑”状态，持续到脱战或下马。<br>骠骑：你当前骑乘的马匹速度+5，你在马匹上的下一次攻击提升马匹速度*1 的伤害。</p>",
                    "actionCost": "主要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "scripts": [
                        {
                            "label": "开启骠骑",
                            "trigger": "attack",
                            "script": "await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"骠骑\"));\nui.notifications.info(\"骠骑状态已应用，下一次攻击伤害提升。\");",
                            "active": true
                        }
                    ],
                    "automationNote": "需手动确认是否骑马。马匹速度提升需手动调整。"
                },
                {
                    "name": "回马枪",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>主要动作，回身一枪，对目标造成 0.8 力量点外功伤害，若目标处于“破甲”，需进行[韧性]检定（难度 15），失败则枪刺额头，目标进行死亡检定。<br>·若在骑马时施展，施展前每移动 5 米，[韧性]检定难度+1。</p>",
                    "actionCost": "主要动作",
                    "range": "3米",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "破甲致死检定",
                            "trigger": "hit",
                            "script": "if (args.target.effects.some(e => e.name === \"破甲\" || e.flags[\"xjzl-system\"]?.slug === \"pojia\")) {\n    await Macros.requestSave({\n        target: args.target,\n        attacker: actor,\n        type: \"renxing\",\n        dc: 15,\n        label: \"回马枪·韧性检定\",\n        failureText: `<span style='color:red;font-weight:bold'>检定失败！</span> ${args.target.name} 需立即进行 <b>死亡检定</b>。`\n    });\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "骑马移动增加检定难度需手动告知目标。"
                }
            ],
            "effects": [
                {
                    "name": "威风",
                    "icon": "icons/svg/aura.svg",
                    "description": "每次造成伤害时自身士气+5，敌人士气-5。",
                    "duration": {
                        "rounds": 2
                    },
                    "flags": {
                        "xjzl-system": {
                            "slug": "weifeng",
                            "scripts": [
                                {
                                    "trigger": "hit",
                                    "label": "威风士气变动",
                                    "script": "if (args.type === 'attack') { await actor.update({'system.resources.morale.value': S.resources.morale.value + 5}); if (args.target.system?.resources?.morale) await args.target.update({'system.resources.morale.value': Math.max(0, args.target.system.resources.morale.value - 5)}); }"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "骠骑",
                    "icon": "icons/svg/horse.svg",
                    "description": "马匹速度+5，下一次攻击提升马匹速度*1 的伤害。",
                    "flags": {
                        "xjzl-system": {
                            "slug": "piaoqi",
                            "scripts": [
                                {
                                    "trigger": "calc",
                                    "script": "const speed = S.combat.speedTotal || 0; const ratio = 1 + (args.move.computedLevel - 1); args.output.damage += speed * ratio; args.output.bonusDesc.push('骠骑冲锋加成'); await thisEffect.delete();"
                                }
                            ]
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "射雕弓",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>边军所修武学，可射落金雕，力道极为强劲，若有雁群经过，亦如雨般跌落。</p>",
            "requirements": "奇门-弓，射声营",
            "moves": [
                {
                    "name": "弯弓饮羽",
                    "type": "real",
                    "element": "gang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>主要动作，满弓劲射，对目标造成 0.5 力量点外功伤害，然后自己获得一层“饮羽”，持续到脱战。<br>饮羽：叠加 2 层后，再施展【弯弓饮羽】时移除所有“饮羽”，使招式伤害+10 点。<br>·若有人处于半空中，可以消耗反应动作释放此招，立于原地，射击目标，对其造成伤害。</p>",
                    "actionCost": "主要动作",
                    "range": "15米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "饮羽增伤计算",
                            "trigger": "calc",
                            "script": "const effect = actor.effects.find(e => e.name === \"饮羽\");\nif (effect && (effect.getFlag(\"xjzl-system\", \"stacks\") || 1) >= 2) {\n    args.output.damage += 10;\n    args.output.bonusDesc.push(\"饮羽爆发: +10\");\n}",
                            "active": true
                        },
                        {
                            "label": "饮羽层数管理",
                            "trigger": "hit",
                            "script": "const effect = actor.effects.find(e => e.name === \"饮羽\");\nif (effect && (effect.getFlag(\"xjzl-system\", \"stacks\") || 1) >= 2) {\n    await effect.delete();\n    ui.notifications.info(\"饮羽效果触发，层数清空\");\n} else {\n    await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"饮羽\"));\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "例无虚发",
                    "type": "feint",
                    "element": "gang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>主要动作，挽强弓，发长箭，对目标造成 0.4 力量点外功伤害，击破架招后，使目标陷入“下盘不稳”，持续三回合。然后自身获得 10 点士气。</p>",
                    "actionCost": "主要动作",
                    "range": "15米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破施加不稳",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.addEffect(args.target, \"unstable\");\n    // unstable 是系统状态，默认可能无时间或永久。这里规则是3回合。建议 automationNote 说明需手动移除或调整。\n    await actor.update({ \"system.resources.morale.value\": S.resources.morale.value + 10 });\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "下盘不稳状态持续3回合需手动管理。"
                },
                {
                    "name": "落雁惊鸿",
                    "type": "stance",
                    "element": "gang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>次要动作，弓弦抱月，开启架招。格挡成功后，为自身添加“落雁”，持续二回合或被击破架招。<br>落雁：你免疫下盘不稳、禁足、缚身。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "scripts": [
                        {
                            "label": "格挡获落雁",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args) && S.combat.blockTotal > 0) {\n    await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"落雁\"));\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "万箭穿云",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "weaponType": "special",
                    "weaponSubtype": "弓",
                    "description": "<p>主要动作，抽弓急射，对目标造成 0.8 力量点外功伤害，并将其击退 3 米。<br>·战场上每有一个友方拥有士气，招式伤害+5。（至多+30）</p>",
                    "actionCost": "主要动作",
                    "range": "20米",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击退效果",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    ChatMessage.create({ content: `${args.target.name} 被击退 3 米！` });\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "友方士气带来的伤害加成需玩家手动在弹窗中添加。"
                }
            ],
            "effects": [
                {
                    "name": "饮羽",
                    "icon": "icons/svg/target.svg",
                    "description": "叠加标记，满2层触发爆发伤害。",
                    "flags": {
                        "xjzl-system": {
                            "stackable": true,
                            "maxStacks": 2
                        }
                    }
                },
                {
                    "name": "落雁",
                    "icon": "icons/svg/wing.svg",
                    "description": "免疫下盘不稳、禁足、缚身 (需手动处理免疫)。",
                    "duration": {
                        "rounds": 2
                    }
                }
            ]
        }
    },
    {
        "name": "岳家枪法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>传承自名将岳飞的军中武技，号称枪中之王。动作古朴沉缓，但招招制敌，一击必杀。</p>",
            "requirements": "棍-长枪，尽忠营",
            "moves": [
                {
                    "name": "大漠孤烟",
                    "type": "real",
                    "element": "yang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>蓄力动作，翻身倒枪，柄击地面，对前方直线范围攻击，对所有敌人造成 0.4 力量点外功伤害。<br>若对方处于“下盘不稳”，则此招必定命中且击倒对方。</p>",
                    "actionCost": "蓄力动作",
                    "range": "3米直线",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "不稳必中判定",
                            "trigger": "check",
                            "script": "if (args.target.effects.some(e => e.name === \"下盘不稳\" || e.flags[\"xjzl-system\"]?.slug === \"unstable\")) {\n    args.flags.forceHit = true;\n}",
                            "active": true
                        },
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "if (args.forceHit) {\n    await game.xjzl.api.effects.addEffect(args.target, \"prone\");\n    ui.notifications.info(`${args.target.name} 被击倒！`);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "精忠报国",
                    "type": "stance",
                    "element": "yang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>次要动作，立身稳持，枪尖对敌，开启架招。架招开启期间，当敌人在你周围 3 米范围对他人造成伤害时，你可以消耗反应动对其施展【大漠孤烟】。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    }
                },
                {
                    "name": "踏破山缺",
                    "type": "counter",
                    "element": "yang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "description": "<p>当你看破对方虚招时，可消耗反应动作施展此招。压制对方虚招，提枪膝撞，回身飞刺，给对方造成 0.6 力量点外功伤害。<br>同时给目标添加“错骨”，持续一回合。</p>",
                    "actionCost": "反应动作",
                    "range": "3米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "添加错骨",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    await game.xjzl.api.effects.addEffect(args.target, \"cuogu\");\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "错骨状态持续1回合需手动管理。"
                },
                {
                    "name": "壮怀激烈",
                    "type": "qi",
                    "element": "yang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "actionType": "buff",
                    "description": "<p>主要动作，提枪邀敌，豪气冲天，你获得 1 点怒气，并获得 10 点士气。</p>",
                    "actionCost": "主要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "scripts": [
                        {
                            "label": "回复怒气士气",
                            "trigger": "attack",
                            "script": "const currentRage = S.resources.rage.value;\nconst maxRage = S.resources.rage.max;\nawait actor.update({\n    \"system.resources.rage.value\": Math.min(maxRage, currentRage + 1),\n    \"system.resources.morale.value\": S.resources.morale.value + 10 + (args.move.computedLevel - 1) * 10\n});\nui.notifications.info(\"获得1点怒气与大量士气\");",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "怒发冲冠",
                    "type": "qi",
                    "isUltimate": true,
                    "element": "yang",
                    "weaponType": "staff",
                    "weaponSubtype": "长枪",
                    "actionType": "buff",
                    "description": "<p>次要动作，矗枪仰天，岳峙渊渟，一往无前，你进入“怒发冲冠”，持续三回合。<br>怒发冲冠：你的招式伤害+10 点；你的每个回合初自身获得 10 点士气。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20
                    },
                    "scripts": [
                        {
                            "label": "开启怒发冲冠",
                            "trigger": "attack",
                            "script": "await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"怒发冲冠\"));",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "怒发冲冠",
                    "icon": "icons/svg/explosion.svg",
                    "description": "招式伤害+10 (每级再+10)，每回合初获得10士气。",
                    "duration": {
                        "rounds": 3
                    },
                    "changes": [
                        {
                            "key": "system.combat.damages.global.mod",
                            "mode": 2,
                            "value": 10
                        }
                    ],
                    "flags": {
                        "xjzl-system": {
                            "slug": "nufachongguan",
                            "scripts": [
                                {
                                    "trigger": "turnStart",
                                    "script": "await actor.update({'system.resources.morale.value': S.resources.morale.value + 10}); ui.notifications.info('怒发冲冠: 士气+10');"
                                }
                            ]
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "荡寇刀法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "wuxue",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>平战乱，定乾坤，夺旗斩将，陷阵先登。</p>",
            "requirements": "刀，尽忠营",
            "moves": [
                {
                    "name": "披坚执锐",
                    "type": "stance",
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>次要动作，持刀不退，开启架招。格挡成功时，获得一层“战意”，至多三层，持续到战斗脱离。<br>战意：每层使你在回合初士气+5。</p>",
                    "actionCost": "次要动作",
                    "range": "自身",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "scripts": [
                        {
                            "label": "格挡获战意",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args) && S.combat.blockTotal > 0) {\n    await game.xjzl.api.effects.addEffect(actor, thisItem.effects.getName(\"战意\"));\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "克敌制胜",
                    "type": "feint",
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>主要动作，挥刀砍杀，对目标造成 0.4 力量点外功伤害。击破对方架招时，使对方陷入“溃散”，持续一回合，你还可以消耗一层“战意”，将对方击飞 1 米。<br>溃散：你每回合初士气-20。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破施加溃散与击飞",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.addEffect(args.target, thisItem.effects.getName(\"溃散\"));\n    \n    if (game.xjzl.api.effects.removeEffect(actor, \"战意\", 1)) {\n        ChatMessage.create({ content: `${args.target.name} 被战意击飞 1 米！` });\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "马革裹尸",
                    "type": "real",
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>主要动作，奋勇不惧，拼死杀敌，对目标造成 0.5 力量点外功伤害。<br>若有人处于半空中，可以消耗反应动作释放此招，猛跃而起，在半空中冲锋追砍，造成伤害。</p>",
                    "actionCost": "主要动作",
                    "range": "1米",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    }
                },
                {
                    "name": "战鼓宣天",
                    "type": "real",
                    "isUltimate": true,
                    "element": "gang",
                    "weaponType": "blade",
                    "description": "<p>蓄力动作，军旗摇动，擂鼓怒吼，对周围敌人造成 0.6 力量点内功伤害，给范围内友方添加“金鼓”，持续三回合；给范围内敌人添加“溃散”，持续三回合。<br>金鼓：每回合初获得 10 点士气。<br>·你每消耗一层战意，本招式命中提升 10 点，金鼓提供的士气+10。<br>溃散：你每回合初士气-20。</p>",
                    "actionCost": "蓄力动作",
                    "range": "5米",
                    "damageType": "neigong",
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "消耗战意增强命中",
                            "trigger": "attack",
                            "script": "const effect = actor.effects.find(e => e.name === \"战意\");\nif (effect) {\n    const stacks = effect.getFlag(\"xjzl-system\", \"stacks\") || 1;\n    args.flags.bonusHit += stacks * 10;\n    await effect.delete();\n    ui.notifications.info(`消耗 ${stacks} 层战意，命中+${stacks*10}`);\n}",
                            "active": true
                        },
                        {
                            "label": "施加状态",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    await game.xjzl.api.effects.addEffect(args.target, thisItem.effects.getName(\"溃散\"));\n}",
                            "active": true
                        }
                    ],
                    "automationNote": "友方金鼓状态需手动添加。消耗战意带来的金鼓加成需手动调整。"
                }
            ],
            "effects": [
                {
                    "name": "战意",
                    "icon": "icons/svg/combat.svg",
                    "description": "每层使你在回合初士气+5。",
                    "flags": {
                        "xjzl-system": {
                            "stackable": true,
                            "maxStacks": 3,
                            "slug": "zhanyi",
                            "scripts": [
                                {
                                    "trigger": "turnStart",
                                    "script": "const stacks = thisEffect.getFlag('xjzl-system', 'stacks') || 1; await actor.update({'system.resources.morale.value': S.resources.morale.value + (5 * stacks)}); ui.notifications.info('战意回复士气');"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "溃散",
                    "icon": "icons/svg/downgrade.svg",
                    "description": "每回合初士气-20。",
                    "duration": {
                        "rounds": 1
                    },
                    "flags": {
                        "xjzl-system": {
                            "slug": "kuisan",
                            "scripts": [
                                {
                                    "trigger": "turnStart",
                                    "script": "if(S.resources.morale) await actor.update({'system.resources.morale.value': Math.max(0, S.resources.morale.value - 20)}); ui.notifications.info('溃散流失士气');"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "金鼓",
                    "icon": "icons/svg/sound.svg",
                    "description": "每回合初获得 10 点士气。",
                    "duration": {
                        "rounds": 3
                    },
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "jingu",
                            "scripts": [
                                {
                                    "trigger": "turnStart",
                                    "script": "await actor.update({'system.resources.morale.value': S.resources.morale.value + 10});"
                                }
                            ]
                        }
                    }
                }
            ]
        }
    },
    {
        "name": "漫天箭雨",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>百步穿杨落雕兵，天雄神射震鸣镝，弦满明月半，激射如流星，引弓射之，百发百中。</p>",
            "moves": [
                {
                    "name": "漫天箭雨",
                    "type": "real",
                    "element": "gang",
                    "damageType": "liushi",
                    "weaponType": "special",
                    "range": "15",
                    "requirements": "奇门-弓",
                    "description": "<p>蓄力动作，挽弓指天，急速抛射箭矢，在目标空格及其周围 3 米范围形成‘箭雨’，持续三回合。</p><p><strong>箭雨：</strong>每回合第一次进入此范围或在此范围开始回合的敌人和其他友方受到 10 点气血流失，且获得一层“流血”，持续到战斗脱离。</p><p>·招式将根据消耗箭矢的品级，提升箭雨的气血流失数值：<br>凡品+0，铜品+5，银品+10，金品+30，玉品+100。</p><p><strong>升级：</strong>箭雨气血流失伤害+5，内力消耗+2。</p>",
                    "automationNote": "箭矢消耗、箭雨区域伤害及品级加成需手动处理。流血状态请使用通用特效。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "actionCost": "蓄力动作"
                }
            ]
        }
    },
    {
        "name": "士气如虹",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>将军营士卒因其意志坚定，斗志昂扬，士气极盛，常以一鼓作气击败敌人，难以被挫折击败。</p>",
            "requirements": "《百战诀》修炼圆满",
            "moves": [
                {
                    "name": "士气如虹",
                    "type": "real",
                    "damageType": "none",
                    "weaponType": "none",
                    "description": "<p>你进入战斗时，获得 10 点士气。<br>你出招将敌人打入濒死时，获得 10 点士气。<br><strong>升级：</strong>进入战斗和将人打入濒死获得的士气+5。</p>",
                    "automationNote": "完全自动化。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "scripts": [
                        {
                            "label": "士气如虹-进战",
                            "trigger": "combatStart",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst gain = 10 + (lvl - 1) * 5;\nawait actor.update({'system.resources.morale.value': S.resources.morale.value + gain});\nui.notifications.info(`${actor.name} 士气如虹：进入战斗获得 ${gain} 点士气`);"
                        },
                        {
                            "label": "士气如虹-击倒反馈",
                            "trigger": "hit",
                            "script": "if (args.isDying) {\n    const lvl = Math.max(1, args.move.computedLevel || 1);\n    const gain = 10 + (lvl - 1) * 5;\n    await actor.update({'system.resources.morale.value': S.resources.morale.value + gain});\n    ui.notifications.info(`${actor.name} 士气如虹：击倒敌人获得 ${gain} 点士气`);\n}"
                        }
                    ],
                    "actionCost": "无"
                }
            ]
        }
    },
    {
        "name": "火器录",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>神机营绝密，记载了制造和使用火器、火药方法，并附上各种图谱，火器虽威力有限，但潜力无穷。</p>",
            "requirements": "《神机军略》修炼圆满",
            "moves": [
                {
                    "name": "火器录",
                    "type": "real",
                    "damageType": "none",
                    "weaponType": "none",
                    "description": "<p>火器本身是消耗品或消耗火药的武器，火器没有技能等级，攻击时不进行命中投掷，也不会暴击。<br>·你使用火器时，伤害+10，释放距离+5。<br>·你购买火器消耗品时，具有 10%折扣。<br><strong>升级：</strong>伤害+10，释放距离+5，折扣+10%。</p>",
                    "automationNote": "被动增益需手动结算。",
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "actionCost": "无"
                }
            ]
        }
    },
    {
        "name": "轰天雷",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>神机营火器用法，铁罐盛药，以火点之，炮起火发，其声如雷，闻百里外。</p>",
            "moves": [
                {
                    "name": "轰天雷",
                    "type": "real",
                    "element": "yang",
                    "damageType": "waigong",
                    "weaponType": "special",
                    "requirements": "火器-轰天雷",
                    "range": "10",
                    "description": "<p>主要动作，引燃后掷向敌人，炸开时声如霹雷，目标及其周围 3 米内所有敌人和其他友方进行一次[轻功]检定（难度 15），失败受到 50 点外功伤害并击飞 1 米。<br><strong>升级：</strong>外功伤害+10，释放距离+5，内力消耗+2。</p>",
                    "automationNote": "消耗品扣除需手动。点击应用伤害仅发送检定请求，失败自动扣除对应HP。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "scripts": [
                        {
                            "label": "轰天雷-必中",
                            "trigger": "attack",
                            "script": "args.flags.forceHit = true;"
                        },
                        {
                            "label": "轰天雷-豁免请求",
                            "trigger": "hit",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst dmg = 50 + (lvl - 1) * 10;\n\nawait Macros.requestSave({\n    target: args.target,\n    attacker: actor,\n    type: 'qinggong',\n    dc: 15,\n    label: '躲避轰天雷',\n    damageOnFail: { value: dmg, type: 'hp' },\n    failureText: `${args.target.name} 被炸飞 1 米！受到 ${dmg} 点伤害。`\n});"
                        }
                    ],
                    "actionCost": "主要动作"
                }
            ]
        }
    },
    {
        "name": "神火飞鸦",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 1,
            "description": "<p>神机营火器用法，外形如乌鸦，用细竹、芦苇编成，鸦身两侧各装两支药筒，和鸦身内火药用燃线相连，点燃后飞射而出爆炸，阵势骇人。</p>",
            "moves": [
                {
                    "name": "神火飞鸦",
                    "type": "real",
                    "element": "yang",
                    "damageType": "fire",
                    "weaponType": "special",
                    "requirements": "火器-神火飞鸦",
                    "range": "20",
                    "description": "<p>全回合动作，点燃引线，飞掠而去，至目标空格后爆炸。目标空格及其周围 5 米范围所有敌人和其他目标进行一次[轻功]检定（难度 15），失败则受到 30 点火焰伤害，同时烧毁身上的凡品防具。<br><strong>升级：</strong>难度+1，火焰伤害+10 点，内力消耗+2。</p>",
                    "automationNote": "消耗品扣除及防具烧毁需手动。点击应用伤害仅发送检定请求，失败回调造成伤害。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "scripts": [
                        {
                            "label": "神火飞鸦-必中",
                            "trigger": "attack",
                            "script": "args.flags.forceHit = true;"
                        },
                        {
                            "label": "神火飞鸦-豁免请求",
                            "trigger": "hit",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst dc = 15 + (lvl - 1);\nconst dmg = 30 + (lvl - 1) * 10;\n\nawait Macros.requestSave({\n    target: args.target,\n    attacker: actor,\n    type: 'qinggong',\n    dc: dc,\n    label: '躲避神火飞鸦',\n    damageOnFail: {\n        value: dmg,\n        type: 'fire'\n    }});"
                        }
                    ],
                    "actionCost": "全回合动作"
                }
            ]
        }
    },
    {
        "name": "猛火油柜",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>神机营火器用法，以猛火油为燃料，用熟铜制成柜，内装引火药的“火楼”。使用时点燃火药，然后用力抽拉，进而喷出烈焰，以烧伤敌军及装备。</p>",
            "requirements": "火器-猛火油柜-银 600 两",
            "moves": [
                {
                    "name": "猛火油柜",
                    "type": "real",
                    "element": "yang",
                    "damageType": "fire",
                    "weaponType": "special",
                    "requirements": "火器-猛火油柜-银 600 两",
                    "range": "5",
                    "description": "<p>全回合动作，点燃一份猛火油，烈焰如龙，直线上所有敌人和其他目标进行一次[轻功]检定（难度 17），失败则受到 40 点火焰伤害，且被添加“引燃”，持续到战斗脱离。成功则伤害减半，不会被添加引燃。<br>·猛火油柜需双手持握，使用的回合无法移动，使用后需要花费一分钟重新装入燃油。<br><strong>升级：</strong>难度+2，火焰伤害+20 点，内力消耗+4。</p>",
                    "automationNote": "完全自动化。燃油消耗需手动。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ]
                    },
                    "calculation": {
                        "base": 40,
                        "growth": 20
                    },
                    "scripts": [
                        {
                            "label": "猛火油柜-必中",
                            "trigger": "attack",
                            "script": "args.flags.forceHit = true;"
                        },
                        {
                            "label": "猛火油柜-全自动判定",
                            "trigger": "preDamage",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst dc = 17 + (lvl - 1) * 2;\n\n// 后台直接投掷检定\nconst roll = await args.target.rollAttributeTest('qinggong', { \n    skipDialog: true, \n    flavor: '躲避猛火油柜' \n});\nconst saveTotal = roll.total;\n\nif (saveTotal >= dc) {\n    args.config.amount = Math.floor(args.config.amount / 2);\n    ui.notifications.info(`${args.target.name} 成功躲避，伤害减半！`);\n} else {\n    // 失败：挂引燃\n    const effectData = thisItem.effects.getName('引燃');\n    if (effectData) {\n        await game.xjzl.api.effects.addEffect(args.target, effectData.toObject());\n        ui.notifications.warn(`${args.target.name} 被引燃了！`);\n    }\n}\n\nargs.config.ignoreBlock = true; // 火焰无视格挡"
                        }
                    ],
                    "actionCost": "全回合动作"
                }
            ],
            "effects": [
                {
                    "name": "引燃",
                    "icon": "icons/svg/fire.svg",
                    "description": "被猛火油引燃，持续燃烧。",
                    "transfer": false,
                    "flags": {
                        "xjzl-system": {
                            "slug": "yinran",
                            "stackable": true
                        }
                    },
                    "changes": [
                        {
                            "key": "flags.xjzl-system.regenHpTurnStart",
                            "mode": 2,
                            "value": "-5"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "一窝蜂",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>神机营火器用法，特制木桶，内可装火箭，至多三十二支，每支分插一格，上缚药筒，引信集作一束，点火后，数十支火箭可同时射出，火力极猛。</p>",
            "requirements": "火器-一窝蜂-银 1200 两",
            "moves": [
                {
                    "name": "一窝蜂",
                    "type": "real",
                    "element": "yang",
                    "damageType": "fire",
                    "weaponType": "special",
                    "requirements": "火器-一窝蜂-银 1200 两",
                    "range": "10",
                    "description": "<p>全回合动作，火箭漫天，每支造成 5 点火焰伤害。<br>·你最多一次性射出 32 支火箭。<br>·目标每有一级[轻功]，便能减少一根火箭的火焰伤害（即减少 5 点火焰伤害）。<br>·一窝蜂需双手持握，使用的回合无法移动，使用后每回合可以装入一支火箭。<br>·无需投掷命中，敌人无法闪避。<br><strong>升级：</strong>每支火箭造成的火焰伤害+1，内力消耗+2。</p>",
                    "automationNote": "完全自动化。使用请注意安全，据说曾有主持人使用此武器猛烈攻击孕妇！",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ]
                    },
                    "calculation": {
                        "base": 5,
                        "growth": 1
                    },
                    "scripts": [
                        {
                            "label": "一窝蜂-装填",
                            "trigger": "attack",
                            "script": "const dialog = await foundry.applications.api.DialogV2.prompt({\n    window: { title: '一窝蜂: 发射数量' },\n    content: '<div class=\"form-group\"><label>发射火箭数 (1-32)</label><input type=\"number\" name=\"count\" value=\"32\" min=\"1\" max=\"32\"></div>',\n    ok: { label: '发射', callback: (e, b) => new FormData(b.form).get('count') }\n});\nconst count = parseInt(dialog) || 1;\n\n// 读取基础单发伤害 (已经在 calculateMoveDamage 中算好)\nconst singleDmg = args.flags.damageResult.damage;\nconst totalDmg = singleDmg * count;\n\n// 直接修改最终伤害\nargs.flags.damageResult.damage = totalDmg;\n\n// 更新 Breakdown (为了显示好看)\nargs.flags.damageResult.breakdown += `\n+ 一窝蜂装填 (${count}发): ${totalDmg - singleDmg}`;\n\n// 必中\nargs.flags.forceHit = true;\n\n// 存储数量供后续使用\n// 我们将其暂存在 damageResult 对象上，因为它会一直传递\nargs.flags.damageResult.rocketCount = count;\nargs.flags.damageResult.singleDmg = singleDmg;"
                        },
                        {
                            "label": "一窝蜂-轻功减免",
                            "trigger": "preDamage",
                            "script": "// 从传递过来的对象中读取参数\n// 注意：hit/preDamage 阶段，之前的 flags.damageResult 被展开到了 args 中，或者作为 damageResult 存在\n// 根据你的 ChatManager 实现，它通常在 args.damageResult 里，或者直接在 args 里\n// 安全起见，我们在 attack 脚本里把 count 放进了 damageResult，这里应该能通过 args.damageResult 读到\n// 如果 args.damageResult 不存在，我们得检查下 ChatManager._applyDamage 的逻辑\n// 查看代码：summary.push(resultEntry); resultEntry 包含 ...damageResult\n// hitContext = { ...resultEntry }\n// 所以 args.rocketCount 应该直接可用 (如果它在 damageResult 里)\n\n// 重新确认逻辑：Attack 脚本修改的是 calcResult对象。\n// Item.roll 将 calcResult 存入了 flags['xjzl-system'].calc\n// ChatManager._applyDamage 读取 flags.calc\n// 构造 damageResult 时，并没有把 flags.calc 里的自定义字段全拷进去，只拷了 damage/feint/breakdown 等标准字段\n// ！！！修正：为了确保传递，我们还是得利用 preDamage 的 args.config.amount 反推，或者像之前一样把 count 存到 flags.bonusDamage 里 (不推荐了)\n\n// 【稳健写法】\n// 1. 获取当前伤害 (这是总伤害)\nconst totalDamage = args.config.amount;\n\n// 2. 重新计算单发伤害 (5 + lvl - 1)\nconst lvl = Math.max(1, args.move.computedLevel || 1);\nconst singleDmg = 5 + (lvl - 1);\n\n// 3. 反推数量\nconst count = Math.floor(totalDamage / singleDmg);\n\n// 4. 获取目标轻功\nconst qinggong = args.target.system.skills?.qinggong?.total || 0;\n\n// 5. 减免逻辑\nconst effective = Math.max(0, count - qinggong);\nconst realDamage = effective * singleDmg;\n\n// 6. 修改伤害\nargs.config.amount = realDamage;\n\n// 7. 必中属性\nargs.config.ignoreBlock = true;\nargs.config.ignoreDefense = true;\n\nif (qinggong > 0) {\n    ui.notifications.info(`${args.target.name} 轻功抵消了 ${Math.min(count, qinggong)} 支火箭`);\n}"
                        }
                    ],
                    "actionCost": "全回合动作"
                }
            ]
        }
    },
    {
        "name": "血流漂杵",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>凭君莫话封侯事，一将功成万骨枯，金甲耀光下，悍不畏死心，战至尸骸蔽野血流成河，视死如归。</p>",
            "requirements": "《忠孝难全》修炼圆满",
            "moves": [
                {
                    "name": "血流漂杵",
                    "type": "real",
                    "damageType": "none",
                    "weaponType": "none",
                    "description": "<p><strong>血战到底</strong><br>战斗至流干最后一滴血。<br>当你奄奄一息时（气血值低于最大气血的 10%），招式伤害、命中+5。<br>·每有 1 点杀孽，伤害、命中再+1。（至多+5）<br><br><strong>死战不退</strong><br>宁死不屈，誓死不降。<br>当你的死亡检定成功时，你可以选择不昏迷，而是将先攻顺序调整至最末，并回复 10 点内力。<br>·每选择触发一次该效果，你获得一层“死战”，死战不会被任何内功、武学、物品效果移除。<br>死战：每层使你的死亡检定结果-3。<br><strong>升级：</strong>血战到底中的伤害、命中再+5，杀孽提供的加成上限再+5；死战不退中回复的内力+10。</p>",
                    "automationNote": "血战到底已自动化。死战不退需手动。",
                    "scripts": [
                        {
                            "label": "血战到底",
                            "trigger": "passive",
                            "script": "const hp = S.resources.hp.value;\nconst maxHp = S.resources.hp.max;\nif (maxHp > 0 && (hp / maxHp) < 0.1) {\n    const lvl = Math.max(1, args.move.computedLevel || 1);\n    const baseBonus = 5 + (lvl - 1) * 5;\n    \n    const shanie = S.resources.shanie || 0;\n    const maxShanieBonus = 5 + (lvl - 1) * 5;\n    const shanieBonus = Math.min(shanie, maxShanieBonus);\n    \n    const totalBonus = baseBonus + shanieBonus;\n    \n    S.combat.damages.global.mod += totalBonus;\n    S.combat.hit_waigong += totalBonus;\n    S.combat.hit_neigong += totalBonus;\n}"
                        }
                    ],
                    "actionCost": "无"
                }
            ]
        }
    },
    {
        "name": "铁骑坚甲",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 2,
            "description": "<p>奋身来建非常功，三千铁骑壮且雄，精骑可覆重铁甲，不惧枪尖方阵矛，声威震天，踏破山河。</p>",
            "requirements": "《铁马功》修炼圆满",
            "moves": [
                {
                    "name": "铁骑坚甲",
                    "type": "real",
                    "damageType": "none",
                    "weaponType": "none",
                    "description": "<p><strong>风驰电掣</strong><br>骑术不凡，飒沓流星。<br>你的[马术]等级+2。<br>你骑马攻击敌人时，暴击骰-1。<br><br><strong>披甲重铠</strong><br>铁骑冲锋，无坚不摧。<br>你骑乘穿具马铠的马匹时，马匹的防护额外+5，且马匹不会减少速度。<br><strong>升级：</strong>马术等级+1，暴击骰再-1；马匹防护再+5。</p>",
                    "automationNote": "自动增加马术等级。骑马判定及马匹防护需手动。",
                    "scripts": [
                        {
                            "label": "风驰电掣",
                            "trigger": "passive",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nS.skills.mashu.mod += (2 + (lvl - 1));"
                        }
                    ],
                    "actionCost": "无"
                }
            ]
        }
    },
    {
        "name": "号令千军",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
        "system": {
            "category": "sanshou",
            "sect": "jiangjunying",
            "tier": 3,
            "description": "<p>将军营治军严明，兵卒谨守兵律，令行禁止，军容严正，千总掌一营官兵，莫无不从。</p>",
            "requirements": "号旗（棍），《将星录》修炼圆满",
            "moves": [
                {
                    "name": "号令千军",
                    "type": "qi",
                    "actionType": "buff",
                    "element": "taiji",
                    "damageType": "none",
                    "weaponType": "staff",
                    "requirements": "号旗（棍）",
                    "range": "10",
                    "description": "<p>蓄力动作，手持号旗，指挥若定，调兵遣将，消耗自身士气，然后向周围友方（包括自己）添加以下任意一个“号令”状态，持续三回合。<br>·若友方已有“号令”，则替换为新的号令效果。<br>·若友方士气不足，部分号令无法对其生效。<br><strong>号令-一鼓作气：</strong>每回合初获得 10 点士气。<br><strong>号令-全军冲锋：</strong>可以选择在回合初-5 士气，然后移动速度+5。<br><strong>号令-迎敌备战：</strong>内外功防御+10。<br><strong>号令-诱敌深入：</strong>闪避+10。<br><strong>号令-包抄夹击：</strong>招式命中后添加“下盘不稳”一回合。<br><strong>号令-破军诛将：</strong>招式伤害+10。<br><strong>号令-合军聚众：</strong>可以选择每回合末-5 士气，然后回复 5 气血。<br><strong>号令-鸣金收兵：</strong>可以选择每回合末-5 士气，然后可以朝你的方向不消耗速度移动至多 3 米。<br><strong>升级：</strong>释放范围+5，士气消耗-5。</p>",
                    "automationNote": "出招自动扣除士气。命中时弹出选择框添加Buff。回合末选择性效果需手动。",
                    "costs": {
                        "mp": [
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "scripts": [
                        {
                            "label": "号令千军-士气扣除",
                            "trigger": "attack",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst cost = Math.max(0, 25 - (lvl - 1) * 5);\nif (S.resources.morale.value < cost) {\n    ui.notifications.warn(`士气不足！需要 ${cost}`);\n    args.flags.abort = true;\n} else {\n    await actor.update({ 'system.resources.morale.value': S.resources.morale.value - cost });\n}"
                        },
                        {
                            "label": "号令千军-应用",
                            "trigger": "hit",
                            "script": "const options = [\n    { label: '一鼓作气 (+10士气/回合)', slug: 'haoling_1' },\n    { label: '全军冲锋 (速度+5)', slug: 'haoling_2' },\n    { label: '迎敌备战 (防御+10)', slug: 'haoling_3' },\n    { label: '诱敌深入 (闪避+10)', slug: 'haoling_4' },\n    { label: '包抄夹击 (命中附带下盘不稳)', slug: 'haoling_5' },\n    { label: '破军诛将 (伤害+10)', slug: 'haoling_6' },\n    { label: '合军聚众 (回血)', slug: 'haoling_7' },\n    { label: '鸣金收兵 (移动)', slug: 'haoling_8' }\n];\n\nconst content = options.map((o, i) => `<div class=\"form-group\"><input type=\"radio\" name=\"choice\" value=\"${i}\" ${i===0?'checked':''}> <label>${o.label}</label></div>`).join('');\n\nconst idx = await foundry.applications.api.DialogV2.prompt({\n    window: { title: '选择号令' },\n    content: content,\n    ok: { label: '下令', callback: (e, b) => new FormData(b.form).get('choice') }\n});\n\nif (idx !== null) {\n    const choice = options[parseInt(idx)];\n    const effectData = thisItem.effects.find(e => e.flags?.['xjzl-system']?.slug === choice.slug);\n    if (effectData) {\n        await game.xjzl.api.effects.addEffect(args.target, effectData.toObject());\n        ui.notifications.info(`已对 ${args.target.name} 下达: ${choice.label}`);\n    }\n}"
                        }
                    ],
                    "actionCost": "蓄力动作"
                }
            ]
        },
        "effects": [
            {
                "name": "号令-一鼓作气",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "每回合初获得 10 点士气。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_1",
                        "stackable": false
                    }
                },
                "changes": [
                    {
                        "key": "flags.xjzl-system.regenMoraleTurnStart",
                        "mode": 2,
                        "value": "10"
                    }
                ]
            },
            {
                "name": "号令-全军冲锋",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "可以选择在回合初-5 士气，然后移动速度+5。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_2",
                        "stackable": false
                    }
                },
                "changes": [
                    {
                        "key": "system.combat.speed",
                        "mode": 2,
                        "value": "5"
                    }
                ]
            },
            {
                "name": "号令-迎敌备战",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "内外功防御+10。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_3",
                        "stackable": false
                    }
                },
                "changes": [
                    {
                        "key": "system.combat.def_waigong",
                        "mode": 2,
                        "value": "10"
                    },
                    {
                        "key": "system.combat.def_neigong",
                        "mode": 2,
                        "value": "10"
                    }
                ]
            },
            {
                "name": "号令-诱敌深入",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "闪避+10。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_4",
                        "stackable": false
                    }
                },
                "changes": [
                    {
                        "key": "system.combat.dodge",
                        "mode": 2,
                        "value": "10"
                    }
                ]
            },
            {
                "name": "号令-包抄夹击",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "招式命中后添加“下盘不稳”一回合。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_5",
                        "stackable": false,
                        "scripts": [
                            {
                                "label": "包抄夹击-触发",
                                "trigger": "hit",
                                "script": "if (args.type === 'attack' && args.isHit) {\n    await game.xjzl.api.effects.addEffect(args.target, 'unstable');\n}"
                            }
                        ]
                    }
                }
            },
            {
                "name": "号令-破军诛将",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "招式伤害+10。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_6",
                        "stackable": false
                    }
                },
                "changes": [
                    {
                        "key": "system.combat.damages.skill.mod",
                        "mode": 2,
                        "value": "10"
                    }
                ]
            },
            {
                "name": "号令-合军聚众",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "可以选择每回合末-5 士气，然后回复 5 气血。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_7",
                        "stackable": false
                    }
                }
            },
            {
                "name": "号令-鸣金收兵",
                "icon": "systems/xjzl-system/assets/icons/wuxue/将军营.png",
                "description": "可以选择每回合末-5 士气，然后可以朝你的方向不消耗速度移动至多 3 米。",
                "transfer": false,
                "duration": {
                    "rounds": 3
                },
                "flags": {
                    "xjzl-system": {
                        "slug": "haoling_8",
                        "stackable": false
                    }
                }
            }
        ]
    }
]