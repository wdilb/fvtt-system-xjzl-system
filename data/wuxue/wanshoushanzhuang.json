[
    {
        "name": "十二形拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "wuxue",
            "sect": "wanshoushanzhuang",
            "tier": 1,
            "description": "万兽山庄拳法，以兽形为招式，威武生风。",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "龙拳",
                    "type": "real",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "taiji",
                    "range": "1",
                    "description": "主要动作，大声吼，造成 0.4 力量点外功伤害。\n若目标处于“缚身”，招式可消耗次要动作施展。\n升级：招式伤害+5，内力消耗+1。",
                    "actionCost": "主要动作",
                    "automationNote": "动作类型变更需玩家手动处理。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    }
                },
                {
                    "name": "虎拳",
                    "type": "real",
                    "damageType": "neigong",
                    "weaponType": "unarmed",
                    "element": "taiji",
                    "range": "1",
                    "description": "主要动作，大声嗷，造成 0.4 内息点内功伤害。\n若目标处于“禁足”，招式可消耗反应动作施展。\n升级：招式伤害+5，内力消耗+1。",
                    "actionCost": "主要动作",
                    "automationNote": "动作类型变更需玩家手动处理。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "neixi",
                                "ratio": 0.4
                            }
                        ]
                    }
                },
                {
                    "name": "豹拳",
                    "type": "feint",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "taiji",
                    "range": "1",
                    "description": "主要动作，大声呜，造成 0.3 力量点外功伤害，击破架招时使目标陷入“缚身”，持续一回合。\n升级：招式伤害+5，内力消耗+1。",
                    "actionCost": "主要动作",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击破缚身",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    await game.xjzl.api.effects.addEffect(args.target, \"fushen\");\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "蛇拳",
                    "type": "stance",
                    "weaponType": "unarmed",
                    "element": "taiji",
                    "range": "自身",
                    "description": "次要动作，大声嘶，开启架招。格挡成功时，可使 1 米内的攻击者陷入“禁足”，持续一回合。\n升级：格挡值+5，内力消耗+1。",
                    "actionCost": "次要动作",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "scripts": [
                        {
                            "label": "格挡禁足",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args)) {\n    const effectData = foundry.utils.deepClone(CONFIG.statusEffects.find(e => e.id === \"root\"));\n    effectData.duration = { rounds: 1 };\n    await game.xjzl.api.effects.addEffect(args.attacker, effectData);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鹤拳",
                    "type": "counter",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "taiji",
                    "range": "1",
                    "description": "当你看破虚招时，可消耗反应动作使用此招，压制对方虚招，同时消耗下回合的所有动作，大声“唳！吼、嗷、呜、嘶！”，不消耗动作地对目标分别施展【龙拳】【虎拳】【豹拳】【蛇拳】。\n·你的下回合只能移动。\n升级：怒气消耗-1，内力消耗+2。",
                    "actionCost": "反应动作",
                    "isUltimate": true,
                    "automationNote": "请手动依次施展四式拳法并结算资源。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    }
                }
            ]
        }
    },
    {
        "name": "山林钩",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "wuxue",
            "sect": "wanshoushanzhuang",
            "tier": 1,
            "description": "万兽山庄弟子跋涉深山时砍伐灌木、攀登所用，灵活巧便，威力不容小觑。",
            "requirements": "匕首-双刺",
            "moves": [
                {
                    "name": "穿林打叶",
                    "type": "real",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "element": "gang",
                    "range": "2",
                    "description": "蓄力动作，左钩向上，右钩向下，转身劈向周围，对周围敌人造成 0.3 力量点外功伤害，并为命中的目标添加“剧痛”，持续三回合。\n当有目标处于半空时，可消耗反应动作施展此招，跃至半空，双钩斜挑，对其造成伤害。\n升级：招式伤害+5，内力消耗+2。",
                    "actionCost": "蓄力动作",
                    "automationNote": "对周围敌人的伤害需手动多次施展或选中多个目标。半空判定需手动。",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "附加剧痛",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const pain = foundry.utils.deepClone(CONFIG.statusEffects.find(e => e.id === \"pain\"));\n    pain.duration = { rounds: 3 };\n    await game.xjzl.api.effects.addEffect(args.target, pain);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "攀岩越岭",
                    "type": "feint",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "element": "gang",
                    "range": "1",
                    "description": "主要动作，上钩下劈，对目标造成 0.3 力量点外功伤害。命中无架招目标时，钩穿其臂，用力甩飞，将其朝任意方向击飞 1 米。\n升级：招式伤害+5，内力消耗+1。",
                    "actionCost": "主要动作",
                    "automationNote": "击飞移动需手动。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击飞提示",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    ChatMessage.create({ content: `${args.target.name} 被击飞 1 米。` });\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "逢山开道",
                    "type": "counter",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "element": "gang",
                    "range": "3",
                    "description": "当你看破对方虚招时，可消耗反应动作释放此招，压制虚招，奔袭至目标身旁空格，双钩纵劈而下，对其造成 0.5 力量点外功伤害，并将其击倒。\n升级：招式伤害+5，内力消耗+1。",
                    "actionCost": "反应动作",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "击倒",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    await game.xjzl.api.effects.toggleStatus(args.target, \"prone\", true);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "穷猿奔林",
                    "type": "real",
                    "damageType": "waigong",
                    "weaponType": "dagger",
                    "element": "gang",
                    "range": "3",
                    "description": "主要动作，纵身翻滚至目标身旁空格，钩其双腿，刺其面门，对目标造成 0.6 力量点外功伤害。\n若目标处于倒地状态，双钩劈刺，使其陷入“禁足”，持续一回合，且为其添加“剧痛”五回合。\n升级：招式伤害+10，怒气消耗-1，内力消耗+2。",
                    "actionCost": "主要动作",
                    "isUltimate": true,
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "倒地追击",
                            "trigger": "hit",
                            "script": "if (args.isHit && args.target.statuses.has(\"prone\")) {\n    const root = foundry.utils.deepClone(CONFIG.statusEffects.find(e => e.id === \"root\"));\n    root.duration = { rounds: 1 };\n    await game.xjzl.api.effects.addEffect(args.target, root);\n    \n    const pain = foundry.utils.deepClone(CONFIG.statusEffects.find(e => e.id === \"pain\"));\n    pain.duration = { rounds: 5 };\n    await game.xjzl.api.effects.addEffect(args.target, pain);\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "斗兽棍法",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "wuxue",
            "sect": "wanshoushanzhuang",
            "tier": 1,
            "description": "边境猎户使用的凶悍棍法，面对兽群时极为有效。",
            "requirements": "棍-短棍",
            "moves": [
                {
                    "name": "辗转寻踪",
                    "type": "stance",
                    "weaponType": "staff",
                    "element": "gang",
                    "range": "自身",
                    "description": "次要动作，转棍于腰，开启架招。格挡成功后，获得“寻踪”，持续到该回合结束。\n寻踪：看破值+5。\n升级：格挡值+5，内力消耗+1。",
                    "actionCost": "次要动作",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    },
                    "scripts": [
                        {
                            "label": "格挡获得寻踪",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args)) {\n    const effect = thisItem.effects.getName(\"寻踪\");\n    if (effect) await game.xjzl.api.effects.addEffect(actor, effect.toObject());\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "棍破水火",
                    "type": "stance",
                    "weaponType": "staff",
                    "element": "gang",
                    "range": "自身",
                    "description": "次要动作，双手握棍，开启架招。被击破架招后，可以消耗反应动作施展【辗转寻踪】（无视被破防后一回合内无法开启架招的效果）。\n升级：格挡值+5，内力消耗+1。",
                    "actionCost": "次要动作",
                    "automationNote": "破防后施展架招需玩家手动。",
                    "costs": {
                        "mp": [
                            1,
                            2,
                            3
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5
                    }
                },
                {
                    "name": "棍扫群兽",
                    "type": "real",
                    "damageType": "neigong",
                    "weaponType": "staff",
                    "element": "gang",
                    "range": "1",
                    "description": "蓄力动作，舞棍横扫周围敌人，造成 0.3 力量点内功伤害。每击中一个无架招的敌人，获得一层“磐石”，至多三层，持续到战斗脱离。\n磐石：每层提升 5 点格挡值。\n升级：招式伤害+5，内力消耗+2。",
                    "actionCost": "蓄力动作",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 5,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.3
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "叠加磐石",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const panshi = foundry.utils.deepClone(CONFIG.statusEffects.find(e => e.id === \"panshi\"));\n    panshi.flags[\"xjzl-system\"].maxStacks = 3;\n    await game.xjzl.api.effects.addEffect(actor, panshi);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "困兽死斗",
                    "type": "real",
                    "damageType": "neigong",
                    "weaponType": "staff",
                    "element": "gang",
                    "range": "2",
                    "description": "蓄力动作，怒吼鞭打周围敌人，造成 0.5 力量点内功伤害。并为目标添加“迟滞”，持续一回合。\n·招式对野兽额外造成 1 点体力伤害。\n升级：招式伤害+10，怒气消耗-1，内力消耗+4。",
                    "actionCost": "蓄力动作",
                    "isUltimate": true,
                    "automationNote": "对野兽的体力伤害需手动扣除。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.5
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "附加迟滞",
                            "trigger": "hit",
                            "script": "if (args.isHit) {\n    const effect = foundry.utils.deepClone(CONFIG.statusEffects.find(e => e.id === \"chizhi\"));\n    effect.duration = { rounds: 1 };\n    await game.xjzl.api.effects.addEffect(args.target, effect);\n}",
                            "active": true
                        },
                        {
                            "label": "野兽克制",
                            "trigger": "calc",
                            "script": "if (args.target && args.target.type === 'creature') {\n    args.output.bonusDesc.push(\"对野兽额外造成 1 点体力伤害。\");\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "寻踪",
                    "icon": "icons/svg/eye.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_xunzong"
                        }
                    },
                    "description": "看破值+5。",
                    "changes": [
                        {
                            "key": "system.combat.kanpo",
                            "mode": 2,
                            "value": 5
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "兽王拳",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "wuxue",
            "sect": "wanshoushanzhuang",
            "tier": 2,
            "description": "万兽山庄绝学，气势骇如猛兽下山，欲择人而噬。",
            "requirements": "徒手-拳掌",
            "moves": [
                {
                    "name": "苍龙震天",
                    "type": "stance",
                    "weaponType": "unarmed",
                    "element": "yang",
                    "range": "自身",
                    "description": "次要动作，龙腾虎啸，开启架招，格挡成功后获得一层“捕食”，至多三层，持续到脱战。\n捕食：每层提高《兽王拳》招式伤害 5 点，叠满三层后获得“化龙”，持续到战斗脱离。\n化龙：【苍龙震天】提供的格挡值翻倍。\n升级：格挡值+10，内力消耗+2。",
                    "actionCost": "次要动作",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "scripts": [
                        {
                            "label": "化龙翻倍",
                            "trigger": "passive",
                            "script": "if (actor.effects.some(e => e.name === \"化龙\")) {\n    args.move.calculation.base *= 2;\n    args.move.calculation.growth *= 2;\n}",
                            "active": true
                        },
                        {
                            "label": "捕食与化龙",
                            "trigger": "damaged",
                            "script": "if (Macros.checkStance(actor, args)) {\n    const bushi = thisItem.effects.getName(\"捕食\");\n    const hualong = thisItem.effects.getName(\"化龙\");\n    if (bushi) {\n        const effect = await game.xjzl.api.effects.addEffect(actor, bushi.toObject());\n        if (effect && effect.getFlag(\"xjzl-system\", \"stacks\") >= 3 && hualong) {\n            if (!actor.effects.some(e => e.name === \"化龙\")) {\n                await game.xjzl.api.effects.addEffect(actor, hualong.toObject());\n                ui.notifications.info(`${actor.name} 获得【化龙】！`);\n            }\n        }\n    }\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "猛虎搏兔",
                    "type": "real",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "yang",
                    "range": "3",
                    "description": "主要动作，伏身袭击，奔袭目标周围空格，对其造成 0.4 力量点外功伤害，并获得一层“捕食”，至多三层，持续到脱战。\n·具有“化龙”时，招式伤害提高 10 点。\n升级：招式伤害+10，内力消耗+2。",
                    "actionCost": "主要动作",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "捕食伤害",
                            "trigger": "calc",
                            "script": "const stacks = actor.effects.find(e => e.name === \"捕食\")?.getFlag(\"xjzl-system\", \"stacks\") || 0;\nargs.output.damage += stacks * 5;\nif (actor.effects.some(e => e.name === \"化龙\")) {\n    args.output.damage += 10;\n    args.output.bonusDesc.push(\"化龙加成 +10\");\n}",
                            "active": true
                        },
                        {
                            "label": "获得捕食",
                            "trigger": "hit",
                            "script": "const effect = thisItem.effects.getName(\"捕食\");\nif (effect) await game.xjzl.api.effects.addEffect(actor, effect.toObject());",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "神龙探爪",
                    "type": "feint",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "yang",
                    "range": "1",
                    "description": "主要动作，风云势起，摆拳对目标造成 0.4 力量点外功伤害。命中无架招目标时，给对方添加一层“阻脉”，至多三层，持续到战斗脱离。\n阻脉：每层使出招内力消耗提升一倍。\n升级：招式伤害+10，内力消耗+2。",
                    "actionCost": "主要动作",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "捕食伤害",
                            "trigger": "calc",
                            "script": "const stacks = actor.effects.find(e => e.name === \"捕食\")?.getFlag(\"xjzl-system\", \"stacks\") || 0;\nargs.output.damage += stacks * 5;",
                            "active": true
                        },
                        {
                            "label": "施加阻脉",
                            "trigger": "hit",
                            "script": "if (args.isHit && !args.target.system.martial.stanceActive) {\n    const effect = thisItem.effects.getName(\"阻脉\");\n    if (effect) await game.xjzl.api.effects.addEffect(args.target, effect.toObject());\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "龙游八荒",
                    "type": "counter",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "yang",
                    "range": "5",
                    "description": "当你看破对手虚招时，可消耗反应动作释放此招，压制目标虚招，奔袭至目标身旁空格，轰拳对其造成 0.6 力量点外功伤害。\n·具有“化龙”时，可将目标击倒。\n升级：招式伤害+10，内力消耗+2。",
                    "actionCost": "反应动作",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.6
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "捕食伤害",
                            "trigger": "calc",
                            "script": "const stacks = actor.effects.find(e => e.name === \"捕食\")?.getFlag(\"xjzl-system\", \"stacks\") || 0;\nargs.output.damage += stacks * 5;",
                            "active": true
                        },
                        {
                            "label": "化龙击倒",
                            "trigger": "hit",
                            "script": "if (args.isHit && actor.effects.some(e => e.name === \"化龙\")) {\n    await game.xjzl.api.effects.toggleStatus(args.target, \"prone\", true);\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "兽王降世",
                    "type": "real",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "yang",
                    "range": "1",
                    "description": "主要动作，力拔山兮气盖世，破釜沉舟决雌雄，轰击目标造成 0.8 力量点外功伤害。\n·具有“化龙”时，出招后进入“兽王降世”，持续到脱离战斗。\n兽王降世：你免疫击飞、击退、击倒、下盘不稳、禁足和任意降低移动速度的效果。\n升级：招式伤害+20，怒气消耗-1，内力消耗+4。",
                    "actionCost": "主要动作",
                    "isUltimate": true,
                    "automationNote": "兽王降世的免疫效果需手动执行。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 20,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.8
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "捕食伤害",
                            "trigger": "calc",
                            "script": "const stacks = actor.effects.find(e => e.name === \"捕食\")?.getFlag(\"xjzl-system\", \"stacks\") || 0;\nargs.output.damage += stacks * 5;",
                            "active": true
                        },
                        {
                            "label": "获得兽王降世",
                            "trigger": "hit",
                            "script": "if (actor.effects.some(e => e.name === \"化龙\")) {\n    const effect = thisItem.effects.getName(\"兽王降世\");\n    if (effect) await game.xjzl.api.effects.addEffect(actor, effect.toObject());\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "捕食",
                    "icon": "icons/svg/pawprint.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_bushi",
                            "stackable": true,
                            "maxStacks": 3
                        }
                    },
                    "description": "每层提高《兽王拳》招式伤害 5 点。"
                },
                {
                    "name": "化龙",
                    "icon": "icons/svg/dragon.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_hualong"
                        }
                    },
                    "description": "【苍龙震天】提供的格挡值翻倍。"
                },
                {
                    "name": "阻脉",
                    "icon": "icons/svg/net.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_zumai",
                            "stackable": true,
                            "maxStacks": 3,
                            "scripts": [
                                {
                                    "trigger": "attack",
                                    "script": "const stacks = thisEffect.getFlag('xjzl-system', 'stacks') || 1; args.move.currentCost.mp *= Math.pow(2, stacks);",
                                    "label": "阻脉消耗增加"
                                }
                            ]
                        }
                    },
                    "description": "每层使出招内力消耗提升一倍。"
                },
                {
                    "name": "兽王降世",
                    "icon": "icons/svg/king.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_avatar"
                        }
                    },
                    "description": "免疫击飞、击退、击倒、下盘不稳、禁足和任意降低移动速度的效果。",
                    "changes": [
                        {
                            "key": "flags.xjzl-system.forceSpeedZero",
                            "mode": 5,
                            "value": "false"
                        },
                        {
                            "key": "flags.xjzl-system.unstable",
                            "mode": 5,
                            "value": "false"
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "百兽绘卷",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "wuxue",
            "sect": "wanshoushanzhuang",
            "tier": 2,
            "description": "万兽山庄绝学，气势骇如猛兽下山，欲择人而噬。",
            "requirements": "匕首-笔",
            "moves": [
                {
                    "name": "鹰击长空",
                    "type": "feint",
                    "damageType": "neigong",
                    "weaponType": "dagger",
                    "element": "yang",
                    "range": "1",
                    "description": "主要动作，笔画鹰势，素练风霜，对目标造成 0.4 力量点内功伤害，击破架招时，为自身添加“飞禽”，持续到战斗脱离。\n飞禽：移动时不受《趁虚而入》攻击。\n升级：招式伤害+10，内力消耗+2。",
                    "actionCost": "主要动作",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得飞禽",
                            "trigger": "hit",
                            "script": "if (args.isBroken) {\n    const effect = thisItem.effects.getName(\"飞禽\");\n    if (effect) await game.xjzl.api.effects.addEffect(actor, effect.toObject());\n}",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "狼入羊群",
                    "type": "real",
                    "damageType": "neigong",
                    "weaponType": "dagger",
                    "element": "yang",
                    "range": "1",
                    "description": "蓄力动作，笔走狼势，移步戳笔，对周围敌人造成 0.4 力量点内功伤害，之后为自身添加“走兽”，持续一回合。\n走兽：回合结束时，周围范围内的敌人流失 10 点气血。\n·此招可移动释放，对移动路径上周围 1 米范围内的敌人造成伤害。（不会重复造成伤害）\n升级：招式伤害+10，走兽持续回合+1，消耗+4。",
                    "actionCost": "蓄力动作",
                    "automationNote": "移动路径伤害需手动。走兽光环伤害需回合末手动。",
                    "costs": {
                        "mp": [
                            4,
                            8,
                            12
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "获得走兽",
                            "trigger": "attack",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst rounds = 1 + (lvl - 1);\nconst effectData = thisItem.effects.getName(\"走兽\").toObject();\neffectData.duration = { rounds: rounds };\nawait game.xjzl.api.effects.addEffect(actor, effectData);",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "鱼翔浅底",
                    "type": "stance",
                    "weaponType": "dagger",
                    "element": "yang",
                    "range": "自身",
                    "description": "次要动作，笔绘游鱼，留影莲间，开启架招。同时为自身添加“游鱼”，持续到脱战或被击破架招。\n游鱼：你不会陷入倒地状态。\n升级：格挡值+10，内力消耗+2。",
                    "actionCost": "次要动作",
                    "costs": {
                        "mp": [
                            2,
                            4,
                            6
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10
                    },
                    "scripts": [
                        {
                            "label": "开启游鱼",
                            "trigger": "attack",
                            "script": "const effect = thisItem.effects.getName(\"游鱼\");\nif (effect) await game.xjzl.api.effects.addEffect(actor, effect.toObject());",
                            "active": true
                        }
                    ]
                },
                {
                    "name": "物竞天择",
                    "type": "qi",
                    "damageType": "none",
                    "weaponType": "dagger",
                    "element": "yang",
                    "range": "5",
                    "description": "全回合动作，百兽奔腾，适者生存，根据自身当前具有的“飞禽”“走兽”“游鱼”状态，也为范围内所有友方添加同样的状态，持续到战斗脱离。\n·若同时具有“飞禽”“走兽”“游鱼”状态，还会为所有友方添加“百兽”，持续到战斗脱离。\n百兽：招式伤害提升 20 点，移动速度+5；你的兽宠造成的伤害翻倍，且在它的回合末回复 1 体力。\n升级：释放动作下降一级（全回合-蓄力-主要），怒气消耗-1，内力消耗+8。",
                    "actionCost": "全回合动作",
                    "isUltimate": true,
                    "actionType": "default",
                    "automationNote": "请手动选中所有受益的友方目标。",
                    "costs": {
                        "mp": [
                            8,
                            16,
                            24
                        ],
                        "rage": [
                            7,
                            6,
                            5
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "scripts": [
                        {
                            "label": "扩散状态",
                            "trigger": "hit",
                            "script": "const hasBird = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"wuxue_wanshou_bird\");\nconst hasBeast = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"wuxue_wanshou_beast\");\nconst hasFish = actor.effects.some(e => e.getFlag(\"xjzl-system\", \"slug\") === \"wuxue_wanshou_fish\");\n\nif (hasBird) {\n    const bird = thisItem.effects.getName(\"飞禽\");\n    if (bird) await game.xjzl.api.effects.addEffect(args.target, bird.toObject());\n}\nif (hasBeast) {\n    const beast = thisItem.effects.getName(\"走兽\");\n    if (beast) await game.xjzl.api.effects.addEffect(args.target, beast.toObject());\n}\nif (hasFish) {\n    const fish = thisItem.effects.getName(\"游鱼\");\n    if (fish) await game.xjzl.api.effects.addEffect(args.target, fish.toObject());\n}\n\nif (hasBird && hasBeast && hasFish) {\n    const baishou = thisItem.effects.getName(\"百兽\");\n    if (baishou) await game.xjzl.api.effects.addEffect(args.target, baishou.toObject());\n}",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "飞禽",
                    "icon": "icons/svg/wing.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_bird"
                        }
                    },
                    "description": "移动时不受《趁虚而入》攻击。"
                },
                {
                    "name": "走兽",
                    "icon": "icons/svg/pawprint.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_beast",
                            "scripts": [
                                {
                                    "trigger": "turnEnd",
                                    "script": "ChatMessage.create({ content: `${actor.name} 的【走兽】效果：请手动对周围敌人应用 10 点流失伤害。` });",
                                    "label": "走兽光环提示"
                                }
                            ]
                        }
                    },
                    "description": "回合结束时，周围范围内的敌人流失 10 点气血。"
                },
                {
                    "name": "游鱼",
                    "icon": "icons/svg/fish.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_fish"
                        }
                    },
                    "description": "不会陷入倒地状态。"
                },
                {
                    "name": "百兽",
                    "icon": "icons/svg/king.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_all"
                        }
                    },
                    "description": "招式伤害提升 20 点，移动速度+5；你的兽宠造成的伤害翻倍，且在它的回合末回复 1 体力。",
                    "changes": [
                        {
                            "key": "system.combat.damages.skill.mod",
                            "mode": 2,
                            "value": 20
                        },
                        {
                            "key": "system.combat.speed",
                            "mode": 2,
                            "value": 5
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "驭兽要诀",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "sanshou",
            "sect": "wanshoushanzhuang",
            "tier": 1,
            "description": "万兽山庄弟子各类野兽日夜打交道，精通驯兽。兽宠对万兽山庄弟子而言，既是武器，也是兄弟亲人，非常重要。\n需求：《兽吼功》修炼圆满\n·你的[驭兽]检定结果+1。\n·你的兽宠体力上限+1。\n升级：[驭兽]检定结果+1。",
            "moves": [
                {
                    "name": "驭兽要诀",
                    "type": "qi",
                    "range": "自身",
                    "actionType": "default",
                    "description": "·你的[驭兽]检定结果+1。\n·你的兽宠体力上限+1。\n升级：[驭兽]检定结果+1。",
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "scripts": [
                        {
                            "label": "被动加成",
                            "trigger": "passive",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst bonus = 1 + (lvl - 1);\nif (actor.system.arts.yushou) {\n    actor.system.arts.yushou.checkMod = (actor.system.arts.yushou.checkMod || 0) + bonus;\n}",
                            "active": true
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "野性勃发",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "sanshou",
            "sect": "wanshoushanzhuang",
            "tier": 1,
            "description": "激发野兽凶性，但对它的身体造成永久损伤。",
            "requirements": "消耗：异兽血肉",
            "moves": [
                {
                    "name": "野性勃发",
                    "type": "qi",
                    "range": "1",
                    "actionType": "default",
                    "description": "主要动作，喂食兽宠，下达狂躁命令，激发该兽宠残忍凶暴之情，使其获得“野性”，持续到战斗脱离。\n野性：兽宠防护提升 10 点，造成伤害提升 10 点，持续时间结束后，兽宠的最大体力上限-1，若体力归零，兽宠死亡。\n升级：兽宠防护再+5，伤害再+5。",
                    "actionCost": "主要动作",
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    },
                    "scripts": [
                        {
                            "label": "施加野性",
                            "trigger": "hit",
                            "script": "const lvl = Math.max(1, args.move.computedLevel || 1);\nconst bonus = 10 + (lvl - 1) * 5;\nconst effectData = thisItem.effects.getName(\"野性\").toObject();\neffectData.description = `防护+${bonus}，伤害+${bonus}。结束时体力上限-1。`;\neffectData.changes = [\n    { key: \"system.combat.protection\", mode: 2, value: bonus },\n    { key: \"system.combat.damages.global.mod\", mode: 2, value: bonus }\n];\nawait game.xjzl.api.effects.addEffect(args.target, effectData);",
                            "active": true
                        }
                    ]
                }
            ],
            "effects": [
                {
                    "name": "野性",
                    "icon": "icons/svg/blood.svg",
                    "flags": {
                        "xjzl-system": {
                            "slug": "wuxue_wanshou_wildness"
                        }
                    },
                    "description": "防护提升，伤害提升，结束时体力上限-1。"
                }
            ]
        }
    },
    {
        "name": "兽窍五通",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "sanshou",
            "sect": "wanshoushanzhuang",
            "tier": 2,
            "description": "所谓达者为师，兽存天地之间，有其天赋独到之处。此功钻研兽类与人体相通之处，奥妙无穷。\n需求：《五禽戏》修炼圆满",
            "moves": [
                {
                    "name": "兽窍五通",
                    "type": "qi",
                    "range": "自身",
                    "actionType": "default",
                    "description": "你选择虎、鸟、熊、鹿、猿五种兽类中的一种，模仿它们的生活习惯，获得相应效果：\n虎：你的力量属性技能检定结果+3。\n鸟：你的身法属性技能检定结果+3。\n熊：你的体魄属性技能检定结果+3。\n鹿：你的内息属性技能检定结果+3。\n猿：你的气感属性技能检定结果+3。\n升级：五种兽类增加的属性技能检定结果再+1，且你可以额外选择一类野兽获得加成。",
                    "automationNote": "请在物品特效栏中手动开启对应的兽类加成。",
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ],
                        "rage": [
                            0,
                            0,
                            0
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 0
                    }
                }
            ],
            "effects": [
                {
                    "name": "兽窍·虎",
                    "disabled": true,
                    "description": "力量属性技能检定+3（升级后+4）",
                    "changes": [
                        {
                            "key": "system.stats.liliang.checkMod",
                            "mode": 2,
                            "value": 3
                        }
                    ]
                },
                {
                    "name": "兽窍·鸟",
                    "disabled": true,
                    "description": "身法属性技能检定+3（升级后+4）",
                    "changes": [
                        {
                            "key": "system.stats.shenfa.checkMod",
                            "mode": 2,
                            "value": 3
                        }
                    ]
                },
                {
                    "name": "兽窍·熊",
                    "disabled": true,
                    "description": "体魄属性技能检定+3（升级后+4）",
                    "changes": [
                        {
                            "key": "system.stats.tipo.checkMod",
                            "mode": 2,
                            "value": 3
                        }
                    ]
                },
                {
                    "name": "兽窍·鹿",
                    "disabled": true,
                    "description": "内息属性技能检定+3（升级后+4）",
                    "changes": [
                        {
                            "key": "system.stats.neixi.checkMod",
                            "mode": 2,
                            "value": 3
                        }
                    ]
                },
                {
                    "name": "兽窍·猿",
                    "disabled": true,
                    "description": "气感属性技能检定+3（升级后+4）",
                    "changes": [
                        {
                            "key": "system.stats.qigan.checkMod",
                            "mode": 2,
                            "value": 3
                        }
                    ]
                }
            ]
        }
    },
    {
        "name": "骑猎无双",
        "type": "wuxue",
        "img": "systems/xjzl-system/assets/icons/wuxue/万兽.png",
        "system": {
            "category": "sanshou",
            "sect": "wanshoushanzhuang",
            "tier": 2,
            "description": "你和野兽亲密无间，可骑虎豹围猎，威风八面。",
            "requirements": "消耗：坐骑体力 1",
            "moves": [
                {
                    "name": "骑猎无双",
                    "type": "real",
                    "damageType": "waigong",
                    "weaponType": "unarmed",
                    "element": "none",
                    "range": "骑乘距离",
                    "description": "·你现在可以骑乘除了马之外的大型野兽，骑乘规则和骑马一样（详见马匹详述）\n·当你处于骑乘状态时，可消耗主要动作，跋涉长野，直趋敌隙，进行一个冲撞的[马术]技能检定。同时，还会对路径上的所有敌人造成 0.4 力量点外功伤害。\n升级：冲撞的伤害+10，怒气消耗-1。",
                    "actionCost": "主要动作",
                    "automationNote": "手动发起马术对抗，手动应用伤害。",
                    "costs": {
                        "mp": [
                            0,
                            0,
                            0
                        ],
                        "rage": [
                            3,
                            2,
                            1
                        ],
                        "hp": [
                            0,
                            0,
                            0
                        ]
                    },
                    "calculation": {
                        "base": 0,
                        "growth": 10,
                        "scalings": [
                            {
                                "prop": "liliang",
                                "ratio": 0.4
                            }
                        ]
                    },
                    "scripts": [
                        {
                            "label": "马术检定",
                            "trigger": "attack",
                            "script": "await actor.rollAttributeTest(\"mashu\", { flavor: \"骑猎无双·冲撞\" });",
                            "active": true
                        }
                    ]
                }
            ]
        }
    }
]